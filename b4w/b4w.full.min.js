var b4w=function(a){var p={};a.module=p;var c={};a.register=function(a,c){if(p[a])throw Error('Module "'+a+'" already registered');p[a]=c};a.require=function(a,h){if(!p[a])throw Error('Module "'+a+'" not found');h=h||"__B4W_DEF_NS";c[h]||(c[h]=function(a){return function(b){var l=p[b];if(!l)throw Error('Module "'+b+'" not found');l.Kh||(l.Kh={});l.Kh[a]||(l.Kh[a]={},l(l.Kh[a],c[a]));return l.Kh[a]}}(h));return c[h](a)};a.module_check=function(a){return p[a]?!0:!1};return a}({});"object"==typeof module&&module.Zh&&(GLOBAL.b4w={module:{}});b4w.module.__version=function(a){function p(){return"29.04.2015 10:05:10"}a.version=function(){return"15.04"};a.type=function(){return"RELEASE"};a.date=p;a.timestamp=function(){var a=p(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.Zh&&b4w.module.__version(exports);b4w.module.__config=function(a,p){function c(){return b4w.module_check(a.Mb.pj)}function b(){for(var b=a.Mb,c=null,d=document.getElementsByTagName("script"),m=0;m<d.length;m++){for(var k=d[m].src,x=0;x<b.Jq.length;x++)if(0<=k.indexOf(b.Jq[x])){c=k;break}if(null!==c)break}c||(h.warn("Couldn't determine path to ancillary resources, fallback to the current page directory"),c=document.location.href);b=c.indexOf("?");0<=b&&(c=c.substring(0,b));return c.substring(0,c.lastIndexOf("/")+1)}var h=p("__print"),
d=p("__util");a.P_LOW=1;a.P_HIGH=2;a.P_ULTRA=3;a.P_CUSTOM=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.zv=d.wa(a.context);a.q={alpha_sort:!0,alpha_sort_threshold:.1,Sm:"5.03",gd:1E4,console_verbose:!1,do_not_load_resources:!1,Mk:!1,Op:1.5,Nw:10,background_color:[0,0,0,0],Tf:.01,resolution_factor:1,canvas_resolution_factor:1,Hk:3,allow_cors:!1,$l:!1,gj:!0,show_hud_debug_info:!1,nC:!0,Re:"DEPTH",anaglyph_use:!1,xk:!0,Di:.5,kd:!0,Xe:!0,Gg:!0,Pg:!0,zg:!0,$g:!0,Dg:!0,antialiasing:!0,smaa:!1,
wireframe_debug:!1,Rs:!1,Jg:!0,vi:!0,Ya:!0,tk:!0,water_dynamic:!0,shore_smoothing:!0,kh:!0,hd:1024,Pm:512,Pc:53,Gs:!0,precision:"highp",quality:a.P_HIGH,$k:!0,zy:!1,Zr:!1,wp:!1,Ls:!1,Lf:!1,yq:!1,wl:!1,Jp:!1,ID:!1,Ic:!1,allow_hidpi:!1,gyro_use:!1,Kp:!1,vm:!1,enable_selectable:!0,enable_outlining:!0};a.mw=d.wa(a.q);a.Hd={Ia:-1,Pp:!1,Gf:1};a.controls={xy:1/120};a.Id={dir:"ASSETS=../../assets/",ry:15,Dr:!0,Rm:!1,Kl:!1};a.Ju=d.wa(a.Id);a.Mb={shaders_dir:"",Mz:"include/",pj:"built_in_data",Jq:["b4w.min.js",
"b4w.full.min.js","src/b4w.js","USER_DEFINED_MODULE"],Pr:"./",smaa_search_texture_path:"",smaa_area_texture_path:""};a.sb={enabled:!0,gd:60,Pi:"",Yu:!1};a.Jy=d.wa(a.sb);a.Ii={Mj:1024,Cj:384};a.oz=d.wa(a.Ii);a.Tc={$n:!0,dk:!1,Ho:!1,bp:!1,xp:!1};a.Lz=d.wa(a.Tc);a.Ab={outlining_overview_mode:!1,Le:[1,.4,.05],Qc:1,jk:.2,lk:3.8,mk:1};a.Ll={enabled:!1,nA:"MAIN_OPAQUE",mA:0,Pz:"COLOR"};a.iw=d.wa(a.Ll);a.Fu=function(){var b=a.q,c=a.sb,d=a.Ii;switch(b.quality){case a.P_ULTRA:b.Re="DEPTH";b.shore_smoothing=
!0;b.Xe=!0;b.Gg=!0;b.Pg=!0;b.zg=!0;b.xk=!0;b.Di=1;b.kd=!0;b.Jg=!0;b.vi=!0;b.Ya=!0;b.tk=!0;b.resolution_factor=1.75;d.Mj=2048;b.Hk=3;b.gj=!0;b.Mk=!1;b.Pc=53;b.precision="highp";b.water_dynamic=!0;b.kh=!0;b.antialiasing=!0;b.smaa=!0;b.Dg=!0;b.$g=!0;b.allow_hidpi=!0;b.enable_outlining=!0;c.gd=120;break;case a.P_HIGH:b.Re="DEPTH";b.shore_smoothing=!0;b.Xe=!0;b.Gg=!0;b.Pg=!0;b.zg=!0;b.xk=!0;b.Di=.5;b.kd=!0;b.Jg=!0;b.vi=!0;b.Ya=!0;b.tk=!0;b.resolution_factor=1;d.Mj=1024;b.Hk=3;b.gj=!0;b.Mk=!1;b.Pc=53;b.precision=
"highp";b.water_dynamic=!0;b.kh=!0;b.antialiasing=!0;b.smaa=!1;b.Dg=!0;b.$g=!0;b.allow_hidpi=!1;b.enable_outlining=!0;c.gd=60;break;case a.P_LOW:b.Re="NONE",b.shore_smoothing=!1,b.Xe=!1,b.Gg=!1,b.Pg=!1,b.zg=!1,b.xk=!1,b.Di=.5,b.kd=!1,b.Jg=!1,b.vi=!1,b.Ya=!1,b.tk=!1,b.resolution_factor=1,d.Mj=512,b.Hk=2,b.gj=!1,b.Mk=!0,b.Pc=53,b.precision="mediump",b.water_dynamic=!1,b.kh=!1,b.antialiasing=!1,b.smaa=!1,b.Dg=!1,b.$g=!1,b.allow_hidpi=!1,b.enable_outlining=!1,c.gd=60}};a.set=function(b,c){switch(b){case "allow_cors":a.q.allow_cors=
c;break;case "allow_hidpi":a.q.allow_hidpi=c;break;case "alpha":a.context.alpha=c;break;case "alpha_sort":a.q.alpha_sort=c;break;case "alpha_sort_threshold":a.q.alpha_sort_threshold=c;break;case "anaglyph_use":a.q.anaglyph_use=c;break;case "animation_framerate":a.Hd.Ia=c;break;case "antialiasing":a.q.antialiasing=c;break;case "assets_dds_available":a.Id.Kl=c;break;case "assets_min50_available":a.Id.Rm=c;break;case "audio":a.Tc.$n=c;break;case "background_color":a.q.background_color=c;break;case "built_in_module_name":a.Mb.pj=
c;break;case "canvas_resolution_factor":a.q.canvas_resolution_factor=c;break;case "console_verbose":a.q.console_verbose=c;break;case "context_antialias":a.context.antialias=c;break;case "do_not_load_resources":a.q.do_not_load_resources=c;break;case "gyro_use":a.q.gyro_use=c;break;case "physics_enabled":a.sb.enabled=c;break;case "physics_uranium_path":a.sb.Pi=c;break;case "precision":a.q.precision=c;break;case "quality":a.q.quality=c;break;case "resolution_factor":a.q.resolution_factor=c;break;case "sfx_mix_mode":a.Tc.dk=
c;break;case "shaders_dir":a.Mb.shaders_dir=c;break;case "show_hud_debug_info":a.q.show_hud_debug_info=c;break;case "smaa":a.q.smaa=c;break;case "smaa_search_texture_path":a.Mb.smaa_search_texture_path=c;break;case "smaa_area_texture_path":a.Mb.smaa_area_texture_path=c;break;case "wireframe_debug":a.q.wireframe_debug=c;break;case "enable_selectable":a.q.enable_selectable=c;break;case "enable_outlining":a.q.enable_outlining=c;break;case "outlining_overview_mode":a.Ab.outlining_overview_mode=c;break;
default:h.error("Unknown config property: "+b)}};a.get=function(b){switch(b){case "allow_cors":return a.q.allow_cors;case "allow_hidpi":return a.q.allow_hidpi;case "alpha":return a.context.alpha;case "alpha_sort":return a.q.alpha_sort;case "alpha_sort_threshold":return a.q.alpha_sort_threshold;case "anaglyph_use":return a.q.anaglyph_use;case "animation_framerate":return a.Hd.Ia;case "antialiasing":return a.q.antialiasing;case "assets_dds_available":return a.Id.Kl;case "assets_min50_available":return a.Id.Rm;
case "audio":return a.Tc.$n;case "background_color":return a.q.background_color;case "built_in_module_name":return a.Mb.pj;case "canvas_resolution_factor":return a.q.canvas_resolution_factor;case "console_verbose":return a.q.console_verbose;case "context_antialias":return a.context.antialias;case "do_not_load_resources":return a.q.do_not_load_resources;case "gyro_use":return a.q.gyro_use;case "physics_enabled":return a.sb.enabled;case "physics_uranium_path":return a.sb.Pi;case "precision":return a.q.precision;
case "quality":return a.q.quality;case "resolution_factor":return a.q.resolution_factor;case "sfx_mix_mode":return a.Tc.dk;case "shaders_dir":return a.Mb.shaders_dir;case "show_hud_debug_info":return a.q.show_hud_debug_info;case "smaa":return a.q.smaa;case "smaa_search_texture_path":return a.Mb.smaa_search_texture_path;case "smaa_area_texture_path":return a.Mb.smaa_area_texture_path;case "wireframe_debug":return a.q.wireframe_debug;case "enable_selectable":return a.q.enable_selectable;case "enable_outlining":return a.q.enable_outlining;
case "outlining_overview_mode":return a.Ab.outlining_overview_mode;default:h.error("Unknown config property: "+b)}};a.reset=function(){a.context=d.wa(a.zv);a.q=d.wa(a.mw);a.Id=d.wa(a.Ju);a.sb=d.wa(a.Jy);a.Ii=d.wa(a.oz);a.Tc=d.wa(a.Lz);a.Ll=d.wa(a.iw)};a.Cq=c;a.Ez=function(){var d=a.Mb,l=a.sb;c()||""!=d.shaders_dir||(d.shaders_dir=b()+"../shaders/");if(c())d.smaa_search_texture_path="smaa_search_texture.png",d.smaa_area_texture_path="smaa_area_texture.png";else if(""==d.smaa_search_texture_path||""==
d.smaa_area_texture_path){var g=b()+d.Pr;d.smaa_search_texture_path=d.smaa_search_texture_path||g+"smaa_search_texture.png";d.smaa_area_texture_path=d.smaa_area_texture_path||g+"smaa_area_texture.png"}l.enabled&&""==l.Pi&&(g=b()+d.Pr,l.Pi=g+"uranium.js")};a.get_std_assets_path=function(){return a.Id.dir.replace("ASSETS=","")}};b4w.module.__anchors=function(a,p){function c(a,e){var c=document.createElement("div"),n=c.style;n.position="absolute";n.backgroundColor="black";n.borderRadius="20px 20px 20px 0px";n.boxShadow="0px 0px 10px rgb(180, 180, 200)";n.opacity=1;n.padding="8px 12px";n.lineHeight="15px";n.visibility="hidden";n.fontSize="12px";var u=E.parentElement;u.appendChild(c);var C=m.get_meta_tags(a),H=document.createElement("span"),k=H.style;H.innerHTML=C.title||a.name;k.fontWeight="bold";k.fontSize="12px";k.lineHeight=
"15px";k.color="#fff";k.fontFamily="Arial";d(H);c.appendChild(H);var f=C.description;if(f){var C=document.createElement("div"),G=C.style;G.position="absolute";G.bottom="0px";G.left="0px";G.backgroundColor="#000";G.borderRadius="20px 20px 20px 0px";G.boxShadow="0px 0px 10px rgb(180, 180, 200)";G.visibility="hidden";G.padding="8px 12px";G.overflow="hidden";G.lineHeight="15px";G.fontSize="12px";G.zIndex="2";c.appendChild(C);var v=document.createElement("span"),N=v.style;v.innerHTML=f;N.fontSize="12px";
N.fontFamily="Arial";N.fontWeight="bold";N.lineHeight="15px";N.color="#fff";N.visibility="hidden";C.appendChild(v);var g=!1,l=!1;u.addEventListener("click",function(a){if(!(g||l||A))if(a.target!=H&&a.target!=c||"hidden"!=G.visibility||1!=n.opacity)"visible"==G.visibility&&(n.visibility="visible",k.visibility="visible",G.visibility="hidden",N.visibility="hidden");else{n.visibility="hidden";k.visibility="hidden";G.visibility="visible";g=l=!0;a=c.offsetWidth-24;var v=c.offsetHeight-16,C=Math.min(e,b(f)),
d=h(f,C);C!=a?q.animate(a,C,200,function(a){a==C&&("visible"==G.visibility&&(N.visibility="visible"),g=!1);G.width=a+"px"}):g=!1;d!=v?q.animate(v,d,200,function(a){a==d&&("visible"==G.visibility&&(N.visibility="visible"),l=!1);G.height=a+"px"}):l=!1;l||g||(N.visibility="visible")}},!1)}return c}function b(a){var b=document.createElement("div"),e=document.createElement("span"),c=b.style;e.innerHTML=a;e.style.fontSize="12px";e.style.fontFamily="Arial";e.style.fontWeight="bold";e.style.color="#fff";
e.style.visibility="hidden";c.lineHeight="15px";b.appendChild(e);c.position="absolute";c.visibility="hidden";c.fontSize="12px";c.display="inline-block";c.lineHeight="15px";document.body.appendChild(b);a=b.offsetWidth+1;document.body.removeChild(b);return a}function h(a,b){var e=document.createElement("div"),c=document.createElement("span"),d=e.style;c.innerHTML=a;c.style.fontSize="12px";c.style.fontFamily="Arial";c.style.fontWeight="bold";c.style.color="#fff";c.style.visibility="hidden";d.lineHeight=
"15px";e.appendChild(c);d.position="absolute";d.visibility="hidden";d.fontSize="12px";d.display="inline-block";d.width=b+"px";d.lineHeight="15px";document.body.appendChild(e);c=e.offsetHeight;document.body.removeChild(e);return c}function d(a){a.style["-webkit-touch-callout"]="none";a.style["-webkit-user-select"]="none";a.style["-khtml-user-select"]="none";a.style["-moz-user-select"]="none";a.style["-ms-user-select"]="none";a.style["user-select"]="none";a.style.cursor="default"}function f(){for(var a=
0,b=0;b<n.length;b++)n[b].Ol&&a++;u=new Float32Array(3*a)}var l=p("__batch"),g=p("__camera"),m=p("__objects"),k=p("__print"),x=p("__renderer"),r=p("__scenes"),q=p("__time");p("__util");var z=p("__config").q,E=null,A=!1,n=[],u=new Float32Array(0),e=new Uint8Array(16),O=new Float32Array(3);a.init=function(a){E=a};a.append=function(a){var b;a:{for(b=0;b<n.length;b++)if(n[b].obj==a){b=!0;break a}b=!1}if(!b){b=a.b4w_anchor.detect_visibility&&Boolean(r.ia(r.fi(),"ANCHOR_VISIBILITY"));b={type:a.b4w_anchor.type,
obj:a,x:0,y:0,depth:0,yg:"out",Ol:b,element:null,ah:null,mu:a.b4w_anchor.max_width,zo:0};switch(b.type){case "ANNOTATION":b.element=c(a,b.mu);b.zo=b.element.offsetHeight;break;case "ELEMENT":b.element=document.getElementById(a.b4w_anchor.element_id),b.element||(k.warn("Anchor HTML element was not found, making it generic"),b.type="GENERIC")}n.push(b);f()}};a.remove=function(a){for(var b=0;b<n.length;b++){var e=n[b];if(e.obj==a){"ANNOTATION"==e.type&&E.parentElement.removeChild(e.element);n.splice(b,
1);f();break}}};a.update=function(){for(var a=0,b=0;b<n.length;b++){var e=n[b];e.Ol&&(u.set(e.obj.d.g,3*a),a++);var c,d=e,C=O;c=r.Jj(r.fi());C=g.project_point(c,d.obj.d.g,C);C[0]/=z.resolution_factor;C[1]/=z.resolution_factor;d=r.gq();C[0]/=d;C[1]/=d;c=C;C=c[0];d=c[1];c=c[2];if(C!=e.x||d!=e.y||c!=e.depth){switch(e.type){case "ANNOTATION":var H=e.element;H.style.left=Math.floor(C)+"px";H.style.top=Math.floor(d-e.zo)+"px";break;case "ELEMENT":H=e.element,H.style.left=Math.floor(C-H.offsetWidth/2)+"px",
H.style.top=Math.floor(d-H.offsetHeight/2)+"px"}e.x=C;e.y=d;e.depth=c;e.ah&&e.ah(C,d,e.yg,e.obj,H)}}0<a&&(a=r.ia(r.fi(),"ANCHOR_VISIBILITY").p[0].o,l.AA(a,u))};a.UA=function(){for(var a=0;a<n.length;a++){var b=n[a],c=b.obj,d=b.x,q=b.y,C=b.depth,C=0>d||0>q||0>C||1<C||r.is_hidden(c)||d>=E.clientWidth||q>=E.clientHeight?"out":"visible";if(b.Ol&&"out"!=C){var C=b,H=r.ia(r.fi(),"ANCHOR_VISIBILITY"),u=r.gq(),k=C.x*u,u=C.y*u,k=k*z.resolution_factor,u=u*z.resolution_factor,H=H.j;x.Kr(H.Td,k,H.height-u,2,
2,e);C=1020==e[0]+e[4]+e[8]+e[12]?"visible":"out"==C.yg||0==e[0]+e[4]+e[8]+e[12]?"covered":C.yg}if(C!=b.yg){switch(b.type){case "ANNOTATION":case "ELEMENT":var G=b.element;if(!G)break;"out"==C?(G.style.visibility="hidden",G.children.length&&(G.children[0].style.visibility="hidden"),"ANNOTATION"==b.type&&1<G.children.length&&(k=G.children[1],k.style.visibility="hidden",k.children.length&&(k.children[0].style.visibility="hidden"))):"visible"==C?(G.style.visibility="visible",G.children.length&&(G.children[0].style.visibility=
"visible"),G.style.opacity=1):(G.style.visibility="visible",G.style.opacity=.1,G.children.length&&(G.children[0].style.visibility="visible"),"ANNOTATION"==b.type&&1<G.children.length&&(k=G.children[1],k.style.visibility="hidden",k.children.length&&(k.children[0].style.visibility="hidden")))}b.yg=C;b.ah&&b.ah(d,q,b.yg,c,G)}}};a.attach_move_cb=function(a,b){for(var e=0;e<n.length;e++)n[e].obj==a&&(n[e].ah=b)};a.detach_move_cb=function(a){for(var b=0;b<n.length;b++)n[b].obj==a&&(n[b].ah=null)};a.cleanup=
function(){for(var a=0;a<n.length;a++){var b=n[a];"ANNOTATION"==b.type&&E.parentElement.removeChild(b.element)}n.length=0};a.Bq=function(a){return a.b4w_anchor?!0:!1};a.pause=function(){A=!0};a.resume=function(){A=!1}};b4w.module.__boundings=function(a,p){function c(a,b){for(var c=a[0],d=a[1],n=a[2],k=a[0],e=a[1],f=a[2],g=3;g<a.length;g+=3)var l=a[g],t=a[g+1],m=a[g+2],c=Math.max(c,l),d=Math.max(d,t),n=Math.max(n,m),k=Math.min(k,l),e=Math.min(e,t),f=Math.min(f,m);b.max_x=c;b.max_y=d;b.max_z=n;b.min_x=k;b.min_y=e;b.min_z=f;return b}function b(a,b){b||(b=new Float32Array(24));var c=a.max_x,d=a.max_y,n=a.max_z,k=a.min_x,e=a.min_y,f=a.min_z;b[0]=k;b[1]=e;b[2]=f;b[3]=c;b[4]=e;b[5]=f;b[6]=c;b[7]=d;b[8]=f;b[9]=k;b[10]=
d;b[11]=f;b[12]=k;b[13]=e;b[14]=n;b[15]=c;b[16]=e;b[17]=n;b[18]=c;b[19]=d;b[20]=n;b[21]=k;b[22]=d;b[23]=n;return b}function h(a,b,c){g.add(b,c,a.D);g.scale(a.D,.5,a.D);a.za=g.distance(a.D,b);return a}var d=p("__geometry"),f=p("__util"),l=p("__tsr"),g=p("vec3"),m=new Float32Array(24),k=new Float32Array(3),x=new Float32Array(3),r=new Float32Array(3);a.jp=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.SB=function(){return{max_x:1E12,min_x:-1E12,
max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12}};a.zd=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.Bp=function(a,b){var c=a.max_y,d=a.max_z,n=a.min_x,k=a.min_y,e=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,c);a.max_z=Math.max(b.max_z,d);a.min_x=Math.min(b.min_x,n);a.min_y=Math.min(b.min_y,k);a.min_z=Math.min(b.min_z,e)};a.Pu=c;a.pl=function(d,k,g){g||(g=a.zd());d=b(d,m);f.Me(d,k,d);return c(d,g)};a.Fw=b;a.HD=function(b,c,d){d||
(d=a.zd());var k=c.min_x,n=c.max_x,u=c.min_y,e=c.max_y,f=c.min_z;c=c.max_z;if(k>=b.max_x||n<=b.min_x||u>=b.max_y||e<=b.min_y||f>=b.max_z||c<=b.min_z)return d.min_x=-.1,d.max_x=.1,d.min_y=-.1,d.max_y=.1,d.min_z=-.2,d.max_z=-.1,d;d.min_x=Math.max(b.min_x,k);d.max_x=Math.min(b.max_x,n);d.min_y=Math.max(b.min_y,u);d.max_y=Math.min(b.max_y,e);d.min_z=Math.max(b.min_z,f);d.max_z=Math.min(b.max_z,c);return d};a.LD=function(b,c,d){d||(d=a.zd());var k=b.max_x-b.min_x,n=b.max_y-b.min_y,u=b.max_z-b.min_z;d.min_x=
b.min_x-.5*(c-1)*k;d.max_x=b.max_x+.5*(c-1)*k;d.min_y=b.min_y-.5*(c-1)*n;d.max_y=b.max_y+.5*(c-1)*n;d.min_z=b.min_z-.5*(c-1)*u;d.max_z=b.max_z+.5*(c-1)*u;return d};a.rl=function(b,c,d){d||(d=a.Wi());g.transformMat4(b.D,c,d.D);d.za=b.za*f.Om(c);return d};a.ql=function(a,b,c){c||(c={pf:new Float32Array(3),qf:new Float32Array(3),rf:new Float32Array(3),D:new Float32Array([0,0,0])});l.transform_vec3(a.D,b,c.D);g.copy(a.pf,c.pf);g.copy(a.qf,c.qf);g.copy(a.rf,c.rf);l.transform_dir_vec3(c.pf,b,c.pf);l.transform_dir_vec3(c.qf,
b,c.qf);l.transform_dir_vec3(c.rf,b,c.rf);return c};a.El=function(a,b){return{za:a,D:new Float32Array(b)}};a.Wi=function(){return{D:new Float32Array([0,0,0]),za:0}};a.Dl=function(a,b,c,d){return{pf:new Float32Array(a),qf:new Float32Array(b),rf:new Float32Array(c),D:new Float32Array([d[0],d[1],d[2]])}};a.Ru=function(){return{D:new Float32Array([0,0,0]),za:1E12}};a.Bw=function(a,b){var c=g.subtract(b.D,a.D,g.create());0==g.length(c)&&g.set(1,0,0,c);var d=g.normalize(c,g.create()),c=g.scale(d,a.za,g.create());
g.add(c,a.D,c);var n=g.scale(d,-a.za,g.create());g.add(n,a.D,n);var k=g.scale(d,b.za,g.create());g.add(k,b.D,k);var e=g.scale(d,-b.za,g.create());g.add(e,b.D,e);c=[c,n,k,e];d=g.normalize(d,g.create());n=c[0];k=c[0];for(e=1;e<c.length;e++){var f=g.dot(c[e],d);f<g.dot(n,d)&&(n=c[e]);f>g.dot(k,d)&&(k=c[e])}d=[n,k];c=d[0];d=d[1];a.D=g.scale(g.add(c,d,g.create()),.5,g.create());a.za=g.length(g.subtract(d,c,g.create()))/2};a.kp=function(a,b){var c=b.max_y,d=b.min_y,n=Math.max(0,c-d-2*a);return{za:a,height:n,
D:new Float32Array([0,(c+d)/2,0])}};a.mp=function(a,b){var c=b.max_y,d=b.min_y,n=Math.max(0,c-d);return{za:a,height:n,D:new Float32Array([0,(c+d)/2,0])}};a.lp=function(a,b){var c=b.max_y,d=b.min_y,n=Math.max(0,c-d);return{za:a,height:n,D:new Float32Array([0,(c+d)/2,0])}};a.WB=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.Vy=function(a){for(var b=0,c=0,d=0,n=0,k=0,e=0,f=0,g=0,l=0;l<a.submeshes.length;l++){var t=
a.submeshes[l];if(t.position.length){b=n=t.position[0];c=k=t.position[1];d=e=t.position[2];break}}for(l=0;l<a.submeshes.length;l++)for(var t=a.submeshes[l],t=t.position,m=0;m<t.length/3;m++)var h=t[3*m],C=t[3*m+1],H=t[3*m+2],b=Math.max(h,b),c=Math.max(C,c),d=Math.max(H,d),n=Math.min(h,n),k=Math.min(C,k),e=Math.min(H,e),f=Math.max(Math.sqrt(h*h+C*C+H*H),f),g=Math.max(Math.sqrt(h*h+H*H),g);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=n;a.b4w_bounding_box.max_y=c;a.b4w_bounding_box.min_y=k;a.b4w_bounding_box.max_z=
d;a.b4w_bounding_box.min_z=e;a.b4w_bounding_sphere_radius=f;a.b4w_bounding_cylinder_radius=g};a.wx=function(b){var c=b.subarray(0,3),f=b.subarray(6,9),l=b.subarray(12,15),n=b.subarray(18,21);b=g.subtract(f,c,k);g.normalize(b,b);var u=d.zx(c,f,l,x),u=g.cross(u,b,u);g.normalize(u,u);var e=g.create(),m=g.create();g.subtract(f,c,r);m[0]=g.dot(r,b);m[1]=g.dot(r,u);f=g.create();g.subtract(l,c,r);f[0]=g.dot(r,b);f[1]=g.dot(r,u);l=g.create();g.subtract(n,c,r);l[0]=g.dot(r,b);l[1]=g.dot(r,u);n=a.Wi();l=[e,
m,f,l];e=h(n,l[0],l[1]);for(n=2;n<l.length;n++)if(g.distance(e.D,l[n])>e.za){for(var I=e,e=l,m=l[n],f=n-1,I=h(I,m,e[0]),F=1;F<=f;F++)if(g.distance(I.D,e[F])>I.za){for(var t=I,I=e,y=m,L=e[F],C=F-1,t=h(t,y,L),H=0;H<=C;H++)if(g.distance(t.D,I[H])>t.za){var K=y,M=L,G=I[H],v=g.subtract(M,G,r),v=g.squaredLength(v),N=g.subtract(K,G,r),J=g.squaredLength(N),N=g.subtract(K,M,r),R=g.squaredLength(N),N=v*(J+R-v),V=J*(R+v-J),v=R*(v+J-R),J=N+V+v;g.copy(K,t.D);g.scale(t.D,N/J,t.D);g.scaleAndAdd(t.D,M,V/J,t.D);g.scaleAndAdd(t.D,
G,v/J,t.D);t.za=g.distance(t.D,K)}I=t}e=I}n=e;b=g.scale(b,n.D[0],r);g.scaleAndAdd(b,u,n.D[1],b);g.add(b,c,n.D);return n}};b4w.module.__compat=function(a,p){function c(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}function b(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function h(){return!window.ActiveXObject&&"ActiveXObject"in window}var d=p("__config"),f=p("__extensions"),l=p("__print"),
g=p("__util");a.yz=function(a){var k=d.Hd,x=d.q,r=d.context,q=d.Ii,z=d.Tc;x.hd=a.getParameter(a.MAX_TEXTURE_SIZE);x.Pm=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);var E=Boolean(f.rx());c("Firefox")&&d.Cq()&&(l.warn("Firefox detected for single HTML version, disable video textures."),x.Jp=!0);c("Firefox/28.0")&&(c("Linux")||c("Macintosh"))&&(l.warn("Firefox 28 detected, applying depth hack"),E=!1);c("iPad")||c("iPhone")?(l.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack and disable smaa. Disable ssao for performance. Disable video textures. Initialize WebAudio context with empty sound."),
r.alpha||(x.background_color[3]=1),x.Ls=!0,x.smaa=!1,x.Xe=!1,x.precision="highp",x.yq=!0):c("Mac OS X")&&c("Safari")&&!c("Chrome")&&(l.warn("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures."),z.Ho=!0,z.bp=!0);c("Windows")&&(c("Chrome/40")||c("Firefox/33")||c("Firefox/34")||c("Firefox/35")||c("Firefox/36"))&&(l.warn("Windows/Chrome40 or Firefox33-36 detected. Applying clear procedural skydome hack."),x.wl=!0);b()&&(l.warn("Mobile detected, applying various hacks for video textures."),
x.Lf=!0,c("iPad")||c("iPhone")||(l.warn("Mobile (not iOS) detected, disable playback rate for video textures."),z.xp=!0));(c("Firefox/35.0")||c("Firefox/36.0"))&&c("Windows")&&(l.warn("Windows/Firefox 35/36 detected, applying shadows slink hack"),x.Kp=!0);if(c("iPhone")||h())l.warn("iPhone or IE11 detected. Enable sequential video fallback for video textures."),x.Ic=!0;10>a.getParameter(a.MAX_VARYING_VECTORS)&&(l.warn("Not enough varyings, disable shadows on blend objects"),x.wp=!0);if(r=f.cq())c("Macintosh")&&
-1<a.getParameter(r.UNMASKED_RENDERER_WEBGL).indexOf("Intel HD Graphics 3000")&&(l.warn("OS X / Intel HD 3000 detected, applying depth hack"),E=!1),c("Windows")&&c("Chrome")&&-1<a.getParameter(r.UNMASKED_RENDERER_WEBGL).indexOf("Intel")&&(l.warn("Chrome / Windows / Intel GPU detected, applying cubemap mipamp/rgb hack"),x.vm=!0),-1<a.getParameter(r.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(r.UNMASKED_RENDERER_WEBGL).indexOf("Mali-400")&&(l.warn("ARM Mali-400 detected, applying depth and frames blending hacks"),
E=!1,k.Pp=!0),-1<a.getParameter(r.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(r.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T604")&&(l.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),x.precision="highp",x.Re="NONE"),-1<a.getParameter(r.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(r.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T760")&&(l.warn("ARM Mali-T760 detected, disable SSAO."),x.Xe=!1),-1<a.getParameter(r.UNMASKED_VENDOR_WEBGL).indexOf("Qualcomm")&&-1<
a.getParameter(r.UNMASKED_RENDERER_WEBGL).indexOf("Adreno")&&(l.warn("Qualcomm Adreno detected, applying shader constants hack."),x.Zr=!0,-1<a.getParameter(r.UNMASKED_RENDERER_WEBGL).indexOf("305")&&(l.warn('Qualcomm Adreno305 detected, set "highp" precision.'),x.precision="highp"),-1<a.getParameter(r.UNMASKED_RENDERER_WEBGL).indexOf("330")&&(l.warn('Qualcomm Adreno330 detected, set "highp" precision.'),x.precision="highp")),-1<a.getParameter(r.UNMASKED_VENDOR_WEBGL).indexOf("NVIDIA")&&-1<a.getParameter(r.UNMASKED_RENDERER_WEBGL).indexOf("Tegra 3")&&
(l.warn("NVIDIA Tegra 3 detected, force low quality for B4W_LEVELS_OF_QUALITY nodes."),x.$l=!0);0==a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(l.warn("Vertex textures are not allowed. Disabling vertex textures"),x.$k=!1);x.allow_hidpi&&1<window.devicePixelRatio&&(l.log("%cENABLE HIDPI MODE","color: #00a"),x.resolution_factor=1,x.smaa=!1);E||(x.Jg=!1,x.vi=!1,x.Ya=!1,x.water_dynamic=!1,x.shore_smoothing=!1,x.kh=!1,x.smaa=!1);x.Gs=Boolean(f.dq());x.Uh=E;k=g.clamp(a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),
128,Infinity);x.Pc=g.trunc((k-50)/4);x.tD=g.trunc((k-50)/2);0===a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision&&(x.precision="mediump");h()&&(l.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),q.Cj=512);128>=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS)&&(l.warn("Not enough fragment uniforms, force low quality for B4W_LEVELS_OF_QUALITY nodes."),x.$l=!0)};a.detect_mobile=b;a.Du=function(){c("Firefox/35.0")&&c("Windows")&&(l.warn("Windows/Firefox 35 detected, forcing context's alpha"),
d.context.alpha=!0)};a.xm=h};b4w.module.__constraints=function(a,p){function c(a){var b={};b.type=a;return b}function b(a,b){a.Oa&&a.Oa.O&&d(a.Oa.O,a);b.O&&h(b.O,a);a.Oa=b}function h(a,b){if(-1==a.yc.indexOf(b))a.yc.push(b);else throw"Descendant object override is forbidden";}function d(a,b){var c=a.yc.indexOf(b);if(-1!=c)a.yc.splice(c,1);else throw"No descendant object";}function f(a,b,c){switch(b.type){case 1:var e=a.d.quat,d=b.O.d.T;c=b.O.d.quat;b.ac?(z.copy(b.ac,e),z.multiply(c,e,e)):z.copy(c,e);q.transformMat4(b.offset,
d,a.d.g);a.d.scale=b.yk*b.O.d.scale;break;case 9:var f=a.d.g,e=a.d.quat,d=b.O.d.T;c=b.O.d.quat;z.multiply(z.invert(b.cg,b.cg),e,e);z.multiply(c,e,e);q.transformMat4(b.offset,d,f);z.copy(c,b.cg);break;case 10:f=a.d.g;e=a.d.quat;d=b.O.d.T;c=b.O.d.quat;z.multiply(z.invert(b.cg,b.cg),e,e);z.multiply(c,e,e);q.transformMat4(b.offset,d,f);z.copy(c,b.cg);f=a.d.quat;e=z.multiply(b.O.d.quat,b.ac,F);e=r.Xp(e,A);f=r.Xp(f,n);r.rotate_eye_camera(a,x.se(f[0],e[0]+b.pv,e[0]+b.ov),x.se(f[1],e[1]+b.nv,e[1]+b.qv));
break;case 12:var f=a.d.g,e=a.d.quat,d=b.O.d.T,t=b.O.d.g,h=b.Rz,L=u,O=F;q.transformMat4(b.offset,d,L);x.smooth_v(L,f,c,h,f);d=u;q.sub(t,f,d);q.normalize(d,d);var p=e,f=C,t=f.subarray(0,3),L=f.subarray(3,6),aa=f.subarray(6,9);q.copy(d,L);q.negate(L,L);q.normalize(L,L);Boolean(.999999<Math.abs(q.dot(d,x.AXIS_Y)))?(d=E.fromQuat(z.normalize(p,O),H),q.copy(d.subarray(0,3),t)):q.cross(x.AXIS_Y,L,t);q.normalize(t,t);q.cross(t,L,aa);q.normalize(aa,aa);z.fromMat3(f,O);z.normalize(O,O);x.ds(O,e,c,.16*h,e);
break;case 2:e=a.d.quat;f=I;c=F;m(b.O,b.Wu,!0,f,c);b.ac?(z.copy(b.ac,e),z.multiply(c,e,e)):z.copy(c,e);a.d.scale=b.yk*f[3];x.transform_vec3(b.offset,f[3],c,f,a.d.g);break;case 3:f=a.d.g;e=a.d.quat;c=b.O.d.g;l(f,e,c);break;case 4:f=a.d.g;e=a.d.quat;c=b.target;l(f,e,c);break;case 5:f=a.d.g;e=a.d.quat;c=b.O.d.g;l(f,e,c);e=q.dist(f,c);if(e=e>b.ri?e-b.ri:e<b.si?e-b.si:0)q.sub(c,f,u),q.normalize(u,u),q.scale(u,e,u),q.add(f,u,f);break;case 6:f=a.d.g;e=a.d.quat;c=b.target;l(f,e,c);e=q.dist(f,c);if(e=e>b.ri?
e-b.ri:e<b.si?e-b.si:0)q.sub(c,f,u),q.normalize(u,u),q.scale(u,e,u),q.add(f,u,f);break;case 7:d=b.O.d.T;q.transformMat4(b.offset,d,a.d.g);break;case 8:t=b.O.d.g;f=a.d.g;q.add(t,b.offset,f);break;case 13:e=a.d.quat;d=b.O.d.T;c=b.O.d.quat;b.ac?(z.copy(b.ac,e),z.multiply(c,e,e)):z.copy(c,e);q.transformMat4(b.offset,d,a.d.g);break;case 11:f=b.O.d;c=k.create_sep(f.g,f.scale,f.quat,y);k.multiply(c,b.As,c);f=a.d.g;f[0]=c[0];f[1]=c[1];f[2]=c[2];a.d.scale=c[3];e=a.d.quat;e[0]=c[4];e[1]=c[5];e[2]=c[6];e[3]=
c[7];break;case 14:c=b.O,e=r.ux(c),f=a.d.g,h=r.Kj(e,"TOP"),O=r.Kj(e,"BOTTOM"),d=h-O,b.Pq?(t=r.Kj(e,"LEFT"),f[0]=t+d*b.Fm):(t=r.Kj(e,"RIGHT"),f[0]=t-d*b.Fm),f[2]=b.ys?-(h-d*b.In):-(O+d*b.In),r.dy(e)?f[1]=-b.distance:(f[1]=-1,q.normalize(f,f),q.scale(f,b.distance/Math.abs(f[1]),f)),k.transform_dir_vec3(f,c.d.ub,f),q.add(c.d.g,f,f),e=a.d.quat,b.ac?(z.copy(b.ac,e),z.multiply(c.d.quat,e,e)):z.copy(c.d.quat,e)}"CAMERA"==a.d.type&&(f=x.AXIS_Y,10==b.type&&(c=b.O.d.quat,f=q.transformQuat(f,c,K)),r.On(a),g(a,
f))}function l(a,b,c){var d=u;x.quat_to_dir(b,x.AXIS_MY,d);q.normalize(d,d);var C=e;q.subtract(c,a,C);q.normalize(C,C);a=x.kz(d,C,I);z.multiply(a,b,b);z.normalize(b,b)}function g(a,b){var c=a.d,d=c.quat,C=x.quat_to_dir(c.quat,x.AXIS_Y,u);q.normalize(C,C);if(.999999<Math.abs(q.dot(b,C)))C=z.identity(F);else{var f=q.cross(b,C,e);q.normalize(f,f);if(c.da==r.MS_TARGET_CONTROLS)c.Gk&&q.negate(f,f);else{var n=x.quat_to_dir(c.quat,x.AXIS_Z,O);0<q.dot(n,b)&&q.negate(f,f)}c=x.quat_to_dir(c.quat,x.AXIS_X,O);
q.normalize(c,c);var n=x.clamp(q.dot(c,f),-1,1),k=Math.acos(n),C=-.999999>=n?z.setAxisAngle(C,k,F):z.rotationTo(c,f,F);z.normalize(C,C)}z.multiply(C,d,d);r.On(a)}function m(a,b,c,e,d){var C=a.d,f=C.Ff,n=C.Bc[b];b=n.Th;a=a.pose.bones[n.en];var n=a.ro,H=I,g=C.wc,u=C.vc,l=C.pc,m=C.oc,h=g[4*b+1],x=g[4*b+2],K=g[4*b+3],r=u[4*b+1],q=u[4*b+2],A=u[4*b+3];H[0]=(1-f)*g[4*b]+f*u[4*b];H[1]=(1-f)*h+f*r;H[2]=(1-f)*x+f*q;H[3]=(1-f)*K+f*A;g=F;u=t;g[0]=l[4*b];g[1]=l[4*b+1];g[2]=l[4*b+2];g[3]=l[4*b+3];u[0]=m[4*b];u[1]=
m[4*b+1];u[2]=m[4*b+2];u[3]=m[4*b+3];z.slerp(g,u,f,g);f=y;k.set_transcale(H,f);k.set_quat(g,f);c?(c=L,k.translate(n,a.ju,c),k.multiply(f,c,f)):k.multiply(f,n,f);k.multiply(C.ub,f,f);e[0]=f[0];e[1]=f[1];e[2]=f[2];e[3]=f[3];d&&(d[0]=f[4],d[1]=f[5],d[2]=f[6],d[3]=f[7])}var k=p("__tsr"),x=p("__util"),r=p("__camera"),q=p("vec3");p("vec4");var z=p("quat"),E=p("mat3");p("mat4");a.tB=1;a.sB=2;a.xB=3;a.yB=4;a.nB=5;a.oB=6;a.uB=7;a.mB=8;a.rB=9;a.qB=10;a.Ad=11;a.pB=12;a.vB=13;a.wB=14;var A=new Float32Array(2),
n=new Float32Array(2),u=new Float32Array(3),e=new Float32Array(3),O=new Float32Array(3),I=new Float32Array(4),F=new Float32Array(4),t=new Float32Array(4),y=new Float32Array(16),L=new Float32Array(16),C=new Float32Array(9),H=new Float32Array(9),y=new Float32Array(8),K=new Float32Array(3);a.Bo=function(a,e,v,d,C){var n=c(1);n.O=e;n.offset=new Float32Array(v);n.ac=d?new Float32Array(d):null;n.yk=C;b(a,n);f(a,n,0)};a.Ao=function(a,e,d,C,n,k){var H=c(2);H.O=e;H.Wu=d;H.offset=new Float32Array(C);H.ac=n?
new Float32Array(n):null;H.yk=k;b(a,H);f(a,H,0)};a.vu=function(a,e,d,C){var n=c(9),k=a.d.quat,H=e.d.quat;n.O=e;n.offset=new Float32Array(d);n.cg=new Float32Array(H);C&&(z.copy(C,k),z.multiply(H,k,k));b(a,n);f(a,n,0)};a.uu=function(a,e,d,C,n,k,H,g){var t=c(10),u=a.d.quat,l=e.d.quat;t.O=e;t.offset=new Float32Array(d);t.cg=new Float32Array(l);t.ov=x.angle_wrap_0_2pi(n);t.pv=x.angle_wrap_0_2pi(k);t.qv=x.angle_wrap_periodic(H,-Math.PI,Math.PI);t.nv=x.angle_wrap_periodic(g,-Math.PI,Math.PI);C?(t.ac=new Float32Array(C),
z.copy(C,u),z.multiply(l,u,u)):t.ac=z.create();b(a,t);f(a,t,0)};a.tu=function(a,e,d,C){var n=c(12);n.O=e;n.offset=new Float32Array(d);n.Rz=C;b(a,n);f(a,n,0)};a.xu=function(a,e,d,C){var n=c(13);n.O=e;n.offset=new Float32Array(d);n.yk=1;n.ac=C?new Float32Array(C):null;b(a,n);f(a,n,0)};a.OB=h;a.AD=d;a.zu=function(a,e){var d=c(3);d.O=e;b(a,d);f(a,d,0)};a.Au=function(a,e){var d=c(4);d.target=new Float32Array(e);b(a,d);f(a,d,0)};a.qu=function(a,e,d,C){var n=c(5);n.O=e;n.si=d;n.ri=C;b(a,n);f(a,n,0)};a.ru=
function(a,e,d,C){var n=c(6);n.target=new Float32Array(e);n.si=d;n.ri=C;b(a,n);f(a,n,0)};a.wu=function(a,e,d){var C=c(7);C.O=e;C.offset=new Float32Array(d);b(a,C);f(a,C,0)};a.pu=function(a,e,d){var C=c(8);C.O=e;C.offset=new Float32Array(d);b(a,C);f(a,C,0)};a.ou=function(a,e,d){var C=c(11);C.O=e;C.As=new Float32Array(d);b(a,C);f(a,C,0)};a.append_stiff_viewport=function(a,e,d){var C=c(14);C.O=e;if("left"in d)C.Pq=!0,C.Fm=d.left;else if("right"in d)C.Pq=!1,C.Fm=d.right;else{m_print.error("append_stiff_viewport: Wrong positioning params");
return}if("top"in d)C.ys=!0,C.In=d.top;else if("bottom"in d)C.ys=!1,C.In=d.bottom;else{m_print.error("append_stiff_viewport: Wrong positioning params");return}"distance"in d?(C.distance=d.distance,C.ac="rotation"in d?new Float32Array(d.rotation):null,b(a,C),f(a,C,0)):m_print.error("append_stiff_viewport: Wrong positioning params")};a.IA=function(a,b){a.Oa&&f(a,a.Oa,b)};a.jz=l;a.correct_up=g;a.fv=function(a){return a.Oa?!0:!1};a.remove=function(a){a.Oa.O&&d(a.Oa.O,a);a.Oa=null};a.Vd=function(a){return a.Oa?
a.Oa.type:null};a.get_parent=function(a){return a.Oa&&a.Oa.O?a.Oa.O:null};a.Ud=function(a){return a.Oa&&11==a.Oa.type?a.Oa.As:null};a.mx=m};b4w.module.__controls=function(a,p){function c(a){return{type:a,value:0,ba:null,Lm:null,Km:null,Zj:null,Nc:!1,key:0,gc:"",zl:null,Vm:!1,yl:function(){},xl:null,dp:function(){},pd:null,zn:new Float32Array(3),Rl:new Float32Array(3),Jm:!1,Jr:function(){},axis:"",uc:0,Bh:new Float32Array(3),uk:new Float32Array(4),threshold:0,Hr:new Float32Array(4),jj:0,ij:0,Rr:0,kj:0,Gc:0,repeat:!1,Io:!1,Pj:0,Oj:0,Nj:0,om:0,nm:0,mm:0}}function b(a,b){var B;if(a.Zj){B=a.Lm;for(var e=a.Km,c=0;c<B.length;c++)e[c]=B[c].value;
B=a.Zj(e)}else B=!1;B||(a.value=Number(b))}function h(a){a=H.indexOf(a);-1<a?H.splice(a,1):u.error("Wrong object")}function d(a,b){for(var B=0,e=0;e<b.length;e++)for(var c=b[e].me,d=0;d<c.length;d++)for(var C=c[d].md,v=0;v<C.length;v++)C[v]===a&&B++;return B}function f(a,b){switch(a.type){case 80:e.remove_collision_test(a.zl,a.gc,a.yl);a.Nc=!0;break;case 90:e.clear_collision_impulse_test(a.xl);a.Nc=!0;break;case 100:e.remove_ray_test(a.pd,a.gc,a.zn,a.Rl,a.Jm);a.Nc=!0;break;case 130:a.Nc=!0}var B=
b.indexOf(a);-1<B&&b.splice(B,1)}function l(a){for(var B=0;B<K.length;B++){var e=K[B];20==e.type&&a.keyCode==e.key&&b(e,1)}ia&&a.preventDefault();ya&&ya(a)}function g(a){for(var B=0;B<K.length;B++){var e=K[B];20==e.type&&0==a.keyCode&&16==e.key&&b(e,0);20==e.type&&a.keyCode==e.key&&b(e,0)}ia&&a.preventDefault();ya&&ya(a)}function m(a){var B=!1,e=null;v=a.clientX;N=a.clientY;for(var c=0;c<K.length;c++){var d=K[c];50==d.type&&(b(d,1),d.ba=a.which);160==d.type&&(B||(e=O.pick_object(a.clientX,a.clientY),
B=!0),d.value=e==d.pd?1:0)}S&&a.preventDefault();ba&&ba(a)}function k(a){for(var B=0;B<K.length;B++){var e=K[B];50==e.type&&b(e,0);160==e.type&&e.Io&&(e.value=0)}S&&!qa&&a.preventDefault();ba&&ba(a)}function x(a){var B=a.clientX,e=a.clientY;v=B;N=e;for(var c=B-J,d=e-R,C=Math.sqrt(c*c+d*d),f=0;f<K.length;f++){var n=K[f];if(40===n.type)switch(n.axis){case "X":b(n,c);n.ba=B;break;case "Y":b(n,d);n.ba=e;break;case "XY":b(n,C),n.ba[0]=B,n.ba[1]=e}}S&&!qa&&a.preventDefault();ba&&ba(a)}function r(a){var B=
a.wheelDelta||-40*a.detail,B=B*L.xy;G+=B;for(B=0;B<K.length;B++){var e=K[B];30===e.type&&b(e,G)}P&&a.preventDefault();Y&&Y(a)}function q(a){var b=a.targetTouches;if(1==b.length){for(var e=b[0],b=e.pageX,e=e.pageY,c=!1,d=null,C=0;C<K.length;C++){var v=K[C];160==v.type&&(c||(d=O.pick_object(b,e),c=!0),v.value=d==v.pd)}U[0]=b;U[1]=-1;Z[0]=e;Z[1]=-1}else 1<b.length&&(w=ha=A(b),U[0]=b[0].pageX,U[1]=b[1].pageX,Z[0]=b[0].pageY,Z[1]=b[1].pageY);V.set(U);ca.set(Z);B&&B(a)}function z(e){var c=e.targetTouches;
if(0!==c.length){if(1===c.length){V[0]=c[0].pageX;V[1]=-1;ca[0]=c[0].pageY;ca[1]=-1;var c=V[0]-U[0],d=ca[0]-Z[0],C=Math.sqrt(c*c+d*d);if(-1!=U[1]&&-1!=Z[1]){var v=V[0]-U[1],n=ca[0]-Z[1],f=Math.sqrt(v*v+n*n);f<C&&(c=v,d=n,C=f)}for(f=0;f<K.length;f++){var G=K[f];if(60===G.type)switch(G.ba=a.PL_SINGLE_TOUCH_MOVE,G.axis){case "X":b(G,c);break;case "Y":b(G,d);break;case "XY":b(G,C)}}}else if(1<c.length){V[0]=c[0].pageX;V[1]=c[1].pageX;ca[0]=c[0].pageY;ca[1]=c[1].pageY;w=A(c);C=w-ha;v=T;v[0]=(V[0]+V[1])/
2;v[1]=(ca[0]+ca[1])/2;n=aa;n[0]=(U[0]+U[1])/2;n[1]=(Z[0]+Z[1])/2;var k,c=v[0],d=v[1],f=n[0],G=n[1];k=Math.sqrt((c-f)*(c-f)+(d-G)*(d-G));for(f=0;f<K.length;f++)if(G=K[f],70===G.type&&Math.abs(k)<Math.abs(C)&&(G.ba=a.PL_MULTITOUCH_MOVE_ZOOM,b(G,C)),60===G.type&&Math.abs(k)>Math.abs(C))switch(G.ba=a.PL_MULTITOUCH_MOVE_PAN,G.axis){case "X":c=v[0]-n[0];b(G,c);break;case "Y":d=v[1]-n[1];b(G,d);break;case "XY":b(G,k)}}ga&&e.preventDefault();B&&B(e)}}function E(a){for(var B=0;B<K.length;B++){var e=K[B];
if(170==e.type||180==e.type)e.Oj=a.beta,e.Pj=a.gamma,e.Nj=a.alpha,e.value||(e.om=a.gamma,e.nm=a.beta,e.mm=a.alpha,b(e,1))}}function A(a){var b=a[0],B=a[1];a=b.pageX;var b=b.pageY,e=B.pageX,B=B.pageY;return Math.sqrt((a-e)*(a-e)+(b-B)*(b-B))}var n=p("__config"),u=p("__print"),e=p("__physics"),O=p("__scenes"),I=p("__time"),F=p("__util"),t=p("vec3"),y=p("quat"),L=n.controls,C=n.q,H=[],K=[],M={},G=0,v=0,N=0,J=0,R=0,V=new Float32Array(2),ca=new Float32Array(2),U=new Float32Array(2),Z=new Float32Array(2),
T=new Float32Array(2),aa=new Float32Array(2),w=0,ha=0,ma=!1,fa=0,ia=!1,S=!1,P=!1,ga=!1,qa=!1,ya=null,ba=null,Y=null,B=null;a.CT_CONTINUOUS=10;a.CT_TRIGGER=20;a.CT_SHOT=30;a.CT_LEVEL=40;a.PL_SINGLE_TOUCH_MOVE=0;a.PL_MULTITOUCH_MOVE_ZOOM=1;a.PL_MULTITOUCH_MOVE_PAN=2;a.update=function(B,e){for(var c=0;c<K.length;c++){var d=K[c],C=B,f=e;if(f)switch(d.type){case 110:var n=d.pd,k=n.d.g,n=n.d.quat,g=t.dist(d.Bh,k),u=d.Hr;y.invert(d.uk,u);y.multiply(n,u,u);y.normalize(u,u);u=Math.abs(2*Math.acos(u[3]));g/=
f;d.jj=F.smooth(g,d.jj,f,.3);d.ba[0]=g;g=u/f;d.ij=F.smooth(g,d.ij,f,.3);d.ba[1]=g;d.jj>=d.threshold||d.ij>=d.Rr?b(d,1):b(d,0);t.copy(k,d.Bh);y.copy(n,d.uk);d.uc=C;break;case 120:n=d.pd;k=n.d.g;n=Math.abs(k[1]-d.Bh[1])/f;d.kj=F.smooth(n,d.kj,f,.3);d.ba=n;d.kj>=d.threshold?b(d,1):b(d,0);t.copy(k,d.Bh);d.uc=C;break;case 130:!d.Nc&&0<=d.Gc&&C-d.uc>=d.Gc&&(b(d,1),d.repeat?d.uc=C:d.Gc=-d.Gc);break;case 140:d.uc||(d.uc=C);b(d,C-d.uc);d.uc=C;break;case 150:b(d,C);break;case 170:d.ba[0]=Math.PI*(d.Pj-d.om)/
180;d.ba[1]=Math.PI*(d.Oj-d.nm)/180;d.ba[2]=Math.PI*(d.Nj-d.mm)/180;d.om=d.Pj;d.nm=d.Oj;d.mm=d.Nj;break;case 180:d.ba[0]=Math.PI*d.Pj/180,d.ba[1]=Math.PI*d.Oj/180,d.ba[2]=Math.PI*d.Nj/180}}for(c=0;c<H.length;c++)for(f=H[c],d=f.me,C=0;C<d.length;C++)if(k=d[C],k.Cs!=fa){k.Cs=fa;for(var n=k,g=n.md,u=n.tz,l=0;l<g.length;l++)u[l]=g[l].value;var n=n.ky(u),g=k,u=g.Mq,m=l=void 0;switch(g.type){case a.CT_CONTINUOUS:n?m=l=1:1==u?m=l=-1:l=0;break;case a.CT_TRIGGER:n&&-1==u?m=l=1:n||1!=u?l=0:m=l=-1;break;case a.CT_SHOT:n&&
-1==u?m=l=1:n||1!=u?l=0:(l=0,m=-1);break;case a.CT_LEVEL:l=g.Lq!=n?1:0;break;default:F.ma("Wrong sensor manifold type: "+g.type)}m&&(g.Mq=m);if(g=l)if(u=f==M?null:f,ma=!1,k.callback(u,k.id,g,k.Zu),k.Lq=n,ma){c=-1;break}}for(c=0;c<H.length;c++)for(f=H[c],d=f.me,C=0;C<d.length;C++)for(k=d[C],f=k.md,k=0;k<f.length;k++)switch(n=f[k],n.type){case 30:b(n,0);break;case 40:b(n,0);break;case 60:b(n,0);break;case 70:b(n,0);break;case 130:b(n,0)}G=0;J=v;R=N;U.set(V);Z.set(ca);ha=w;fa++};a.create_custom_sensor=
function(a){var B=c(10);b(B,a);return B};a.create_keyboard_sensor=function(a){var b=c(20);b.key=a;return b};a.create_collision_sensor=function(a,B,e){if(!a||!a.l)return u.error("Wrong collision object"),null;var d=c(80);d.zl=a;d.gc=B||"ANY";d.Vm=e||!1;d.yl=function(a,B){b(d,a);a&&B&&e&&(d.ba=d.ba||new Float32Array(3),d.ba[0]=B[0],d.ba[1]=B[1],d.ba[2]=B[2])};d.Nc=!0;return d};a.create_collision_impulse_sensor=function(a){if(!a||!a.l)return u.error("Wrong collision impulse object"),null;var B=c(90);
B.xl=a;B.dp=function(a){b(B,a)};B.Nc=!0;return B};a.create_ray_sensor=function(a,B,e,d,C){if(!a)return u.error("Wrong collision object"),null;var v=c(100);v.pd=a;v.zn=B;v.Rl=e;v.Jm=d;v.gc=C||"ANY";v.Jr=function(a,B){b(v,a);a&&(v.ba=B)};v.Nc=!0;return v};a.create_mouse_click_sensor=function(){return c(50)};a.create_mouse_wheel_sensor=function(){return c(30)};a.create_mouse_move_sensor=function(a){var b=c(40);b.axis=a||"XY";b.ba="XY"==b.axis?new Float32Array(2):0;return b};a.create_touch_move_sensor=
function(a){var b=c(60);b.axis=a||"XY";b.ba=0;return b};a.create_touch_zoom_sensor=function(){var a=c(70);a.ba=0;return a};a.create_motion_sensor=function(a,b,B){if(!a)return u.error("Wrong collision object"),null;var e=c(110);e.pd=a;var d=a.d.g;a=a.d.quat;e.Hr=new Float32Array(4);e.Bh=new Float32Array(d);e.uk=new Float32Array(a);e.jj=0;e.ij=0;e.threshold=b;e.Rr=B;e.uc=0;e.ba=new Float32Array([0,0]);return e};a.create_vertical_velocity_sensor=function(a,b){if(!a)return u.error("Wrong collision object"),
null;var B=c(120);B.pd=a;var e=a.d.quat;B.Bh=new Float32Array(a.d.g);B.uk=new Float32Array(e);B.kj=0;B.threshold=b;B.uc=0;B.ba=0;return B};a.create_timer_sensor=function(a,b){var B=c(130);B.Gc=a;B.repeat=b;B.Nc=!0;return B};a.reset_timer_sensor=function(a,b,B,e){a=a||M;a=a.Kc;if(!a||!a[b])return u.error("reset_timer_sensor(): wrong object"),null;b=a[b].md[B];if(!b)return u.error("reset_timer_sensor(): sensor not found"),null;b.uc=I.Og();b.Gc=e};a.create_elapsed_sensor=function(){var a=c(140);a.uc=
0;return a};a.create_gyro_delta_sensor=function(){var a=c(170);a.ba=new Float32Array(3);return a};a.create_gyro_angles_sensor=function(){var a=c(180);a.ba=new Float32Array(3);return a};a.create_timeline_sensor=function(){return c(150)};a.create_selection_sensor=function(a,b){var B=c(160);B.pd=a;B.Io=b;return B};a.sz=b;a.get_sensor_value=function(a,b,B){a=a||M;a=a.Kc;if(!a||!a[b])return u.error("get_sensor_value(): wrong object"),null;b=a[b].md[B];return b?b.value:(u.error("get_sensor_value(): sensor not found"),
null)};a.get_sensor_payload=function(a,b,B){a=a||M;a=a.Kc;if(!a||!a[b])return u.error("get_sensor_payload(): wrong object"),null;b=a[b].md[B];return b?b.ba:(u.error("get_sensor_payload(): sensor not found"),null)};a.cleanup=function(){H=[];K=[];M={}};a.check_sensor_manifold=function(a,b){a=a||M;if(!a.Kc)return!1;if(b&&a.Kc[b])return!0;if(!b)for(var B in a.Kc)return!0;return!1};a.remove_sensor_manifold=function(a,b){a=a||M;var B=a.Kc;if(B){var e=a.me;if(b){var c=B[b];if(c){for(var C=c.md,v=0;v<C.length;v++)1===
d(C[v],H)&&f(C[v],K);delete B[b];c=e.indexOf(c);-1<c?e.splice(c,1):F.ma("Incorrect manifolds array");Object.getOwnPropertyNames(B).length||h(a)}}else{for(b in B){c=B[b];C=c.md;for(v=0;v<C.length;v++)1===d(C[v],H)&&f(C[v],K);delete B[b];c=e.indexOf(c);-1<c?e.splice(c,1):F.ma("Incorrect manifolds array")}h(a);ma=!0}}};a.create_sensor_manifold=function(a,b,B,c,C,v,n){a=a||M;a.Kc=a.Kc||{};a.me=a.me||[];var G=a.Kc,k=a.me,g=G[b];if(g){c=g.md;for(var u=0;u<c.length;u++)1===d(c[u],H)&&f(c[u],K);g=k.indexOf(g);
-1<g?k.splice(g,1):F.ma("Incorrect manifolds array")}B={id:b,type:B,md:c.slice(0),ky:C,tz:Array(c.length),callback:v,Zu:n,Mq:-1,Lq:0,Cs:-1};G[b]=B;k.push(B);-1==H.indexOf(a)&&H.push(a);a=B.md;for(b=0;b<a.length;b++){G=a[b];if(G.Nc){switch(G.type){case 80:e.append_collision_test(G.zl,G.gc,G.yl,G.Vm);break;case 90:e.apply_collision_impulse_test(G.xl,G.dp);break;case 100:e.append_ray_test(G.pd,G.gc,G.zn,G.Rl,G.Jm,G.Jr);break;case 130:G.uc=I.Og(),0>G.Gc&&(G.Gc=-G.Gc)}G.Nc=!1}-1==K.indexOf(G)&&K.push(G)}ma=
!0};a.Ml=function(a){for(var b=0;b<a.length;b++)if(!a[b])return a[b];return a[a.length-1]};a.lw=function(a){for(var b=0;b<a.length;b++)if(a[b])return a[b];return a[a.length-1]};a.reset=function(){for(var a=0;a<H.length;a++){var b=H[a],B=b.Kc,b=b.me,e;for(e in B)delete B[e];b.splice(0,b.length)}for(a=0;a<K.length;a++)f(K[a],K),a--;H.splice(0,H.length)};a.debug=function(){u.log(String(H.length)+" objects with manifolds",H);u.log(String(K.length)+" sensors",K);for(var a=[],b=[],B=0;B<K.length;B++){var e=
K[B];80==e.type&&a.push(e);100==e.type&&b.push(e)}u.log(String(a.length)+" collision sensors",a);u.log(String(b.length)+" ray sensors",b)};a.register_keyboard_events=function(a,b){a.addEventListener("keydown",l,!1);a.addEventListener("keyup",g,!1);ia=b};a.register_mouse_events=function(a,b,B){if(B)var e=window;else e=a,e.addEventListener("mouseout",k,!1);a.addEventListener("mousedown",m,!1);e.addEventListener("mousemove",x,!1);e.addEventListener("mouseup",k,!1);S=b;qa=B};a.register_wheel_events=function(a,
b){a.addEventListener("mousewheel",r,!1);a.addEventListener("DOMMouseScroll",r,!1);P=b};a.register_touch_events=function(a,b){a.addEventListener("touchstart",q,!1);a.addEventListener("touchmove",z,!1);document.addEventListener("touchstart",function(){});ga=b};a.register_device_orientation=function(){window.DeviceOrientationEvent&&C.gyro_use&&window.addEventListener("deviceorientation",E,!1)};a.unregister_keyboard_events=function(a){a.removeEventListener("keydown",l,!1);a.removeEventListener("keyup",
g,!1)};a.unregister_mouse_events=function(a){a.removeEventListener("mousedown",m,!1);a.removeEventListener("mousemove",x,!1);a.removeEventListener("mouseout",k,!1);a.removeEventListener("mouseup",k,!1)};a.unregister_wheel_events=function(a){a.removeEventListener("mousewheel",r,!1);a.removeEventListener("DOMMouseScroll",r,!1)};a.unregister_touch_events=function(a){a.removeEventListener("touchstart",q,!1);a.removeEventListener("touchmove",z,!1);document.removeEventListener("touchstart",function(){})};
a.unregister_device_orientation=function(){window.DeviceOrientationEvent&&C.gyro_use&&window.removeEventListener("deviceorientation",E,!1)};a.MB=function(a){ya=a};a.NB=function(a){ba=a};a.QB=function(a){Y=a};a.PB=function(a){B=a}};b4w.module.__curve=function(a,p){function c(a,b,c,d,k){var h=d.length;k||(k=new Float32Array(h));for(var r=h+a,q=new Float32Array(r),z=1;z<=r-1;z++)q[z-1]=b>=c[z-1]&&b<c[z+1-1]?1:0;for(var E=2;E<=a;E++)for(z=1;z<=r-E;z++)q[z-1]=(0!=q[z-1]?(b-c[z-1])*q[z-1]/(c[z+E-1-1]-c[z-1]):0)+(0!=q[z+1-1]?(c[z+E-1]-b)*q[z+1-1]/(c[z+E-1]-c[z+1-1]):0);b==c[r-1]&&(q[h-1]=1);a=0;for(z=1;z<=h;z++)a+=q[z-1]*d[z-1];for(z=1;z<=h;z++)k[z-1]=0!=a?q[z-1]*d[z-1]/a:0;return k}function b(a){a=a.Xj;return a[a.length-1]}function h(a){a=
a.qp;return a[a.length-1]}var d=p("__util");a.Yv=function(a){var b={},d=a.data;a=d.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var m=a.order_u;b.Ke=m;a=a.points;var k=a.length/5,h=[],r=k+m,k=k+2;h[0]=0;for(var q=2;q<=r;q++)h[q-1]=q>m&&q<k?h[q-2]+1:h[q-2];b.Xj=h;if("2D"==d.dimensions)b.Ge=!1;else if("3D"==d.dimensions)b.Ge=!0;else throw"Wrong curve dimensions";m=[];h=[];for(d=0;d<a.length;d+=5)m.push(a[d]),m.push(a[d+1]),m.push(a[d+2]),b.Ge&&m.push(a[d+3]),h.push(a[d+4]);b.Cl=
m;b.ao=h;a=[];for(var d=b.Cl,m=b.Ge?4:3,h=b.ao,r=b.Xj,k=b.Ke,q=d.length/m,z=q+k,E=0,A=r[z-1]/999,n=0;1E3>n;n++){5E-6>r[z-1]-E&&(E=r[z-1]);for(var u=c(k,E,r,h),e=0;e<m;e++)for(var O=a[m*n+e]=0;O<q;O++)a[m*n+e]+=u[O]*d[m*O+e];E+=A}m=b.Ge?4:3;h=new Float32Array(1E3);h[0]=0;for(d=1;1E3>d;d+=1)r=a[(d-1)*m],k=a[(d-1)*m+1],q=a[(d-1)*m+2],z=a[d*m],E=a[d*m+1],A=a[d*m+2],h[d]=h[d-1]+Math.sqrt((z-r)*(z-r)+(E-k)*(E-k)+(A-q)*(A-q));b.qp=h;return b};a.dA=function(a,d,g){g||(g=[]);var h=d,k=Math.max(h,0);d=k=Math.min(h,
b(a));var h=a.Cl,k=a.Ge?4:3,x=a.ao,r=a.Xj,q=a.Ke;a=h.length/k;var z=a+q;5E-6>r[z-1]-d&&(d=r[z-1]);z=new Float32Array(a);c(q,d,r,x,z);for(d=0;d<k;d++)for(x=g[d]=0;x<a;x++)g[d]+=z[x]*h[k*x+d]};a.aA=function(a,b,c){c||(c=[]);var d=a.Cl,k=a.Ge?4:3,h=a.ao,r=a.Xj,q=a.Ke;a=d.length/k;var z=a+q;5E-6>r[z-1]-b&&(b=r[z-1]);var z=new Float32Array(a),E=b;b=z;var A=h.length;b||(b=new Float32Array(A));var n=new Float32Array(A),u=new Float32Array(A),e=n,O=u;e||(e=new Float32Array(A));O||(O=new Float32Array(A));for(var I=
A+q,F=new Float32Array(I),t=new Float32Array(I),y=1;y<=I-1;y++)F[y-1]=E>=r[y-1]&&E<r[y+1-1]?1:0;E==r[I-1]&&(F[A-1]=1);for(var L=2;L<=q;L++)for(y=1;y<=I-L;y++){var C=0!=F[y-1]?F[y-1]/(r[y+L-1-1]-r[y-1]):0,H=0!=F[y+1-1]?-F[y+1-1]/(r[y+L-1]-r[y+1-1]):0,K=0!=t[y-1]?(E-r[y-1])*t[y-1]/(r[y+L-1-1]-r[y-1]):0,M=0!=t[y+1-1]?(r[y+L-1]-E)*t[y+1-1]/(r[y+L-1]-r[y+1-1]):0;F[y-1]=(0!=F[y-1]?(E-r[y-1])*F[y-1]/(r[y+L-1-1]-r[y-1]):0)+(0!=F[y+1-1]?(r[y+L-1]-E)*F[y+1-1]/(r[y+L-1]-r[y+1-1]):0);t[y-1]=C+H+K+M}for(y=1;y<=
A;y++)e[y-1]=F[y-1],O[y-1]=t[y-1];r=0;for(q=1;q<=A;q++)r+=n[q-1]*h[q-1];E=0;for(q=1;q<=A;q++)E+=u[q-1]*h[q-1];for(q=1;q<=A;q++)b[q-1]=0!=r?u[q-1]*h[q-1]/r+n[q-1]*h[q-1]*E/(r*r):0;for(h=0;h<k;h++)for(r=c[h]=0;r<a;r++)c[h]+=z[r]*d[k*r+h]};a.JD=b;a.cA=h;a.bA=function(a,c){if(0>=c)return 0;var g=b(a);if(c>=h(a))return g;var m=a.qp,k=d.mj(m,c,0,m.length-1);return g*(k+(c-m[k])/(m[k+1]-m[k]))/1E3}};b4w.module.__dds=function(a,p){function c(a,b,c,d){var k=new Uint16Array(4),f=new Uint16Array(c*d),n=0,u=0,e=0,g=u=n=0,h=0,l=0,t=0,m=c/4;d/=4;for(var L=0;L<d;L++)for(var C=0;C<m;C++)e=b+4*(L*m+C),k[0]=a[e],k[1]=a[e+1],n=k[0]&31,u=k[0]&2016,g=k[0]&63488,h=k[1]&31,l=k[1]&2016,t=k[1]&63488,k[2]=5*n+3*h>>3|5*u+3*l>>3&2016|5*g+3*t>>3&63488,k[3]=5*h+3*n>>3|5*l+3*u>>3&2016|5*t+3*g>>3&63488,n=a[e+2],u=4*L*c+4*C,f[u]=k[n&3],f[u+1]=k[n>>2&3],f[u+2]=k[n>>4&3],f[u+3]=k[n>>6&3],u+=c,f[u]=k[n>>8&3],f[u+1]=k[n>>
10&3],f[u+2]=k[n>>12&3],f[u+3]=k[n>>14],n=a[e+3],u+=c,f[u]=k[n&3],f[u+1]=k[n>>2&3],f[u+2]=k[n>>4&3],f[u+3]=k[n>>6&3],u+=c,f[u]=k[n>>8&3],f[u+1]=k[n>>10&3],f[u+2]=k[n>>12&3],f[u+3]=k[n>>14];return f}function b(a,b,d,h){var E=new Int32Array(d,0,31),A,n,u,e,O,I;if(542327876!=E[0])return l.error("Invalid magic number in DDS header"),0;if(!E[20]&4)return l.error("Unsupported format, must contain a FourCC code"),0;A=E[21];switch(A){case g:n=8;u=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case m:n=16;u=
b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case k:n=16;u=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return l.error("Unsupported FourCC code:",f(A)),null}I=1;E[2]&131072&&!1!==h&&(I=Math.max(1,E[7]));e=E[4];O=E[3];E=E[1]+4;if(b)for(A=0;A<I;++A)h=Math.max(4,e)/4*Math.max(4,O)/4*n,b=new Uint8Array(d,E,h),a.compressedTexImage2D(a.TEXTURE_2D,A,u,e,O,0,b),E+=h,e=Math.max(.5*e,1),O=Math.max(.5*O,1);else if(A==g)Math.max(4,e),Math.max(4,O),b=new Uint16Array(d),d=c(b,E/2,e,O),a.texImage2D(a.TEXTURE_2D,
0,a.RGB,e,O,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,d),h&&a.generateMipmap(a.TEXTURE_2D);else return l.error("No manual decoder for",f(A),"and no native support"),0;return I}function h(a,c,d,k,f,g){var n=new XMLHttpRequest;n.open("GET",d,!0);n.responseType="arraybuffer";n.onload=function(){if(200==n.status){a.bindTexture(a.TEXTURE_2D,k);var d=b(a,c,n.response,f);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<d?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}g&&
g(k)};n.send(null);return k}function d(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function f(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var l=p("__print"),g=d("DXT1"),m=d("DXT3"),k=d("DXT5");a.qC=c;a.VA=b;a.hq=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.px=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case g:b=6;break;case m:case k:b=4;break;default:l.error("Unsupported FourCC code:",f(a))}return b};
a.nD=h;a.mD=function(a,b,c,d){var k=a.createTexture();h(a,b,c,k,!0,d);return k}};b4w.module.__debug=function(a,p){function c(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function b(a,b){typeof a!=typeof b&&l.ma("Structure assertion failed: incompatible types");for(var e in a)e in b||l.ma("Structure assertion failed: missing key in the first object: "+e);for(e in b)e in a||l.ma("Structure assertion failed: missing key in the second object: "+e),typeof a[e]!=typeof b[e]&&l.ma("Structure assertion failed: incompatible types for key "+e)}var h=
p("__extensions"),d=p("__print"),f=p("__textures"),l=p("__util"),g=null,m={},k=!1,x={},r=[],q=-1,z=null,E=!1;a.no={WM_OPAQUE_WIREFRAME:0,WM_TRANSPARENT_WIREFRAME:1,WM_FRONT_BACK_VIEW:2,WM_DEBUG_SPHERES:3};a.qc=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),e;for(e in b){var c=b[e];c in a&&(m[a[c]]=c)}g=a};a.iv=function(a){if(k){var b=g.getError();b!=g.NO_ERROR&&(b in m?l.ma("GL Error: "+b+", gl."+m[b]+" ("+
a+")"):l.ma("Unknown GL error: "+b+" ("+a+")"))}};a.dv=function(){if(k)switch(g.checkFramebufferStatus(g.FRAMEBUFFER)){case g.FRAMEBUFFER_COMPLETE:break;case g.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:d.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case g.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:d.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case g.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:d.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
break;case g.FRAMEBUFFER_UNSUPPORTED:d.error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:d.error("FRAMEBUFFER CHECK FAILED")}};a.gv=function(){if(-1!=q)return q;g.bindFramebuffer(g.FRAMEBUFFER,g.createFramebuffer());var a=f.Bj("DEBUG",f.Jh);f.resize(a,1,1);g.framebufferTexture2D(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,a.Hb,a.Ta,0);g.checkFramebufferStatus(g.FRAMEBUFFER)!=g.FRAMEBUFFER_COMPLETE?(q=!0,d.warn("depth-only issue was found")):q=!1;g.bindFramebuffer(g.FRAMEBUFFER,null);return q};
a.jv=function(a,b,e){if(k&&!g.getShaderParameter(a,g.COMPILE_STATUS))throw e=c(e),d.error("shader compilation failed:\n"+e+"\n"+g.getShaderInfoLog(a)+" ("+b+")"),"Engine failed: see above for error messages";};a.kv=function(a,b,e,f,l,m){if(k&&!g.getProgramParameter(a,g.LINK_STATUS)){var t=h.Zp();t&&(l=t.getTranslatedShaderSource(e),m=t.getTranslatedShaderSource(f));l=c(l);m=c(m);d.error("shader linking failed:\n"+l+"\n\n\n"+m+"\n"+g.getProgramInfoLog(a)+" ("+b+")");throw"Engine failed: see above for error messages";
}};a.set_check_gl_errors=function(a){k=a};a.rC=function(a){x[a]=a in x?x[a]+1:1};a.update=function(){for(var a in x)d.log(a,x[a]),x[a]=0};a.fbmsg=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var e=arguments[b];if(l.is_vector(e))for(var c=0;c<e.length;c++)a.push(e[c]);else a.push(arguments[b])}r.push(a)};a.msg=function(){for(var a=1,b=0;b<r.length;b++){var e=r[b];e[1]==arguments[0]&&a++}e=[a];for(b=0;b<arguments.length;b++)if(a=arguments[b],l.is_vector(a))for(var c=0;c<a.length;c++)e.push(a[c]);
else e.push(arguments[b]);r.push(e)};var A=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.print_telemetry=function(a){a||(a=1);for(var b=0,e={},c=Math.max(0,performance.now()-1E3*a),k=0;k<r.length;k++){var f=r[k];a=f[0];if(!(a<c)){var t=String(f[1]);e[t]||(e[t]=A[b++%A.length]);a=["%c"+(a/1E3).toFixed(6),e[t],t];for(t=2;t<f.length;t++)a.push(f[t]);d.log.apply(this,a)}}r.splice(0)};a.plot_telemetry=function(a){a||(a=1);for(var b={},e=Math.max(0,performance.now()-
1E3*a),c=0;c<r.length;c++){var k=r[c];a=k[0];if(!(a<e))for(var f=2;f<k.length;f++){var t=String(k[1]);3<k.length&&(t+="_"+String(f-2));b[t]||(b[t]=t+"\n");b[t]+=String(a)+" "+k[f]+"\n"}}a="";for(t in b)a+=b[t]+"\n\n";d.log(a);r.splice(0)};a.XB=function(a){function b(a){return-1<e.indexOf(a)?!0:!1}var e=navigator.userAgent.toLowerCase();switch(a.toLowerCase()){case "chrome":return b("mozilla")&&b("applewebkit")&&b("chrome");case "firefox":return b("mozilla")&&b("gecko")&&b("firefox");case "msie":return b("mozilla")&&
b("trident")&&b("msie");case "opera":return b("opera")&&b("presto");case "safari":return b("mozilla")&&b("applewebkit")&&b("safari")&&!b("chrome");default:return!1}};a.check_finite=function(a){if(l.is_vector(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.LB=function(a,b){typeof a!=b&&l.ma("Type assertion failed: value type is not a {"+b+"}:",a)};a.JB=b;a.KB=function(a){E?b(a,z):E=!0;z=a}};b4w.module.__extensions=function(a,p){function c(a){if(a in d)return d[a];var c=h.getExtension(a)||null;d[a]=c;b.log("%cGET EXTENSION","color: #"+(c?"0a0":"a00"),a);return c}var b=p("__print"),h=null,d={};a.qc=function(a){h=a};a.dq=function(){return c("WEBGL_compressed_texture_s3tc")||c("WEBKIT_WEBGL_compressed_texture_s3tc")||c("MOZ_WEBGL_compressed_texture_s3tc")};a.rx=function(){return c("WEBGL_depth_texture")||c("WEBKIT_WEBGL_depth_texture")||c("MOZ_WEBGL_depth_texture")};a.jx=function(){return c("EXT_texture_filter_anisotropic")||
c("WEBKIT_EXT_texture_filter_anisotropic")||c("MOZ_EXT_texture_filter_anisotropic")};a.Zp=function(){return c("WEBGL_debug_shaders")};a.cq=function(){return c("WEBGL_debug_renderer_info")};a.$p=function(){return c("OES_element_index_uint")};a.Ex=function(){return c("OES_standard_derivatives")};a.cleanup=function(){d={}}};b4w.module.__graph=function(a){function p(a,b,e){e||(e=null);if(c(a,b))throw"Graph already has node with given ID";a.Fa.push(b,e)}function c(a,b){for(var e=a.Fa,c=0;c<e.length;c+=2)if(e[c]==b)return!0;return!1}function b(a,b,e,d){d||(d=null);if(c(a,b)&&c(a,e))a.la.push(b,e,d);else throw"Wrong node IDs";}function h(a,b){if(!c(a,b))throw"Node not found";for(var e=a.Fa,d=0;d<e.length;d+=2)e[d]==b&&(e.splice(d,2),d-=2)}function d(a){a=a.Fa;for(var b=-1,e=0;e<a.length;e+=2)b=Math.max(b,a[e]);return++b}
function f(a,b){for(var e=a.Fa,c=0;c<e.length;c+=2)if(e[c+1]==b)return e[c];return-1}function l(a){var b=[],e={};g(a,e);for(var c=a.Fa,d=0;d<c.length;d+=2)0==u(a,c[d])&&m(a,c[d],e,b);return{Fa:b,la:a.la.slice(0)}}function g(a,b){for(var e=a.Fa,c=0;c<e.length;c+=2)b[e[c]]=!1}function m(a,b,c,d){if(!c[b]){c[b]=!0;for(var k=0;k<n(a,b);k++)m(a,e(a,b,k),c,d);d.unshift(b,A(a,b))}}function k(a,b,c,d){if(!c[b]){c[b]=!0;if(10==d||30==d)for(var G=0;G<n(a,b);G++){var v=e(a,b,G);k(a,v,c,d)}if(20==d||30==d)for(G=
0;G<u(a,b);G++)v=O(a,b,G),k(a,v,c,d)}}function x(a){var b=a.Fa;a=a.la;for(var c=[],e=[],d=[],v=0;v<b.length;v++)d[b[2*v]]=v,c.push(v,b[2*v+1]);for(v=0;v<a.length;v+=3)e.push(d[a[v]],d[a[v+1]],a[v+2]);return{Fa:c,la:e}}function r(a,b,c){if(c.$c==c.Je){for(var d=0,k=0;d<c.Je;d++)-1!=c.Nd[d]&&(a[k]=d,b[k]=c.Nd[d],k++);return!0}if(c.Je>c.bh||c.Ye>c.Ze||c.xh>c.zh||c.wh>c.yh)return!1;for(var k=d=-1,v=!1;!v&&q(c,L,d,k);)if(d=L[0],k=L[1],z(c,d,k)){var f;f=c;v={};v.ci=f.ci;v.di=f.di;v.Xm=f.Xm;v.Gj=f.Gj;v.Je=
f.Je;v.bh=f.bh;v.Ke=f.Ke;v.$c=v.gk=f.$c;v.wh=f.wh;v.xh=f.xh;v.Ye=f.Ye;v.yh=f.yh;v.zh=f.zh;v.Ze=f.Ze;v.Lh=-1;v.Nd=f.Nd;v.zf=f.zf;v.Jf=f.Jf;v.Kf=f.Kf;v.Zf=f.Zf;v.$f=f.$f;v.Ak=f.Ak;f.Ak[0]+=1;var v=f=v,t=d,g=k,h=v.ci,l=v.di,m=v.Je,x=v.bh,A=v.Nd,y=v.zf,w=v.Jf,F=v.Kf,I=v.Zf,p=v.$f;E(t<m);E(g<x);E(v.$c<m);E(v.$c<x);m=++v.$c;v.Lh=t;w[t]||(w[t]=m,v.wh++,I[t]&&v.Ye++);I[t]||(I[t]=m,v.xh++,w[t]&&v.Ye++);F[g]||(F[g]=m,v.yh++,p[g]&&v.Ze++);p[g]||(p[g]=m,v.zh++,F[g]&&v.Ze++);A[t]=g;y[g]=t;for(A=0;A<u(h,t);A++)y=
O(h,t,A),w[y]||(w[y]=m,v.wh++,I[y]&&v.Ye++);for(A=0;A<n(h,t);A++)y=e(h,t,A),I[y]||(I[y]=m,v.xh++,w[y]&&v.Ye++);for(A=0;A<u(l,g);A++)y=O(l,g,A),F[y]||(F[y]=m,v.yh++,p[y]&&v.Ze++);for(A=0;A<n(l,g);A++)y=e(l,g,A),p[y]||(p[y]=m,v.zh++,F[y]&&v.Ze++);v=r(a,b,f);E(1>=f.$c-f.gk);E(-1!=f.Lh);y=f.ci;t=f.di;g=f.$c;h=f.Lh;l=f.Nd;w=f.zf;m=f.Jf;F=f.Kf;x=f.Zf;I=f.$f;if(f.gk<g){m[h]==g&&(m[h]=0);for(p=0;p<u(y,h);p++)A=O(y,h,p),m[A]==g&&(m[A]=0);x[h]==g&&(x[h]=0);for(p=0;p<n(y,h);p++)A=e(y,h,p),x[A]==g&&(x[A]=0);
y=l[h];F[y]==g&&(F[y]=0);for(p=0;p<u(t,y);p++)A=O(t,y,p),F[A]==g&&(F[A]=0);I[y]==g&&(I[y]=0);for(p=0;p<n(t,y);p++)A=e(t,y,p),I[A]==g&&(I[A]=0);l[h]=-1;w[y]=-1;f.$c=f.gk;f.Lh=-1}}return v}function q(a,b,c,e){-1==c&&(c=0);-1==e?e=0:e++;var d=a.Ye,v=a.Ze,f=a.xh,k=a.zh,n=a.wh,t=a.yh,g=a.$c,h=a.Je,l=a.bh,m=a.Nd,u=a.zf,r=a.Jf,q=a.Kf,x=a.Zf,A=a.$f;if(d>g&&v>g)for(;c<h&&(-1!=m[c]||0==x[c]||0==r[c]);)c++,e=0;else if(f>g&&k>g)for(;c<h&&(-1!=m[c]||0==x[c]);)c++,e=0;else if(n>g&&t>g)for(;c<h&&(-1!=m[c]||0==r[c]);)c++,
e=0;else if(0==c&&0!=a.Ke){for(r=0;r<h&&-1!=m[c=a.Ke[r]];)r++;r==h&&(c=h)}else for(;c<h&&-1!=m[c];)c++,e=0;if(d>g&&v>g)for(;e<l&&(-1!=u[e]||0==A[e]||0==q[e]);)e++;else if(f>g&&k>g)for(;e<l&&(-1!=u[e]||0==A[e]);)e++;else if(n>g&&t>g)for(;e<l&&(-1!=u[e]||0==q[e]);)e++;else for(;e<l&&-1!=u[e];)e++;return c<h&&e<l?(b[0]=c,b[1]=e,!0):!1}function z(a,b,c){var d=a.ci,f=a.di,v=a.bh,k=a.Nd,g=a.zf,t=a.Jf,h=a.Kf,l=a.Zf,m=a.$f;E(b<a.Je);E(c<v);E(-1==k[b]);E(-1==g[c]);if(!(0,a.Xm)(A(d,b),A(f,c)))return!1;for(var r=
v=0,q=0,x=0,z=0,L=0,y=0;y<n(d,b);y++){var p=e(d,b,y);if(-1!=k[p]){var ia=k[p];if(!I(f,c,ia)||!F(a.Gj,d,b,p,f,c,ia))return!1}else t[p]&&q++,l[p]&&v++,t[p]||l[p]||z++}for(y=0;y<u(d,b);y++)if(p=O(d,b,y),-1!=k[p]){if(ia=k[p],!I(f,ia,c)||!F(a.Gj,d,p,b,f,ia,c))return!1}else t[p]&&q++,l[p]&&v++,t[p]||l[p]||z++;for(y=0;y<n(f,c);y++)if(ia=e(f,c,y),-1!=g[ia]){if(p=g[ia],!I(d,b,p))return!1}else h[ia]&&x++,m[ia]&&r++,h[ia]||m[ia]||L++;for(y=0;y<u(f,c);y++)if(ia=O(f,c,y),-1!=g[ia]){if(p=g[ia],!I(d,p,b))return!1}else h[ia]&&
x++,m[ia]&&r++,h[ia]||m[ia]||L++;return q<=x&&v<=r&&z<=L}function E(a){if(!a)throw"Assertion failed";}function A(a,b){for(var c=a.Fa,e=0;e<c.length;e+=2)if(c[e]==b)return c[e+1];return null}function n(a,b){for(var c=a.la,e=0,d=0;d<c.length;d+=3)c[d]==b&&e++;return e}function u(a,b){for(var c=a.la,e=0,d=0;d<c.length;d+=3)c[d+1]==b&&e++;return e}function e(a,b,c){a=a.la;for(var e=0,d=0;d<a.length;d+=3)if(a[d]==b){if(e==c)return a[d+1];e++}return-1}function O(a,b,c){a=a.la;for(var e=0,d=0;d<a.length;d+=
3)if(a[d+1]==b){if(e==c)return a[d];e++}return-1}function I(a,b,c){a=a.la;for(var e=0;e<a.length;e+=3)if(a[e]==b&&a[e+1]==c)return!0;return!1}function F(a,b,c,e,d,v,f){for(var k=t(b,c,e),n=t(d,v,f),g=0;g<k;g++){for(var h=!1,l=0;l<n;l++)if(a(y(b,c,e,g),y(d,v,f,l))){h=!0;break}if(!h)return!1}return!0}function t(a,b,c){var e=0;a=a.la;for(var d=0;d<a.length;d+=3)a[d]==b&&a[d+1]==c&&e++;return e}function y(a,b,c,e){a=a.la;for(var d=0,v=0;v<a.length;v+=3)if(a[v]==b&&a[v+1]==c){if(d==e)return a[v+2];d++}return null}
var L=[-1,-1];a.jo=-1;a.AB=10;a.fo=20;a.EB=30;a.create=function(){for(var a=arguments,b=[],c=[],e=0;e<a.length;e++){var d=a[e];switch(d.length){case 2:b.push(d[0],d[1]);break;case 3:c.push(d[0],d[1],d[2]);break;default:throw"Wrong graph constructor params";}}return{Fa:b,la:c}};a.jC=function(a,b){for(var c=[],e=[],d=0;d<a.length;d++)c.push(a[d][0],a[d][1]);for(d=0;d<b.length;d++)e.push(b[d][0],b[d][1],b[d][2]);return{Fa:c,la:e}};a.dl=p;a.SC=c;a.qe=b;a.Gi=h;a.hh=function(a,b,c,e){if(!I(a,b,c))throw"Edge not found";
a=a.la;for(var d=0,v=0;v<a.length;v+=3)if(a[v]==b&&a[v+1]==c){if(-1==e)a.splice(v,3);else{if(e==d){a.splice(v,3);break}d++}v-=3}};a.C=function(a,b){if(-1==f(a,b)){var c=d(a);p(a,c,b);return c}throw"Non-unique attribute";};a.ez=function(a,b,c,e,d){a=a.la;for(var v=0;v<a.length;v+=3)a[v]==b&&a[v+1]==c&&a[v+2]==e&&(a[v+2]=d)};a.Sp=d;a.dh=f;a.m=function(a,c,e,d){c=f(a,c);e=f(a,e);if(-1!=c&&-1!=e)b(a,c,e,d);else throw"Attributes not found";};a.S=function(a,b){for(var c=a.Fa,e=0;e<c.length&&!b(c[e],c[e+
1]);e+=2);};a.af=function(a,b){for(var c=a.la,e=0;e<c.length&&!b(c[e],c[e+1],c[e+2]);e+=3);};a.ge=function(a,b,c){for(var e=a.la,d=0;d<e.length;d+=3)if(e[d+1]==b){var v=e[d];if(c(v,A(a,v),e[d+2]))break}};a.bf=function(a,b,c){for(var e=a.la,d=0;d<e.length;d+=3)if(e[d]==b){var v=e[d+1];if(c(v,A(a,v),e[d+2]))break}};a.Jn=l;a.tA=function(a){a=l(a).Fa;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};a.bD=function(){};a.rs=function(a,b,e){if(!c(a,b))throw"No such node";var d={};g(a,d);k(a,b,d,
e);b=[];for(var f in d)d[f]&&(f=Number(f),b.push(f,A(a,f)));a={Fa:b,la:a.la.slice(0)};d=a.la;for(f=0;f<d.length;f+=3)b=d[f+1],c(a,d[f])&&c(a,b)||(d.splice(f,3),f-=3);return a};a.Dx=function(a){for(var b=[],c=a.Fa,e=0;e<c.length;e+=2){var d=c[e];u(a,d)||b.push(d)}return b};a.fq=function(a){for(var b=[],c=a.Fa,e=0;e<c.length;e+=2){var d=c[e];n(a,d)||b.push(d)}return b};a.match=function(a,b,c,e){var d={};d.ci=x(a);d.di=x(b);d.Xm=c||function(a,b){return a==b};d.Gj=e||function(a,b){return a==b};e=a.Fa.length/
2;var v=b.Fa.length/2;d.Je=e;d.bh=v;d.Ke=0;d.$c=d.gk=0;d.Ye=d.wh=d.xh=0;d.Ze=d.yh=d.zh=0;d.Lh=-1;d.Nd=Array(e);d.zf=Array(v);d.Jf=Array(e);d.Kf=Array(v);d.Zf=Array(e);d.$f=Array(v);d.Ak=[1];for(c=0;c<e;c++)d.Nd[c]=-1,d.Jf[c]=0,d.Zf[c]=0;for(c=0;c<v;c++)d.zf[c]=-1,d.Kf[c]=0,d.$f[c]=0;v=Array(e);e=Array(e);if(r(v,e,d)){for(c=0;c<v.length;c++)v[c]=a.Fa[2*v[c]],e[c]=b.Fa[2*e[c]];return[v,e]}return null};a.hb=A;a.fh=n;a.wq=u;a.Ng=e;a.Lj=O;a.LC=t;a.Mg=y;a.replace=function(a,b,c){for(var e=a.la,f=d(a),v=
0;v<b.length;v++){var k=b[v];h(a,k);for(var n=0;n<e.length;n+=3)e[n]==k&&(e[n]=f),e[n+1]==k&&(e[n+1]=f),e[n]==e[n+1]&&(e.splice(n,3),n-=3)}p(a,f,c)};a.Wy=function(a,b,c,e,d){if(!I(a,b,c))throw"Edge not found";a=a.la;for(var v=0;v<a.length;v+=3)a[v]==b&&a[v+1]==c&&(a[v]=e,a[v+1]=d)};a.kC=function(a,b){var c=a.Fa,e=a.la,d;d="digraph debug {\n    node [shape=box];\n";for(var v=0;v<c.length;v+=2){var f=c[v],k=c[v+1],k=b?b(f,k):String(f);d+="    ";d+=String(f)+' [label="'+k.replace(/\"/g,'\\"')+'"];\n'}for(v=
0;v<e.length;v+=3)c=e[v],f=e[v+1],d+="    ",d+=String(c)+" -> "+String(f)+";\n";return d+="}"}};b4w.module.__ipc=function(a){a.ct=0;var p=a.Ws=1;a.Xs=2;a.Zs=3;a.$s=4;a.at=5;a.dt=6;var c=a.ft=7,b=a.gt=8,h=a.ht=9;a.it=10;a.et=11;a.bt=12;a.Ys=13;a.Ft=100;a.Bd=101;a.jt=102;a.kt=103;a.lt=104;a.nt=105;a.mt=106;a.ot=107;a.pt=108;a.qt=109;a.rt=110;a.st=111;a.tt=112;a.ut=113;a.vt=114;a.wt=115;a.xt=116;a.yt=117;a.zt=118;a.At=119;a.Bt=120;a.Dt=121;a.Et=122;a.Gt=123;a.lo=124;a.Ht=125;a.It=126;a.Jt=127;a.Kt=128;a.Lt=129;a.Mt=130;a.Nt=131;a.Ot=132;a.Pt=133;a.Qt=134;a.Rt=135;a.St=136;a.mo=137;var d=a.aj=138;
a.Tt=139;a.ko=140;a.Ut=141;a.Vt=142;a.CB=143;a.Ct=144;var f=null,l={msg_id:h,body_id:0,time:0,trans:new Float32Array(3),quat:new Float32Array(4),linvel:new Float32Array(3),angvel:new Float32Array(3),Zb:new Float32Array(16)};l.Zb[0]=h;var g={msg_id:c,chassis_hull_body_id:0,prop_ind:0,trans:new Float32Array(3),quat:new Float32Array(4),Zb:new Float32Array(10)};g.Zb[0]=c;var m={msg_id:b,body_id:0,from:new Float32Array(3),to:new Float32Array(3),local:0,body_id_b_hit:0,cur_result:0,Zb:new Float32Array(11)};
m.Zb[0]=b;var k={msg_id:p,body_id_a:0,body_id_b:0,result:0,coll_point:new Float32Array(3),Zb:new Float32Array(7)};k.Zb[0]=p;var x={msg_id:d,body_id:0,trans:new Float32Array(3),quat:new Float32Array(4),Zb:new Float32Array(9)};x.Zb[0]=d;a.init=function(a,q){a.addEventListener("message",function(a){a=a.data;var f=a[0]|0;switch(f){case h:var r=l;r.body_id=a[1];r.time=a[2];r.trans[0]=a[3];r.trans[1]=a[4];r.trans[2]=a[5];r.quat[0]=a[6];r.quat[1]=a[7];r.quat[2]=a[8];r.quat[3]=a[9];r.linvel[0]=a[10];r.linvel[1]=
a[11];r.linvel[2]=a[12];r.angvel[0]=a[13];r.angvel[1]=a[14];r.angvel[2]=a[15];break;case c:r=g;r.chassis_hull_body_id=a[1];r.prop_ind=a[2];r.trans[0]=a[3];r.trans[1]=a[4];r.trans[2]=a[5];r.quat[0]=a[6];r.quat[1]=a[7];r.quat[2]=a[8];r.quat[3]=a[9];break;case b:r=m;r.body_id=a[1];r.from[0]=a[2];r.from[1]=a[3];r.from[2]=a[4];r.to[0]=a[5];r.to[1]=a[6];r.to[2]=a[7];r.local=a[8];r.body_id_b_hit=a[9];r.cur_result=a[10];break;case p:r=k;r.body_id_a=a[1];r.body_id_b=a[2];r.result=a[3];r.coll_point[0]=a[4];
r.coll_point[1]=a[5];r.coll_point[2]=a[6];break;case d:r=x;r.body_id=a[1];r.trans[0]=a[2];r.trans[1]=a[3];r.trans[2]=a[4];r.quat[0]=a[5];r.quat[1]=a[6];r.quat[2]=a[7];r.quat[3]=a[8];break;default:r=a}q(f,r)},!1);f=a};a.cleanup=function(){f=null};a.s=function(){if(f){switch(arguments[0]|0){case h:var a=l,q=a.Zb;q[1]=a.body_id;q[2]=a.time;q[3]=a.trans[0];q[4]=a.trans[1];q[5]=a.trans[2];q[6]=a.quat[0];q[7]=a.quat[1];q[8]=a.quat[2];q[9]=a.quat[3];q[10]=a.linvel[0];q[11]=a.linvel[1];q[12]=a.linvel[2];
q[13]=a.angvel[0];q[14]=a.angvel[1];q[15]=a.angvel[2];break;case c:a=g;q=a.Zb;q[1]=a.chassis_hull_body_id;q[2]=a.prop_ind;q[3]=a.trans[0];q[4]=a.trans[1];q[5]=a.trans[2];q[6]=a.quat[0];q[7]=a.quat[1];q[8]=a.quat[2];q[9]=a.quat[3];break;case b:a=m;q=a.Zb;q[1]=a.body_id;q[2]=a.from[0];q[3]=a.from[1];q[4]=a.from[2];q[5]=a.to[0];q[6]=a.to[1];q[7]=a.to[2];q[8]=a.local;q[9]=a.body_id_b_hit;q[10]=a.cur_result;break;case p:a=k;q=a.Zb;q[1]=a.body_id_a;q[2]=a.body_id_b;q[3]=a.result;q[4]=a.coll_point[0];q[5]=
a.coll_point[1];q[6]=a.coll_point[2];break;case d:a=x;q=a.Zb;q[1]=a.body_id;q[2]=a.trans[0];q[3]=a.trans[1];q[4]=a.trans[2];q[5]=a.quat[0];q[6]=a.quat[1];q[7]=a.quat[2];q[8]=a.quat[3];break;default:for(q=[],a=0;a<arguments.length;a++)q.push(arguments[a])}f.postMessage(q)}};a.bq=function(a){switch(a){case h:return l;case c:return g;case b:return m;case p:return k;case d:return x;default:return null}}};b4w.module.__hud=function(a,p){function c(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function b(a){h(' SCENE "'+a.name+'"');if(a.d){var b=0,c=0;g.S(a.d.rb,function(a,d){if("SINK"==d.type)h(" (F)",d.type);else{var f=d.type,k=Math.round(d.j.width)+"x"+Math.round(d.j.height),g=d.p.length,e=d.Sh,l=d.enqueue&&d.W;l?h(" (A)",f,d.Xf,k,e,"of",g):h(" (P)",f,d.Xf,k,e,"of",g);d.Sh=0;l&&(b+=g,c+=e)}});return[b,c]}h("No INFO")}function h(){for(var a=80+20*k[0],b=[5,
18,3,10,4,3,5],c=arguments[0],d=1;d<arguments.length;d++){for(var f="",g=0;g<b[d]-String(arguments[d]).length;g++)f+=" ";c+=f+arguments[d]}k[0]++;m.fillText(c,30,a)}function d(a,b,c){b*=a.Ba;c.x=a.x+b;c.y=a.y;c.Ba=a.Ba-2*b;c.sa=a.sa}function f(a){return a.x+a.Ba/2}function l(a){var b=m,c={x:0,y:0,Ba:0,sa:0},f=b.canvas.width,b=b.canvas.height;c.x=0;c.y=0;c.Ba=f;c.sa=b;d(c,.01,c);f=.02*c.sa;c.x=c.x;c.y+=f;c.Ba=c.Ba;c.sa-=2*f;f=c.Ba/8;c.x+=f*a;c.y=c.y;c.Ba=f;c.sa=c.sa;d(c,.02,c);return c}var g=p("__graph"),
m=null,k=[0,0];a.init=function(a){a=a.getContext("2d");c(a);return m=a};a.Ch=function(){m&&c(m)};a.reset=function(){var a=m;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),k[0]=0,k[1]=0)};a.Oz=function(a,c){var d=m;if(d){d.textAlign="left";d.fillStyle="rgba(0,255,0,255)";h(" FPS",(1/c).toFixed(2));k[0]++;for(var f=d=0,g=0;g<a.length;g++){var l=b(a[g]),d=d+l[0],f=f+l[1];k[0]++}h(" ---------------------------------------------");
h("    ","TOTAL ACTIVE","","",f,"of",d)}};a.print=function(){var a=m;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",h.apply(Math,arguments))};a.plot_array=function(a,b,c,d,k,g,n){var h=m;if(h){b=l(b);var e=b.sa/5;b.x=b.x;b.y+=4*e;b.Ba=b.Ba;b.sa=e;h.textAlign="center";h.fillStyle="#00FF00";m.fillText(a,f(b),b.y-10);h.strokeStyle="#00FF00";h.lineWidth=.5;h.beginPath();h.moveTo(b.x,b.y);h.lineTo(b.x+b.Ba,b.y);h.lineTo(b.x+b.Ba,b.y+b.sa);h.lineTo(b.x,b.y+b.sa);h.closePath();h.stroke();if(!g&&
!n)for(g=1E6,n=-1E6,a=0;a<c.length;a++)g=Math.min(g,c[a]),n=Math.max(n,c[a]);h.textAlign="right";m.fillText(String(g),b.x-10,b.y+b.sa);m.fillText(String(n),b.x-10,b.y);h.textAlign="center";m.fillText(String(d),b.x,b.y+b.sa+15);m.fillText(String(k),b.x+b.Ba,b.y+b.sa+15);h.strokeStyle="#FF0000";h.lineWidth=1.5;h.beginPath();d=b.Ba/(c.length-1);n=b.sa/(n-g);for(a=0;a<c.length;a++)k=b.x+d*a,e=b.y+b.sa-(c[a]-g)*n,0==a?h.moveTo(k,e):h.lineTo(k,e);h.stroke()}};a.draw_mixer_strip=function(a,b,c,d,k,g,n){var h=
m;if(h)for(h.textAlign="center",h.fillStyle="#00FF00",h.font="bold 12px Courier",c=l(c),m.fillText(b?"["+a+"]":a,f(c),c.y),0<=g&&m.fillText(g?"[M]":"[ ]",f(c)-15,c.y+30),0<=n&&m.fillText(n?"[S]":"[ ]",f(c)+15,c.y+30),a={x:0,y:0,Ba:0,sa:0},b=0;b<d.length;b++){g=d[b];var e="VOLUME"==g[0];if(e){n=c.y+350;var p=c.Ba,I=a;I.x=c.x;I.y=n;I.Ba=p;I.sa=250}else{n=c.y+10+50*b;var p=c.Ba,I=c.sa,F=a;F.x=c.x;F.y=n;F.Ba=p;F.sa=I}n=h;var p=a,F=b==k,t=g[0],I=g[1],y=g[2],L=g[3],C=(L-y)/g[4],C=1>C?Math.floor(1/C-1E-5).toFixed(0).length:
0;g=g[5]?Math.log(I/y)/Math.log(L/y):(I-y)/(L-y);n.textAlign="center";F?n.fillText("["+t+"]",f(p),p.y):n.fillText(t,f(p),p.y);n.strokeStyle="#00FF00";n.lineWidth=e?3:1;e?(n.textAlign="right",n.fillText(L.toFixed(C),f(p)-10,p.y+15),n.textAlign="right",n.fillText(y.toFixed(C),f(p)-10,p.y+p.sa-15)):(n.textAlign="right",n.fillText(y.toFixed(C),p.x+28,p.y+15),n.textAlign="left",n.fillText(L.toFixed(C),p.x+p.Ba-28,p.y+15));n.beginPath();if(e){var H=p.y+15+(p.sa-30)*(1-g);n.moveTo(f(p),p.y+15);n.lineTo(f(p),
p.y+p.sa-15);n.moveTo(f(p)-5,p.y+15);n.lineTo(f(p)+5,p.y+15);n.moveTo(f(p)-5,p.y+p.sa-15);n.lineTo(f(p)+5,p.y+p.sa-15);n.moveTo(f(p)-5,H);n.lineTo(f(p)+5,H)}else{var K=p.x+30+(p.Ba-60)*g;n.moveTo(p.x+30,p.y+15);n.lineTo(p.x+p.Ba-30,p.y+15);n.moveTo(p.x+30,p.y+15-5);n.lineTo(p.x+30,p.y+15+5);n.moveTo(p.x+p.Ba-30,p.y+15-5);n.lineTo(p.x+p.Ba-30,p.y+15+5);n.moveTo(K,p.y+15-5);n.lineTo(K,p.y+15+5)}n.stroke();"EQ_Q"==t?(g=Math.log(1+1/(2*I*I)+Math.sqrt((2+1/(I*I))*(2+1/(I*I))/4-1))/Math.log(2),e?(n.textAlign=
"left",n.fillText(I.toFixed(C),f(p)+10,H),n.textAlign="left",n.fillText("("+g.toFixed(C+1)+")",f(p)+10,H+10)):(n.textAlign="right",n.fillText(I.toFixed(C),K,p.y+30),n.textAlign="left",n.fillText("("+g.toFixed(C+1)+")",K,p.y+30))):e?(n.textAlign="left",n.fillText(I.toFixed(C),f(p)+10,H)):(n.textAlign="center",n.fillText(I.toFixed(C),K,p.y+30))}}};b4w.module.__renderer=function(a,p){function c(a){if(a){var b=(a.ga?A.COLOR_BUFFER_BIT:0)|(a.ka?A.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "SHADOW_CAST":a=x;break;case "DEPTH":a=r;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":case "ANCHOR_VISIBILITY":a=q;break;case "OUTLINE_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=z;break;default:a=k.background_color}}else b=A.COLOR_BUFFER_BIT|A.DEPTH_BUFFER_BIT,a=k.background_color;A.colorMask(!0,!0,!0,!0);A.depthMask(!0);
A.clearColor(a[0],a[1],a[2],a[3]);A.clear(b)}function b(a,b,c){A.bindBuffer(A.ARRAY_BUFFER,a.df);for(var d=0;d<b.length;d++){var f=b[d];A.enableVertexAttribArray(f.Sf);A.vertexAttribPointer(f.Sf,f.jd,A.FLOAT,!1,0,f.Nu+f.Ow*c)}a.Wd?(A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,a.Wd),A.drawElements(a.mode,a.count,a.sm,0)):A.drawArrays(a.mode,0,a.count);for(d=0;d<b.length;d++)f=b[d],A.disableVertexAttribArray(f.Sf)}function h(a){switch(a){case 0:return A.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return A.TEXTURE_CUBE_MAP_NEGATIVE_X;
case 2:return A.TEXTURE_CUBE_MAP_POSITIVE_Y;case 3:return A.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 4:return A.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return A.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function d(a){var b=a.Ni,c=[],d=[],f={},k;for(k in b){var n=!1;switch(k){case "u_proj_matrix":var g=function(a,b,c,d,e,v){a.uniformMatrix4fv(b,!1,v.pa)},n=!0;break;case "u_view_matrix":case "u_view_matrix_frag":g=function(a,b,c,d,e,v){a.uniformMatrix4fv(b,!1,v.ja)};n=!0;break;case "u_shadow_cast_billboard_view_matrix":g=function(a,
b,c,d,e,v){a.uniformMatrix4fv(b,!1,v.$r)};n=!0;break;case "u_view_proj_prev":g=function(a,b,c,d,e,v){a.uniformMatrix4fv(b,!1,v.Sy)};n=!0;break;case "u_view_proj_inverse":g=function(a,b,c,d,e,v){a.uniformMatrix4fv(b,!1,v.Eh)};n=!0;break;case "u_sky_vp_inverse":g=function(a,b,c,d,e,v){a.uniformMatrix4fv(b,!1,v.od)};n=!0;break;case "u_camera_eye":case "u_camera_eye_frag":g=function(a,b,c,d,e,v){a.uniform3fv(b,v.Ce)};n=!0;break;case "u_camera_eye_last":g=function(a,b,c,d,e,v){a.uniform3fv(b,v.Ip)};n=
!0;break;case "u_camera_quat":g=function(a,b,c,d,e,v){a.uniform4fv(b,v.quat)};n=!0;break;case "u_view_max_depth":g=function(a,b,c,d,e,v){a.uniform1f(b,v.Za)};n=!0;break;case "u_camera_range":g=function(a,b,c,d,e,v){a.uniform2f(b,v.Qa,v.Za)};break;case "u_csm_center_dists":g=function(a,b,c,d,e,v){a.uniform4fv(b,v.op)};break;case "u_cam_water_depth":g=function(a,b,c){a.uniform1f(b,c.tl)};n=!0;break;case "u_waves_height":g=function(a,b,c){a.uniform1f(b,c.jf)};break;case "u_waves_length":g=function(a,
b,c){a.uniform1f(b,c.tg)};break;case "u_fog_color_density":g=function(a,b,c){a.uniform4fv(b,c.Tb)};break;case "u_underwater_fog_color_density":g=function(a,b,c){a.uniform4fv(b,c.Wc)};break;case "u_bloom_key":g=function(a,b,c){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":g=function(a,b,c){a.uniform1f(b,c.bloom_edge_lum)};break;case "u_time":g=function(a,b,c){a.uniform1f(b,c.time)};n=!0;break;case "u_wind":g=function(a,b,c){a.uniform3fv(b,c.Ui)};break;case "u_horizon_color":g=function(a,
b,c){a.uniform3fv(b,c.De)};break;case "u_zenith_color":g=function(a,b,c){a.uniform3fv(b,c.lf)};break;case "u_environment_energy":g=function(a,b,c){a.uniform1f(b,c.Be)};break;case "u_sky_color":g=function(a,b,c){a.uniform3fv(b,c.mh)};break;case "u_rayleigh_brightness":g=function(a,b,c){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":g=function(a,b,c){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":g=function(a,b,c){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":g=
function(a,b,c){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":g=function(a,b,c){a.uniform1f(b,c.rayleigh_strength)};break;case "u_mie_strength":g=function(a,b,c){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":g=function(a,b,c){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":g=function(a,b,c){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":g=function(a,b,c){a.uniform1f(b,c.mie_distribution)};break;
case "u_light_positions":g=function(a,b,c){a.uniform3fv(b,c.Qf)};break;case "u_light_directions":g=function(a,b,c){a.uniform3fv(b,c.Of)};break;case "u_light_color_intensities":g=function(a,b,c){a.uniform3fv(b,c.Nf)};break;case "u_light_factors":g=function(a,b,c){a.uniform4fv(b,c.Pf)};break;case "u_sun_quaternion":g=function(a,b,c){a.uniform4fv(b,c.us)};break;case "u_sun_intensity":g=function(a,b,c){a.uniform3fv(b,c.ts)};break;case "u_sun_direction":g=function(a,b,c){a.uniform3fv(b,c.Fk)};break;case "u_height":g=
function(a,b,c,d,e,v){a.uniform1f(b,v.height)};n=!0;break;case "u_model_matrix":g=function(a,b,c,d){a.uniformMatrix4fv(b,!1,d.T)};n=!0;break;case "u_transb":g=function(a,b,c,d){a.uniform4fv(b,d.wc)};n=!0;break;case "u_transa":g=function(a,b,c,d){a.uniform4fv(b,d.vc)};n=!0;break;case "u_arm_rel_trans":g=function(a,b,c,d){a.uniform4fv(b,d.fl)};n=!0;break;case "u_arm_rel_quat":g=function(a,b,c,d){a.uniform4fv(b,d.el)};n=!0;break;case "u_quat":g=function(a,b,c,d){a.uniform4fv(b,d.quat)};n=!0;break;case "u_quatsb":g=
function(a,b,c,d){a.uniform4fv(b,d.pc)};n=!0;break;case "u_quatsa":g=function(a,b,c,d){a.uniform4fv(b,d.oc)};n=!0;break;case "u_frame_factor":g=function(a,b,c,d){a.uniform1f(b,d.Ff)};n=!0;break;case "au_center_pos":g=function(){};n=!0;break;case "au_wind_bending_amp":g=function(a,b,c,d){a.uniform1f(b,d.yd)};n=!0;break;case "au_wind_bending_freq":g=function(a,b,c,d){a.uniform1f(b,d.kf)};n=!0;break;case "au_detail_bending_freq":g=function(a,b,c,d){a.uniform1f(b,d.ve)};n=!0;break;case "au_detail_bending_amp":g=
function(a,b,c,d){a.uniform1f(b,d.ue)};n=!0;break;case "au_branch_bending_amp":g=function(a,b,c,d){a.uniform1f(b,d.re)};n=!0;break;case "u_node_values":g=function(a,b,c,d){a.uniform1fv(b,d.Zd)};n=!0;break;case "u_node_rgbs":g=function(a,b,c,d){a.uniform3fv(b,d.mc)};n=!0;break;case "u_diffuse_color":g=function(a,b,c,d,e){a.uniform4fv(b,e.ob)};n=!0;break;case "u_diffuse_intensity":g=function(a,b,c,d,e){a.uniform1f(b,e.xe)};n=!0;break;case "u_diffuse_params":g=function(a,b,c,d,e){a.uniform2fv(b,e.Od)};
n=!0;break;case "u_emit":g=function(a,b,c,d,e){a.uniform1f(b,e.Rd)};n=!0;break;case "u_ambient":g=function(a,b,c,d,e){a.uniform1f(b,e.Gd)};n=!0;break;case "u_specular_color":g=function(a,b,c,d,e){a.uniform3fv(b,e.qd)};n=!0;break;case "u_specular_alpha":g=function(a,b,c,d,e){a.uniform1f(b,e.nh)};n=!0;break;case "u_specular_params":g=function(a,b,c,d,e){a.uniform3fv(b,e.cc)};n=!0;break;case "u_reflect_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.fg)};n=!0;break;case "u_mirror_factor":g=function(a,
b,c,d,e){a.uniform1f(b,e.Tm)};n=!0;break;case "u_grass_map_dim":g=function(a,b,c,d,e){a.uniform3fv(b,e.Vb)};n=!0;break;case "u_grass_size":g=function(a,b,c,d,e){a.uniform1f(b,e.lm)};n=!0;break;case "u_scale_threshold":g=function(a,b,c,d,e){a.uniform1f(b,e.iq)};n=!0;break;case "u_cube_fog":g=function(a,b,c,d,e){a.uniformMatrix4fv(b,!1,e.hc)};break;case "u_jitter_amp":g=function(a,b,c,d,e){a.uniform1f(b,e.Hq)};n=!0;break;case "u_jitter_freq":g=function(a,b,c,d,e){a.uniform1f(b,e.Iq)};n=!0;break;case "u_wireframe_mode":g=
function(a,b,c,d,e){a.uniform1i(b,e.wireframe_mode)};break;case "u_wireframe_edge_color":g=function(a,b,c,d,e){a.uniform3fv(b,e.wireframe_edge_color)};break;case "u_subpixel_jitter":g=function(a,b,c){a.uniform2fv(b,c.ey)};n=!0;break;case "u_subsample_indices":g=function(a,b,c){a.uniform4fv(b,c.fy)};n=!0;break;case "u_refr_bump":g=function(a,b,c,d,e){a.uniform1f(b,e.Lr)};n=!0;break;case "u_lamp_light_positions":g=function(a,b,c,d,e){a.uniform3fv(b,e.Cm)};break;case "u_lamp_light_directions":g=function(a,
b,c,d,e){a.uniform3fv(b,e.Am)};break;case "u_lamp_light_color_intensities":g=function(a,b,c,d,e){a.uniform3fv(b,e.zm)};break;case "u_lamp_light_factors":g=function(a,b,c,d,e){a.uniform4fv(b,e.Bm)};break;case "u_halo_size":g=function(a,b,c,d,e){a.uniform1f(b,e.nq)};n=!0;break;case "u_halo_hardness":g=function(a,b,c,d,e){a.uniform1f(b,e.kq)};n=!0;break;case "u_halo_rings_color":g=function(a,b,c,d,e){a.uniform3fv(b,e.mq)};n=!0;break;case "u_halo_lines_color":g=function(a,b,c,d,e){a.uniform3fv(b,e.lq)};
n=!0;break;case "u_halo_stars_blend":g=function(a,b,c,d,e){a.uniform1f(b,e.oq)};n=!0;break;case "u_halo_stars_height":g=function(a,b,c,d,e){a.uniform1f(b,e.pq)};n=!0;break;case "u_fresnel_params":g=function(a,b,c,d,e){a.uniform4fv(b,e.Oc)};n=!0;break;case "u_texture_scale":g=function(a,b,c,d,e){a.uniform3fv(b,e.$e)};n=!0;break;case "u_parallax_scale":g=function(a,b,c,d,e){a.uniform1f(b,e.bg)};n=!0;break;case "u_color_id":g=function(a,b,c,d){a.uniform3fv(b,d.yj)};n=!0;break;case "u_line_points":g=
function(a,b,c,d,e){a.uniform3fv(b,e.lD)};n=!0;break;case "u_diffuse_color_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.we)};n=!0;break;case "u_alpha_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.ne)};n=!0;break;case "u_specular_color_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.gs)};n=!0;break;case "u_normal_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.ar)};n=!0;break;case "u_normalmap0_scale":g=function(a,b,c,d,e){a.uniform2fv(b,e.Wf[0])};n=!0;break;case "u_normalmap1_scale":g=function(a,b,c,
e,d){a.uniform2fv(b,d.Wf[1])};n=!0;break;case "u_normalmap2_scale":g=function(a,b,c,d,e){a.uniform2fv(b,e.Wf[2])};n=!0;break;case "u_normalmap3_scale":g=function(a,b,c,e,d){a.uniform2fv(b,d.Wf[3])};n=!0;break;case "u_foam_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.foam_factor)};n=!0;break;case "u_foam_uv_freq":g=function(a,b,c,e,d){a.uniform2fv(b,d.Mp)};n=!0;break;case "u_foam_mag":g=function(a,b,c,d,e){a.uniform2fv(b,e.Lp)};n=!0;break;case "u_foam_scale":g=function(a,b,c,e,d){a.uniform2fv(b,d.Zl)};
n=!0;break;case "u_water_norm_uv_velocity":g=function(a,b,c,d,e){a.uniform1f(b,e.Gh)};n=!0;break;case "u_shallow_water_col":g=function(a,b,c,e,d){a.uniform3fv(b,d.shallow_water_col)};n=!0;break;case "u_shore_water_col":g=function(a,b,c,d,e){a.uniform3fv(b,e.shore_water_col)};n=!0;break;case "u_water_shallow_col_fac":g=function(a,b,c,e,d){a.uniform1f(b,d.shallow_water_col_fac)};n=!0;break;case "u_water_shore_col_fac":g=function(a,b,c,d,e){a.uniform1f(b,e.shore_water_col_fac)};n=!0;break;case "u_p_length":g=
function(a,b,c,e,d){a.uniform1f(b,d.pr)};n=!0;break;case "u_p_cyclic":g=function(a,b,c,d,e){a.uniform1i(b,e.lr)};n=!0;break;case "u_p_max_lifetime":g=function(a,b,c,e,d){a.uniform1f(b,d.rr)};n=!0;break;case "u_p_fade_in":g=function(a,b,c,d,e){a.uniform1f(b,e.mr)};n=!0;break;case "u_p_fade_out":g=function(a,b,c,e,d){a.uniform1f(b,d.nr)};n=!0;break;case "u_p_size":g=function(a,b,c,d,e){a.uniform1f(b,e.bn)};n=!0;break;case "u_p_alpha_start":g=function(a,b,c,e,d){a.uniform1f(b,d.ir)};n=!0;break;case "u_p_alpha_end":g=
function(a,b,c,d,e){a.uniform1f(b,e.hr)};n=!0;break;case "u_p_nfactor":g=function(a,b,c,e,d){a.uniform1f(b,d.an)};n=!0;break;case "u_p_gravity":g=function(a,b,c,d,e){a.uniform1f(b,e.or)};n=!0;break;case "u_p_mass":g=function(a,b,c,e,d){a.uniform1f(b,d.qr)};n=!0;break;case "u_p_size_ramp":g=function(a,b,c,d,e){a.uniform2fv(b,e.sr)};n=!0;break;case "u_p_color_ramp":g=function(a,b,c,e,d){a.uniform4fv(b,d.jr)};n=!0;break;case "u_p_wind":g=function(a,b,c,d,e){a.uniform3fv(b,e.nk)};n=!0;break;case "u_texel_size":g=
function(a,b,c,e,d){a.uniform2fv(b,d.Gn)};n=!0;break;case "u_p_time":g=function(a,b,c,d,e){a.uniform1f(b,e.nc.P.time)};n=!0;break;case "u_position":g=function(a,b,c,e,d){a.uniform3fv(b,d.yi)};n=!0;break;case "u_va_frame_factor":g=function(a,b,c,d){a.uniform1f(b,d.Js)};n=!0;break;case "u_normal_offset":g=function(a,b,c){a.uniform1f(b,c.self_shadow_normal_offset)};break;case "u_pcf_blur_radii":g=function(a,b,c,d,e,v){a.uniform4fv(b,v.sk)};break;case "u_v_light_matrix":g=function(a,b,c){a.uniformMatrix4fv(b,
!1,c.Is)};n=!0;break;case "u_b_light_matrix":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Ko)};break;case "u_p_light_matrix0":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.ag[0])};n=!0;break;case "u_p_light_matrix1":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.ag[1])};n=!0;break;case "u_p_light_matrix2":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.ag[2])};n=!0;break;case "u_p_light_matrix3":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.ag[3])};n=!0;break;case "u_motion_blur_exp":g=function(a,b,c){a.uniform1f(b,
c.Wq)};n=!0;break;case "u_refl_plane":g=function(a,b,c){a.uniform4fv(b,c.$b)};break;case "u_radial_blur_step":g=function(a,b,c){a.uniform1f(b,c.wk)};break;case "u_god_rays_intensity":g=function(a,b,c){a.uniform1f(b,c.god_rays_intensity)};break;case "u_ssao_radius_increase":g=function(a,b,c){a.uniform1f(b,c.qh)};break;case "u_ssao_blur_discard_value":g=function(a,b,c){a.uniform1f(b,c.ssao_blur_discard_value)};n=!0;break;case "u_ssao_influence":g=function(a,b,c){a.uniform1f(b,c.ph)};break;case "u_ssao_dist_factor":g=
function(a,b,c){a.uniform1f(b,c.oh)};break;case "u_dof_dist":g=function(a,b,c,d,e,v){a.uniform1f(b,v.dof_distance)};n=!0;break;case "u_dof_front":g=function(a,b,c,d,e,v){a.uniform1f(b,v.dof_front)};n=!0;break;case "u_dof_rear":g=function(a,b,c,d,e,v){a.uniform1f(b,v.dof_rear)};n=!0;break;case "u_outline_intensity":g=function(a,b,c,d){a.uniform1f(b,d.Qc)};n=!0;break;case "u_outline_color":g=function(a,b,c){a.uniform3fv(b,c.Le)};break;case "u_draw_outline":g=function(a,b,c){a.uniform1f(b,c.Pl)};n=!0;
break;case "u_brightness":g=function(a,b,c){a.uniform1f(b,c.brightness)};break;case "u_contrast":g=function(a,b,c){a.uniform1f(b,c.contrast)};break;case "u_exposure":g=function(a,b,c){a.uniform1f(b,c.exposure)};break;case "u_saturation":g=function(a,b,c){a.uniform1f(b,c.saturation)};break;default:g=null}g&&(g={name:k,em:g,Sf:b[k]},n?c.push(g):(d.push(g),f[k]=g))}a.zs=c;a.wi=d;a.dn=f}var f=p("__config"),l=p("__debug"),g=p("__textures"),m=p("__util"),k=f.q,x=[1,1,1,1],r=[1,1,1,1],q=[0,0,0,1],z=[0,0,
0,0],E=new Uint8Array([91.8,142.8,.96*255,255]);new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);new Float32Array([1,1,1,0]);new Float32Array([2,2,2,0]);var A=null,n=new Uint8Array(4);a.qc=function(a){var b=k.background_color;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);A=a};a.Vh=function(a){if(a.W){var e=a.j;A.bindFramebuffer(A.FRAMEBUFFER,
e.Td);if(a.hl){var g=e.yb;A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,g.Hb,g.Ta,0)}A.viewport(0,0,e.width,e.height);c(a);a.Ga?A.enable(A.BLEND):A.disable(A.BLEND);a.Bb?A.enable(A.DEPTH_TEST):A.disable(A.DEPTH_TEST);if(a.Ea){for(var e=a.j,g=a.p,f=0;f<g.length;f++){var m=g[f],t=m.o,r=t.Rb;A.useProgram(r.Ai);m=m.ib;r.wi.length||d(r);for(var r=r.wi,q=r.length;q--;){var C=r[q];C.em(A,C.Sf,a,m,t,e)}}a.Ea=!1}switch(a.type){case "SHADOW_CAST":A.enable(A.POLYGON_OFFSET_FILL);A.polygonOffset(a.self_shadow_polygon_offset,
a.self_shadow_polygon_offset);A.cullFace(A.BACK);break;case "MAIN_REFLECT":A.disable(A.POLYGON_OFFSET_FILL);A.cullFace(A.FRONT);break;default:A.disable(A.POLYGON_OFFSET_FILL),A.cullFace(A.BACK)}e=a.j;g=a.p;for(f=0;f<g.length;f++)if(r=g[f],r.W){var t=a,m=e,C=r.ib,x=r.o,q=x.Rb;A.useProgram(q.Ai);for(var r=x.R,z=x.Go,p=q.zs,G=p.length;G--;){var v=p[G];v.em(A,v.Sf,t,C,x,m)}m=x.gp;A.colorMask(m,m,m,m);A.depthMask(x.V);x.Aa?A.enable(A.CULL_FACE):A.disable(A.CULL_FACE);m=x.M;for(x=0;x<m.length;x++)p=m[x],
A.activeTexture(A.TEXTURE0+x),A.bindTexture(p.Hb,p.Ta);if("SKY"==t.type){m=t;q=q.Ni;x=m.j.yb.Ta;p=m.pp;for(G=0;6>G;G++)if(v=h(G),k.wl?(A.bindTexture(A.TEXTURE_CUBE_MAP,x),A.texImage2D(v,0,A.RGBA,1,1,0,A.RGBA,A.UNSIGNED_BYTE,E)):(A.uniformMatrix4fv(q.u_cube_view_matrix,!1,p[G]),A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,v,x,0),b(r,z,C.Rn)),m.ek&&3!=G){var v=m,N=G,J=n;k.wl?J.set(E):(A.readPixels(191,191,1,1,A.RGBA,A.UNSIGNED_BYTE,J),255!=J[0]&&255!=J[1]&&255!=J[2]||A.readPixels(191,220,
1,1,A.RGBA,A.UNSIGNED_BYTE,J));var R=J[0],V=J[1],J=J[2],R=R/255,V=V/255,J=J/255;2===N?(v.hc[3]=R,v.hc[7]=V,v.hc[11]=J):2>N?(v.hc[4*N]=R,v.hc[4*N+1]=V,v.hc[4*N+2]=J):(v.hc[4*(N-2)]=R,v.hc[4*(N-2)+1]=V,v.hc[4*(N-2)+2]=J)}t.Sh+=6}else b(r,z,C.Rn),t.Sh++}l.iv("draw subscene: "+a.type);A.bindFramebuffer(A.FRAMEBUFFER,null)}};a.clear=function(a){A.bindFramebuffer(A.FRAMEBUFFER,a.j.Td);c(a)};a.Do=function(a){var b=a.Go;b.length=0;var c=a.R;a=a.Rb;c&&a||m.ma("Incomplete batch");c=c.Ob;a=a.attributes;for(var d in a){var g=
c[d];b.push({Sf:a[d],Nu:4*g.offset,Ow:1<g.frames?4*g.length:0,jd:g.jd})}};a.Mu=d;a.Eo=function(a){var b=a.Rb,c=a.M;a=a.Gb;A.useProgram(b.Ai);for(var d=0;d<c.length;d++)A.uniform1i(b.Ni[a[d]],d)};a.Kr=function(a,b,c,d,g,f){d||(d=1);g||(g=1);f||(f=new Uint8Array(4*d*g));f.length!=4*d*g&&m.ma("read_pixels(): Wrong storage");A.bindFramebuffer(A.FRAMEBUFFER,a);A.readPixels(b,c,d,g,A.RGBA,A.UNSIGNED_BYTE,f);A.bindFramebuffer(A.FRAMEBUFFER,null);return f};a.CA=function(a){var b=a.Rb;A.useProgram(b.Ai);b.wi.length||
d(b);b=b.dn.u_cube_fog;b.em(A,b.Sf,null,null,a,null)};a.dz=function(a,b){var c=A.createFramebuffer();A.bindFramebuffer(A.FRAMEBUFFER,c);if(a){var d=a,f=d.Ta,d=d.Hb==A.TEXTURE_CUBE_MAP?A.TEXTURE_CUBE_MAP_NEGATIVE_Z:d.Hb;A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,d,f,0)}g.Dq(b)?A.framebufferRenderbuffer(A.FRAMEBUFFER,A.DEPTH_ATTACHMENT,A.RENDERBUFFER,b.ff):g.mi(b)&&(d=b,f=d.Ta,d=d.Hb,A.framebufferTexture2D(A.FRAMEBUFFER,A.DEPTH_ATTACHMENT,d,f,0));l.dv();A.bindFramebuffer(A.FRAMEBUFFER,
null);return c};a.cz=function(a,b,c,d,f){null==a?(A.bindFramebuffer(A.FRAMEBUFFER,a),A.viewport(0,0,d,f),A.clear(A.COLOR_BUFFER_BIT|A.DEPTH_BUFFER_BIT)):(g.mi(b)&&A.deleteTexture(b.Ta),g.Dq(c)?A.deleteRenderbuffer(c.ff):g.mi(c)&&A.deleteTexture(c.Ta),A.deleteFramebuffer(a))};a.VC=function(){};a.cleanup=function(){}};b4w.module.__shaders=function(a,p){function c(a,c,d){var e=a.ye;"string"==typeof d&&(a=b(a,d))&&(d=a[1]);for(a=0;a<e.length;a++)if(e[a][0]==c){e[a][1]=d;return}e.push([c,d])}function b(a,b){for(var c=a.ye,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function h(a,b){var c=a+b;if(O[c])return O[c];if(n){var d=n[b];if(!d)return null}else{d=E.Fx(a+b);if(!d)return null;d=u.yr.parse(d)}return O[c]=d}function d(a,b,c){function d(b){b=b.a;for(var c=0;c<b.length;c++){var u=b[c];switch(u.type){case "condition":a:for(var u=
u.a,J=0;J<u.length;J++){var z=u[J];switch(z.type){case "if":case "elif":var P=z.c;try{var ga=e(P)}catch(y){throw"Failed to process #"+z.type+" expression: "+P.join(" ");}if(ga){d(z.group);break a}break;case "else":d(z.group);break a;case "ifdef":z.name in l&&d(z.group);break;case "ifndef":z.name in l||d(z.group)}}break;case "include":u=h(A.shaders_dir,A.Mz+u.file);d(u);break;case "var":case "export":case "import":break;case "define":J=u.name;l[J]=u.b;u.L&&(q[J]=u.L);break;case "error":throw"Shader error: #error "+
u.b.join(" ");case "line":break;case "pragma":v.push("#pragma "+u.name+" "+u.b.join(" "));break;case "undef":u=u.name;delete l[u];delete q[u];break;case "warning":r.warn("Shader warning: #warning "+u.b.join(" "));break;case "extension":v.push("#extension "+f(u.b,l,q,!1));break;case "#":break;case "node":x[u.name]=u;break;case "nodes_global":u=n;for(J=0;J<u.length;J++)if(z=u[J],P=x[z.id])for(var L=0,ba=0;ba<P.k.length;ba++){var Y=P.k[ba];"node_param"==Y.type&&(Y=Y.qualifier.join(" ")+" ","vert"==a?
Y+=z.Ti[L]:"frag"==a&&(Y+=z.L[L],null!==z.pk[L]&&(Y+=" = "+z.pk[L])),Y+=";",v.push(Y),L++)}break;case "nodes_main":u=n;for(J=0;J<u.length;J++)if(z=u[J],P=x[z.id]){L={};ba={};for(Y=0;Y<z.ze.length;Y++)ba[z.ze[Y][0]]=[z.ze[Y][1]];w=O=I=0;for(var Y=z,B=P.k,W=L,na=ba,oa=0;oa<B.length;oa++){var F=B[oa];switch(F.type){case "node_in":var Ga=Y.J[I];if(null!==Y.um[I]){if(("MATERIAL"==Y.id&&3===I||"MATERIAL_EXT"==Y.id&&3===I||"TEXTURE_COLOR"==Y.id||"TEXTURE_NORMAL"==Y.id)&&F.e){W[F.name]=Y.um[I];I++;continue}var da=
F.qualifier.join(" ")+" ",da=da+Ga,da=da+(" = "+Y.um[I]),da=da+";";v.push(da)}W[F.name]=Ga;I++;break;case "node_out":Ga=Y.Ra[O];if(!F.e||-1<p.indexOf(Ga))da=F.qualifier.join(" ")+" ",da+=Ga,da+=";",v.push(da),W[F.name]=Ga;-1<p.indexOf(Ga)&&(na["USE_OUT_"+F.name]=[1]);O++;break;case "node_param":"vert"==a?Ga=Y.Ti[w]:"frag"==a&&(Ga=Y.L[w]),W[F.name]=Ga,w++}}v.push("{");g(z,P.f,L,ba);v.push("}")}break;case "lamp":E[u.name]=u;break;case "lamps_main":u=k;for(J=0;J<u.length;J++)if(z=u[J],z.cy){v.push("{");
P=E[z.type].f;for(L=0;L<P.length;L++){ba=P[L];Y=[];for(B=0;B<ba.b.length;B++){W=ba.b[B];switch(W){case "LAMP_IND":W=z.index;break;case "LAMP_LIGHT_FACT_IND":W=z.iy;break;case "LAMP_FAC_CHANNELS":W=z.hy;break;case "LAMP_SPOT_SIZE":W=m(z.Uc);break;case "LAMP_SPOT_BLEND":W=m(z.lg||.01);break;case "LAMP_LIGHT_DIST":W=m(z.distance);break;case "LAMP_SHADOW_MAP_IND":W=z.Uw?1:0}Y.push(W)}v.push(Y.join(" "))}v.push("}")}break;case "textline":v.push(f(u.b,l,q,!1));break;default:throw"Unknown element type: "+
u.type;}}}function e(a,b){var c=f(a,l,q,!0,b);return z.yr.parse(c)}function g(a,b,c,d){for(var n=0;n<b.length;n++){var k=b[n];switch(k.type){case "node_condition":a:for(var h=a,k=k.a,t=c,m=d,u=0;u<k.length;u++){var r=k[u];switch(r.type){case "node_if":case "node_elif":var B=r.c;try{var W=e(B,m)}catch(G){throw"Failed to process #"+r.type+" expression: "+B.join(" ");}if(W){g(h,r.f,t,m);break a}break;case "node_else":g(h,r.f,t,m);break a;case "node_ifdef":(r.name in l||r.name in m)&&g(h,r.f,t,m);break;
case "node_ifndef":r.name in l||r.name in m||g(h,r.f,t,m)}}break;case "textline":h=[];for(t=0;t<k.b.length;t++)m=k.b[t],m in c?h.push(c[m]):h.push(m);v.push(f(h,l,q,!0,d))}}}var n=c.Ym,k=c.Gm;c=c.ye||[];for(var v=[],l={},u=0;u<c.length;u++)l[c[u][0]]=[c[u][1]];for(u=0;u<n.length;u++)l["USE_NODE_"+n[u].id]=[1];var q={},x={},E={},p=[];for(u in n)for(var F in n[u].J)p.push(n[u].J[F]);d(b);var I=0,O=0,w=0;return v.join("\n")}function f(a,b,c,d,e){var g=[];l(a,b,c,d,g,e);return g.join(" ")}function l(a,
b,c,d,e,g){for(var f=0;f<a.length;f++){var n=a[f];n in b||g&&n in g?(n=g&&g[n]||b[n],0==n.length&&d?e.push(0):l(n,b,c,d,e,g)):e.push(n)}}function g(a,b,c,d){d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);q.jv(d,b,c);return d}function m(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return k(a);case 2:return"vec2("+k(a[0])+","+k(a[1])+")";case 3:return"vec3("+k(a[0])+","+k(a[1])+","+k(a[2])+")";case 4:return"vec4("+k(a[0])+","+k(a[1])+","+k(a[2])+","+k(a[3])+")";case 9:return"mat3("+
k(a[0])+","+k(a[1])+","+k(a[2])+","+k(a[3])+","+k(a[4])+","+k(a[5])+","+k(a[6])+","+k(a[7])+","+k(a[8])+")";case 16:return"mat4("+k(a[0])+","+k(a[1])+","+k(a[2])+","+k(a[3])+","+k(a[4])+","+k(a[5])+","+k(a[6])+","+k(a[7])+","+k(a[8])+","+k(a[9])+","+k(a[10])+","+k(a[11])+","+k(a[12])+","+k(a[13])+","+k(a[14])+","+k(a[15])+")";default:throw"Wrong glsl value dimension";}}function k(a){return a%1?String(a):String(a)+".0"}var x=p("__config"),r=p("__print"),q=p("__debug"),z=p("__gpp_eval"),E=p("__assets");
p("__util");var A=x.Mb;if(b4w.module_check("shader_texts"))var n=p("shader_texts"),u=null;else n=null,u=p("__gpp_parser");var e={},O={},I=[],F=null;a.qc=function(a){F=a};a.v=c;a.sx=b;a.cD=function(a,b){for(var c=a.ye,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.vz=function(a){a.ye=[];for(var b="ALPHA ALPHA_CLIP BEND_CENTER_ONLY BILLBOARD_PRES_GLOB_ORIENTATION CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING BILLBOARD_JITTERED BILLBOARD_SPHERICAL HAIR_BILLBOARD SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PROCEDURAL_FOG REFLECTION REFLECTION_PASS REFLECTIVE REFRACTIVE USE_REFRACTION USE_REFRACTION_CORRECTION SHORE_SMOOTHING SKINNED SKY_COLOR SKY_TEXTURE SSAO_HEMISPHERE SSAO_BLUR_DEPTH SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_MIRROR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA NUM_LIGHTS NUM_LFACTORS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_SRC SHADOW_DST POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER BILLBOARD BILLBOARD_RANDOM PRECISION EPSILON USE_ENVIRONMENT_LIGHT USE_SKY_BLEND USE_SKY_PAPER USE_SKY_REAL USE_SKY_TEXTURE WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS".split(" "),
d=0;d<b.length;d++){var e=b[d],g;switch(e){case "ALPHA":case "ALPHA_CLIP":case "BILLBOARD_PRES_GLOB_ORIENTATION":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "NUM_LIGHTS":case "NUM_LFACTORS":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PROCEDURAL_FOG":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTIVE":case "REFRACTIVE":case "USE_REFRACTION":case "USE_REFRACTION_CORRECTION":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_COLOR":case "SKY_TEXTURE":case "SSAO_HEMISPHERE":case "SSAO_BLUR_DEPTH":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_MIRROR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "BILLBOARD":case "BILLBOARD_RANDOM":case "HAIR_BILLBOARD":case "USE_ENVIRONMENT_LIGHT":case "USE_SKY_BLEND":case "USE_SKY_PAPER":case "USE_SKY_REAL":case "USE_SKY_TEXTURE":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":g=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "BILLBOARD_SPHERICAL":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":g=1;break;case "SHADOW_TEX_RES":g=m(2048);break;case "AA_METHOD":g="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":g="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":g="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":g="POST_EFFECT_NONE";break;case "SHADOW_SRC":g="SHADOW_SRC_NONE";break;case "SHADOW_DST":g=
"SHADOW_DST_NONE";break;case "SSAO_QUALITY":g="SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":g="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":g="TEXTURE_COORDS_UV_ORCO";break;case "PRECISION":g=x.q.precision;break;case "EPSILON":g="highp"==x.q.precision?1E-6:1E-4;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":g="u_va_frame_factor";break;default:r.error("Unknown directive ("+a.Ri+", "+a.$h+"): "+e)}c(a,e,g)}};a.PC=function(a){return a.Ri};a.aq=function(a){return a.$h};a.WC=function(a,d){for(var e=
d.ye,g=0;g<e.length;g++){var f=e[g][0],n=e[g][1];b(a,f)&&c(a,f,n)}};a.ox=function(a){var b=JSON.stringify(a),c=e[b];if(c)return c;var f=a.$h,c=h(A.shaders_dir,a.Ri),f=h(A.shaders_dir,f);if(!c||!f)return null;var n=d("vert",c,a),k=d("frag",f,a),c=F,m=g(c,b,n,c.VERTEX_SHADER),l=g(c,b,k,c.FRAGMENT_SHADER),f=c.createProgram();c.attachShader(f,m);c.attachShader(f,l);c.linkProgram(f);c.validateProgram(f);c.getProgramParameter(f,c.VALIDATE_STATUS)==c.zB&&r.error("shader program is not valid",b);q.kv(f,b,
m,l,n,k);a={Wn:m,Qp:l,Ai:f,attributes:{},Ni:{},wi:[],dn:{},zs:[],Na:a};k=c.getProgramParameter(f,c.ACTIVE_ATTRIBUTES);for(n=0;n<k;n++)m=c.getActiveAttrib(f,n).name,a.attributes[m]=c.getAttribLocation(f,m);k=c.getProgramParameter(f,c.ACTIVE_UNIFORMS);for(n=0;n<k;n++)m=c.getActiveUniform(f,n).name.split("[0]").join(""),a.Ni[m]=c.getUniformLocation(f,m);return e[b]=c=a};a.hw=function(){return I};a.Yp=function(){return e};a.cleanup=function(){for(var a in e){var b=e[a];F.deleteProgram(b.Ai);F.deleteShader(b.Wn);
F.deleteShader(b.Qp);delete e[a]}for(var c in O)delete O[c];for(var d in I)delete I[d]};a.lC=function(a){var b=a.ye;r.log("Shader: "+a.Ri+" "+a.$h+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)r.log("  "+b[a][0],b[a][1])};a.t=m;a.ap=function(a,b){return b in a.Ni?!0:!1};a.Ix=function(a){return(F.getShaderSource(a).match(/(?:^|\s)varying(?=\s)/g)||[]).length}};b4w.module.__geometry=function(a,p){function c(a){return 65536<a.I?y.$p()?!1:!0:!1}function b(a){return 0<a.aa.length?!0:!1}function h(a,c,e){if(!b(a))return a;e||I.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.I*(c||1)+", will use drawArrays","color: #aa0");c=a.aa;e=a.I;var g=a.F,f=a.w,n;for(n in g){var k=g[n],h=z(k,e);g[n]=d(c,k,h)}for(g=0;g<f.length;g++){var m=f[g];for(n in m)k=m[n],h=z(k,e),m[n]=d(c,k,h)}for(g=0;g<a.X.length;g++){n=a.X[g].Jb;for(var l in n)k=n[l],h=
z(k,e),n[l]=d(c,k,h)}a.I=c.length;a.aa=new Uint16Array(0);return a}function d(a,b,c){if(0==b.length)return new Float32Array(0);for(var d=new Float32Array(a.length*c),e=0;e<a.length;e++)for(var g=a[e],f=0;f<c;f++)d[c*e+f]=b[c*g+f];return d}function f(a,b){var c=a.Vc,d=a.Ob[b];if(d)return c.subarray(d.offset,d.offset+d.length);throw"extract_array() failed; invalid name: "+b;}function l(b,c){var d,e;switch(c){case a.Ih:case a.$i:d=M.TRIANGLES;e=M.STATIC_DRAW;break;case a.io:d=M.POINTS;e=M.STATIC_DRAW;
break;case a.Zi:d=M.TRIANGLES;e=M.DYNAMIC_DRAW;break;case a.ho:d=M.POINTS;e=M.DYNAMIC_DRAW;break;case a.Us:d=M.LINES;e=M.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=d;b.Qi=e}function g(a){a.Ee?(a.Wd||(a.Wd=M.createBuffer()),M.bindBuffer(M.ELEMENT_ARRAY_BUFFER,a.Wd),M.bufferData(M.ELEMENT_ARRAY_BUFFER,a.Ee,a.Qi),a.Dj=a.Ee.byteLength):a.Dj=0;a.df||(a.df=M.createBuffer());M.bindBuffer(M.ARRAY_BUFFER,a.df);M.bufferData(M.ARRAY_BUFFER,a.Vc,a.Qi);a.tp=a.Vc.byteLength}function m(a){for(var b=
t.gb("JOIN_"+a.length+"_SUBMESHES"),c=0,d=0;d<a.length;d++)c+=a[d].aa.length;b.aa=new Uint32Array(c);var e=c=0,g=0;if(0<a[0].X.length)for(var f=0;f<a[0].X.length;f++){for(d=0;d<a.length;d++)c+=a[d].X[f].Jb.a_position.length,e+=a[d].X[f].Jb.a_normal.length,g+=a[d].X[f].Jb.a_tangent.length;d={a_position:new Float32Array(c),a_normal:new Float32Array(e),a_tangent:new Float32Array(g)};b.X.push({Sj:a[0].X[f].Sj,Jb:d})}for(d=c=0;d<a.length;d++)c+=a[d].I;b.I=c;var e=a[0],n;for(n in e.F){for(d=c=0;d<a.length;d++)c+=
a[d].F[n].length;b.F[n]=new Float32Array(c)}for(n in e.w[0]){for(d=c=0;d<a.length;d++)c+=a[d].w[0][n].length;for(d=0;d<e.w.length;d++)b.w[d]=b.w[d]||{},b.w[d][n]=new Float32Array(c)}for(n=e=c=0;n<a.length;n++){for(var g=a[n],k=g.aa,f=g.I,h=g.F,d=0;d<k.length;d++)b.aa[c+d]=k[d]+e;var c=c+k.length,m;for(m in h){var k=h[m],l=e*z(k,f);b.F[m].set(k,l)}for(d=0;d<g.w.length;d++){var h=g.w[d],u=b.w[d];for(m in h)k=h[m],l=e*z(k,f),u[m].set(k,l)}e+=f}if(0<b.X.length)for(n=0;n<b.X.length;n++)for(m=b.X[n].Jb,
d=g=e=c=0;d<a.length;d++)f=a[d].X[n].Jb,m.a_position.set(f.a_position,c),m.a_normal.set(f.a_normal,e),m.a_tangent.set(f.a_tangent,g),c+=f.a_position.length,e+=f.a_normal.length,g+=f.a_tangent.length;return b}function k(a,b,c,d,e,g){var f=t.gb("SUBMESH_"+a.name+"_"+b),n=a.submeshes[b],k=n.base_length,m=a.materials[b];f.I=k;var l=!1;if(r(c,"a_texcoord")){var z=null,A=a.materials[b];b=a.submeshes[b];if(A.texture_slots.length)switch(A=A.texture_slots[0],A.texture_coords){case "UV":A=a.uv_textures.indexOf(A.uv_layer);
-1==A||0==A?z=new Float32Array(b.texcoord):1==A&&(z=new Float32Array(b.texcoord2));break;case "ORCO":for(var C=a.b4w_bounding_box,z=new Float32Array(2*b.base_length),A=(C.max_x+C.min_x)/2,E=(C.max_z+C.min_z)/2,p=C.max_x-C.min_x,C=C.max_z-C.min_z,S=0,P=0;P<b.position.length;P+=3)z[S++]=(b.position[P]-A)/p+.5,z[S++]=(E-b.position[P+2])/C+.5}null===z&&(z=new Float32Array(b.texcoord));b=z}else b=new Float32Array(0);var ga,z=n.group;if(r(c,"a_influence")&&d){A=new Float32Array(4*k);E=z.length/k;p=new Float32Array(E);
for(C=0;C<E;C++)for(ga in p[C]=-1,d)if(S=d[ga],S.Ms===C){p[C]=S.Th;break}P=3<E?E:4;d=new Float32Array(P);ga=new Uint32Array(P);for(var C=new Float32Array(4),S=new Float32Array(P),P=new Uint32Array(P),H=new Float32Array(4),y=0;y<k;y++)d.set(S),ga.set(P),C.set(H),A.set(q(z,E,y,k,p,d,ga,C),4*y)}else A=new Float32Array(0);ga=A;d=e?t.wa(e):{};d.a_color={Hf:!0};d.a_color.src=r(c,"a_color")&&a.active_vcol_name?[{name:a.active_vcol_name,Dc:7}]:[];e={a_texcoord:b,a_influence:ga};ga=n.vertex_colors;b=n.color;
z=a.name;A=[];for(E=0;E<ga.length;E++)A.push(ga[E].name);for(var ba in d)if(E=d[ba].src,E.length){for(C=p=0;C<E.length;C++)p+=t.gg(E[C].Dc);e[ba]=new Float32Array(p*k);for(C=S=0;C<E.length;C++){var Y=E[C].name,P=E[C].Dc,H=t.Qr(P),B=A.indexOf(Y);-1==B&&t.ma('vertex color "'+Y+'" for mesh "'+z+'" not found.');var y=ga[B].mask,W=t.gg(y);(P&y)!==P&&I.error("Wrong color extraction from "+Y+" to "+ba+".");for(var na=Y=0;na<B;na++)Y+=t.gg(ga[na].mask);B=Y*k;for(Y=0;Y<k;Y++)for(na=0;3>na;na++)H[na]&&(e[ba][Y*
p+(S+t.Hi(P,na))]=b[B+Y*W+t.Hi(y,na)]);S+=W}}else e[ba]=new Float32Array(0);ba=a.uv_textures;d=n.texcoord;ga=n.texcoord2;b=a.name;if(g)for(var oa in g){z=ba.indexOf(oa);-1==z&&t.ma('uv map "'+oa+'" for mesh "'+b+'" not found');if(0==z)var K=new Float32Array(d);else 1==z&&(K=new Float32Array(ga));e[g[oa]]=K}f.F=e;f.aa=new Uint32Array(n.indices);g=n.position.length/k/3;K=(oa=r(c,"a_normal")&&n.normal.length?!0:!1)&&r(c,"a_tangent")&&n.tangent.length?!0:!1;ba=oa&&m.texture_slots.length&&r(c,"a_tangent")&&
"ORCO"==m.texture_slots[0].texture_coords?!0:!1;0<a.b4w_shape_keys.length&&(l=!0);for(e=0;e<g;e++){m=x(n,c,k,oa,K,ba,e);if(l)if(d={},d.name=a.b4w_shape_keys[e].name,f.X.push(d),0!=e){d.Jb=m;d.Sj=a.b4w_shape_keys[e].value;continue}else d.Jb=x(n,c,k,oa,K,ba,e),d.Sj=1;f.w.push(m)}if(1<g&&!l){a=f.w[0];var m={},F;for(F in a)m[F]=new Float32Array(a[F]);f.w.push(m)}r(c,"a_polyindex")&&(h(f,1,!0),f.F.a_polyindex=u(f));return f}function x(a,b,c,d,e,g,f){var n={},k=new Float32Array(3*c),h=new Float32Array(d?
3*c:0),m=new Float32Array(e||g?4*c:0),l=f*c*3;k.set(a.position.subarray(l,l+3*c),0);d&&(l=f*c*3,h.set(a.normal.subarray(l,l+3*c),0));if(e)l=f*c*4,m.set(a.tangent.subarray(l,l+4*c),0);else if(g)for(a=m,I.warn('Not precise tangents calculation for normalmap using GENERATED texture coordinates in mesh: "'+mesh.name+'". Please add a UV-map.'),b=0;b<c;b++)d=C,e=H,d[0]=h[3*b],d[1]=h[3*b+1],d[2]=h[3*b+2],L.cross(d,t.AXIS_Z,e),0==L.length(e)&&L.cross(d,t.AXIS_X,e),L.normalize(e,e),a[4*b]=e[0],a[4*b+1]=e[1],
a[4*b+2]=e[2],a[4*b+3]=1;else if(d&&r(b,"a_tangent"))for(m=new Float32Array(4*c),c=0;c<m.length;c++)m[c]=1;n.a_position=k;n.a_normal=h;n.a_tangent=m;return n}function r(a,b){return-1<a.indexOf(b)?!0:!1}function q(b,c,d,e,g,f,n,k){for(var h=!0,m=0;m<c;m++){var l=b[m*e+d];if(-1!==l){var t=g[m];-1!==t&&(f[m]=l,n[m]=t,h=!1)}}if(h)return k;E(f,n,a.Tk,!1);for(m=b=0;4>m;m++)b+=f[m];if(.01>b)return k;for(m=0;4>m;m++)f[m]/=b;if(.01>Math.abs(f[0]-1))k[0]=n[0]+1;else for(m=0;4>m;m++)k[m]=n[m]+f[m];return k}
function z(a,b){if(0==b)return 0;var c=a.length,d=c/b;if(d!=Math.floor(d))throw"Array size mismatch during geometry calculation: array length="+c+", base length="+b;return d}function E(b,c,d,e){for(var g=b.length,f=g,n=!1,k=e?-1:1;1<f||n;){1<f&&(f=Math.floor(f/1.247330950103979));for(var n=!1,h=0;f+h<g;h++)if(d==a.Tk?0>k*(b[h]-b[h+f]):b[h]<b[h+f]&&e)n=b[h],b[h]=b[h+f],b[h+f]=n,n=c[h],c[h]=c[h+f],c[h+f]=n,n=!0}}function A(a,b,c){var d=[],e=[];L.subtract(b,a,d);L.subtract(c,a,e);L.normalize(d,d);L.normalize(e,
e);return Math.acos(L.dot(d,e))}function n(a,c,d){c||(c=[]);d=d?a.w[0].a_normal:a.w[0].a_position;if(b(a)){a=a.aa;for(var e=a.length/3,g=0;g<e;g++){var f=new Float32Array(9),n=a[3*g];f[0]=d[3*n];f[1]=d[3*n+1];f[2]=d[3*n+2];n=a[3*g+1];f[3]=d[3*n];f[4]=d[3*n+1];f[5]=d[3*n+2];n=a[3*g+2];f[6]=d[3*n];f[7]=d[3*n+1];f[8]=d[3*n+2];c[g]=f}}else for(g=0;g<d.length;g++)f=new Float32Array(9),f[0]=d[9*g],f[1]=d[9*g+1],f[2]=d[9*g+2],f[3]=d[9*g+3],f[4]=d[9*g+4],f[5]=d[9*g+5],f[6]=d[9*g+6],f[7]=d[9*g+7],f[8]=d[9*
g+8],c[g]=f;return c}function u(a){for(var b=new Float32Array(a.I),c=0;c<a.I;c++)b[c]=c%3;return b}function e(a,b,c){var d=L.dist(a,b);a=L.dist(a,c);b=L.dist(b,c);c=(d+a+b)/2;return c*(c-d)*(c-a)*(c-b)}function O(a,b,c,d,e){c-=b;for(var g=0;g<c;g+=d)g%d==e&&vec3.normalize(a.subarray(g+b-e,g+b+1),a.subarray(g+b-e,g+b+1))}var I=p("__print"),F=p("__tsr"),t=p("__util"),y=p("__extensions"),L=p("vec3"),C=new Float32Array(3),H=new Float32Array(3),K=new Float32Array(3);a.Ed=10;a.oo=20;a.FB=30;a.$i=10;a.io=
20;a.Zi=30;a.ho=40;a.Us=50;a.Tk=0;a.Xt=1;a.Ih=a.$i;var M=null;a.qc=function(a){M=a};a.mC=function(a){var b=_buffers[a];M.deleteBuffer(b.Wd);M.deleteBuffer(b.df);delete _buffers[a]};a.kA=function(d,e,f,n){c(d)&&h(d);var k=d.aa,m=d.I,t=d.w,u={},r;for(r in d.F)r in n&&!n[r].Hf||(u[r]=d.F[r]);n={Ee:null,Vc:null,sm:0,count:0,Ob:{},mode:0,Qi:0,Dj:0,tp:0,df:null,Wd:null,Qj:null,X:null};if(0<d.X.length){r=t[0];for(var q=1;q<d.X.length;q++){for(var x=d.X[q].Jb,A=x.a_position,C=x.a_normal,E=r.a_position,p=
r.a_normal,H=A.length,S=d.X[q].Sj,P=0;P<H;P++)E[P]+=S*A[P],p[P]+=S*C[P];x=x.a_tangent;A=r.a_tangent;C=x.length;for(P=0;P<C;P++)A[P]+=S*x[P]}}if(k.length)if(r=k.length,65536>=m)var q=new Uint16Array(k),ga=M.UNSIGNED_SHORT;else q=new Uint32Array(k),ga=M.UNSIGNED_INT;else r=m,q=null;var S=0,P=t.length,y;for(y in t[0])x=t[0][y],S+=x.length*P;for(y in u)x=u[y],S+=x.length;y=new Float32Array(S);var S=0,P={},K;for(K in u)if(A=u[K],x=A.length)y.set(A,S),P[K]={RB:K,jd:z(A,m),offset:S,frames:1,length:x},S+=
x;u=t.length;for(K in t[0])if(A=t[0][K],x=A.length,A=z(A,m),x)for(P[K]={jd:A,offset:S,frames:u,length:x},1<u&&(P[K+"_next"]={jd:A,offset:S+x,frames:u,length:x}),C=0;C<u;C++)A=t[C][K],y.set(A,S),S+=x;n.count=r;n.Ee=q;n.Vc=y;n.sm=ga;n.Ob=P;l(n,f);g(n);e!=a.Ed&&b(d)&&(n.Qj={uy:new Float32Array(k.length),vy:new Float32Array(k.length),uw:new Float32Array(k.length/3),type:e});n.X=d.X;return n};a.ay=c;a.$x=b;a.Cn=h;a.EA=function(a,b,c){l(a,b);a.count=c.length;a.Ee=c;a.sm=c instanceof Uint16Array?M.UNSIGNED_SHORT:
M.UNSIGNED_INT};a.Kk=function(a,b,c,d){var e=a.Vc,f=a.Ob,n=f[b];n?(c&&n.jd!=c&&t.ma('invalid num_comp for "'+b+'"'),e.set(d,n.offset)):(e=e.length,n=new Float32Array(e+d.length),n.set(a.Vc),n.set(d,e),a.Vc=n,f[b]={jd:c,offset:e});g(a)};a.Ew=f;a.qD=function(a){a.Qi=M.STATIC_DRAW};a.ny=function(a){a.Qi=M.DYNAMIC_DRAW};a.Es=g;a.cp=function(a){a.Wd&&M.deleteBuffer(a.Wd);a.df&&M.deleteBuffer(a.df)};a.rq=function(a,b){return a.submeshes[b].base_length?!1:!0};a.ss=function(a,b){for(var c=0;c<a.w.length;c++){var d=
a.w[c].a_position;F.transform_vectors(d,b,d,0);d=a.w[c].a_normal;0<d.length&&F.transform_dir_vectors(d,b,d,0);d=a.w[c].a_tangent;0<d.length&&F.transform_tangents(d,b,d,0)}(c=a.F.au_center_pos)&&c.length&&F.transform_vectors(c,b,c,0);return a};a.iA=function(a,b){var c=a.F.au_center_pos;if(c&&c.length){var d=new Float32Array(c);F.transform_vectors(d,b,d,0);for(var e=0;e<a.w.length;e++)for(var g=0;g<d.length;g++)a.w[e].a_position[g]+=d[g]-c[g];c.set(d)}else throw'Attribute "au_center_pos" is missing in particle submesh';
};a.hA=function(a,b){var c=a.I,d;for(d in b){var e=b[d].length;a.F[d]=new Float32Array(e*c);for(var g=0;g<c;g++)for(var f=0;f<e;f++)a.F[d][g*e+f]=b[d][f]}};a.jA=m;a.my=function(a,b,c){if(!a.I)return t.gb("EMPTY");var d=c.length;65536<a.I*d&&!y.$p()&&h(a,d);var e=a.aa,g=a.I,f=a.F;a=a.w;for(var n in b){var k=b[n].length,m=k*g;f[n]=new Float32Array(m);for(var l=0;l<g;l++)for(m=0;m<k;m++)f[n][l*k+m]=b[n][m]}b=t.gb("CLONE_"+d+"_SUBMESHES");b.I=g*d;b.aa=new Uint32Array(e.length*d);for(l=0;l<d;l++)for(k=
e.length*l,n=g*l,m=0;m<e.length;m++)b.aa[k+m]=e[m]+n;for(var u in f)for(e=f[u],m=e.length*d,k=z(e,g),b.F[u]=new Float32Array(m),l=0;l<d;l++)n=g*k*l,b.F[u].set(e,n);for(u in a[0])for(l=0;l<a.length;l++)for(e=a[l][u],m=e.length*d,k=z(e,g),b.w[l]=b.w[l]||{},b.w[l][u]=new Float32Array(m),m=0;m<d;m++)switch(f=c[m],n=g*k*m,u){case "a_position":F.transform_vectors(e,f,b.w[l][u],n);break;case "a_normal":F.transform_dir_vectors(e,f,b.w[l][u],n);break;case "a_tangent":F.transform_tangents(e,f,b.w[l][u],n);
break;default:throw"Wrong attribute name: "+u;}return b};a.Hp=k;a.Hw=function(a){var b=a.I,c=a.w[0].a_position,d=new Float32Array(12*b),e=new Float32Array(8*b);a=new Uint16Array(4*a.aa.length);for(var g=0;g<b;g++)d[12*g]=c[3*g],d[12*g+1]=c[3*g+1],d[12*g+2]=c[3*g+2],d[12*g+3]=c[3*g],d[12*g+4]=c[3*g+1],d[12*g+5]=c[3*g+2],d[12*g+6]=c[3*g],d[12*g+7]=c[3*g+1],d[12*g+8]=c[3*g+2],d[12*g+9]=c[3*g],d[12*g+10]=c[3*g+1],d[12*g+11]=c[3*g+2],e[8*g]=-.5,e[8*g+1]=-.5,e[8*g+2]=-.5,e[8*g+3]=.5,e[8*g+4]=.5,e[8*g+5]=
.5,e[8*g+6]=.5,e[8*g+7]=-.5,a[6*g]=4*g+2,a[6*g+1]=4*g+1,a[6*g+2]=4*g,a[6*g+3]=4*g+2,a[6*g+4]=4*g,a[6*g+5]=4*g+3;c=t.gb("HALO");c.w=[];c.w[0]={};c.I=4*b;c.w[0].a_position=d;c.F.a_halo_bb_vertex=e;c.aa=a;return c};a.Nx=r;a.Iw=function(a){for(var b=["a_position","a_normal"],c=[],d=0;d<a.submeshes.length;d++){var e=k(a,d,b,null,null,null);e.I&&c.push(e)}return 0==c.length?t.gb("EMPTY"):1==c.length?c[0]:m(c)};a.DA=function(a,b,c){for(var d=a.Ee,e=f(a,"a_position"),g=a.Qj,n=g.uy,k=g.vy,g=g.uw,m=d,h=m.length/
3,l=0;l<h;l++){var u=m[3*l],r=m[3*l+1],x=m[3*l+2],q=e[3*u+1],z=e[3*u+2],A=e[3*r+1],P=e[3*r+2],C=e[3*x+1],E=e[3*x+2];n[3*l]=(e[3*u]+e[3*r]+e[3*x])/3;n[3*l+1]=(q+A+C)/3;n[3*l+2]=(z+P+E)/3}t.Me(n,b,k);b=k.length/3;for(e=0;e<b;e++)n=k[3*e]-c[0],m=k[3*e+1]-c[1],h=k[3*e+2]-c[2],g[e]=n*n+m*m+h*h;c=d;d=g.length;if(!(2>d))for(k=d,e=!1;1<k||e;)for(1<k&&(k=Math.floor(k/1.247330950103979)),e=!1,b=0;k+b<d;b++)0>g[b]-g[b+k]&&(e=g[b],g[b]=g[b+k],g[b+k]=e,e=c,n=b,m=b+k,h=e[3*n],l=e[3*n+1],u=e[3*n+2],e[3*n]=e[3*m],
e[3*n+1]=e[3*m+1],e[3*n+2]=e[3*m+2],e[3*m]=h,e[3*m+1]=l,e[3*m+2]=u,e=!0);d=c;M.bindBuffer(M.ELEMENT_ARRAY_BUFFER,a.Wd);M.bufferData(M.ELEMENT_ARRAY_BUFFER,d,M.DYNAMIC_DRAW)};a.es=E;a.So=function(a,b,c){for(var d=b.length/3,e=a.length/3,g=[],f=Array(3),n=Array(3),k=Array(3),m=0;m<e;m++){for(var h=a[3*m],l=a[3*m+1],t=a[3*m+2],u=0;3>u;u++)f[u]=b[3*h+u],n[u]=b[3*l+u],k[u]=b[3*t+u];if(c)var u=A(f,n,k),r=A(n,k,f),x=Math.PI-u-r;else x=r=u=1;var q=g,P;P=f;var z=k,C=[],E=[],ba=[];L.subtract(n,P,C);L.subtract(z,
P,E);L.cross(C,E,ba);L.normalize(ba,ba);P=ba;for(z=0;3>z;z++)C=3*l+z,E=3*t+z,q[3*h+z]=u*P[z],q[C]=r*P[z],q[E]=x*P[z]}if(c)for(var Y in c)for(m=c[Y],a=0;3>a;a++){b=3*m[0]+a;for(e=1;e<m.length;e++)f=3*m[e]+a,g[b]+=g[f];for(e=1;e<m.length;e++)f=3*m[e]+a,g[f]=g[b]}for(m=0;m<d;m++){c=m;Y=g;a=new Float32Array(3);for(b=0;3>b;b++)e=3*c+b,a[b]=Y[e];L.normalize(a,a);for(b=0;3>b;b++)e=3*c+b,Y[e]=a[b]}return g};a.Uo=function(a,b,c){for(var d={},e=b.length/3,g=0;g<e;g++){var f=String(b[3*g])+String(b[3*g+1])+
String(b[3*g+2]);d[f]=[]}e=a.length;for(g=0;g<e;g++)b=a[g],f=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),f in d&&d[f].push(b);return d};a.fm=function(a,b,c,d){var g=n(a,null,!1);if(c)var f=n(a,null,!0);var k=g.length,m=new Float32Array(k),h=C,l=H;for(a=0;a<k;a++){var u=g[a];h.set(u.subarray(0,3));l.set(u.subarray(3,6));K.set(u.subarray(6));m[a]=Math.sqrt(e(h,l,K))}h=new Float32Array(k);h[0]=m[0];for(a=1;a<k;a++)h[a]=h[a-1]+m[a];k=h[m.length-1];m=[];for(a=0;a<b;a++){var l=k*t.Hc(d),l=t.mj(h,l,
0,h.length-1),u=c?f[l]:g[l],l=a,r=u,x=d,u=void 0,u=new Float32Array(3),q=r[0],z=r[1],A=r[2],E=r[3],P=r[4],ga=r[5],p=r[6],y=r[7],ba=r[8],r=t.Hc(x),x=t.Hc(x);1<r+x&&(r=1-r,x=1-x);var Y=1-r-x,z=Y*z+r*P+x*y,A=Y*A+r*ga+x*ba;u[0]=Y*q+r*E+x*p;u[1]=z;u[2]=A;m[l]=u}return m};a.sC=n;a.Gp=u;a.PD=e;a.zx=function(a,b,c,d){var e=b[0]-a[0],g=c[0]-a[0],f=b[1]-a[1],n=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];d[0]=f*a-b*n;d[1]=g*b-e*a;d[2]=e*n-f*g;return d};a.nz=function(a,b,c){a=a.w[0].a_position;for(var d=0;d<a.length;d+=
3)a[d]=(a[d]-c[0])*b[0]+c[0],a[d+1]=(a[d+1]-c[1])*b[1]+c[1],a[d+2]=(a[d+2]-c[2])*b[2]+c[2]};a.Gu=function(a,b,c){var d=a.n;a=a.d.Se;for(var e=1;e<a.length;e++)a[e].name==b&&(a[e].value=c);for(e=0;e<d.length;e++)if(!d[e].Ef&&d[e].vd&&!d[e].Eg){var g=d[e].R.Ob;b=d[e].R.Vc;M.bindBuffer(M.ARRAY_BUFFER,d[e].R.df);if(g.a_position){var f=g.a_position.offset,n=g.a_position.length+f,k=d[e].R.X[0].Jb.a_position;for(c=f;c<n;c++)b[c]=k[c-f];for(k=1;k<d[e].R.X.length;k++){var m=d[e].R.X[k].Jb.a_position,h=a[k].value;
if(h)for(c=f;c<n;c++)b[c]+=h*m[c-f]}M.bufferSubData(M.ARRAY_BUFFER,4*f,b.subarray(f))}if(g.a_normal){f=g.a_normal.offset;n=g.a_normal.length+f;k=d[e].R.X[0].Jb.a_normal;for(c=f;c<n;c++)b[c]=k[c-f];for(k=1;k<d[e].R.X.length;k++)if(m=d[e].R.X[k].Jb.a_normal,h=a[k].value)for(c=f;c<n;c++)b[c]+=h*m[c-f];O(b,f,n,3,2);M.bufferSubData(M.ARRAY_BUFFER,4*f,b.subarray(f))}if(g.a_tangent){f=g.a_tangent.offset;g=g.a_tangent.length+f;k=d[e].R.X[0].Jb.a_tangent;for(c=f;c<g;c++)b[c]=k[c-f];for(k=1;k<d[e].R.X.length;k++)if(n=
d[e].R.X[k].Jb.a_tangent,h=a[k].value)for(c=f;c<g;c++)b[c]+=h*n[c-f];O(b,f,g,4,3);M.bufferSubData(M.ARRAY_BUFFER,4*f,b.subarray(f))}}};a.check_shape_keys=function(a){return a.d.vd};a.get_shape_keys_names=function(a){var b=[];if(a.d)for(var c=1;c<a.d.Se.length;c++)b.push(a.d.Se[c].name);return b};a.get_shape_key_value=function(a,b){if(a.d)for(var c=1;c<a.d.Se.length;c++)if(b==a.d.Se[c].name)return a.d.Se[c].value;return 0};a.tq=function(a,b){var c=a.d.Se;if(c)for(var d=1;d<c.length;d++)if(c[d].name==
b)return!0;return!1};a.gi=function(a){return a&&a.d&&a.d.bd?!0:!1}};b4w.module.__objects=function(a,p){function c(a){a={type:a,ad:0,Mx:[0,0],g:new Float32Array(3),quat:new Float32Array(4),ub:new Float32Array(8),T:new Float32Array(16),zq:new Float32Array(16),Nb:new Float32Array(3),lc:new Float32Array(3),Sg:0,Tg:0,wm:!1,yj:null,Qc:0,Gk:!1,Hs:!1,da:0,Tn:1,Sn:1,Un:1,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,Bf:null,Bs:!1,Pd:0,Af:0,cb:!1,Wb:null,wd:null,Kb:null,Ql:!0,H:null,ti:null,bi:0,Wh:0,am:0,pi:0,Tf:0,zr:"",Lk:!1,rc:!1,Eb:!1,bc:!1,Pb:!1,Db:!1,Rc:!1,uf:!1,
xd:!1,Ej:!1,bd:!1,Ya:!1,Fg:!1,Rg:!1,Yj:!1,hg:!1,ik:!1,Ab:!1,hk:!1,er:!1,Wj:!1,is_visible:!1,bm:!1,Vi:0,yd:0,kf:0,ve:0,ue:0,re:0,Yd:"",Cb:null,lj:!1,Kd:!1,Nh:"",ol:!1,Ff:0,time:0,Rn:0,Js:0,Pc:0,ai:!1,Ok:!1,vd:!1,Se:[],li:!1,pe:!1,oe:1,bl:0,al:1,Ik:new Int8Array([-1,-1]),Ck:[],Vq:[],as:[],pc:null,oc:null,wc:null,vc:null,Bc:null,Ar:null,fl:null,el:null,Zd:null,Vf:null,$j:null,mc:null,Uf:null,ak:null,Ib:null,ll:null,jl:null,kl:null,Wa:null,Lc:null,xb:null,sf:null,tf:null,scale:1,He:1E4};L.identity(a.quat);
t.identity(a.ub);H.identity(a.T);H.identity(a.zq);return a}function b(a){var b=a.parent;if(b&&b.wg)return!0;switch(a.type){case "MESH":var c=k.Tj(a),d=a.b4w_do_not_batch,g=a.b4w_collision,f=a.b4w_vehicle,n=a.b4w_floating,b=a.b4w_character,m=a.b4w_billboard,h=O.Px(a),l=e.sq(a),t=0<a.data.b4w_shape_keys.length,u=a.b4w_dynamic_geometry;if(!(c=c||d||g||f||t||n))a:{a=a.data;for(c=0;c<a.materials.length;c++)if("LENS_FLARES"===a.materials[c].name){c=!0;break a}c=!1}return c||h||b||m||l||u;case "EMPTY":return b=
k.Tj(a),m=e.sq(a),a=a.b4w_do_not_batch,b||m||a;default:return!0}}function h(a,b,c,e,g,f,n,k,m){for(var l=0;l<a.nodes.length;l++){var t=a.nodes[l];if("VALUE"==t.type){var u=b+t.name;e.push(t.outputs[0].default_value);g.push(u,g.length/2)}else"RGB"==t.type?(u=b+t.name,t=t.outputs[0].default_value.slice(0,3),n.push(t[0],t[1],t[2]),k.push(u,k.length/2)):"GROUP"==t.type&&(u=t.node_group.node_tree,h(u,b+t.name+"%join%",u.animation_data,e,g,f,n,k,m))}if(c)for((a=c.action)&&d(a,b,f,g,m,k),c=c.nla_tracks,
e=0;e<c.length;e++)for(n=c[e].strips,l=0;l<c[e].strips.length;l++)a=n[l].action,d(a,b,f,g,m,k)}function d(a,b,c,d,e,g){var n=a.d.L,k;for(k in n){var m=b+k.match(/"(.*?)"/)[1],n=f(d,m);null!=n?(m=a.name+"%join%"+k,c.push(m,n)):(n=f(g,m),null!=n&&(m=a.name+"%join%"+k,e.push(m,n)))}}function f(a,b){for(var c=0;c<a.length;c+=2)if(a[c]==b)return a[c+1];return null}function l(a,b,c){return{name:a,type:b,modifiers:[],particle_systems:[],constraints:[],data:null,parent:null,b4w_vehicle_settings:null,b4w_floating_settings:null,
b4w_character_settings:null,b4w_vehicle:!1,b4w_character:!1,b4w_floating:!1,n:[],po:c,yc:[],me:[],Fd:[],Kc:null,Oa:null,zc:null,i:null,B:[],l:null,h:null,fa:null}}function g(a){return a instanceof Array?a.slice():a}function m(a){if("object"!=typeof a||null===a)return a;var b=a instanceof Array?[]:{},c=null,d=null,e=null;a.M&&(c=a.M,a.M=null);a.Gb&&(d=a.Gb,a.Gb=null);a.X&&(e=a.X,a.X=null);for(var g in a)b[g]=a[g]&&"object"==typeof a[g]?a[g]instanceof Float32Array?new Float32Array(a[g]):a[g]instanceof
Uint32Array?new Uint32Array(a[g]):a[g]instanceof Uint16Array?new Uint16Array(a[g]):a[g]instanceof WebGLUniformLocation?a[g]:a[g]instanceof WebGLProgram?a[g]:a[g]instanceof WebGLShader?a[g]:a[g]instanceof WebGLBuffer?null:m(a[g]):a[g];c&&(b.M=c,a.M=c);d&&(b.Gb=d,a.Gb=d);e&&(b.X=e,a.X=e);return b}var k=p("__animation"),x=p("__batch"),r=p("__boundings"),q=p("__camera"),z=p("__config"),E=p("__constraints"),A=p("__curve"),n=p("__geometry"),u=p("__lights"),e=p("__nla"),O=p("__particles"),I=p("__scenes"),
F=p("__transform"),t=p("__tsr"),y=p("__util"),L=p("quat"),C=p("vec3"),H=p("mat4"),K=z.Ab,M=0,G=new Float32Array(4);a.Aj=c;a.Pn=function(a,d){var e=b(a);a.wg=e;a.d=c("MESH"===a.type?e?"DYNAMIC":"STATIC":a.type);a.po=!1;a.Oa=null;a.yc=[];a.B=[];a.l=null;a.h=null;a.fa=null;a.ua||(a.ua=null);var e=a.d,g=a.location,f=a.scale[0];y.Ty(a.rotation_quaternion,G);F.set_translation(a,g);F.set_rotation(a,G);F.set_scale(a,f);switch(a.type){case "ARMATURE":g=a.pose.bones;for(f=0;f<g.length;f++){var n=g[f],m=n.bone,
l=new Float32Array(m.matrix_local),z=new Float32Array(16);H.invert(l,z);var p=new Float32Array(n.matrix_basis),w=new Float32Array(3);C.subtract(m.tail_local,m.head_local,w);y.dB(w,z,w);n.ju=w;n.du=[n].concat(n.parent_recursive);n.ro=t.from_mat4(l,t.create());n.qo=t.from_mat4(p,t.create());n.Wk=t.create();n.ej=!1}g=k.Xu(a);e.Bc=g;g=k.To(a,g);a.b4w_animation_mixing?(e.pc=new Float32Array(g.ta),e.oc=new Float32Array(g.ta),e.wc=new Float32Array(g.g),e.vc=new Float32Array(g.g)):(e.pc=g.ta,e.oc=g.ta,e.wc=
g.g,e.vc=g.g);e.Ar=g;e.Ff=0;e.pe=a.b4w_animation_mixing;break;case "MESH":e.hg=K.outlining_overview_mode||a.b4w_selectable;e.ik=a.b4w_selectable;e.Ab=K.outlining_overview_mode||a.b4w_outlining;e.hk=a.b4w_outlining;e.er=K.outlining_overview_mode||a.b4w_outline_on_select;e.Kd=a.b4w_billboard;e.Su=a.b4w_pres_glob_orientation;e.Nh="BASIC";e.ol="SPHERICAL"==a.b4w_billboard_geometry;e.ti={jk:a.b4w_outline_settings.outline_duration,lk:a.b4w_outline_settings.outline_period,mk:a.b4w_outline_settings.outline_relapses};
e.hg&&(a.d.yj=y.Rp(M),M++);if("MESH"!=a.type)throw"Wrong object type: "+a.name;a.d.Ok=a.data.b4w_vertex_anim.length?!0:!1;if("MESH"!=a.type)throw"Wrong object type: "+a.name;f=a.d;if(a.data.b4w_shape_keys.length)for(f.vd=!0,g=0;g<a.data.b4w_shape_keys.length;g++)n={},n.value=a.data.b4w_shape_keys[g].value,n.name=a.data.b4w_shape_keys[g].name,f.Se.push(n);else f.vd=!1;if(f=k.get_first_armature_object(a)){g=a.d;n=a.data.vertex_groups;if(n.length){m=f.data.bones;l=f.pose.bones;z=0;p={};for(w=0;w<m.length;w++){var O=
m[w].name,ma=y.keysearch("name",O,n);if(ma){var fa=y.jm(l,"name",O);p[O]={Qo:w,Th:z++,en:fa,Ms:ma.index}}}g.Bc=p;g.Pc=z;g.li=!0}g=a.d.Bc;g=k.To(f,g);f.b4w_animation_mixing?(e.pc=new Float32Array(g.ta),e.oc=new Float32Array(g.ta),e.wc=new Float32Array(g.g),e.vc=new Float32Array(g.g)):(e.pc=g.ta,e.oc=g.ta,e.wc=g.g,e.vc=g.g);e.fl=new Float32Array(4);e.el=L.create();e.Ar=g;e.Ff=0}f=a.d;g=a.data.materials;n=[];m=[];l=[];z=[];p=[];w=[];for(O=0;O<g.length;O++)ma=g[O],(fa=ma.node_tree)&&h(fa,ma.name+"%join%",
fa.animation_data,n,m,l,z,p,w);f.Zd=n;f.Vf=m;f.$j=l;f.mc=z;f.Uf=p;f.ak=w;a.n=[];e.rc=a.b4w_shadow_cast;e.Eb=a.b4w_shadow_receive;e.bc=a.b4w_shadow_cast_only&&e.rc;e.Pb=a.b4w_reflexible;e.Db=a.b4w_reflexible_only&&e.Pb;e.Rc=a.b4w_reflective;e.uf=a.b4w_caustics;e.xd=a.b4w_wind_bending;e.Vi=a.b4w_wind_bending_angle;f=x.jB(a.b4w_wind_bending_angle,x.Ou(a.data.b4w_bounding_box),a.scale[0]);e.yd=f;e.kf=a.b4w_wind_bending_freq;e.ve=a.b4w_detail_bending_freq;e.ue=a.b4w_detail_bending_amp;e.re=a.b4w_branch_bending_amp;
e.Rg=!1;e.Yd=a.b4w_main_bend_stiffness_col;f=a.b4w_detail_bend_colors;e.Cb={};e.Cb.Oq=f.leaves_stiffness_col;e.Cb.Nq=f.leaves_phase_col;e.Cb.gr=f.overall_stiffness_col;e.Fg=a.b4w_do_not_cull;e.Ej=a.b4w_disable_fogging;e.bd=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";f=a.data.materials[0];e.bi=f.physics.friction;e.Wh=f.physics.elasticity;e.pi=0;e.He=1E4;e.Tf=a.b4w_lod_transition;e.Yj=!0;break;case "CAMERA":q.$u(a);q.Ku(a);break;case "LAMP":u.gy(a);break;case "CURVE":if(f=A.Yv(a))a.iu=
f;break;case "EMPTY":e.Ib=r.zd(),f=r.Wi(),e.Lc=f}if(!d&&(a.parent&&"OBJECT"==a.parent_type?(g=e.g,n=e.quat,f=e.scale,E.Bo(a,a.parent,g,n,f)):a.parent&&"BONE"==a.parent_type&&"ARMATURE"==a.parent.type?(g=e.g,n=e.quat,f=e.scale,E.Ao(a,a.parent,a.parent_bone,g,n,f)):a.ua&&a.ua.b4w_group_relative?(f=t.create_sep(e.g,e.scale,e.quat),E.ou(a,a.ua,f)):a.ua&&!a.ua.b4w_group_relative&&(F.A(a),t.multiply(a.ua.d.ub,a.d.ub,a.d.ub),F.set_translation(a,t.get_trans_view(a.d.ub)),F.set_scale(a,t.get_scale(a.d.ub)),
F.set_rotation(a,t.get_quat_view(a.d.ub))),f=a.dupli_group))for(g=f.objects,f=0;f<g.length;f++)g[f].ua=a;a.field&&(e.am=a.field.strength,I.Ds(a));e.Lk=a.game.use_collision_compound;e.zr=a.game.physics_type;F.A(a)};a.MA=function(a){for(var b=0;b<a.length;b++){var c=a[b];!c.d||"DYNAMIC"!=c.d.type&&"CAMERA"!=c.d.type||F.A(c);c.b4w_use_default_animation&&k.Tj(c)&&(k.apply_def(c),c.B.length&&k.play(c,null,k.SLOT_ALL))}};a.Xb=function(a){return a.wg?!0:!1};a.ii=function(a){return"MESH"==a.type&&a.wg?!0:
!1};a.get_meta_tags=function(a){a=a.b4w_object_tags;return{title:a?a.title:"",description:a?a.description:"",category:a?a.category:""}};a.cleanup=function(){M=0};a.xq=l;a.copy=function(a,b,c){b=l(b,a.type,!1);var d=[];if(c){for(var e=0;e<a.n.length;e++)a.n[e].Ef||(b.n.push(m(a.n[e])),d.push(a.n[e].R));for(e=0;e<a.n.length;e++)if(a.n[e].Ef){var f=m(a.n[e]);b.n.push(f);for(var k=0;k<d.length;k++)d[k]==a.n[e].R&&(f.R=b.n[k].R)}}else b.n=g(a.n);b.d=m(a.d);a.wg&&(b.wg=a.wg);a.ua&&(b.ua=a.ua);a.Fd&&(b.Fd=
g(a.Fd));!a.l||a.b4w_vehicle||a.b4w_character||a.b4w_floating||(b.l=m(a.l));b.game=m(a.game);b.b4w_collision_id=a.b4w_collision_id;b.b4w_correct_bounding_offset=a.b4w_correct_bounding_offset;b.b4w_collision=a.b4w_collision;b.data=a.data;b.particle_systems=c?m(a.particle_systems):g(a.particle_systems);if(c)for(e=0;e<b.n.length;e++){b.n[e].R&&n.Es(b.n[e].R);if("PARTICLES"==b.n[e].type&&b.n[e].gn)for(k=0;k<b.yD.length;k++)if(b.particle_systems[k].name==b.n[e].gn){b.n[e].nc=b.particle_systems[k];break}b.n[e].eh=
b.uuid;x.BA(b.n[e],y.Ag(b.d,0))}b.uuid=y.Tp();b.d.wm=!0;b.d.yj=y.Rp(M);M++;return b};a.Av=m;a.Hx=function(a,b){for(var c=a.d.Vf,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null};a.Bx=function(a,b){for(var c=a.d.Uf,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}};b4w.module.__particles=function(a,p){function c(){throw"_rand() undefined";}function b(a,b,c,d,g,e,f){var k=a.P.Nl,h=a.P.cd,l=a.P.time;a=a.P.Cr;for(var x=b?4:1,p=0;p<k.length;p+=x){var C=k[p];if(C>a&&C<=l)for(C=0;8>C;C++)h[8*p+C]=g[C];for(C=0;8>C;C++)r[C]=h[8*p+C];C=q;C[0]=c[3*p];C[1]=c[3*p+1];C[2]=c[3*p+2];m.transform_vec3(C,r,C);e[3*p]=C[0];e[3*p+1]=C[1];e[3*p+2]=C[2];var H=q;H[0]=d[3*p];H[1]=d[3*p+1];H[2]=d[3*p+2];m.transform_dir_vec3(H,r,H);f[3*p]=H[0];f[3*p+1]=H[1];f[3*p+2]=H[2];if(b)for(C=1;4>
C;C++)e[3*(p+C)]=e[3*p],e[3*(p+C)+1]=e[3*p+1],e[3*(p+C)+2]=e[3*p+2],f[3*(p+C)]=H[0],f[3*(p+C)+1]=H[1],f[3*(p+C)+2]=H[2]}}function h(a){a?(g.eA(a),c=function(){return g.Uy()}):c=function(){return Math.random()}}var d=p("__config"),f=p("__geometry"),l=p("__scenes"),g=p("__util"),m=p("__tsr"),k=p("vec3"),x=d.Hd,r=new Float32Array(8),q=new Float32Array(3);a.Qg=function(a){return 0<a.particle_systems.length?!0:!1};a.pm=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;
return!1};a.QC=function(a){for(var b=0;b<a.particle_systems.length;b++)if("HAIR"==a.particle_systems[b].settings.type)return!0;return!1};a.Px=function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.Zw=function(a,d,m,n){m.P=m.P||{};var l=f.Iw(d),e=m.settings.count,r=m.settings.frame_start/x.Ia,q=m.settings.frame_end/x.Ia,p=m.settings.lifetime/x.Ia,t=m.settings.lifetime_random,y=m.settings.emit_from,L=
m.settings.factor_random,C=m.settings.angular_velocity_mode,H=m.settings.angular_velocity_factor,K=m.settings.b4w_randomize_emission,M=m.settings.b4w_cyclic;h(m.seed);var G=m.P.aB="WORLD"==m.settings.b4w_coordinate_system?!0:!1;m.P.frame=0;if(d=!a.If){var v;v=[];for(var N=0;N<e;N++)v.push(-.5,-.5,-.5,.5,.5,.5,.5,-.5);v=new Float32Array(v);for(var N=[],J=0;J<e;J++)N.push(4*J,4*J+2,4*J+1,4*J,4*J+3,4*J+2);N=new Uint16Array(N)}switch(y){case "VERT":for(var J=l.w[0].a_position,l=l.w[0].a_normal,R=J.length/
3,y=[],V=0;V<e;V++){var ca=Math.round((R-1)*c());y.push(ca);d&&(y.push(ca),y.push(ca),y.push(ca))}R=[];for(V=0;V<y.length;V++)R.push(J[3*y[V]]),R.push(J[3*y[V]+1]),R.push(J[3*y[V]+2]);J=new Float32Array(R);R=[];for(V=0;V<y.length;V++)R.push(l[3*y[V]]),R.push(l[3*y[V]+1]),R.push(l[3*y[V]+2]);y=new Float32Array(R);break;case "FACE":J=[];y=[];V=[];g.Rj(0,V);R=f.fm(l,e,!1,V);g.Rj(0,V);l=f.fm(l,e,!0,V);for(V=0;V<R.length;V++)J.push(R[V][0],R[V][1],R[V][2]),d&&(J.push(R[V][0],R[V][1],R[V][2]),J.push(R[V][0],
R[V][1],R[V][2]),J.push(R[V][0],R[V][1],R[V][2])),y.push(l[V][0],l[V][1],l[V][2]),d&&(y.push(l[V][0],l[V][1],l[V][2]),y.push(l[V][0],l[V][1],l[V][2]),y.push(l[V][0],l[V][1],l[V][2]));J=new Float32Array(J);y=new Float32Array(y);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}y=[J,y];l=y[0];y=y[1];m.P.yi=new Float32Array(l);m.P.Cy=new Float32Array(y);m.P.My=new Float32Array(l.length);m.P.Dy=new Float32Array(y.length);m.P.time=0;m.P.Cr=
-1;J=[];q=(q-r)/e;for(R=0;R<e;R++)V=K?q*R+10*q*(.5-c()):q*R,M||(V+=r),J.push(V),d&&(J.push(V),J.push(V),J.push(V));r=new Float32Array(J);m.P.Nl=new Float32Array(r);m.P.up=new Float32Array(r);m.P.cd=new Float32Array(8*r.length);for(K=0;K<8*r.length;K++)for(M=0;8>M;M++)m.P.cd[8*K+M]=n[M];G&&b(m,d,l,y,n,l,y);m=[];n=p*t;for(t=0;t<e;t++)G=n*c(),m.push(p-G),d&&(m.push(p-G),m.push(p-G),m.push(p-G));p=new Float32Array(m);m=[];for(n=0;n<e;n++){t=[c()-.5,c()-.5,c()-.5];k.normalize(t,t);m.push(L*t[0]);m.push(L*
t[1]);m.push(L*t[2]);switch(C){case "NONE":m.push(0);break;case "SPIN":case "VELOCITY":m.push(H);break;case "RAND":m.push(2*H*(c()-.5));break;default:throw"Undefined velocity factor";}if(d)for(t=m.slice(-4),G=0;12>G;G++)m.push(t[G%4])}e=new Float32Array(m);L=g.gb("EMITTER_PARTICLES");C=g.Mc();C.a_position=l;C.a_normal=y;L.w[0]=C;d?(a.Qd=f.Zi,L.aa=N):(a.Qd=f.ho,L.aa=new Uint16Array(0));L.I=l.length/3;L.F.a_p_delay=r;L.F.a_p_lifetime=p;L.F.a_p_vels=e;d&&(L.F.a_p_bb_vertex=v);return L};a.JA=function(a){for(var c=
a.n,d=0;d<c.length;d++){var g=c[d],k=c[d].nc;if(k){var e=g.R;if(!k.P.aB)break;var m=k.P.My,l=k.P.Dy;b(k,!g.If,k.P.yi,k.P.Cy,a.d.ub,m,l);f.ny(e);f.Kk(e,"a_position",3,m);f.Kk(e,"a_normal",3,l)}}};a.wz=function(a,b,c){var d=b.settings.lifetime/x.Ia,g=b.settings.normal_factor,e=9.81*b.settings.effector_weights.gravity,f=b.settings.effector_weights.wind,k=b.settings.mass,m=b.settings.b4w_fade_in/x.Ia,h=b.settings.b4w_fade_out/x.Ia,r=b.settings.b4w_cyclic;a.pr=b.settings.frame_end/x.Ia-b.settings.frame_start/
x.Ia;a.lr=r?1:0;a.an=g;a.or=e;g=l.Kx();a.nk[0]=g[0]*f;a.nk[1]=g[1]*f;a.nk[2]=g[2]*f;a.rr=d;a.qr=k;a.mr=m;a.nr=h;a.If?(d=c.halo.size,f=c.halo.hardness,30>f?(f=.5,k=.9):40>f?(f=.1,k=1):50>f?(f=0,k=.8):(f=0,k=.5)):(d=b.settings.particle_size,k=f=1);a.bn=d;a.ir=f;a.hr=k;d=b.settings.texture_slots;b=[-1,0,-1,0,-1,0,-1,0];if(d[0]&&d[0].use_map_size&&d[0].texture&&"BLEND"==d[0].texture.type&&d[0].texture.use_color_ramp){d=d[0].texture.color_ramp.elements;f=Math.min(2*d.length,b.length);for(k=0;k<f;k+=2)m=
d[k/2],b[k]=m.position,b[k+1]=(m.color[0]+m.color[1]+m.color[2])/3;a.tr=d.length}a.sr.set(b);b=c.texture_slots;c=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(b[0]&&"STRAND"==b[0].texture_coords&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp){d=b[0].texture.color_ramp.elements;f=Math.min(4*d.length,c.length);for(k=0;k<f;k+=4)m=d[k/4],c[k]=m.position,c[k+1]=m.color[0],c[k+2]=m.color[1],c[k+3]=m.color[2];a.kr=d.length}a.jr.set(c)};a.Gz=function(a,b){a.P.Cr=a.P.time;a.P.time=b};a.Oy=
function(a){for(var b=a.I,c=a.w[0].a_position,d=a.F.a_texcoord,g=[],e=[],f=0;f<b;f++)e.push(c[3*f]),e.push(c[3*f+1]),g.push(c[3*f+2]);g=new Float32Array(g);e=new Float32Array(e);a.F.a_lf_dist=g;a.F.a_lf_bb_vertex=e;a.F.a_texcoord=d;return a};a.set_size=function(a,b,c){a=a.n;for(var d=0;d<a.length;d++){var g=a[d],e=g.nc;e&&e.name==b&&(g.bn=c)}};a.set_normal_factor=function(a,b,c){a=a.n;for(var d=0;d<a.length;d++){var g=a[d],e=g.nc;e&&e.name==b&&(g.an=c)}};a.set_factor=function(a,b,c){a=a.n;for(var d=
0;d<a.length;d++){var g=a[d],e=g.nc;if(e&&e.name==b){var k=e.P.Nl;if(1==c)e=k;else if(0==c)for(var m=!g.If,l=m?4:1,e=e.P.up,h=0;h<e.length;h+=l)e[h]=1E4,m&&(e[h+1]=e[h],e[h+2]=e[h],e[h+3]=e[h]);else for(var r=1/c,e=e.P.up,l=(m=!g.If)?4:1,x=0,h=0;h<e.length;h+=l)h>=x?(e[h]=k[h],x+=r):e[h]=1E4,m&&(e[h+1]=e[h],e[h+2]=e[h],e[h+3]=e[h]);f.Kk(g.R,"a_p_delay",1,e)}}};a.SA=function(a,b,c){a=a.particle_systems;for(var d=0;d<a.length;d++){var g=a[d];if("EMITTER"==g.settings.type)for(var e=g.P.Nl,d=0;d<8*e.length;d++)g.P.cd[8*
d]=b[0],g.P.cd[8*d+1]=b[1],g.P.cd[8*d+2]=b[2],g.P.cd[8*d+3]=b[3],g.P.cd[8*d+4]=c[0],g.P.cd[8*d+5]=c[1],g.P.cd[8*d+6]=c[2],g.P.cd[8*d+7]=c[3]}}};b4w.module.__primitives=function(a,p){function c(a,b,c,d){for(var g=[],f=[],h=[],A=[],n=2*c/(a-1),u=2*d/(b-1),e=0;e<a;e++)for(var p=-c+e*n,I=0;I<b;I++)if(f.push(p,0,-d+I*u),h.push(0,1,0),A.push(e/(a-1),I/(b-1)),e&&I){var F=e*b+I,t=F-1,y=(e-1)*b+I,L=y-1;g.push(F,t,y);g.push(t,L,y)}a=l.Mc();a.a_position=new Float32Array(f);a.a_normal=new Float32Array(h);h=l.gb("GRID_PLANE");h.w[0]=a;h.F.a_texcoord=new Float32Array(A);h.aa=new Uint32Array(g);h.I=f.length/3;return h}function b(a){var b=a.length;if(b%
4)throw"Wrong array";for(var c=[],g=[],f=0;f<b;f+=4){var h=a[f+1],p=a[f+2],A=a[f+3];d(a[f],g);d(h,g);d(p,g);d(A,g);c.push(f,f+1,f+2);c.push(f,f+2,f+3)}a=l.Mc();a.a_position=new Float32Array(g);b=l.gb("FROM_QUADS");b.w[0]=a;b.aa=new Uint32Array(c);b.I=g.length/3;return b}function h(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function d(a,b){b.push(a[0],a[1],a[2])}var f=p("__geometry"),l=p("__util"),g=p("__config").q;a.IC=function(a){for(var b=l.gb("LINE"),c=[],d=0;d<2*a;d++)c.push(d);d=l.Mc();d.a_point=
new Float32Array(c);b.w[0]=d;b.aa=new Uint32Array(c);b.I=2*a;return b};a.JC=function(a,b){var d=c(2,2,a,b);d.name="PLANE";return d};a.HC=c;a.cx=function(a,b,c){function d(a,b){return 1==a%2&&(0==b||b==A-1)||1==b%2&&(0==a||a==p-1)?!0:!1}var h=c/=Math.pow(2,a-1),z=c,p=b+1,A=b+1;b=[];c=[];for(var n=0,u=0,e=-1,O=[],I=0;I<a;I++){for(var F=2*h/(p-1),t=2*z/(A-1),y=[],L=[],C=0,H=0;H<p;H++){for(var K=-h+H*F,M=[],G=0;G<A;G++){var v=-z+G*t;if(K>-n&&K<n&&v>-u&&v<u)M.push(-1),C++;else{for(var N=null,J=0;J<O.length;J+=
3)if(K==O[J]&&v==O[J+1]){N=O[J+2];break}J=null!==N?N:e+1;d(H,G)?(M.push(-2),C++):(null==N&&(0==G||G==A-1||0==H||H==p-1?(N=I==a-1?F:2*F,y.push(K,v,J)):N=F,c.push(K,N,v),e++),M.push(J));if(H&&G)if(1==H)if(d(H-1,G)){if(1<G){var v=J-1,N=L[H-1][G+1],R=N-1;b.push(J,v,R)}else N=L[H-1][G+1],R=N-1;b.push(J,R,N)}else d(H,G)||(v=J-1,N=L[H-1][G],b.push(J,v,N));else if(H==p-1){if(!d(H,G))if(G==A-1)v=J-1,N=L[H-1][G-1],R=L[H-2][G],b.push(J,v,N),b.push(J,N,R);else{var v=J-1,N=L[H-1][G],R=N-1,V=N+1;b.push(J,v,R);
b.push(J,R,N);b.push(J,N,V);2==G&&(V=L[H-2][G-2],b.push(v,V,R))}}else 1==G?d(H,G-1)?(v=L[H-1][G],N=L[H-1][G-1],b.push(J,N,v)):(v=M[G-1],N=L[H-1][G],R=L[H-2][G-1],b.push(J,v,N),b.push(v,R,N)):G==A-1?d(H,G)||(v=M[G-1],N=L[H-1][G-1],R=L[H-2][G],b.push(J,v,N),b.push(J,N,R)):-1!=L[H-1][G]&&-1!=L[H-1][G-1]&&-1!=M[G-1]?(v=M[G-1],N=L[H-1][G],R=L[H-1][G-1],b.push(J,v,N),b.push(v,R,N),G==A-2&&d(H,G+1)&&(V=L[H-1][G+1],b.push(J,N,V))):G==A-2&&d(H,G+1)&&(N=L[H-1][G],V=L[H-1][G+1],b.push(J,N,V))}}L.push(M)}O=y;
n=h;u=z;h*=2;z*=2}2E4>n&&(a=-(2*n)/(p-1),c.push(-2E4,a,-2E4),c.push(-2E4,a,2E4),c.push(-n,a,-u),c.push(-n,a,u),c.push(2E4,a,-2E4),c.push(2E4,a,2E4),c.push(n,a,-u),c.push(n,a,u),J=e+1,b.push(J+3,J+2,J+1,J+2,J+0,J+1,J+6,J+4,J+2,J+4,J+0,J+2,J+5,J+7,J+1,J+7,J+3,J+1,J+5,J+4,J+7,J+7,J+4,J+6));a=l.Mc();a.a_position=new Float32Array(c);h=l.gb("multigrid_plane");h.w[0]=a;h.aa=new Uint32Array(b);h.I=c.length/3;g.Rs&&(f.Cn(h,1,!0),a.a_polyindex=f.Gp(h));return h};a.GC=function(a){var b=a.length;if(b%3)throw"Wrong array";
for(var c=[],g=[],f=0;f<b;f+=3){var h=a[f+1],p=a[f+2];d(a[f],g);d(h,g);d(p,g);c.push(f,f+1,f+2)}a=l.Mc();a.a_position=new Float32Array(g);b=l.gb("FROM_TRIANGLES");b.w[0]=a;b.aa=new Uint32Array(c);b.I=g.length/3;return b};a.FC=b;a.$w=function(a){a=l.eB(a);var c=[];c.push(a[0],a[1],a[2],a[3]);c.push(a[0],a[3],a[5],a[4]);c.push(a[3],a[2],a[6],a[5]);c.push(a[1],a[7],a[6],a[2]);c.push(a[0],a[4],a[7],a[1]);c.push(a[4],a[5],a[6],a[7]);a=b(c);a.name="FRUSTUM";return a};a.$a=function(){var a=l.gb("FULLSCREEN_TRI"),
b=l.Mc();b.a_position=new Float32Array([0,0,1,0,0,1]);a.w[0]=b;a.aa=new Uint32Array([0,1,2]);a.I=3;return a};a.ax=function(){var a=l.gb("FULLSCREEN_QUAD"),b=l.Mc();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.w[0]=b;a.aa=new Uint32Array([0,2,1,1,2,3]);a.I=4;return a};a.Ww=function(){var a=l.gb("BILLBOARD"),b=l.Mc();b.a_bb_vertex=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.w[0]=b;a.aa=new Uint32Array([0,2,1,0,3,2]);a.I=4;return a};a.Xw=function(){var a=l.gb("CUBEMAP_BOARD"),b=l.Mc();
b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.w[0]=b;a.aa=new Uint32Array([0,2,1,0,3,2]);a.I=4;return a};a.Vp=function(a,b){var c=l.gb("UV_SPHERE"),g,q,z=[],p=[],A=[];for(q=0;8>=q;q++)for(g=0;16>=g;g++){var n=g/16,u=q/8;p.push(-a*Math.cos(2*n*Math.PI)*Math.sin(u*Math.PI)+b[0],a*Math.cos(u*Math.PI)+b[1],a*Math.sin(2*n*Math.PI)*Math.sin(u*Math.PI)+b[2])}for(q=n=0;8>q;q++)for(g=0;16>g;g++){var u=h(p,17*q+g+1),e=h(p,17*q+g),O=h(p,17*(q+1)+g),I=h(p,17*(q+1)+g+1);Math.abs(u[1])==a+b[1]?(d(u,z),
d(O,z),d(I,z),A.push(n,n+1,n+2),n+=3):Math.abs(O[1])==a+b[1]?(d(u,z),d(e,z),d(O,z),A.push(n,n+1,n+2),n+=3):(d(u,z),d(e,z),d(O,z),d(I,z),A.push(n,n+1,n+2),A.push(n,n+2,n+3),n+=4)}g={};g.a_position=z;p=f.Uo(A,p,z);g.a_normal=f.So(A,z,p);g.a_tangent=[];c.F.a_influence=[];c.F.a_color=[];c.F.a_texcoord=[];c.w[0]=g;c.aa=A;c.I=z.length/3;return c};a.Up=function(a){var b=l.gb("INDEX"),c=l.Mc();c.a_index=new Float32Array(a);for(var d=0;d<a;d++)c.a_index[d]=d;b.w[0]=c;b.aa=new Uint16Array(0);b.I=a;return b}};b4w.module.__prerender=function(a,p){var c=p("__config"),b=p("__debug"),h=p("__geometry"),d=p("__util"),f=p("__renderer"),l=p("vec3"),g=c.q,m="MAIN_OPAQUE MAIN_BLEND MAIN_REFLECT SHADOW_CAST DEPTH OUTLINE_MASK WIREFRAME COLOR_PICKING MAIN_XRAY COLOR_PICKING_XRAY".split(" ");a.fn=function(a){if(-1<m.indexOf(a.type)){for(var c=!1,r=a.p,q=0;q<r.length;q++){var z=r[q],p=z,A=a,n=p.ib,u=A.j;p.W=!0;n.is_visible=!1;if(n)if(n.Rg)p.W=!1;else{var e=u.Ce,O=n.xb.D,I=n.He,e=Math.sqrt((O[0]-e[0])*(O[0]-e[0])+(O[1]-
e[1])*(O[1]-e[1])+(O[2]-e[2])*(O[2]-e[2])),O=n.Tf*n.xb.za;e>=n.pi&&e<I+O?(n.is_visible=!0,"OUTLINE_MASK"!=A.type||Boolean(n.Qc)?(u=u.cm,n.Fg?n=!1:"STATIC"===n.type?(I=n.xb,n=I.D,n=d.$z(n,u,I.za)):(I=n.tf,n=I.D,n=d.zw(n,u,I.pf,I.qf,I.rf)),n?p.W=!1:"WIREFRAME"==A.type&&(p.W=p.o.wireframe_mode==b.no.WM_DEBUG_SPHERES?p.o.Eg:!p.o.Eg)):p.W=!1):p.W=!1}else p.W=!1;z.W&&(c=!0)}switch(a.type){case "WIREFRAME":break;default:"MAIN_OPAQUE"===a.type||"DEPTH"===a.type||c?a.W=!0:(a.W&&f.clear(a),a.W=!1)}}if("MAIN_BLEND"==
a.type&&g.alpha_sort&&a.p){c=a.j.Ce;r=l.dist(c,a.Ts)>g.alpha_sort_threshold;for(q=0;q<a.p.length;q++)if(p=a.p[q],z=p.ib,z.bm||r){if((A=p.o)&&A.Ga&&A.je!=h.Ed){A=A.R;if(!A||!p.W)continue;(p=A.Qj)&&p.type==h.oo&&h.DA(A,z.T,c)}z.bm=!1}r&&a.Ts.set(c)}}};b4w.module.__print=function(a){function p(a,b){var c=[];-1<a[0].indexOf("%c")?c.push(a[0].replace("%c","%c"+b+": ")):c.push(b+": "+a[0]);for(var g=1;g<a.length;g++)c.push(a[g]);return c}var c=!1,b=0,h=0;a.Iz=function(a){c=a};a.log=function(){if(c){var a=p(arguments,"B4W LOG");console.log.apply(console,a)}};a.error=function(){b++;var a=p(arguments,"B4W ERROR");console.error.apply(console,a)};a.warn=function(){h++;var a=p(arguments,"B4W WARN");console.warn.apply(console,a)};a.info=function(){var a=
p(arguments,"B4W INFO");console.info.apply(console,a)};a.Cw=function(){b++;var a=p(arguments,"B4W EXPORT ERROR");console.error.apply(console,a)};a.Dw=function(){h++;var a=p(arguments,"B4W EXPORT WARNING");console.warn.apply(console,a)};a.time=function(){c&&console.time.apply(console,arguments)};a.timeEnd=function(){c&&console.timeEnd.apply(console,arguments)};a.group=function(){c&&console.group.apply(console,arguments)};a.groupCollapsed=function(){c&&console.groupCollapsed.apply(console,arguments)};
a.groupEnd=function(){c&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.Jx=function(){return h};a.tx=function(){return b};a.clear_errors_warnings=function(){b=h=0}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,p){function c(a){switch(a.type){case "MAPPING":a.vector_type||(a.vector_type="POINT",b("node Mapping",a,"vector_type"));break;case "MATERIAL":case "MATERIAL_EXT":"specular_shader"in a||(a.specular_shader="COOKTORR",b("node material",a,"specular_shader"));"specular_hardness"in a||(a.specular_hardness=50,b("node material",a,"specular_hardness"));"specular_slope"in a||(a.specular_slope=.1,b("node material",a,"specular_slope"));"specular_toon_size"in a||(a.specular_toon_size=
.5,b("node material",a,"specular_toon_size"));"specular_toon_smooth"in a||(a.specular_toon_smooth=.1,b("node material",a,"specular_toon_smooth"));"specular_intensity"in a||(a.specular_intensity=.5,b("node material",a,"specular_intensity"));"diffuse_shader"in a||(a.diffuse_shader="LAMBERT",b("node material",a,"diffuse_shader"));"roughness"in a||(a.roughness=.5,b("node material",a,"roughness"));"diffuse_fresnel"in a||(a.diffuse_fresnel=.1,b("node material",a,"diffuse_fresnel"));"diffuse_fresnel_factor"in
a||(a.diffuse_fresnel_factor=.5,b("node material",a,"diffuse_fresnel_factor"));break;case "MATH":case "MIX_RGB":"use_clamp"in a||(a.use_clamp=!1,b("node "+a.type,a,"use_clamp"));break;case "GROUP":switch(a.node_tree_name=a.node_tree_name.replace(/\.[0-9]{3,}$/g,""),a.node_tree_name){case "CLAMP":case "LEVELS_OF_QUALITY":case "LINEAR_TO_SRGB":case "NORMAL_VIEW":case "PARALLAX":case "REFLECT":case "REFRACTION":case "REPLACE":case "SMOOTHSTEP":case "SRGB_TO_LINEAR":case "TIME":case "TRANSLUCENCY":case "VECTOR_VIEW":a.node_tree_name=
"B4W_"+a.node_tree_name}}}function b(a,b,c){c=c+">>"+a;c in z||(z[c]={Bn:[],Or:"undefined",type:a});z[c].Bn.push(b.name)}function h(a,b){param_id in z||(z[param_id]={Bn:[],Or:"deprecated",type:a});z[param_id].Bn.push(b.name)}function d(a,b){b||(b=a.name+"_COPY");var c=a.materials,d=a.submeshes;a.materials=null;a.submeshes=null;var e=m.xf(a);a.materials=c;a.submeshes=d;e.name=b;e.materials=a.materials.slice(0);e.submeshes=[];for(c=0;c<d.length;c++){var g=m.vj(d[c]);e.submeshes.push(g)}return e}var f=
p("__boundings"),l=p("__curve"),g=p("__print"),m=p("__util"),k=p("vec3"),x=p("vec4"),r=p("quat"),q=p("mat4"),z={};a.ev=function(a){z={};var d=a.worlds;if(0==d.length){g.warn('WARNING Datablock world is missing, reexport "'+a.b4w_filepath_blend+'" scene');var f={name:"DEFAULT",horizon_color:[0,0,0],zenith_color:[0,0,0],light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},use_sky_paper:!1,use_sky_blend:!1,use_sky_real:!1,b4w_fog_color:[.5,.5,.5],b4w_fog_density:0};
d.push(f)}for(var d=a.worlds,k=0;k<d.length;k++){var f=d[k],e=f.b4w_shadow_settings;"csm_resolution"in e||(b("world",f,"b4w_shadow_settings.csm_resolution"),e.csm_resolution=2048);"self_shadow_polygon_offset"in e||(b("world",f,"b4w_shadow_settings.self_shadow_polygon_offset"),e.self_shadow_polygon_offset=1);"self_shadow_normal_offset"in e||(b("world",f,"b4w_shadow_settings.self_shadow_normal_offset"),e.self_shadow_normal_offset=.01);"b4w_enable_csm"in e||(b("world",f,"b4w_shadow_settings.b4w_enable_csm"),
e.b4w_enable_csm=!1);"csm_num"in e||(b("world",f,"b4w_shadow_settings.csm_num"),e.csm_num=1);"csm_first_cascade_border"in e||(b("world",f,"b4w_shadow_settings.csm_first_cascade_border"),e.csm_first_cascade_border=10);"first_cascade_blur_radius"in e||(b("world",f,"b4w_shadow_settings.first_cascade_blur_radius"),e.first_cascade_blur_radius=3);"csm_last_cascade_border"in e||(b("world",f,"b4w_shadow_settings.csm_last_cascade_border"),e.csm_last_cascade_border=100);"last_cascade_blur_radius"in e||(b("world",
f,"b4w_shadow_settings.last_cascade_blur_radius"),e.last_cascade_blur_radius=1.5);"fade_last_cascade"in e||(b("world",f,"b4w_shadow_settings.fade_last_cascade"),e.fade_last_cascade=!0);"blend_between_cascades"in e||(b("world",f,"b4w_shadow_settings.blend_between_cascades"),e.blend_between_cascades=!0);e=f.b4w_ssao_settings;"dist_factor"in e||(b("world",f,"b4w_ssao_settings.dist_factor"),e.dist_factor=0,e.samples=16);"hemisphere"in e||(b("world",f,"b4w_ssao_settings.hemisphere"),e.hemisphere=!1);"blur_depth"in
e||(b("world",f,"b4w_ssao_settings.blur_depth"),e.blur_depth=!1);"blur_discard_value"in e||(b("world",f,"b4w_ssao_settings.blur_discard_value"),e.blur_discard_value=1);"use_sky_blend"in f||(b("world",f,"use_sky_blend"),f.use_sky_blend=!1);"use_sky_paper"in f||(b("world",f,"use_sky_paper"),f.use_sky_paper=!1);"use_sky_real"in f||(b("world",f,"use_sky_real"),f.use_sky_real=!1);"b4w_outline_color"in f||(f.b4w_outline_color="b4w_glow_color"in f?f.b4w_glow_color:[1,1,1],b("world",f,"b4w_outline_color"));
"b4w_outline_factor"in f||(f.b4w_outline_factor="b4w_glow_factor"in f?f.b4w_glow_factor:1,b("world",f,"b4w_outline_factor"));"b4w_fog_density"in f||(b("world",f,"b4w_fog_density"),f.b4w_fog_density=0);"b4w_sky_settings"in f&&"rayleigh_brightness"in f.b4w_sky_settings||(b("world",f,"rayleigh_brightness"),f.b4w_sky_settings={render_sky:!1,procedural_skydome:!1,use_as_enviroment_map:!1,color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,
mie_strength:.006,rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4});"render_sky"in f.b4w_sky_settings||(b("world",f,"render_sky"),f.b4w_sky_settings.render_sky=!1);"b4w_bloom_settings"in f?("blur"in f.b4w_bloom_settings||(b("world",f,"b4w_bloom_settings.blur"),f.b4w_bloom_settings.blur=4),"edge_lum"in f.b4w_bloom_settings||(b("world",f,"b4w_bloom_settings.edge_lum"),f.b4w_bloom_settings.edge_lum=1)):(b("world",f,"b4w_bloom_settings"),f.b4w_bloom_settings={key:.2,blur:4});
"b4w_motion_blur_settings"in f?("motion_blur_factor"in f.b4w_motion_blur_settings||(b("world",f,"b4w_motion_blur_settings.motion_blur_factor"),f.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in f.b4w_motion_blur_settings||(b("world",f,"b4w_motion_blur_settings.motion_blur_decay_threshold"),f.b4w_motion_blur_settings.motion_blur_decay_threshold=.01)):(b("world",f,"b4w_motion_blur_settings"),f.b4w_motion_blur_settings={motion_blur_factor:.01,motion_blur_decay_threshold:.01});
"b4w_color_correction_settings"in f||(b("world",f,"b4w_color_correction_settings"),f.b4w_color_correction_settings={brightness:0,contrast:0,exposure:1,saturation:1});"steps_per_pass"in f.b4w_god_rays_settings||(b("world",f,"b4w_god_rays_settings.steps_per_pass"),f.b4w_god_rays_settings.steps_per_pass=10)}d=a.scenes;for(k=0;k<d.length;k++)f=d[k],"b4w_use_nla"in f||(f.b4w_use_nla=!1,b("scene",f,"b4w_use_nla")),"fps"in f||(f.fps=24,b("scene",f,"fps")),"b4w_nla_cyclic"in f||(f.b4w_nla_cyclic=!1,b("scene",
f,"b4w_nla_cyclic")),"b4w_nla_script"in f||(f.b4w_nla_script=[],b("scene",f,"b4w_nla_script")),"b4w_detect_collisions"in f&&(h("scene",f),delete f.b4w_detect_collisions),"audio_doppler_speed"in f||(f.audio_doppler_speed=343.3),"audio_doppler_factor"in f||(f.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in f||(f.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:.003,release:.25},b("scene",f,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in f||(f.b4w_enable_convolution_engine=
!1),"b4w_enable_bloom"in f||(f.b4w_enable_bloom=!1,b("scene",f,"b4w_enable_bloom")),"b4w_enable_motion_blur"in f||(f.b4w_enable_motion_blur=!1,b("scene",f,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in f||(f.b4w_enable_color_correction=!1,b("scene",f,"b4w_enable_color_correction")),"b4w_enable_antialiasing"in f||(f.b4w_enable_antialiasing=!0,b("scene",f,"b4w_enable_antialiasing")),"b4w_tags"in f||(f.b4w_tags={title:"",description:""},b("scene",f,"b4w_tags")),"b4w_enable_object_selection"in
f||(f.b4w_enable_object_selection="AUTO",b("scene",f,"b4w_enable_object_selection")),"b4w_enable_outlining"in f||(f.b4w_enable_outlining="AUTO",b("scene",f,"b4w_enable_outlining"));f=a.meshes;for(k=0;k<f.length;k++){e=f[k];e.b4w_bounding_box||(b("mesh",e,"b4w_bounding_box"),e.b4w_bounding_box={max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0});e.uv_textures||(b("mesh",e,"uv_textures"),e.uv_textures=[]);e.b4w_bounding_sphere_center||(e.b4w_bounding_sphere_center=[0,0,0]);e.b4w_bounding_cylinder_center||
(e.b4w_bounding_cylinder_center=[0,0,0]);e.b4w_bounding_ellipsoid_center||(e.b4w_bounding_ellipsoid_center=[0,0,0]);e.b4w_bounding_ellipsoid_axes||(d=e.b4w_bounding_box,e.b4w_bounding_ellipsoid_axes=[(d.max_x-d.min_x)/2,(d.max_y-d.min_y)/2,(d.max_z-d.min_z)/2]);"b4w_shape_keys"in e||(e.b4w_shape_keys=[],b("mesh",e,"b4w_shape_keys"));for(var d=e,l=["b4w_apply_scale","b4w_apply_modifiers","b4w_export_edited_normals","b4w_loc_export_vertex_anim","b4w_shape_keys"],r=null,q=0;q<l.length;q++)d[l[q]]&&(r?
(d[l[q]]=!1,g.warn('WARNING property "'+l[q]+'" of object "'+d.name+'" has been set to "false". Foreground property "'+r+'" already exists.')):r=l[q]);for(d=0;d<e.b4w_vertex_anim.length;d++)l=e.b4w_vertex_anim[d],"allow_nla"in l||(b('mesh["b4w_vertex_anim"]',e,"allow_nla"),l.allow_nla=!0)}d=a.cameras;for(k=0;k<d.length;k++)f=d[k],f.type||(f.type="PERSP",b("camera",f,"type")),"b4w_eye_target_dist"in f&&(delete f.b4w_eye_target_dist,h("camera",f)),"b4w_trans_velocity"in f||(f.b4w_trans_velocity=1,b("camera",
f,"b4w_trans_velocity")),"b4w_rot_velocity"in f||(f.b4w_rot_velocity=1,b("camera",f,"b4w_rot_velocity")),"b4w_zoom_velocity"in f||(f.b4w_zoom_velocity=.1,b("camera",f,"b4w_zoom_velocity")),"b4w_use_distance_limits"in f||(f.b4w_use_distance_limits=!1,b("camera",f,"b4w_use_distance_limits")),"b4w_distance_min"in f||(f.b4w_distance_min=1,b("camera",f,"b4w_distance_min")),"b4w_distance_max"in f||(f.b4w_distance_max=100,b("camera",f,"b4w_distance_max")),"b4w_horizontal_translation_min"in f||(f.b4w_horizontal_translation_min=
-100,b("camera",f,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in f||(f.b4w_horizontal_translation_max=100,b("camera",f,"b4w_horizontal_translation_max")),"b4w_vertical_translation_min"in f||(f.b4w_vertical_translation_min=-100,b("camera",f,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in f||(f.b4w_vertical_translation_max=100,b("camera",f,"b4w_vertical_translation_max")),"b4w_use_horizontal_clamping"in f||(f.b4w_use_horizontal_clamping=!1,b("camera",f,"b4w_use_horizontal_clamping")),
"b4w_rotation_left_limit"in f||(f.b4w_rotation_left_limit=-Math.PI,b("camera",f,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in f||(f.b4w_rotation_right_limit=Math.PI,b("camera",f,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in f||(f.b4w_horizontal_clamping_type="LOCAL",b("camera",f,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in f||(f.b4w_use_vertical_clamping=!1,b("camera",f,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in f||(f.b4w_rotation_down_limit=
-Math.PI/2,b("camera",f,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in f||(f.b4w_rotation_up_limit=Math.PI/2,b("camera",f,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in f||(f.b4w_vertical_clamping_type="LOCAL",b("camera",f,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in f||(f.b4w_hover_angle_min=Math.PI/6,b("camera",f,"b4w_hover_angle_min")),"b4w_hover_angle_max"in f||(f.b4w_hover_angle_max=Math.PI/6,b("camera",f,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in f||
(f.b4w_enable_hover_hor_rotation=!0,b("camera",f,"b4w_enable_hover_hor_rotation")),"b4w_use_panning"in f||(f.b4w_use_panning=!0,b("camera",f,"b4w_use_panning"));d=a.lamps;for(k=0;k<d.length;k++)f=d[k],"b4w_generate_shadows"in f||(f.b4w_generate_shadows=!1,b("lamp",f,"b4w_generate_shadows")),"b4w_dynamic_intensity"in f||(f.b4w_dynamic_intensity=!1,b("lamp",f,"b4w_dynamic_intensity")),"use_diffuse"in f||(f.use_diffuse=!0,b("lamp",f,"use_diffuse")),"use_specular"in f||(f.use_specular=!0,b("lamp",f,"use_specular"));
d=a.speakers;for(k=0;k<d.length;k++)f=d[k],"b4w_behavior"in f||(f.b4w_behavior=f.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in f||(f.b4w_disable_doppler=!1),"b4w_delay"in f||(f.b4w_delay=0),"b4w_delay_random"in f||(f.b4w_delay_random=0),"b4w_volume_random"in f||(f.b4w_volume_random=0),"b4w_pitch_random"in f||(f.b4w_pitch_random=0),"b4w_fade_in"in f||(f.b4w_fade_in=0),"b4w_fade_out"in f||(f.b4w_fade_out=0),"b4w_loop"in f||(f.b4w_loop=!1),"b4w_loop_count"in f||(f.b4w_loop_count=
0),"b4w_loop_count_random"in f||(f.b4w_loop_count_random=0),"b4w_playlist_id"in f||(f.b4w_playlist_id="");d=a.textures;for(k=0;k<d.length;k++)f=d[k],"b4w_anisotropic_filtering"in f||(f.b4w_anisotropic_filtering="OFF",b("texture",f,"b4w_anisotropic_filtering")),"b4w_water_foam"in f||(f.b4w_water_foam=!1,b("texture",f,"b4w_water_foam")),"b4w_foam_uv_freq"in f||(f.b4w_foam_uv_freq=[1,1],b("texture",f,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in f||(f.b4w_foam_uv_magnitude=[1,1],b("texture",f,"b4w_foam_uv_magnitude")),
"b4w_parallax_steps"in f||(f.b4w_parallax_steps=5,b("material",f,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in f||(f.b4w_parallax_lod_dist=10,b("material",f,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in f||(f.b4w_shore_dist_map=!1,b("texture",f,"b4w_shore_dist_map")),"b4w_shore_boundings"in f||(f.b4w_shore_boundings=new Float32Array(4),f.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],b("texture",f,"b4w_shore_boundings")),"b4w_max_shore_dist"in f||(f.b4w_max_shore_dist=100,b("texture",f,"b4w_max_shore_dist")),
"b4w_disable_compression"in f||(f.b4w_disable_compression=!1,b("texture",f,"b4w_disable_compression")),"b4w_source_type"in f||(f.b4w_source_type="",b("texture",f,"b4w_source_type")),"b4w_source_id"in f||(f.b4w_source_id="",b("texture",f,"b4w_source_id")),"b4w_source_size"in f||(f.b4w_source_size=1024,b("texture",f,"b4w_source_size")),"b4w_enable_canvas_mipmapping"in f||(f.b4w_enable_canvas_mipmapping=!0,b("texture",f,"b4w_enable_canvas_mipmapping"));f=a.materials;for(k=0;k<f.length;k++){e=f[k];"b4w_node_mat_type"in
e&&h("material",e);"b4w_skydome"in e&&h("material",e);"b4w_procedural_skydome"in e&&h("material",e);e.b4w_water&&("b4w_water_shore_smoothing"in e||(e.b4w_water_shore_smoothing=!1,b("material",e,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in e||(e.b4w_water_dynamic=!1,b("material",e,"b4w_water_dynamic")),"b4w_waves_height"in e||(e.b4w_waves_height=1,b("material",e,"b4w_waves_height")),"b4w_waves_length"in e||(e.b4w_waves_length=1,b("material",e,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in
e||(e.b4w_water_dst_noise_scale0=.05,b("material",e,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in e||(e.b4w_water_dst_noise_scale1=.03,b("material",e,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in e||(e.b4w_water_dst_noise_freq0=1.3,b("material",e,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in e||(e.b4w_water_dst_noise_freq1=1,b("material",e,"b4w_water_dst_noise_freq1")),"b4w_water_dir_min_shore_fac"in e||(e.b4w_water_dir_min_shore_fac=.4,b("material",e,
"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in e||(e.b4w_water_dir_freq=.5,b("material",e,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in e||(e.b4w_water_dir_noise_scale=.05,b("material",e,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in e||(e.b4w_water_dir_noise_freq=.07,b("material",e,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in e||(e.b4w_water_dir_min_noise_fac=.5,b("material",e,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in e||(e.b4w_water_dst_min_fac=
.2,b("material",e,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in e||(e.b4w_water_waves_hor_fac=5,b("material",e,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in e||(e.b4w_water_absorb_factor=6,b("material",e,"b4w_water_absorb_factor")),"b4w_water_fog_color"in e||(e.b4w_water_fog_color=new Float32Array(3),e.b4w_water_fog_color=[.5,.7,.7],b("material",e,"b4w_water_fog_color")),"b4w_foam_factor"in e||(e.b4w_foam_factor=5,b("material",e,"b4w_foam_factor")),"b4w_generated_mesh"in e||(e.b4w_generated_mesh=
!1,b("material",e,"b4w_generated_mesh")),"b4w_water_num_cascads"in e||(e.b4w_water_num_cascads=5,b("material",e,"b4w_water_num_cascads")),"b4w_water_subdivs"in e||(e.b4w_water_subdivs=64,b("material",e,"b4w_water_subdivs")),"b4w_water_detailed_dist"in e||(e.b4w_water_detailed_dist=1E3,b("material",e,"b4w_water_detailed_dist")));"b4w_dynamic_grass_size"in e||(e.b4w_dynamic_grass_size="");"b4w_dynamic_grass_color"in e||(e.b4w_dynamic_grass_color="");"diffuse_intensity"in e||(e.diffuse_intensity=1,b("material",
e,"diffuse_intensity"));"b4w_use_ghost"in e||(e.b4w_use_ghost=!1);"b4w_collision_group"in e||(e.b4w_collision_group=128,b("material",e,"b4w_collision_group"));"b4w_collision_mask"in e||(e.b4w_collision_mask=127,b("material",e,"b4w_collision_mask"));"b4w_do_not_render"in e||(e.b4w_do_not_render=!1,b("material",e,"b4w_do_not_render"));"HALO"!=e.type||"b4w_halo_sky_stars"in e||(e.b4w_halo_sky_stars=!1,b("material",e,"b4w_halo_sky_stars"));"HALO"!=e.type||"b4w_halo_stars_blend_height"in e||(e.b4w_halo_stars_blend_height=
10,b("material",e,"b4w_halo_stars_blend_height"));"HALO"!=e.type||"b4w_halo_stars_min_height"in e||(e.b4w_halo_stars_min_height=0,b("material",e,"b4w_halo_stars_min_height"));"specular_shader"in e||(e.specular_shader="COOKTORR",b("material",e,"specular_shader"));"diffuse_shader"in e||(e.diffuse_shader="LAMBERT",b("material",e,"diffuse_shader"));"roughness"in e||(e.roughness=.5,b("material",e,"roughness"));"diffuse_fresnel"in e||(e.diffuse_fresnel=.1,b("material",e,"diffuse_fresnel"));"diffuse_fresnel_factor"in
e||(e.diffuse_fresnel_factor=.5,b("material",e,"diffuse_fresnel_factor"));"specular_slope"in e||(e.specular_slope=.2,b("material",e,"specular_slope"));"specular_toon_size"in e||(e.specular_toon_size=.5,b("material",e,"specular_toon_size"));"specular_toon_smooth"in e||(e.specular_toon_smooth=.1,b("material",e,"specular_toon_smooth"));"specular_alpha"in e||(e.specular_alpha=1,b("material",e,"specular_alpha"));"b4w_wettable"in e||(e.b4w_wettable=!1,b("material",e,"b4w_wettable"));"b4w_refractive"in e||
(e.b4w_refractive=!1,b("material",e,"b4w_refractive"));"b4w_refr_bump"in e||(e.b4w_refr_bump=0,b("material",e,"b4w_refr_bump"));"b4w_shallow_water_col"in e||(e.b4w_shallow_water_col=[0,.8,.3],b("material",e,"b4w_shallow_water_col"));"b4w_shore_water_col"in e||(e.b4w_shore_water_col=[0,.9,.2],b("material",e,"b4w_shore_water_col"));"b4w_shallow_water_col_fac"in e||(e.b4w_shallow_water_col_fac=1,b("material",e,"b4w_shallow_water_col_fac"));"b4w_shore_water_col_fac"in e||(e.b4w_shore_water_col_fac=.5,
b("material",e,"b4w_shore_water_col_fac"));"b4w_water_sss_strength"in e||(e.b4w_water_sss_strength=5.9,b("material",e,"b4w_water_sss_strength"));"b4w_water_sss_width"in e||(e.b4w_water_sss_width=.45,b("material",e,"b4w_water_sss_width"));"b4w_render_above_all"in e||(e.b4w_render_above_all=!1,b("material",e,"b4w_render_above_all"));"b4w_water_norm_uv_velocity"in e||(e.b4w_water_norm_uv_velocity=.05,b("material",e,"b4w_water_norm_uv_velocity"));l=e.texture_slots;for(d=0;d<l.length;d++)r=l[d],"blend_type"in
r||(r.blend_type="MIX",b("texture_slot",r,"blend_type"));if(e.node_tree)for(e=e.node_tree.nodes,d=0;d<e.length;d++)c(e[d])}f=a.node_groups;for(k=0;k<f.length;k++)for(e=f[k].node_tree.nodes,d=0;d<e.length;d++)c(e[d]);f=a.objects;for(k=0;k<f.length;k++){e=f[k];switch(e.type){case "MESH":"b4w_dynamic_geometry"in e||(e.b4w_dynamic_geometry=!1);"b4w_reflexible"in e||(e.b4w_reflexible=!1);"b4w_reflexible_only"in e||(e.b4w_reflexible_only=!1);"b4w_reflective"in e||(e.b4w_reflective=!1);"b4w_wind_bending"in
e||(e.b4w_wind_bending=!1,b("object",e,"b4w_wind_bending"));"b4w_wind_bending_angle"in e||(e.b4w_wind_bending_angle=10,e.b4w_wind_bending_freq=.25,b("object",e,"wind bending params"));"b4w_detail_bending_amp"in e||(e.b4w_detail_bending_amp=.1,e.b4w_branch_bending_amp=.3,b("object",e,"detail bending params"));"b4w_detail_bending_freq"in e||(e.b4w_detail_bending_freq=1,b("object",e,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in e||(e.b4w_main_bend_stiffness_col="",b("object",e,"b4w_main_bend_stiffness_col"));
"b4w_detail_bend_colors"in e||(e.b4w_detail_bend_colors={leaves_stiffness_col:"",leaves_phase_col:"",overall_stiffness_col:""},b("object",e,"b4w_detail_bend_colors"));"b4w_caustics"in e||(e.b4w_caustics=!1);"vertex_groups"in e&&e.vertex_groups.length&&e.data&&0==e.data.vertex_groups.length&&(e.data.vertex_groups=e.vertex_groups,delete e.vertex_groups,b("object",e,"vertex_groups"));"b4w_vertex_anim"in e&&e.b4w_vertex_anim.length&&e.data&&0==e.data.b4w_vertex_anim.length&&(e.data.b4w_vertex_anim=e.b4w_vertex_anim,
delete e.b4w_vertex_anim,b("object",e,"b4w_vertex_anim"));"b4w_do_not_render"in e||(e.b4w_do_not_render=!1);"use_ghost"in e.game||(e.game.use_ghost=!1);"use_sleep"in e.game||(e.game.use_sleep=!1);"velocity_min"in e.game||(e.game.velocity_min=0);"velocity_max"in e.game||(e.game.velocity_max=0);"collision_group"in e.game||(e.game.collision_group=1);"collision_mask"in e.game||(e.game.collision_mask=255);"b4w_vehicle_settings"in e?e.b4w_vehicle_settings&&("steering_ratio"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.steering_ratio=
10),"steering_max"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.steering_max=1),"inverse_control"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.inverse_control=!1),"force_max"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.force_max=1500),"brake_max"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.brake_max=100),"speed_ratio"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.max_speed_angle=Math.PI),
"delta_tach_angle"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.suspension_compression=4.4),"suspension_stiffness"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in e.b4w_vehicle_settings||
(e.b4w_vehicle_settings.roll_influence=.1),"max_suspension_travel_cm"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.floating_factor=3),"floating_factor"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.water_rot_damp=.9)):(e.b4w_vehicle_settings=
null,b("object",e,"b4w_vehicle_settings"));"b4w_floating_settings"in e?e.b4w_floating_settings&&("floating_factor"in e.b4w_floating_settings||(e.b4w_floating_settings.floating_factor=3),"water_lin_damp"in e.b4w_floating_settings||(e.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in e.b4w_floating_settings||(e.b4w_floating_settings.water_rot_damp=.8)):(e.b4w_floating_settings=null,b("object",e,"b4w_floating_settings"));"b4w_character_settings"in e?e.b4w_character_settings&&("walk_speed"in
e.b4w_character_settings||(e.b4w_character_settings.walk_speed=4),"run_speed"in e.b4w_character_settings||(e.b4w_character_settings.run_speed=8),"step_height"in e.b4w_character_settings||(e.b4w_character_settings.step_height=.25),"jump_strength"in e.b4w_character_settings||(e.b4w_character_settings.jump_strength=5),"waterline"in e.b4w_character_settings||(e.b4w_character_settings.waterline=0)):(e.b4w_character_settings=null,b("object",e,"b4w_character_settings"));"b4w_selectable"in e||(e.b4w_selectable=
!1,b("object",e,"b4w_selectable"));"b4w_outlining"in e||(e.b4w_outlining=!1,b("object",e,"b4w_outlining"));"b4w_outline_on_select"in e||(e.b4w_outline_on_select=!1,b("object",e,"b4w_outline_on_select"));"b4w_billboard"in e||(e.b4w_billboard=!1,b("object",e,"b4w_billboard"));"b4w_billboard_geometry"in e||(e.b4w_billboard_geometry="SPHERICAL",b("object",e,"b4w_billboard_geometry"));"b4w_pres_glob_orientation"in e||(e.b4w_pres_glob_orientation=!1,b("object",e,"b4w_pres_glob_orientation"));"b4w_outline_settings"in
e||("b4w_glow_settings"in e?e.b4w_outline_settings=e.b4w_glow_settings:(e.b4w_outline_settings={},e.b4w_outline_settings.outline_duration=1,e.b4w_outline_settings.outline_period=1,e.b4w_outline_settings.outline_relapses=0),b("object",e,"b4w_outline_settings"));"b4w_lod_transition"in e||(e.b4w_lod_transition=.01,b("object",e,"b4w_lod_transition"));"lod_levels"in e||(e.lod_levels=[],b("object",e,"lod_levels"));"b4w_animation_mixing"in e||(e.b4w_animation_mixing=!1,b("object",e,"b4w_animation_mixing"));
break;case "EMPTY":"b4w_group_relative"in e||(e.b4w_group_relative=!1,b("object",e,"b4w_group_relative")),"b4w_anchor"in e||(e.b4w_anchor=null,b("object",e,"b4w_anchor")),!e.b4w_anchor||"max_width"in e.b4w_anchor||(e.b4w_anchor.max_width=250)}"b4w_anim_behavior"in e||(e.b4w_anim_behavior=e.b4w_cyclic_animation?"CYCLIC":"FINISH_STOP",b("object",e,"b4w_anim_behavior"));if(!("rotation_quaternion"in e)){d=[0,0,0,1];m.euler_to_quat(e.rotation_euler,d);var l=d,r=d[0],q=d[1],t=d[2];l[0]=d[3];l[1]=r;l[2]=
q;l[3]=t;e.rotation_quaternion=d;b("object",e,"rotation_quaternion")}"webgl_do_not_batch"in e&&(e.b4w_do_not_batch=e.webgl_do_not_batch)&&h("object",e);"b4w_shadow_cast_only"in e||(e.b4w_shadow_cast_only=!1,b("object",e,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in e||(e.b4w_correct_bounding_offset="AUTO",b("object",e,"b4w_correct_bounding_offset"));l=e.particle_systems;for(d=0;d<l.length;d++)r=l[d],q=r.settings,"use_whole_group"in q||(q.use_whole_group=!1,b("object",q,"use_whole_group")),
r.transforms||(r.transforms=new Float32Array,b("particle_system",r,"transforms")),"b4w_billboard_align"in q||(q.b4w_billboard_align="VIEW",b("particle_settings",q,"b4w_billboard_align")),"b4w_dynamic_grass"in q||(q.b4w_dynamic_grass=!1,b("object",q,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in q||(q.b4w_dynamic_grass_scale_threshold=.01,b("object",q,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in q||(q.b4w_initial_rand_rotation=!1,b("particle_settings",q,"b4w_initial_rand_rotation")),
"b4w_rotation_type"in q||(q.b4w_rotation_type="Z",b("particle_settings",q,"b4w_rotation_type")),"b4w_rand_rotation_strength"in q||(q.b4w_rand_rotation_strength=1,b("particle_settings",q,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in q||(q.b4w_hair_billboard=!1,b("particle_settings",q,"b4w_hair_billboard")),"b4w_hair_billboard_type"in q||(q.b4w_hair_billboard_type="BASIC",b("particle_settings",q,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in q||(q.b4w_hair_billboard_jitter_amp=
0,b("particle_settings",q,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in q||(q.b4w_hair_billboard_jitter_freq=0,b("particle_settings",q,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in q||(q.b4w_hair_billboard_geometry="SPHERICAL",b("particle_settings",q,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in q||(q.b4w_wind_bend_inheritance="PARENT",b("particle_settings",q,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in q||(q.b4w_shadow_inheritance=
"PARENT",b("particle_settings",q,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in q||(q.b4w_reflection_inheritance="PARENT",b("particle_settings",q,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in q||(q.b4w_vcol_from_name="",b("particle_settings",q,"b4w_vcol_from_name")),"b4w_vcol_to_name"in q||(q.b4w_vcol_to_name="",b("particle_settings",q,"b4w_vcol_to_name")),"b4w_coordinate_system"in q||(q.b4w_coordinate_system="LOCAL",b("particle_settings",q,"b4w_coordinate_system")),"b4w_allow_nla"in
q||(q.b4w_allow_nla=!0,b("particle_settings",q,"b4w_allow_nla"));"constraints"in e||(e.constraints=[],b("object",e,"constraints"));l=e.modifiers;for(d=0;d<l.length;d++){a:{r=l[d];switch(r.type){case "ARRAY":if(!("fit_type"in r)){g.error("WARNING Incomplete modifier "+String(r.type)+' for "'+e.name+'", reexport "'+a.b4w_filepath_blend+'" scene');r=!1;break a}}r=!0}r||(l.splice(d,1),d--)}"animation_data"in e||(e.animation_data={action:null,nla_tracks:[]},b("object",e,"animation_data"));if(e.animation_data)for(("action"in
e.animation_data)||(e.animation_data.action=null,g.warn("no action in animation data "+e.name)),("nla_tracks"in e.animation_data)||(e.animation_data.nla_tracks=[],g.warn("no NLA in animation data "+e.name)),l=e.animation_data.nla_tracks,d=0;d<l.length;d++)for(r=l[d],q=0;q<r.strips.length;q++)t=r.strips[q],"action"in t||(t.action=null,g.warn("no action in NLA strip "+e.name)),"action_frame_start"in t||(t.action_frame_start=0,g.warn("no action_frame_start in NLA strip "+e.name)),"action_frame_end"in
t||(t.action_frame_end=t.frame_end-t.frame_start,g.warn("no action_frame_start in NLA strip "+e.name));"b4w_collision_id"in e||(e.b4w_collision_id="",b("material",e,"b4w_collision_id"));d=e.scale;0==d[0]&&0==d[1]&&0==d[2]?d=!0:(l=Math.abs((d[1]-d[2])/d[1]),d=.001>Math.abs((d[0]-d[1])/d[0])&&.001>l);d||g.warn("non-uniform scale for object "+e.name)}for(var x in z)k=z[x],d=x.match(/.*?(?=>>|$)/i)[0],g.warn("WARNING "+String(d)+" is "+k.Or+" for "+k.type+", reexport "+a.b4w_filepath_blend)};a.bv=function(a,
b){"num_channels"in a||(a.num_channels=1,g.warn('B4W Warning: no channels number in animation fcurve for "'+b.name+'" action, reexport scene'))};a.Eu=function(a){var b;a:{b=a.modifiers;for(var c=0;c<b.length;c++){var g=b[c].type;if("ARRAY"==g||"CURVE"==g){b=!0;break a}}b=!1}if(!b)return null;b=d(a.data,a.data.name+"_MOD");a=a.modifiers;for(c=0;c<a.length;c++){var e=a[c];switch(e.type){case "ARRAY":for(var g=b,h=e,z=0,p=0,t=0,y=new Float32Array(16),e=[],L=1;L<h.count;L++){h.use_constant_offset&&(z+=
h.constant_offset_displace[0],p+=h.constant_offset_displace[1],t+=h.constant_offset_displace[2]);if(h.use_relative_offset)var C=g.b4w_bounding_box,z=z+(C.max_x-C.min_x)*h.relative_offset_displace[0],p=p+(C.max_y-C.min_y)*h.relative_offset_displace[1],t=t+(C.max_z-C.min_z)*h.relative_offset_displace[2];m.uA(z,p,t,y);for(var H=C=d(g),K=y,M=0;M<H.submeshes.length;M++){var G=H.submeshes[M];m.Me(G.position,K,G.position,0);m.fB(G.normal,K,G.normal);m.rA(G.tangent,K,G.tangent)}e.push(C)}for(L=0;L<e.length;L++)for(h=
g,z=e[L],p=0;p<h.submeshes.length;p++){t=h.submeshes[p];y=z.submeshes[p];C=t.base_length;H=t.indices.length;t.base_length+=y.base_length;for(var v in t)if("base_length"!=v)if("indices"==v)for(t[v]=m.xA(t[v],y[v]),K=H;K<t.indices.length;K++)t.indices[K]+=C;else"vertex_colors"!=v&&(t[v]=m.Mw(t[v],y[v]))}break;case "CURVE":for(var g=b,L=e.object.iu,h=new Float32Array(16),p=L.Ge?4:3,z=new Float32Array(p),p=new Float32Array(p),t=new Float32Array(3),y=new Float32Array(4),C=new Float32Array(4),H=new Float32Array(3),
K=new Float32Array(3),M=new Float32Array(3),G=new Float32Array(4),N=new Float32Array(4),J=0;J<g.submeshes.length;J++){var R=g.submeshes[J],V=R.position,ca=R.normal,R=R.tangent,U;a:switch(U=e.deform_axis,U){case "POS_X":case "NEG_X":U=0;break a;case "POS_Y":case "NEG_Y":U=1;break a;case "POS_Z":case "NEG_Z":U=2;break a;default:throw"Wrong deform axis value "+U;}H[0]=0;H[1]=0;H[2]=0;H[U]=1;for(var Z=l.cA(L),T=0;T<V.length/3;T++){M[0]=V[3*T];M[1]=V[3*T+1];M[2]=V[3*T+2];var aa=M[U],w=l.bA(L,aa);l.dA(L,
w,z);t[0]=z[0];t[1]=z[1];t[2]=z[2];l.aA(L,w,p);K[0]=p[0];K[1]=0;K[2]=p[2];k.normalize(K,K);r.rotationTo(H,K,y);0>aa?(z[0]=K[0],z[1]=K[1],z[2]=K[2],k.scale(z,aa,z),k.add(t,z,t)):aa>Z&&(z[0]=K[0],z[1]=K[1],z[2]=K[2],k.scale(z,aa-Z,z),k.add(t,z,t));q.fromRotationTranslation(y,t,h);L.Ge&&(r.setAxisAngle(H,z[3],C),k.transformQuat(M,C,M));M[U]=0;k.transformMat4(M,h,M);V[3*T]=M[0];V[3*T+1]=M[1];V[3*T+2]=M[2];ca.length&&(G[0]=ca[3*T],G[1]=ca[3*T+1],G[2]=ca[3*T+2],G[3]=0,x.transformMat4(G,h,G),ca[3*T]=G[0],
ca[3*T+1]=G[1],ca[3*T+2]=G[2]);R.length&&(N[0]=R[3*T],N[1]=R[3*T+1],N[2]=R[3*T+2],N[3]=0,x.transformMat4(N,h,N),R[3*T]=N[0],R[3*T+1]=N[1],R[3*T+2]=N[2])}}}f.Vy(b)}return b};a.iC=function(){return{name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,
specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",
use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]}};a.Lu=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(d.b4w_use_nla)for(var d=d.b4w_nla_script,e=0;e<d.length;e++){var f=d[e];switch(f.type){case "SELECT":case "SELECT_PLAY":for(var g=0;g<a.length;g++){var k=a[g];k.name==f.object&&(k.b4w_selectable=!0)}break;case "SHOW":case "HIDE":for(g=0;g<
a.length;g++)k=a[g],k.name==f.object&&(k.b4w_do_not_batch=!0)}}}}};b4w.module.__scenegraph=function(a,p){function c(a){a=ra.wa(a);a.Td=null;a.yb=null;a.Cc=null;return a}function b(a,b){var c=[];Q.af(a,function(b,e,f){-1<c.indexOf(f)?Q.ez(a,b,e,f,d(f)):c.push(f)});Q.S(a,function(e,f){for(var B=0;B<f.na.length;B++){var g=f.na[B];b||"MAIN_REFLECT"!=f.type||(g.pg=!0);-1<c.indexOf(g)?f.na[B]=d(g):c.push(g)}"ANTIALIASING"==f.type&&Q.ge(a,e,function(a,b){if("MOTION_BLUR"==b.type)for(var c=0;c<b.na.length;c++){var d=b.na[c];d.ya=la.G;d.xa=la.G}});b||Q.ge(a,e,function(a,
b,c){"DEPTH"==c.K&&(c.pg=!0)})});Q.S(a,function(b){var c={};h(a,b,c);for(var d in c){b=c[d];for(var e=b[0],f=0;f<b.length;f++)if(b[f].ya==la.G){e=b[f];break}for(var B=b[0],f=0;f<b.length;f++)if(b[f].xa==la.G){B=b[f];break}for(var g=b[0],f=0;f<b.length;f++)if(!b[f].pg){g=b[f];break}for(f=0;f<b.length;f++)b[f].ya=e.ya,b[f].xa=B.xa,b[f].pg=g.pg}})}function h(a,b,c){Q.ge(a,b,function(b,d,e){e.Ka&&e.K==e.ca&&(c[e.K]=c[e.K]||[],-1==c[e.K].indexOf(e)&&c[e.K].push(e),h(a,b,c))});Q.bf(a,b,function(a,b,d){d.Ka&&
(c[d.K]=c[d.K]||[],-1==c[d.K].indexOf(d)&&c[d.K].push(d))});b=Q.hb(a,b);if("MOTION_BLUR"==b.type)for(var d=0;d<b.na.length;d++){var e=b.na[d];c[e.K].push(e)}}function d(a){if(a.oa)throw"Failed to clone slink with attached texture";return ra.xf(a)}function f(a){var b=Q.Jn(a),c=[];Q.S(b,function(a,d){switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":var e=[];break;default:e=c}for(var f=0;f<d.na.length;f++){var B=d.na[f],h=x(e,B,g(B));B.oa=h;
d.td[f]=h}for(f=0;f<d.td.length;f++)h=d.td[f],k(e,h);switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":e=[]}Q.bf(b,a,function(c,d,f){if(!f.oa){if((c=m(b,a,f.K))&&f.Ka&&!f.oa){d=e;for(var B=c,k=0;k<d.length;k++){var h=d[k];h.Fn===B&&h.Ci++}}else c=x(e,f,g(f));f.oa=c}});Q.ge(b,a,function(a,b,c){k(e,c.oa)});Q.bf(b,a,function(a,b,c){c.oa&&"NONE"==c.ca&&k(e,c.oa)})})}function l(a){q(a,function(b,c,d){b.Ch&&(ya(a,d,"SMAA_NEIGHBORHOOD_BLENDING")&&
"SMAA_NEIGHBORHOOD_BLENDING"!=d.type||ya(a,d,"ANTIALIASING")||"ANCHOR_VISIBILITY"==d.type)&&(b.We*=ta.resolution_factor)})}function g(a){a=ra.xf(a);delete a.ca;delete a.Ka;delete a.oa;return JSON.stringify(a)}function m(a,b,c){var d=null;Q.ge(a,b,function(a,b,e){if(e.Ka&&e.K==e.ca&&e.K==c&&e.oa)return d=e.oa,!0});Q.bf(a,b,function(a,b,e){if(e.Ka&&e.K==c&&e.oa)return d=e.oa,!0});return d}function k(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.Fn===b&&d.Ci&&d.Ci--}}function x(a,b,c){for(var d=null,
e=0;e<a.length;e++){var f=a[e];if(f.id==c&&0===f.Ci){d=f;break}}if(d)return d.Ci++,d.Fn;b=r(b);a.push({id:c,Ci:1,Fn:b});return b}function r(a){var b=a.We*a.size;switch(a.K){case "COLOR":var c=la.Bj("COLOR",la.vg);la.resize(c,b,b);la.on(c,a.ya,a.xa);return c;case "DEPTH":return a.pg?(c=la.Bj("DEPTH_RBUF",la.ug),la.resize(c,b,b)):(c=la.Bj("DEPTH_TEX",la.Jh),la.resize(c,b,b),la.on(c,a.ya,a.xa)),c;case "CUBEMAP":return c=la.Iv(b);case "SCREEN":return null;default:throw"Wrong slink param: "+a.K;}}function q(a,
b){var c=!1;Q.af(a,function(d,e,f){if(f&&(d=Q.hb(a,d),e=Q.hb(a,e),b(f,!1,d,e)))return c=!0});c||Q.S(a,function(a,c){for(var d=0;d<c.na.length;d++)if(b(c.na[d],!0,c,null))return!0})}function z(a){Q.S(a,function(b,c){if("SINK"!=c.type){var d=c.j;Q.bf(a,b,function(a,b,c){c.Ka&&c.oa&&(pa.zk(d,c.K,c.oa),c.K==c.ca&&b.j&&pa.zk(b.j,c.K,c.oa))});for(var e=0;e<c.na.length;e++){var f=c.na[e];f.Ka&&f.K==f.ca&&pa.zk(d,f.K,c.td[e])}!d.yb&&!d.Cc||d.Td||(d.Td=La.dz(d.yb,d.Cc))}})}function E(a){var b=null,c=0;Q.S(a,
function(a,d){if(d.type==Ia.nA){if(c==Ia.mA)return b=d,!0;c++}});return b}function A(a,b){var c=Q.dh(a,b),d=F("NONE"),f=Q.C(a,d),B=Q.fq(a)[0];Q.af(a,function(b,c){c==B&&Q.Wy(a,b,B,b,f)});Q.af(a,function(f,B,g){if(f==c)return Q.m(a,b,d,e(Ia.Pz,"u_color",g.size,g.We,g.Ch)),!0});Q.qe(a,f,B,e("SCREEN","NONE",.5,.5,!0))}function n(a,b){var c=u("SHADOW_CAST");c.Fl=a;c.self_shadow_polygon_offset=b.self_shadow_polygon_offset;switch(b.Dm){case "SPOT":case "POINT":c.j=pa.nb(pa.Sb);pa.pn(c.j,180*b.Uc/Math.PI,
.1,2*b.distance);break;default:c.j=pa.nb(pa.nf)}return c}function u(a){return{type:a,Ga:!1,ur:!1,hl:!1,ek:!1,Sh:0,time:0,j:null,pp:null,$b:null,p:[],na:[],td:[],Ui:new Float32Array(3),Ts:new Float32Array(3),Vb:new Float32Array(3),Tb:new Float32Array(4),hc:new Float32Array(16),Be:0,Xf:0,Of:null,Qf:null,Nf:null,Pf:null,De:new Float32Array(3),lf:new Float32Array(3),ts:new Float32Array([0,0,0]),Fk:new Float32Array(3),us:new Float32Array(4),kk:0,Pl:0,ki:!1,Le:new Float32Array(3),gf:0,Ua:null,Nk:!1,Te:new Float32Array(2),
Ue:new Float32Array(2),lh:0,Yg:0,tl:0,Wc:null,jf:0,tg:0,hf:0,uf:!1,Yo:0,Zo:new Float32Array(2),Xo:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,mh:new Float32Array(3),ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,qh:0,ph:0,oh:0,ls:0,ssao_only:0,ssao_white:0,brightness:0,contrast:0,exposure:0,saturation:0,
god_rays_intensity:0,Xg:0,wk:0,th:0,Fl:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,Is:null,Ko:null,ag:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,Oo:0,Ep:0,bk:0,ck:0,Wq:0,zi:"",ey:new Float32Array(2),W:!0,enqueue:!0,ga:!0,ka:!0,Bb:!0,Ea:!0}}function e(a,b,c,d,e){return{K:a,ca:b,size:c,We:d,Ch:e,Ka:!0,oa:null,pg:!1,ya:la.Cd,xa:la.Cd}}function O(a,b){for(var c=0,d=B(a,b),e=0;e<d.length;e++){var f=d[e];"SHADOW_CAST"==f.type&&(f=Y(a,f,"SHADOW_CAST").j,b.Is=f.ja,b.Ko=new Float32Array([.5,
0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1]),b.ag=b.ag||[],b.ag[c]=f.pa,c++)}}function I(){var a=u("GRASS_MAP");a.j=pa.nb(pa.le);return a}function F(a){var b=u("POSTPROCESSING");b.ga=!1;b.ka=!1;b.Bb=!1;b.j=pa.nb(pa.lb);b.zi=a;return b}function t(a){var b=u("BLOOM_BLUR");b.ga=!1;b.ka=!1;b.Bb=!1;b.j=pa.nb(pa.lb);b.zi=a;return b}function y(a,b,c,d,e,f,B,g,k){var h=u("MAIN_"+a);if("OPAQUE"===a)h.ga=!0,h.ka=c,h.Ga=!1;else if("BLEND"===a)h.ga=!1,h.ka=!1,h.Ga=!0;else if("XRAY"===a)h.ga=!1,h.ka=!0,h.Ga=!0;else if("REFLECT"===
a)h.ga=!0,h.ka=!0,h.Ga=!1;else throw"wrong main subscene type";h.Ga&&g&&(h.self_shadow_normal_offset=g.self_shadow_normal_offset);h.j=b;h.De.set(B.De);h.lf.set(B.lf);h.Be=B.Be;h.Tb=f;d&&(h.Ua=d,d.Tb&&(h.Wc=new Float32Array(d.Tb)),h.jf=d.waves_height,h.tg=d.waves_length,h.hf=d.hf,d.sj&&k&&(h.uf=!0,h.Yo=d.sj,h.Zo.set(d.vl),h.Xo=d.ul),d.Bk&&(h.Nk=!0,a=d.Nz,h.Te[0]=(a[0]+a[1])/2,h.Te[1]=(a[2]+a[3])/2,h.Ue[0]=a[0]-a[1],h.Ue[1]=a[2]-a[3],h.lh=d.lh,h.Yg=d.Yg));h.Of=new Float32Array(3*e);h.Qf=new Float32Array(3*
e);h.Nf=new Float32Array(3*e);h.Pf=new Float32Array(0==e%2?2*e:2*e+2);return h}function L(a,b){var c=u("COLOR_PICKING");b&&(c.type+="_XRAY",c.ga=!1,c.ka=!0);c.enqueue=!1;c.j=a;return c}function C(a){var b=u("WIREFRAME");b.W=!1;b.ga=!1;b.ka=!1;b.j=a;return b}function H(a){var b=u("ANCHOR_VISIBILITY");b.ga=!0;b.ka=!1;b.j=a;return b}function K(a,b){var c=u("DEPTH");c.j=a;c.self_shadow_normal_offset=b.self_shadow_normal_offset;return c}function M(a){var b=u("DEPTH_PACK");b.ga=!1;b.ka=!1;b.j=a;return b}
function G(a,b,c){var d=u("SSAO");d.ga=!1;d.ka=!1;d.Bb=!1;d.j=a;d.Tb=b;d.Wc=new Float32Array(b);d.qh=c.radius_increase;d.ssao_hemisphere=c.Rx;d.ph=c.influence;d.oh=c.dist_factor;d.ls=c.lz;return d}function v(a,b){var c=u("SSAO_BLUR");c.ga=!1;c.ka=!1;c.Bb=!1;c.ssao_blur_depth=b.Uu;c.ssao_blur_discard_value=b.No;c.j=a;return c}function N(){var a=u("ANTIALIASING");a.ga=!1;a.ka=!1;a.Bb=!1;a.j=pa.nb(pa.lb);return a}function J(a){var b=u(a);b.ga="SMAA_BLENDING_WEIGHT_CALCULATION"==a||"SMAA_EDGE_DETECTION"==
a?!0:!1;b.ka=!1;b.Bb=!1;b.j=pa.nb(pa.lb);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(b.fy=new Float32Array(4));return b}function R(a,b,c,d){var e=u("COMPOSITING");e.ga=!1;e.ka=!1;e.Bb=!1;e.j=pa.nb(pa.lb);e.brightness=a;e.contrast=b;e.exposure=c;e.saturation=d;return e}function V(a,b){var c=u("MOTION_BLUR");c.ga=!1;c.ka=!1;c.Bb=!1;c.j=pa.nb(pa.lb);c.hl=!0;c.bk=a;c.ck=b;return c}function ca(a){var b=u("DOF");b.ga=!1;b.ka=!1;b.Bb=!1;b.j=a;return b}function U(a){var b=u("OUTLINE_MASK");b.j=a;b.Bb=!1;return b}
function Z(a){var b=u("OUTLINE");b.Le.set(a.Le);b.kk=a.kk;b.Ep=5;b.Oo=3;b.Bb=!1;b.j=pa.nb(pa.lb);return b}function T(){var a=u("REFRACT");a.ga=!1;a.ka=!1;a.Bb=!1;a.j=pa.nb(pa.lb);return a}function aa(a,b,c,d,e,f,B){var g=u("GOD_RAYS");g.ga=!1;g.ka=!1;g.Bb=!1;g.De=[1,1,1];g.lf=[1,1,1];g.Be=1;g.ur=d;g.gf=b;g.wk=e;g.Xg=c;g.th=B;g.j=a;g.Xf=f;g.Of=new Float32Array(3*f);g.Qf=new Float32Array(3*f);g.Nf=new Float32Array(3*f);g.Pf=new Float32Array(0==f%2?2*f:2*f+2);return g}function w(a,b){var c=u("GOD_RAYS_COMBINE");
c.ga=!1;c.ka=!1;c.Bb=!1;c.j=pa.nb(pa.lb);c.god_rays_intensity=a;c.Xf=b;c.Of=new Float32Array(3*b);c.Qf=new Float32Array(3*b);c.Nf=new Float32Array(3*b);c.Pf=new Float32Array(0==b%2?2*b:2*b+2);return c}function ha(a,b){var c=u("SKY");c.enqueue=!1;c.ga=!1;c.ka=!1;c.Bb=!1;var d=pa.nb(pa.lb);d.width=lb.Cj;d.height=lb.Cj;c.j=d;c.pp=ra.Yw();c.Xf=a;c.Of=new Float32Array(3*a);c.Qf=new Float32Array(3*a);c.Nf=new Float32Array(3*a);c.Pf=new Float32Array(0==a%2?2*a:2*a+2);c.De=[1,1,1];c.lf=[1,1,1];c.Be=1;c.mh.set(b.mh);
c.procedural_skydome=b.procedural_skydome;c.use_as_environment_lighting=b.use_as_environment_lighting;c.rayleigh_brightness=b.rayleigh_brightness;c.mie_brightness=b.mie_brightness;c.spot_brightness=b.spot_brightness;c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;c.mie_distribution=b.mie_distribution;return c}function ma(){var a=u("COPY");
a.ga=!1;a.ka=!1;a.j=pa.nb(pa.lb);return a}function fa(){var a=u("ANAGLYPH");a.ga=!1;a.ka=!1;a.j=pa.nb(pa.lb);return a}function ia(){var a=u("LUMINANCE");a.ga=!1;a.ka=!1;a.j=pa.nb(pa.lb);return a}function S(){var a=u("AVERAGE_LUMINANCE");a.ga=!1;a.ka=!1;a.j=pa.nb(pa.lb);return a}function P(a,b,c,d){var e=u("LUMINANCE_TRUNCED");e.ga=!1;e.ka=!1;e.bloom_key=a;e.bloom_edge_lum=b;e.j=d;e.Of=new Float32Array(3*c);e.Qf=new Float32Array(3*c);e.Nf=new Float32Array(3*c);e.Pf=new Float32Array(0==c%2?2*c:2*c+
2);return e}function ga(a){var b=u("BLOOM");b.ga=!1;b.ka=!1;b.j=pa.nb(pa.lb);b.bloom_blur=a;return b}function qa(){var a=u("SINK");a.enqueue=!1;return a}function ya(a,b,c){if(b.type===c)return!0;b=W(a,b);for(var d=0;d<b.length;d++)if(ya(a,b[d],c))return!0;return!1}function ba(a,b,c){if(b.type===c)return!0;b=B(a,b);for(var d=0;d<b.length;d++)if(ba(a,b[d],c))return!0;return!1}function Y(a,b,c){if(b.type===c)return b;b=B(a,b);for(var d=0;d<b.length;d++){var e=Y(a,b[d],c);if(e)return e}return null}function B(a,
b){var c=Q.dh(a,b);if(c==Q.jo)throw"Subscene not in graph";for(var d=[],e=Q.wq(a,c),f=0;f<e;f++){var B=Q.Lj(a,c,f);B!=c&&d.push(Q.hb(a,B))}return d}function W(a,b){var c=Q.dh(a,b);if(c==Q.jo)throw"Subscene not in graph";for(var d=[],e=Q.fh(a,c),f=0;f<e;f++){var B=Q.Ng(a,c,f);B!=c&&d.push(Q.hb(a,B))}return d}function na(a){var b=[],c=[];q(a,function(a){a.oa&&-1==b.indexOf(a.oa)&&(b.push(a.oa),c.push(a.oa,b.length-1))});return c}function oa(a,b){var c;c=""+(a.K+"\\n");c+="NONE"!=a.ca?a.ca+"\\n":"";
c+="(";if(a.Ch){var d=a.We;Math.round(d)!=d&&(d=d.toFixed(2));d=(1==d?"":d)+"S";c+=d+"x"+d}else c+=a.size+"x"+a.size;if("SCREEN"!=a.K){c+=" ";if(a.pg)c+="RR";else{var d=a.ya,e=a.xa,f="";d==la.G?f+="L":d==la.Cd&&(f+="N");e==la.G?f+="L":e==la.Cd&&(f+="N");c+=f}for(d=0;d<b.length;d+=2)b[d]==a.oa&&(c+=" "+b[d+1])}return c+")\\n"}var pa=p("__camera"),Ga=p("__config"),da=p("__debug"),Q=p("__graph"),La=p("__renderer"),la=p("__textures"),ra=p("__util");p("vec4");var Ia=Ga.Ll,ta=Ga.q,lb=Ga.Ii;a.lv=function(a){switch(a.ca){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "OFFSCREEN":case "NONE":return!1;
default:return!0}};a.wA=q;a.Sv=function(a,d,B){function g(b,f){var B=c(Aa[f]);d.H.push(B);B=y(b,B,!1,Ga,oa,xa,db,eb,a.vh);W.push(B);Q.C(k,B);Q.m(k,h[f],B,ba[f]);Q.m(k,h[f],B,q[f]);Ka&&(Q.m(k,Ka,B,vb),Q.m(k,Ka,B,wb));if(sb){for(var l=0;l<Y.length;l++)Q.m(k,Y[l],B,p[l]);var l=m[f],n=e("COLOR","u_scene_depth",1,1,!0);n.ya=la.Cd;n.xa=la.Cd;Q.m(k,l,B,n)}r.length&&(Q.m(k,r[f],B,u[f]),B.$b=ib[0]);x.length&&Q.m(k,x[f],B,na[f]);return B}var k=Q.create(),h=[],W=[],m=[],ba=[],q=[],r=[],u=[],x=[],na=[],Y=[],
p=[],oa=a.Kq,Ga=a.Ua,ya=a.kn,La=a.Xe,Eb=a.Pg,Pa=a.py,ib=a.Xy,cc=a.zg,sc=a.$g,dc=a.Dg,Lb=a.antialiasing,db=a.bo,xa=a.Tb,eb=a.nd,Xa=a.ty,Qa=a.Tu,xb=a.av,pb=a.Lx,yb=a.Hy,zb=a.Gg,sb=a.qw,Na=Boolean(B.length),Aa=[];if(a.anaglyph_use&&!Na){var Fb=d.H[0],Gb=c(Fb);pa.Uq(Fb,pa.mb);pa.Uq(Gb,pa.wb);Aa.push(Fb,Gb);d.H.push(Gb)}else{var Ba=d.H[0];Aa.push(Ba)}if(ya){pa.Nn(Aa[0],eb);for(var ec=eb.csm_num,ea=0;ea<ec;ea++){var Ca=n(ea,eb);Q.C(k,Ca);Y.push(Ca);var Ra=eb.csm_resolution,Ba=Ca.j;Ba.width=Ra;Ba.height=
Ra;Ca.ga=!1;p.push(e("DEPTH","u_shadow_map"+ea,Ra,1,!1));(da.gv()||ta.Kp)&&Ca.na.push(e("COLOR","COLOR",Ra,1,!1))}}if(0<ib.length&&!Na)for(ea=0;ea<Aa.length;ea++){Ba=c(Aa[ea]);d.H.push(Ba);var wa=y("REFLECT",Ba,!1,Ga,oa,xa,db,null,a.vh);wa.$b=ib[0];wa.j.$b=ib[0];Q.C(k,wa);r.push(wa);u.push(e("COLOR","u_reflectmap",1,ta.Di,!0));wa.na.push(e("DEPTH","DEPTH",1,ta.Di,!0))}h=[];W=[];if(a.Ya){var Ka=I();Q.C(k,Ka);Ra=lb.Mj;Ka.j.width=Ra;Ka.j.height=Ra;var vb=e("DEPTH","u_grass_map_depth",Ra,1,!1);vb.ya=
la.G;vb.xa=la.G;var wb=e("COLOR","u_grass_map_color",Ra,1,!1);wb.ya=la.G;wb.xa=la.G}else wb=vb=Ka=null;for(var Xb=[],Yb=[],ea=0;ea<Aa.length;ea++){var Ba=Aa[ea],Oa={};q.push(e("DEPTH","DEPTH",1,1,!0));if(sb){var Qb=c(Ba);d.H.push(Qb);if(ya){Oa=K(Qb,eb);Q.C(k,Oa);Yb.push(Oa);for(var Hb=0;Hb<Y.length;Hb++)Ca=Y[Hb],Q.m(k,Ca,Oa,p[Hb]);var Zb=e("COLOR","u_color",1,1,!0),Rb=e("DEPTH","u_depth",1,1,!0);if(La){var kc=c(Ba);d.H.push(kc);var lc=a.fA,bb=G(kc,xa,lc);Q.C(k,bb);var mc=e("COLOR","u_ssao_mask",1,
1,!0);Q.m(k,Oa,bb,Zb);Q.m(k,Oa,bb,Rb);var nc=c(Ba);d.H.push(nc);var hb=v(nc,lc);Q.C(k,hb);var fc=e("COLOR","u_shadow_mask",1,1,!0);Q.m(k,bb,hb,mc);Q.m(k,Oa,hb,Rb)}var D=c(Qb);d.H.push(D);var Mb=M(D);Q.C(k,Mb);Q.m(k,Oa,Mb,e("DEPTH","u_depth",1,1,!0));m.push(Mb)}else Oa=K(Qb,eb),Q.C(k,Oa),m.push(Oa);Ka&&(Q.m(k,Ka,Oa,vb),Q.m(k,Ka,Oa,wb))}wa=y("OPAQUE",Ba,!sb,Ga,oa,xa,db,null,a.vh);Q.C(k,wa);W.push(wa);sb&&(Q.m(k,Oa,wa,q[ea]),mc?Q.m(k,hb,wa,fc):ya&&Q.m(k,Oa,wa,e("COLOR","u_shadow_mask",1,1,!0)));var qb=
e("COLOR","u_color",1,1,!0);ba.push(e("COLOR","COLOR",1,1,!0));Ka&&(Q.m(k,Ka,wa,vb),Q.m(k,Ka,wa,wb));r.length&&(Q.m(k,r[ea],wa,u[ea]),wa.$b=ib[0])}h=W;W=[];if(!Na&&a.sv){Ba=c(h[0].j);d.H.push(Ba);var Sa=L(Ba,!1);Q.C(k,Sa);if(a.he){Ba=c(h[0].j);d.H.push(Ba);var jb=L(Ba,!0);Q.C(k,jb);Q.m(k,Sa,jb,e("COLOR","COLOR",1,1,!0));Q.m(k,Sa,jb,e("DEPTH","DEPTH",1,1,!0))}}else Sa=null;if(Pa.kd&&!Na)for(ea=0;ea<Aa.length;ea++){var X=T();Q.C(k,X);Q.m(k,h[ea],X,qb);x.push(X);na.push(e("COLOR","u_refractmap",1,1,
!0))}for(ea=0;ea<Aa.length;ea++)wa=g("BLEND",ea),Xb.push(wa);h=W;W=[];if(a.he){for(ea=0;ea<Aa.length;ea++)g("XRAY",ea);h=W;W=[]}if(ta.wireframe_debug){for(ea=0;ea<Aa.length;ea++){Ba=ra.wa(Aa[ea]);d.H.push(Ba);var Ha=C(Ba);W.push(Ha);Q.C(k,Ha);Q.m(k,h[ea],Ha,ba[ea]);Q.m(k,h[ea],Ha,q[ea]);Ka&&(Q.m(k,Ka,Ha,vb),Q.m(k,Ka,Ha,wb))}h=W;W=[]}if(!Na&&a.lu){Ba=ra.wa(Aa[0]);d.H.push(Ba);var Za=H(Ba);Q.C(k,Za);Q.m(k,h[0],Za,q[0])}if(Eb&&sb&&!Na){for(ea=0;ea<Aa.length;ea++){var tb=pb.Xg,Ta=pb.Vx,Ab=pb.th,Da=h[ea],
tc=Ga?1:0,$b=e("DEPTH","u_input",1,1,!0);$b.ya=la.G;$b.xa=la.G;var ac=e("COLOR","u_input",1,.25,!0);ac.ya=la.G;ac.xa=la.G;var Sb=tb/Ab,Gc=c(Aa[ea]);d.H.push(Gc);var uc=aa(Gc,tc,tb,!0,Sb,oa,Ab);Q.C(k,uc);Q.m(k,Da,uc,$b);var Sb=tb/Ab*.5,cb=c(Aa[ea]);d.H.push(cb);var Ya=aa(cb,tc,tb,!1,Sb,oa,Ab);Q.C(k,Ya);Q.m(k,uc,Ya,ac);var Sb=tb/Ab*.25,od=c(Aa[ea]);d.H.push(od);var Nb=aa(od,tc,tb,!1,Sb,oa,Ab);Q.C(k,Nb);Q.m(k,Ya,Nb,ac);var vc=w(Ta,oa);W.push(vc);Q.C(k,vc);Q.m(k,Da,vc,e("COLOR","u_main",1,1,!0));Q.m(k,
Nb,vc,e("COLOR","u_god_rays",1,1,!0))}h=W;W=[]}if(cc&&!Na){for(ea=0;ea<Aa.length;ea++){var Da=h[ea],oc=ia();Q.C(k,oc);Q.m(k,Da,oc,e("COLOR","u_input",1,1,!0));var Hc=S();Q.C(k,Hc);Hc.j.width=1;Hc.j.height=1;var Tb=e("COLOR","u_input",1,.25,!0);Tb.ya=la.G;Tb.xa=la.G;var Ic=e("COLOR","u_luminance",1,.25,!0);Ic.ya=la.G;Ic.xa=la.G;Q.m(k,oc,Hc,Tb);var jd=Qa.key,wc=Qa.ww,gc=c(Aa[ea]);d.H.push(gc);var hc=P(jd,wc,oa,gc);Q.C(k,hc);Q.m(k,Da,hc,e("COLOR","u_main",1,1,!0));Q.m(k,oc,hc,Ic);Q.m(k,Hc,hc,e("COLOR",
"u_average_lum",1,1,!1));var Ob=e("COLOR","u_color",1,.25,!0);Ob.ya=la.G;Ob.xa=la.G;var xc=t("X_BLUR");Q.C(k,xc);Q.m(k,hc,xc,Ob);var pc=t("Y_BLUR");Q.C(k,pc);Q.m(k,xc,pc,Ob);var ic=ga(Qa.blur);Q.C(k,ic);var Jc=e("COLOR","u_bloom",1,.25,!0);Jc.ya=la.G;Jc.xa=la.G;Q.m(k,pc,ic,Jc);Q.m(k,Da,ic,e("COLOR","u_main",1,1,!0));W.push(ic)}h=W;W=[]}if(sc&&!Na){for(ea=0;ea<h.length;ea++){var Oc=h[ea],Bb=V(Xa.bk,Xa.ck);W.push(Bb);Q.C(k,Bb);Q.m(k,Oc,Bb,e("COLOR","u_mb_tex_curr",1,1,!0));Bb.na.push(e("COLOR","u_mb_tex_accum",
1,1,!0))}h=W;W=[]}if(zb&&sb&&!Na){for(ea=0;ea<h.length;ea++){var Da=h[ea],Ub=c(Aa[ea]);d.H.push(Ub);Ob=e("COLOR","u_color",1,1,!0);Ob.ya=la.G;Ob.xa=la.G;var rb=F("X_BLUR");Q.C(k,rb);Q.m(k,Da,rb,Ob);var Cb=F("Y_BLUR");Q.C(k,Cb);Q.m(k,rb,Cb,Ob);var Oa=Xb[ea],yc=ca(Ub);Ub.dof_distance=d.dof_distance;Ub.Bf=d.Bf;Ub.dof_front=d.dof_front;Ub.dof_rear=d.dof_rear;Ub.dof_power=d.dof_power;Ub.dof_on=1;W.push(yc);Q.C(k,yc);Q.m(k,Da,yc,e("COLOR","u_sharp",1,1,!0));Q.m(k,Cb,yc,e("COLOR","u_blurred",1,1,!0));Q.m(k,
Oa,yc,e("DEPTH","u_depth",1,1,!0))}h=W;W=[]}if(!Na&&a.outline){for(ea=0;ea<Aa.length;ea++){var Da=h[ea],$c=c(Aa[ea]);d.H.push($c);var bc=U($c);Q.C(k,bc);var Kc=F("X_EXTEND"),ad=e("COLOR","u_color",1,1,!0),rd=e("COLOR","u_outline_mask",1,1,!0);Kc.ki=!0;Q.C(k,Kc);Q.m(k,bc,Kc,ad);var qc=e("COLOR","u_color",1,.5,!0);qc.ya=la.G;qc.xa=la.G;var zc=F("Y_EXTEND");zc.ki=!0;Q.C(k,zc);Q.m(k,Kc,zc,qc);rb=F("X_BLUR");rb.ki=!0;Q.C(k,rb);Q.m(k,zc,rb,qc);var Pc=e("COLOR","u_color",1,.25,!0);Pc.ya=la.G;Pc.xa=la.G;
var Db=e("COLOR","u_outline_mask_blurred",1,.25,!0);Db.ya=la.G;Db.xa=la.G;Cb=F("Y_BLUR");Cb.ki=!0;Q.C(k,Cb);Q.m(k,rb,Cb,Pc);var Lc=Z(yb);Q.C(k,Lc);Q.m(k,Da,Lc,e("COLOR","u_outline_src",1,1,!0));Q.m(k,bc,Lc,rd);Q.m(k,Cb,Lc,Db);W.push(Lc)}h=W;W=[]}if(dc&&!Na){for(ea=0;ea<h.length;ea++){var Da=h[ea],bd=R(xb.brightness,xb.contrast,xb.exposure,xb.saturation);Q.C(k,bd);Q.m(k,Da,bd,e("COLOR","u_color",1,1,!0));W.push(bd)}h=W;W=[]}if(Lb){for(ea=0;ea<h.length;ea++)if(Da=h[ea],ta.smaa){var Ac=e("COLOR","u_color",
1,1,!0);Ac.ya=la.G;Ac.xa=la.G;var Qc=J("SMAA_EDGE_DETECTION");Q.C(k,Qc);Q.m(k,Da,Qc,Ac);var fb=J("SMAA_BLENDING_WEIGHT_CALCULATION");Q.C(k,fb);Q.m(k,Qc,fb,Ac);var Bc=e("COLOR","u_search_tex",1,1,!1),Rc=e("COLOR","u_area_tex",1,1,!1);Bc.ya=la.G;Bc.xa=la.G;Rc.ya=la.G;Rc.xa=la.G;fb.na.push(Bc);fb.na.push(Rc);var Cc=J("SMAA_NEIGHBORHOOD_BLENDING");Q.C(k,Cc);Q.m(k,Da,Cc,Ac);var cd=e("COLOR","u_blend",1,1,!0);cd.ya=la.G;cd.xa=la.G;Q.m(k,fb,Cc,cd);W.push(Cc)}else{var Mc=N();Q.C(k,Mc);var Sc=e("COLOR","u_color",
1,1,!0);Sc.ya=la.G;Sc.xa=la.G;Q.m(k,Da,Mc,Sc);if(1<ta.resolution_factor){var dd=F("NONE");Q.C(k,dd);Q.m(k,Mc,dd,Sc);W.push(dd)}else W.push(Mc)}h=W;W=[]}if(a.anaglyph_use&&!Na){var Tc=fa();Q.C(k,Tc);Q.m(k,h[0],Tc,e("COLOR","u_sampler_left",1,1,!0));Q.m(k,h[1],Tc,e("COLOR","u_sampler_right",1,1,!0));W.push(Tc)}else W.push(h[0]);var pd=Q.dh(k,h[0]),ed=!1;Q.ge(k,pd,function(a,b,c){if(c.K==c.ca)return ed=!0});if(ed){var Ib=ma();Q.C(k,Ib);Q.m(k,h[0],Ib,e("COLOR","u_color",1,1,!0));h=W;W=[];W.push(Ib)}Sa&&
(jb?W.push(jb):W.push(Sa));Za&&W.push(Za);if(!Na&&a.Dk.procedural_skydome){var Dc=ha(oa,a.Dk);Q.C(k,Dc);W.push(Dc)}var Jb=qa();Q.C(k,Jb);for(ea=0;ea<W.length;ea++){var Nc=W[ea];switch(Nc.type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":Q.m(k,Nc,Jb,e("COLOR","NONE",1,1,!0));Q.m(k,Nc,Jb,e("DEPTH","NONE",1,1,!0));break;case "SKY":Q.m(k,Nc,Jb,e("CUBEMAP","u_sky",lb.Cj,1,!1));break;case "ANCHOR_VISIBILITY":Q.m(k,Nc,Jb,e("COLOR","NONE",1,1,!0));break;default:if(Na){var fd=B[0].d,Ec=e("COLOR","OFFSCREEN",
1,1,!0);Ec.oa=fd;Q.m(k,W[ea],Jb,Ec);for(Hb=1;Hb<B.length;Hb++){var gd=B[Hb].d,Ib=ma();Q.C(k,Ib);Q.m(k,W[ea],Ib,e("COLOR","u_color",1,1,!0));Ec=e("COLOR","OFFSCREEN",1,gd.kg/fd.kg,!0);Ec.oa=gd;Q.m(k,Ib,Jb,Ec)}}else Q.m(k,W[ea],Jb,e("SCREEN","NONE",1,1,!0))}}if(Ia.enabled){var Uc=E(k);Uc&&A(k,Uc)}b(k,sb);1<ta.resolution_factor&&l(k);f(k);z(k);for(ea=0;ea<Yb.length;ea++)O(k,Yb[ea]);for(ea=0;ea<Xb.length;ea++)O(k,Xb[ea]);return k};a.ZC=u;a.vC=function(a){var b=null;Q.S(a,function(a,c){return c.j&&null===
c.j.Td?(b=c,!0):!1});return b};a.pb=function(a,b,c){a=B(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];return null};a.RC=ya;a.Qx=ba;a.xx=B;a.NC=W;a.Ha=function(a,b){var c=null;Q.S(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.gw=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=na(a);Q.S(a,function(a,d){var e=b+="    ",f="",f=d.type.replace(/_/g," ");"POSTPROCESSING"==
d.type&&(f+=" ("+d.zi.replace(/_/g," ")+")");if(d.j){for(var f=f+"\\n",B=0;B<c.length;B+=2)c[B]==d.j.yb&&(f+="C"+c[B+1]+" ");for(B=0;B<c.length;B+=2)c[B]==d.j.Cc&&(f+="D"+c[B+1])}d.na.length&&(f+="\\n-----\\n");for(B=0;B<d.na.length;B++)f+=oa(d.na[B],c);B="SINK"==d.type?"dotted":d.enqueue?"solid":"dashed";b=e+(String(a)+' [label="'+f+'" color="black" style="'+(B+",bold")+'"];\n')});Q.af(a,function(a,d,e){b+="    ";b+=String(a)+" -> "+String(d)+' [label="'+oa(e,c)+'" style="'+(e.Ka?"solid":"dotted")+
'"];\n'});return b+="}"};a.Tv=function(a){a=Q.tA(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.enqueue&&b.push(d)}return b}};b4w.module.__textures=function(a,p){function c(){return{name:"",type:0,source:"",width:0,height:0,Bl:1,fj:!0,kg:1024,Ap:!1,Ld:null,Ja:null,ih:null,Tr:1,de:0,jh:!1,Pk:!1,Mf:!1,U:0,Ca:0,Kg:0,WA:!1,ng:!1,Um:0,Ub:0,Hb:0,Ta:null,ff:null}}function b(b,d,e){var f=b.type,g=new Uint8Array([204,204,204,255]),k=c();switch(f){case "DATA_TEX2D":case "IMAGE":var l=t.createTexture(),m=t.TEXTURE_2D;t.bindTexture(m,l);t.texImage2D(m,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,g);b.image&&"MOVIE"==b.image.source&&(k.Mf=
!0,k.U=b.frame_start,k.Ca=b.frame_offset,k.Kg=b.frame_duration,k.WA=b.use_auto_refresh,k.ng=b.use_cyclic,k.Um=b.movie_length,0!=k.Ca&&z.warn('Frame offset for texture "'+b.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.'));break;case "NONE":l=t.createTexture();m=t.TEXTURE_2D;t.bindTexture(m,l);if("NONE"==b.b4w_source_type)return null;if("SCENE"==b.b4w_source_type)if(b.b4w_source_id&&(e=n.keysearch("name",b.b4w_source_id,e)))k.kg=b.b4w_source_size,e.Yc=e.Yc||[],e.Yc.push(b),
t.texImage2D(m,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,g);else return null;break;case "ENVIRONMENT_MAP":l=t.createTexture();m=t.TEXTURE_CUBE_MAP;t.bindTexture(m,l);e="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var q=0;6>q;q++)u.vm?t.texImage2D(t["TEXTURE_CUBE_MAP_"+e[q]],0,t.RGB,1,1,0,t.RGB,t.UNSIGNED_BYTE,g):t.texImage2D(t["TEXTURE_CUBE_MAP_"+e[q]],0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,g);break;case "VORONOI":case "BLEND":return null;default:return z.error('texture "'+
b.name+'" has unsupported type "'+f+'"'),null}("NONE"!=f||b.b4w_enable_canvas_mipmapping&&"CANVAS"==b.b4w_source_type)&&"DATA_TEX2D"!=f?u.vm?t.texParameteri(m,t.TEXTURE_MIN_FILTER,t.LINEAR):t.texParameteri(m,t.TEXTURE_MIN_FILTER,y[u.Hk]):t.texParameteri(m,t.TEXTURE_MIN_FILTER,t.LINEAR);t.texParameteri(m,t.TEXTURE_MAG_FILTER,t.LINEAR);g=m;e=b.b4w_anisotropic_filtering;"DEFAULT"===e&&(e=d);"OFF"!==e&&u.gj&&(d=A.jx())&&(e=parseFloat(e.split("x")[0]),t.texParameterf(g,d.TEXTURE_MAX_ANISOTROPY_EXT,e));
"REPEAT"!=b.extension||b.b4w_shore_dist_map?(t.texParameteri(m,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(m,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)):(t.texParameteri(m,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(m,t.TEXTURE_WRAP_T,t.REPEAT));k.type=a.vg;k.width=1;k.height=1;k.Ta=l;k.Hb=m;"CANVAS"==b.b4w_source_type&&"NONE"==f?(f=b.b4w_source_id,l=b.b4w_source_size,k.Ap=b.b4w_enable_canvas_mipmapping,k.name=f,k.source="CANVAS",m=document.createElement("canvas"),m.setAttribute("id",f),m.width=l,m.height=
l,k.Ld=m.getContext("2d"),I[f]=k,h(k)):"SCENE"==b.b4w_source_type&&"NONE"==f?(k.name=b.b4w_source_id,k.source="SCENE"):(k.name=b.name,k.source=f,t.generateMipmap(m),t.bindTexture(m,null));return b.d=k}function h(a){if("CANVAS"!=a.source)throw"Wrong texture";var b=a.Hb;t.bindTexture(b,a.Ta);var c=g(a),d=m(a),e=a.Ld.canvas;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0);t.texImage2D(b,0,c,c,d,e);t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1);a.Ap&&t.generateMipmap(b);t.bindTexture(b,null);a.width=e.width;a.height=
e.height}function d(a){var b=a.Hb;t.bindTexture(b,a.Ta);t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0);t.texImage2D(b,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,a.ih[a.de]);t.bindTexture(b,null)}function f(a){t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.LINEAR);t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.LINEAR)}function l(a,b){var c=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384];return-1==c.indexOf(a)||-1==c.indexOf(b)}
function g(b){switch(b.type){case a.vg:b=t.RGBA;break;case a.Uk:b=t.RGB;break;case a.bj:b=t.RGBA;break;case a.cj:b=t.RGB;break;case a.Jh:b=t.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}return b}function m(b){switch(b.type){case a.vg:b=t.UNSIGNED_BYTE;break;case a.Uk:b=t.UNSIGNED_BYTE;break;case a.bj:b=t.FLOAT;break;case a.cj:b=t.FLOAT;break;case a.Jh:b=t.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}function k(a){return a in F?(u.Ic?F[a].jh=!0:F[a].Ja.play(),!0):null}
function x(a){return a in F?(a=F[a],u.Ic?(a.de=a.Ca,d(a),a.de++):a.Ja.currentTime=a.Ca/a.Ub,!0):null}function r(a){return a in F?(u.Ic?F[a].jh=!1:F[a].Ja.pause(),!0):null}var q=p("__config"),z=p("__print"),E=p("__dds"),A=p("__extensions"),n=p("__util"),u=q.q,e=q.Hd,O=q.Tc;a.Cd=0;a.G=0;a.au=0;a.Zt=0;a.$t=0;a.Yt=0;a.vg=10;a.Uk=20;a.bj=30;a.cj=40;a.Jh=50;a.ug=60;var I={},F={},t=null,y;a.qc=function(b){y=[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];
a.Cd=b.NEAREST;a.G=b.LINEAR;a.au=b.NEAREST_MIPMAP_NEAREST;a.Zt=b.LINEAR_MIPMAP_NEAREST;a.$t=b.NEAREST_MIPMAP_LINEAR;a.Yt=b.LINEAR_MIPMAP_LINEAR;t=b};a.nx=function(a){return a in I?I[a].Ld:null};a.HA=function(a){return a in I?(h(I[a]),!0):!1};a.Bj=function(b,d){var e=c();e.name=b;e.type=d;e.source="NONE";if(d==a.ug)e.ff=t.createRenderbuffer();else{var f=t.TEXTURE_2D,g=t.createTexture();t.bindTexture(f,g);t.texParameteri(f,t.TEXTURE_MAG_FILTER,t.LINEAR);t.texParameteri(f,t.TEXTURE_MIN_FILTER,t.LINEAR);
t.texParameteri(f,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(f,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.bindTexture(f,null);e.Hb=f;e.Ta=g}return e};a.Iv=function(b){var d=t.createTexture(),e=t.TEXTURE_CUBE_MAP;t.bindTexture(e,d);t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.LINEAR);t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.LINEAR);t.texParameteri(e,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(e,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);for(var f="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),
g=0;6>g;g++)t.texImage2D(t[f[g]],0,t.RGBA,b,b,0,t.RGBA,t.UNSIGNED_BYTE,null);t.bindTexture(e,null);e=c();e.name="CUBEMAP";e.type=a.vg;e.source="NONE";e.width=3*b;e.height=2*b;e.Bl=1;e.Ta=d;e.Hb=t.TEXTURE_CUBE_MAP;return e};a.on=function(b,c,d){if(b.type!=a.ug){var e=b.Hb;t.bindTexture(e,b.Ta);c&&t.texParameteri(e,t.TEXTURE_MIN_FILTER,c);d&&t.texParameteri(e,t.TEXTURE_MAG_FILTER,d);t.bindTexture(e,null)}};a.MC=function(b){if(b.type==a.ug)return{min:a.Cd,ly:a.Cd};var c=b.Hb;t.bindTexture(c,b.Ta);b=
t.getTexParameter(c,t.TEXTURE_MIN_FILTER);var d=t.getTexParameter(c,t.TEXTURE_MAG_FILTER);t.bindTexture(c,null);return{min:b,ly:d}};a.resize=function(b,c,d){c=Math.max(c,1);d=Math.max(d,1);if(b.width!=c||b.height!=d){if(b.type==a.ug)t.bindRenderbuffer(t.RENDERBUFFER,b.ff),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,c,d),t.bindRenderbuffer(t.RENDERBUFFER,null);else{var e=b.Hb;t.bindTexture(e,b.Ta);var f=g(b),k=m(b);t.texImage2D(e,0,f,c,d,0,f,k,null);t.bindTexture(e,null)}c>u.hd||d>u.hd?
z.error('Slink texture "'+b.name+'" has unsupported size'):(b.width=c,b.height=d)}};a.aw=b;a.TA=function(a){var b=a.Hb;t.bindTexture(b,a.Ta);t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0);4!=a.Ja.length?t.texImage2D(b,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,a.Ja):t.texImage2D(b,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,a.Ja);t.bindTexture(b,null)};a.QA=d;a.Oi=function(a,b,c,d){var g=a.source,k=a.Hb;t.bindTexture(k,a.Ta);if(4==b.length){var h=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==g)if(h)t.texImage2D(k,
0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,b),a.width=1,a.height=1;else if(c){c=E.hq(b);if(c.width>u.hd||c.height>u.hd){z.error("texture has unsupported size",d);return}E.VA(t,A.dq(),b,!0);l(c.width,c.height)&&(a.Jo||z.warn("using NPOT texture",d),f(k));a.width=c.width;a.height=c.height;a.Bl=E.px(b)}else{t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0);if(b.width>u.hd||b.height>u.hd){z.error("texture has unsupported size",d);return}a.Mf?u.Ic?b&&(F[a.name]=a,a.ih=b,a.Ub=a.Um/b.length,a.Kg=Math.round(a.Kg/a.Ub),
a.Ca=Math.round(a.Ca/a.Ub),a.U=Math.round(a.U/a.Ub),a.de=a.Ca,t.texImage2D(k,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,a.ih[0])):(a.Ja=b,a.Ja.loop=a.ng,b&&(F[a.name]=a),a.Ub=e.Ia,b.duration&&(a.Ub=a.Um/b.duration),O.xp||(b.playbackRate=e.Ia/a.Ub,O.bp&&2<b.playbackRate&&(b.playbackRate=2)),t.texImage2D(k,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,a.Ja)):t.texImage2D(k,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,b);u.Ic&&a.Mf?(a.width=b[0].width,a.height=b[0].height):(a.width=b.width,a.height=b.height);l(b.width,b.height)?(a.Jo||(a.Mf?
z.warn("using NPOT video texture",d):z.warn("using NPOT texture",d)),f(k)):a.Mf||t.generateMipmap(k)}else if("ENVIRONMENT_MAP"==g)if(c=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],h){for(h=0;6>h;h++)g=c[h],t.texImage2D(t["TEXTURE_CUBE_MAP_"+g[0]],0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,b);a.width=3;a.height=2}else{t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1);var m=b.width/3;if(m>u.Pm||m>u.Pm){z.error("cubemap has unsupported size",d);
return}for(h=0;6>h;h++){var g=c[h],n=document.createElement("canvas");n.width=m;n.height=m;var q=n.getContext("2d");"POSITIVE_Y"==g[0]||"NEGATIVE_Y"==g[0]?(q.translate(0,m),q.scale(1,-1)):(q.translate(m,0),q.scale(-1,1));q.drawImage(b,g[1]*m,g[2]*m,m,m,0,0,m,m);t.texImage2D(t["TEXTURE_CUBE_MAP_"+g[0]],0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)}a.width=3*m;a.height=2*m;l(b.width/3,b.height/2)?(z.warn("using NPOT cube map texture",d),f(k)):t.generateMipmap(k)}else"DATA_TEX2D"==g&&(t.texImage2D(k,0,t.RGBA,b.width,
b.height,0,t.RGBA,t.UNSIGNED_BYTE,b.data),a.width=b.width,a.height=b.height);t.bindTexture(k,null)};a.pw=function(a){t.deleteTexture(a)};a.mi=function(a){return a&&a.name&&(a.Ta||a.ff)?!0:!1};a.Dq=function(a){return a&&a.name&&a.ff?!0:!1};a.dD=function(b){return b.type==a.bj||b.type==a.cj?!0:!1};a.Gx=function(b){var c=0;switch(b.type){case a.vg:case a.Uk:c=4;break;case a.bj:case a.cj:c=16;break;case a.Jh:c=3;break;case a.ug:c=2}return c};a.ex=function(a){var c=null,c={name:"special_ssao_texture",
type:"DATA_TEX2D",extension:"REPEAT",b4w_anisotropic_filtering:"OFF"};b(c,null,a);c.image={filepath:null};return c};a.cleanup=function(){if(!u.Ic)for(var a in F)F[a].Ja.pause(),F[a].Ja.src="",F[a].Ja.load();I={};F={}};a.play_video=k;a.reset_video=x;a.pause_video=r;a.pause=function(){for(var a in F)u.Ic&&!F[a].jh||!u.Ic&&F[a].Ja.paused||(r(a),F[a].Pk=!0)};a.reset=function(){for(var a in F)x(a),F[a].Pk=!1};a.play=function(a){for(var b in F)if(!a||F[b].Pk)k(b),F[b].Pk=!1}};b4w.module.__assets=function(a,p){function c(){return E.Cq()?p(E.Mb.pj).data:null}function b(){var a={dj:null,hu:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},open:function(b,c){a.dj=c;a.readyState=1},send:function(){a.status=
404;a.readyState=4;var b=c();b&&a.dj in b&&(a.status=200,b[a.dj]&&(a.response=a.hu(b[a.dj])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function h(b){for(var c=0,e=0;e<b.length;e++){var h=b[e];20===h.state&&c++;if(c>=I.ry)break;if(10===h.state)switch(h.state=20,c++,h.type){case a.AT_ARRAYBUFFER:d(h,"arraybuffer");break;case a.AT_JSON:d(h,"json");break;case a.AT_TEXT:d(h,"text");break;case a.AT_AUDIOBUFFER:f(h);break;case a.AT_IMAGE_ELEMENT:l(h);
break;case a.AT_AUDIO_ELEMENT:g(h);break;case a.Yi:m(h);break;case a.Xi:k(h);break;default:u.ma("Wrong asset type: "+h.type)}}}function d(a,d){var e=c(),f=e&&a.r in e?new b:new XMLHttpRequest;f.open("GET",a.r,!0);"text"==d?(f.overrideMimeType("text/plain"),f.responseType="text"):"json"==d?(f.overrideMimeType("application/json"),f.responseType="text"):f.responseType=d;f.onreadystatechange=function(){if(40!=a.state&&4==f.readyState){if(200==f.status||0==f.status){var b=f.response;if(b){if("json"==d&&
"string"==typeof b)try{b=JSON.parse(b)}catch(c){a.fb(null,a.uri,a.type,a.r,a.jb);A.error(c+" (parsing JSON "+a.r+")");return}a.fb(b,a.uri,a.type,a.r,a.jb)}else a.fb(null,a.uri,a.type,a.r,a.jb),A.error("empty responce when trying to get "+a.r)}else a.fb(null,a.uri,a.type,a.r,a.jb),A.error(f.status+" when trying to get "+a.r);a.state=30}};f.addEventListener("progress",function(b){b.lengthComputable&&a.Gr(b.loaded/b.total)},!1);f.send(null)}function f(a){var d=c(),e=d&&a.r in d?new b:new XMLHttpRequest;
e.open("GET",a.r,!0);e.responseType="arraybuffer";e.onreadystatechange=function(){if(40!=a.state&&4==e.readyState)if(200==e.status||0==e.status){var b=e.response;b?n.kw(b,function(b){a.fb(b,a.uri,a.type,a.r,a.jb);a.state=30},function(){a.fb(null,a.uri,a.type,a.r,a.jb);A.error("failed to decode "+a.r);a.state=30}):(a.fb(null,a.uri,a.type,a.r,a.jb),A.error("empty responce when trying to get "+a.r),a.state=30)}else a.fb(null,a.uri,a.type,a.r,a.jb),A.error(e.status+" when trying to get "+a.r),a.state=
30};e.send(null)}function l(a){var b=document.createElement("img");F.allow_cors&&(b.crossOrigin="Anonymous");b.onload=function(){40!=a.state&&(a.fb(b,a.uri,a.type,a.r,a.jb),a.state=30)};b.addEventListener("error",function(){40!=a.state&&(a.fb(null,a.uri,a.type,a.r,a.jb),A.error("could not load image: "+a.r),a.state=30)},!1);var d=c();if(d&&a.r in d)if(d[a.r]){var e=r(a.r);b.src="data:"+e+";base64,"+d[a.r]}else O.xm()?(d=document.createEvent("CustomEvent"),d.initCustomEvent("error",!1,!1,null)):d=
new CustomEvent("error"),b.dispatchEvent(d);else b.src=a.r}function g(a){var b=document.createElement("audio");F.allow_cors&&(b.crossOrigin="Anonymous");b.addEventListener("loadeddata",function(){40!=a.state&&(a.fb(b,a.uri,a.type,a.r,a.jb),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.fb(null,a.uri,a.type,a.r,a.jb),A.error("could not load sound: "+a.r),a.state=30)},!1);var d=c();if(d&&a.r in d)if(d[a.r]){var e=q(a.r);b.src="data:"+e+";base64,"+d[a.r];40!=a.state&&(a.fb(b,
a.uri,a.type,a.r,a.jb),a.state=30)}else O.xm()?(d=document.createEvent("CustomEvent"),d.initCustomEvent("error",!1,!1,null)):d=new CustomEvent("error"),b.dispatchEvent(d);else b.src=a.r,F.Lf&&b.load();setTimeout(function(){b.Sz=1},5E3)}function m(a){function b(){40!=a.state&&(a.fb(null,a.uri,a.type,a.r),A.error("could not load video: "+a.r,a.jb),a.state=30)}var d=document.createElement("video");d.muted=!0;if(F.allow_cors||F.Lf)d.crossOrigin="Anonymous";d.addEventListener("loadeddata",function(){d.removeEventListener("error",
b,!1);40!=a.state&&(a.fb(d,a.uri,a.type,a.r,a.jb),a.state=30)},!1);d.addEventListener("error",b,!1);var e=c();if(e&&a.r in e)if(e[a.r]){var f=z(a.r);d.src="data:"+f+";base64,"+e[a.r];40!=a.state&&(a.fb(d,a.uri,a.type,a.r,a.jb),a.state=30)}else O.xm()?(e=document.createEvent("CustomEvent"),e.initCustomEvent("error",!1,!1,null)):e=new CustomEvent("error"),d.dispatchEvent(e);else d.src=a.r,F.Lf&&d.load();setTimeout(function(){d.Sz=1},1E4)}function k(a){function d(b){a.fb(b,a.uri,a.type,a.r,a.jb)}var e=
c(),f=e&&a.r in e?new b:new XMLHttpRequest;f.open("GET",a.r,!0);f.responseType="arraybuffer";f.onreadystatechange=function(){if(40!=a.state&&4==f.readyState){if(200==f.status||0==f.status){var b=f.response;b?x(b,d):(a.fb(null,a.uri,a.type,a.r,a.jb),A.error("empty responce when trying to get "+a.r))}else a.fb(null,a.uri,a.type,a.r,a.jb),A.error(f.status+" when trying to get "+a.r);a.state=30}};f.addEventListener("progress",function(b){b.lengthComputable&&a.Gr(b.loaded/b.total)},!1);f.send(null)}function x(a,
b){for(var c=new Int32Array(a),d=new Int8Array(a),e=c[3],f={images:[],Ub:c[4]},g=20,k=0;k<e;k++){var h=c[g/4],l=document.createElement("img");l.src=window.URL.createObjectURL(new Blob([d.subarray(g+4,g+4+h)],{type:"image/jpg"}));f.images.push(l);g+=h+8-h%4}l.onload=function(){b(f)}}function r(a){var b="image";switch(u.hm(a).toLowerCase()){case "jpeg":case "jpg":b+="/jpeg";break;case "png":b+="/png"}return b}function q(a){var b="audio";switch(u.hm(a).toLowerCase()){case "ogv":case "ogg":b+="/ogg";
break;case "mp3":b+="/mpeg";break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+="/webm"}return b}function z(a){var b="video";switch(u.hm(a).toLowerCase()){case "ogv":b+="/ogg";break;case "webm":b+="/webm";break;case "m4v":b+="/mp4"}return b}var E=p("__config"),A=p("__print"),n=p("__sfx"),u=p("__util"),e=p("__version"),O=p("__compat"),I=E.Id,F=E.q;a.AT_ARRAYBUFFER=10;a.AT_JSON=20;a.AT_TEXT=30;a.AT_AUDIOBUFFER=40;a.AT_IMAGE_ELEMENT=50;a.AT_AUDIO_ELEMENT=60;a.Yi=70;a.Xi=80;var t=[],y=0,L={};a.Li=
function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.Fx=function(a){if(L[a])return L[a];var b=I.Dr?a+e.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=c.responseText;if(b.length)return L[a]=b;u.ma("Error XHR: responce is empty, GET "+a)}else u.ma("Error XHR: "+c.status+", GET "+a)};a.cleanup=function(){for(var a=0;a<t.length;a++)t[a].state=40;t=[];y=0;L={}};a.enqueue=
function(a,b,d,f){for(var g=0;g<a.length;g++){var k=a[g],k={uri:k[0],type:k[1],r:k[2],jb:k[3],state:10,fb:b||function(){},vr:d||function(){},Gr:f||function(){},wr:y};if(I.Dr){var l=c();l&&k.r in l||(k.r+=e.timestamp())}t.push(k)}h(t);y++};a.update=function(){h(t);for(var a=t,b=0,c=!0,d=0;d<a.length;d++){var e=a[d];e.wr===a[b].wr?30!==e.state&&(c=!1):(c&&(a[d-1].vr(),c=d-b,a.splice(b,c),d-=c),b=d,c=30===a[d].state?!0:!1);d===a.length-1&&c&&(a[d].vr(),a.splice(b))}}};b4w.module.__loader=function(a,p){function c(c,d,e,f){var g=A,k=q.create(),h;for(h in d){var l=b(d[h]);(f&&l.ab||!c&&l.tb)&&r(l);q.C(k,l)}for(h in d)for(l=d[h],l.name=h,c=0;c<l.J.length;c++)q.m(k,d[l.J[c]],l,null);d=b({name:"out",Ma:a.Vs,Xa:function(a,b,c,d,e){0===b.id&&(g.Er=!0);3!=b.status&&(b.status=2);b.Sq(b.id,!0);e(b,c);z.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")},bb:5});var m=[];if(e)for(e=q.fq(k),c=0;c<e.length;c++)m.push(q.hb(k,e[c]));else q.S(k,function(a,b){b.Va||m.push(b)});
q.C(k,d);for(c=0;c<m.length;c++)d.J.push(m[c].name),q.m(k,m[c],d,null);return k}function b(a){a.Va=a.Va||!1;a.Ma||0===a.Ma||(a.Ma=a.Xc);a.J=a.J||[];a.ji=a.ji||!1;a.sn=a.sn||!1;a.bb=a.bb||0;a.ab=a.ab||!1;a.tb=a.tb||!1;a.status=0;a.oD=0;a.Im=0;a.wf=a.wf||null;return a}function h(a,b){for(var c=[],d=[],f=0;f<b.length;f++){var g=b[f];q.hb(a.rd,g).ji&&(q.bf(a.rd,g,function(d){var f=!0;q.ge(a.rd,d,function(a,b){if(!b.ji)return f=!1,1});f&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(f))}for(f=
d.length-1;0<=f;f--)b.splice(d[f],1);return c}function d(a){function b(c,d){var e=q.hb(a.rd,c),f=q.hb(a.rd,d),g=f.Ma-e.Ma;0==g&&(g=e.Va-f.Va);return g}var c=[],d=a.fe,f=!1;do{var g=h(a,d);c.push.apply(c,d);0<g.length&&(f=!0);d=g}while(0<g.length);f&&c.sort(b);a.fe=c;return a.fe.length}function f(a,b,c){if(b.sn)return b.ji=!0,g(a,b),!1;if(!b.Xa&&!b.vf&&!b.Ph)return g(a,b),!1;if(0==b.status&&(b.status++,b.Xa))return b.Xa(c,a,b,b.wf,g,m),!0;if(1==b.status){if(b.vf)return b.vf(c,a,b,b.wf,g,m),!0;b.status++}return 2==
b.status&&(b.status++,b.Ph)?(b.Ph(c,a,b,b.wf,g,m),!0):!1}function l(a){if(0==a.Ek)return 100;var b=0;q.S(a.rd,function(c,d){a.do_not_load_resources&&d.ab||(b+=d.Im*d.bb)});return E.trunc(100*b/a.Ek)}function g(a,b){b.ji=!0;b.status=3;k(a,b,1)}function m(a,b,c){1>c?k(a,b,c):b.status++}function k(a,b,c){var d=A;if(b.Xa||b.vf||b.Ph)if(b.Im=c,b=l(a),a.rp!=b||1==c)a.yn(b,performance.now()-a.xs),a.rp=b,d.Mm=!0}function x(a,b){var c=null;q.S(a.rd,function(a,d){if(d.name==b)return c=d,1});return c}function r(a){a.sn=
!0;a.Im=1}var q=p("__graph"),z=p("__print"),E=p("__util");a.Xc=0;a.ke=1;a.Vs=2;var A=null;a.eq=function(){return A};a.Uv=function(){var a={ud:[],Jl:0,Yk:0,Er:!1,Mm:!1};return A=a};a.bw=function(a,b,d,f,g,k,h,l){var m=A,r={id:m.ud.length,status:0,r:b,Lo:"",Sq:d||function(){},Hm:l||!1,UD:k,xs:0,rp:0,Ek:0,ln:!1,yn:f||function(){},hp:g||function(){},rd:null,fe:null,rm:!1,qm:!1,tm:!1};a=c(0===r.id,a,k,h);r.rd=a;b=[];d=q.Dx(a);for(f=0;f<d.length;f++)b.push(d[f]);r.fe=b;q.S(a,function(a,b){!(b.Xa||b.vf||
b.Ph)||r.do_not_load_resources&&b.ab||(r.Ek+=b.bb)});m.ud.push(r);m.Yk++;return r.id};a.PA=function(b){var c=A;if(c&&0!=A.Yk)if(c.Mm)c.Mm=!1;else{var e=performance.now();do{var g=c.ud[c.Jl],k=b[g.id];if(3!=g.status)if(0==g.status&&(g.status=1,g.xs=performance.now(),g.yn(0,0)),d(g)){var h=g,l=h.fe.length;do{var m=q.hb(h.rd,h.fe[0]),r=f(h,m,k);m.Ma==a.ke&&(h.ln=!0);m=h.fe.shift();h.fe.push(m);l--}while(!r&&0!=l)}else g.hp(k,g),g.status=3,c.Yk--,h=g,h.yn=null,h.hp=null,h.rd=null,h.fe=null;c.Er&&(c.Jl=
(c.Jl+1)%c.ud.length);if(g.ln){g.ln=!1;break}}while(16>performance.now()-e)}};a.KD=m;a.bs=function(a,b){var c=x(a,b);null!==c&&r(c)};a.sA=function(a){return a&&3==a.status};a.is_primary_loaded=function(a){var b=A;if(!b)return!1;a|=0;return b.ud[a]&&(3==b.ud[a].status||2==b.ud[a].status)};a.cleanup=function(){A=null}};b4w.module.__nla=function(a,p){function c(){return{type:"CLIP",U:0,ha:0,ce:!1,paused:!1,Mh:"",cl:"",Ac:0,uo:0,ku:0,Dp:0,Cp:0,uh:!1}}function b(a,b){for(var c=a.b4w_nla_script,d=b.Pe,e=0;e<c.length;e++){var f=c[e];switch(f.type){case "PLAY":d.push({type:"PLAY",U:f.frame_range[0],ha:f.frame_range[1],Fe:!1});break;case "SELECT":case "SELECT_PLAY":var g=E.fd(E.mf,f.object,0),k=E.Cx(a),h=k.indexOf(g);if(-1==h){z.error("NLA script error: non-selectable object");return}for(var f={type:f.type,cs:"SELECT"==
f.type?f.target_slot:e+1,Qz:e+1,Qe:-1,rz:k.length,qz:h,U:f.frame_range[0],ha:f.frame_range[1],Fe:!1},h=[],l=0;l<k.length;l++)h.push(r.create_selection_sensor(k[l],!0));r.create_sensor_manifold(g,"NLA_SELECT_"+e,r.CT_SHOT,h,r.lw,function(a,c,d,e){if(!(b.zb>=b.Pe.length)&&(d=b.Pe[b.zb],"SELECT"==d.type||"SELECT_PLAY"==d.type&&!d.Fe)){for(d=0;d<e.rz;d++)if(r.get_sensor_value(a,c,d)&&d==e.qz){e.Qe=1;return}e.Qe=0}},f);d.push(f);break;case "JUMP":d.push({type:"JUMP",un:f.target_slot});break;case "CONDJUMP":d.push({type:"CONDJUMP",
un:f.target_slot,vv:f.condition,Ei:f.register1,Fi:f.register2,Zm:f.number1,$m:f.number2});break;case "REGSTORE":d.push({type:"REGSTORE",Yy:f.registerd,Ey:f.number1});break;case "MATH":d.push({type:"MATH",Gy:f.operation,Ei:f.register1,Fi:f.register2,Zm:f.number1,$m:f.number2,gh:f.registerd});break;case "SHOW":case "HIDE":g=E.fd(E.mf,f.object,0);d.push({type:f.type,obj:g});break;case "REDIRECT":d.push({type:"REDIRECT",url:f.url});break;case "PAGEPARAM":d.push({type:"PAGEPARAM",Iy:f.param_name,gh:f.registerd});
break;case "NOOP":d.push({type:"NOOP"})}}}function h(a,b,c,g){if(a.Pe.length){if(a.zb>=a.Pe.length)if(a.cyclic)a.zb=0;else{a.Ca-=e.Ia*c;return}var k=f(a,b,g,!1),l=a.Pe[a.zb];switch(l.type){case "PLAY":l.Fe?k>=l.ha&&(l.Fe=!1,a.zb++,h(a,b,c,g)):(a.Ca+=l.U-k,l.Fe=!0,d(a,l));break;case "SELECT":case "SELECT_PLAY":-1<l.Qe?"SELECT"==l.type||"SELECT_PLAY"==l.type&&0==l.Qe?(a.zb=l.Qe?l.cs:l.Qz,l.Qe=-1,h(a,b,c,g)):l.Fe?k>=l.ha&&(l.Fe=!1,a.zb=l.cs,l.Qe=-1,h(a,b,c,g)):(a.Ca+=l.U-k,l.Fe=!0,d(a,l)):a.Ca-=e.Ia*
c;break;case "JUMP":a.zb=l.un;h(a,b,c,g);break;case "CONDJUMP":var k=-1==l.Ei?l.Zm:a.ld[l.Ei],m=-1==l.Fi?l.$m:a.ld[l.Fi],q=!1;switch(l.vv){case "EQUAL":k==m&&(q=!0);break;case "NOTEQUAL":k!=m&&(q=!0);break;case "LESS":k<m&&(q=!0);break;case "GREATER":k>m&&(q=!0);break;case "LEQUAL":k<=m&&(q=!0);break;case "GEQUAL":k>=m&&(q=!0)}q?a.zb=l.un:a.zb++;h(a,b,c,g);break;case "REGSTORE":a.ld[l.Yy]=l.Ey;a.zb++;h(a,b,c,g);break;case "MATH":k=-1==l.Ei?l.Zm:a.ld[l.Ei];m=-1==l.Fi?l.$m:a.ld[l.Fi];switch(l.Gy){case "ADD":a.ld[l.gh]=
k+m;break;case "MUL":a.ld[l.gh]=k*m;break;case "SUB":a.ld[l.gh]=k-m;break;case "DIV":0==m&&n.ma("Division by zero in NLA script"),a.ld[l.gh]=k/m}a.zb++;h(a,b,c,g);break;case "SHOW":E.show_object(l.obj);a.zb++;h(a,b,c,g);break;case "HIDE":E.hide_object(l.obj);a.zb++;h(a,b,c,g);break;case "REDIRECT":window.location.href=l.url;a.Pe.length=0;break;case "PAGEPARAM":a:{k=location.href.toString();if(-1!=k.indexOf("?"))for(k=k.split("?")[1].split("&"),m=0;m<k.length;m++)if(q=k[m].split("="),1<q.length&&q[0]==
l.Iy){k=Number(q[1]);break a}k=0}a.ld[l.gh]=k;a.zb++;h(a,b,c,g);break;case "NOOP":a.zb++,h(a,b,c,g)}}}function d(a,b){for(var c=a.Pe,d=0;d<c.length;d++){var e=c[d];e!=b&&(e.Qe=-1)}}function f(a,b,c,d){b=(b-c)*e.Ia+a.Ca-a.U;a.cyclic&&d&&(b%=a.ha-a.U+1);return b+=a.U}function l(a,b){b?u.pause_video(a.name):(u.reset_video(a.name),u.play_video(a.name))}function g(a,b){for(var d=[],e=0;e<a.length;e++){var f=a[e].strips;if(f)for(var g=0;g<f.length;g++){var k=f[g],h=c();h.type=k.type;h.U=k.frame_start;h.ha=
k.frame_end;h.Ac=b;h.uo=k.action_frame_start;h.ku=k.action_frame_end;k.action&&(h.Mh=k.action.name,h.cl=k.action.uuid);d.push(h)}}return d}function m(a){return A.Xd(a)&&a.data.animation_data&&a.data.animation_data.nla_tracks.length?!0:!1}var k=p("__animation"),x=p("__camera"),r=p("__controls"),q=p("__config");p("__loader");p("__particles");var z=p("__print"),E=p("__scenes"),A=p("__sfx"),n=p("__util"),u=p("__textures"),e=q.Hd,O=q.q,I=[],F=-1;a.OA=function(a,d){var e={U:a.frame_start,ha:a.frame_end,
Ca:0,ni:-1,cyclic:d,ae:[],M:[],Pe:[],zb:0,ld:{R1:0,R2:0,R3:0,R4:0,R5:0,R6:0,R7:0,R8:0}};b(a,e);for(var f=E.Da(a,"ALL",E.DATA_ID_ALL),h=0;h<f.length;h++){var l=f[h],q=0,r=[],v=l.animation_data;v&&v.nla_tracks.length&&(v=v.nla_tracks,n.is_armature(l)||x.is_camera(l)||n.is_mesh(l)||n.Uj(l)||A.Xd(l))&&(v=g(v,q),v.length&&(r=r.concat(v),q++));m(l)&&(v=l.data.animation_data.nla_tracks,v=g(v,q),v.length&&(r=r.concat(v),q++));if(k.qq(l))for(var u=l.data.materials,p=0;p<u.length;p++){var F=u[p].node_tree,
v=F.animation_data;F&&v&&(v=v.nla_tracks,v=g(v,q),v.length&&(r=r.concat(v),q++))}for(p=0;p<l.particle_systems.length;p++)v=l.particle_systems[p],u=v.settings,"EMITTER"==u.type&&u.b4w_allow_nla&&(u=c(),u.type="CLIP",u.U=e.U,u.ha=e.ha+1,u.Mh=v.name,u.Ac=q,r.push(u),q++);v=q+1;if(n.is_mesh(l)&&l.data)for(p=0;p<l.data.b4w_vertex_anim.length;p++)F=l.data.b4w_vertex_anim[p],F.allow_nla&&(q=v,u=c(),u.type="CLIP",u.U=e.U,u.ha=e.ha+1,u.Mh=F.name,u.Ac=q,r.push(u));r.length&&(l.Vk=r,e.ae.push(l))}f=a.d.Dh;for(p=
0;p<f.length;p++)if(h=f[p].d,h.Ja||h.ih)u=c(),u.type="VIDEO",l=1,O.Ic&&(l=h.Ub),u.U=Math.min(h.U*l,e.ha),u.ha=h.ng?e.ha:Math.min((h.Kg+h.U+h.Ca)*l,e.ha),u.Mh=f[p].name,h.fu=u,e.M.push(h);p=e.U;f=e.ha;for(h=0;h<e.ae.length;h++)for(l=e.ae[h],q=l.Vk,r=0;r<q.length;r++)u=q[r],v=l.name+" ["+u.U+":"+u.ha+"]",u.U=Math.max(p,u.U),u.ha=Math.min(f+1,u.ha),u.U>u.ha&&(z.warn("NLA: out of scene range: "+v),q.splice(r,1),r--);for(p=0;p<e.ae.length;p++)for(f=e.ae[p].Vk,h=0;h<f.length;h++){l=f[h];q=e.U;r=e.ha+1;
for(u=0;u<f.length;u++)v=f[u],l.Ac==v.Ac&&(v.ha<=l.U&&(q=l.U),v.U>=l.ha&&(r=Math.min(r,v.U)));l.Dp=q;l.Cp=r}I.push(e)};a.start=function(){F=0};a.update=function(a,b){if(!(0>F)){0==F&&(F=a);for(var c=0;c<I.length;c++){var d=I[c];h(d,a,b,F);for(var g=f(d,a,F,!0),m=0;m<d.ae.length;m++){for(var n=d.ae[m],q=n.Vk,r=0;r<q.length;r++){var x=q[r];"SOUND"==x.type&&g<d.ni-1E-6&&(x.ce=!1)}for(r=0;r<q.length;r++)switch(x=q[r],x.type){case "CLIP":if(x.Dp<=g&&g<x.Cp&&!x.ce){var u=n,z=x;""!=z.cl?k.Cu(u,z.cl,z.Ac):
k.apply(u,z.Mh,z.Ac);k.set_behavior(u,k.AB_FINISH_STOP,z.Ac);for(u=0;u<q.length;u++)q[u]!=x&&q[u].Ac==x.Ac&&(q[u].ce=!1);x.ce=!0}if(x.ce){var u=n,z=g-x.U+x.uo,p=k.get_current_frame_float(u,x.Ac);1E-6<Math.abs(z-p)&&k.set_current_frame_float(u,z,x.Ac)}break;case "SOUND":(g<d.ni-1E-6||d.ni<x.U)&&x.U<=g&&g<x.ha&&!x.ce&&(A.play(n,(x.U-g)/e.Ia,(x.ha-x.U)/e.Ia),x.ce=!0),d.ni<x.ha&&x.ha<=g&&x.ce&&(x.ce=!1)}}for(m=0;m<d.M.length;m++)x=d.M[m].fu,x.U<=Math.round(g)&&Math.round(g)<x.ha&&!x.uh&&(l(d.M[m],x.uh),
x.uh=!0),x.ha<=Math.round(g)&&x.uh&&(l(d.M[m],x.uh),x.uh=!1);d.ni=g}}};a.cleanup=function(){I.length=0;F=-1};a.sq=function(a){var b=a.animation_data;return b&&b.nla_tracks.length||m(a)||k.qq(a)?!0:!1}};b4w.module.__camera=function(a,p){function c(b){switch(b){case "STATIC":return a.MS_STATIC;case "TARGET":return a.MS_TARGET_CONTROLS;case "EYE":return a.MS_EYE_CONTROLS;case "HOVER":return a.MS_HOVER_CONTROLS;default:throw"Unknown move style";}}function b(b){var c={type:b,name:"",We:1,width:0,height:0,Td:null,yb:null,Cc:null,va:0,kc:0,Qa:0,Za:0,left:0,right:0,top:0,bottom:0,Ce:new Float32Array(3),Ip:new Float32Array(3),quat:new Float32Array(4),ja:new Float32Array(16),TB:new Float32Array(16),pa:new Float32Array(16),
Eh:new Float32Array(16),Sy:new Float32Array(16),od:new Float32Array(16),$r:new Float32Array(16),ef:new Float32Array(16),dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,Bf:null,dof_on:0,cm:{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),Qa:new Float32Array([0,0,0,0]),Za:new Float32Array([0,0,0,0])},Mi:0,sd:0,$b:null,Rh:null,Gl:null,op:new Float32Array(4),sk:new Float32Array(4)};if(b==a.lb)return c;switch(b){case a.Sb:l(c,
40,.1,1E3);break;case a.xc:l(c,2.5,.1,1E3);break;case a.Dd:break;case a.le:break;case a.nf:break;case a.mb:case a.wb:throw"Stereo camera may only be created from perspective one";default:throw"Unknown camera type";}return c}function h(b,c,d){if(b.type!=a.mb&&b.type!=a.wb)throw"set_stereo_params(): wrong camera type";b.Mi=c;b.sd=d;O(b,b.va);if(N.Z())for(c=N.get_active(),b=c.d.nd,c=N.Jj(c).d.H,d=0;d<c.length;d++)C(c[d],b)}function d(a,b){return f(a.d.quat,b)}function f(a,b){var c=J.quat_to_dir(a,J.AXIS_Y,
w),d=J.quat_to_dir(a,J.AXIS_Z,ha),e=-Math.asin(c[1]/R.length(c)),c=Math.abs(e)>Math.PI/4?R.scale(d,-J.sign(e),ma):R.scale(c,-J.sign(d[1]),ma),f=Math.atan(Math.abs(c[0]/c[2]));0<d[1]&&(e=J.sign(e)*Math.PI-e);d=f;0>c[2]&&(d=Math.PI-d);0>c[0]&&(d=2*Math.PI-d);b[0]=d;b[1]=e;return b}function l(b,c,d,e,f){switch(b.type){case a.Sb:case a.mb:case a.wb:b.kc=c;b.va=1;break;case a.xc:b.top=c;b.va=1;break;case a.Dd:delete b.kc;b.kc=c;b.va=f/c;break;case a.le:b.top=c;b.va=f/c;break;default:v.error("set_frustum(): Unsupported camera type: "+
b.type)}b.Qa=d;b.Za=e}function g(b,c){var d=c.d.g,e=c.d.quat,f=qa;Z.rotateX(c.d.T,-Math.PI/2,f);Z.invert(f,b.ja);if(b.$b){var f=b.$b[0],g=b.$b[1],k=b.$b[2],h=b.$b[3],l=qa;l[0]=1-2*f*f;l[1]=-2*f*g;l[2]=-2*f*k;l[3]=0;l[4]=-2*f*g;l[5]=1-2*g*g;l[6]=-2*g*k;l[7]=0;l[8]=-2*f*k;l[9]=-2*g*k;l[10]=1-2*k*k;l[11]=0;l[12]=-2*f*h;l[13]=-2*g*h;l[14]=-2*k*h;l[15]=1;Z.multiply(b.ja,l,b.ja);O(b,b.va,!0);f=S;g=qa;Z.invert(b.ja,g);Z.transpose(g,g);V.transformMat4(b.$b,g,f);g=P;g[0]=(J.sign(f[0])+b.pa[8])/b.pa[0];g[1]=
(J.sign(f[1])+b.pa[9])/b.pa[5];g[2]=-1;g[3]=(1+b.pa[10])/b.pa[14];V.scale(f,2/(f[0]*g[0]+f[1]*g[1]+f[2]*g[2]+f[3]*g[3]),f);b.pa[2]=f[0];b.pa[6]=f[1];b.pa[10]=f[2]+1;b.pa[14]=f[3]}b.type==a.mb?b.ja[12]+=b.sd/2:b.type==a.wb&&(b.ja[12]-=b.sd/2);Z.multiply(b.pa,b.ja,b.ef);F(b);I(b);R.copy(b.Ce,b.Ip);R.copy(d,b.Ce);ca.copy(e,b.quat)}function m(b,c,d,e){Z.lookAt(c,d,e,b.ja);b.type==a.mb?b.ja[12]+=b.sd/2:b.type==a.wb&&(b.ja[12]-=b.sd/2);Z.multiply(b.pa,b.ja,b.ef);F(b);I(b);R.copy(c,b.Ce)}function k(a){var b=
a.d.H;if(!b)throw"Wrong object";for(var c=a.d,d=0;d<b.length;d++){var e=b[d];g(e,a);J.Fp(e.ef,e.cm);if(e.Bf)if(e.dof_on){var f=R.dist(c.g,e.Bf.location);e.dof_distance=f}else e.dof_distance=0}}function x(b){b=b.d;if(b.da==a.MS_TARGET_CONTROLS){var c=J.quat_to_dir(b.quat,J.AXIS_Z,w);b.Gk=0<c[1]}}function r(b,c){var e=b.d,f=e.Wb;!f||e.da!=a.MS_EYE_CONTROLS&&e.da!=a.MS_TARGET_CONTROLS||(c&&(e=d(b,T),f.left+=e[0],f.right+=e[0]),f.left=J.angle_wrap_0_2pi(f.left),f.right=J.angle_wrap_0_2pi(f.right))}function q(b,
c){var e=b.d,f=e.wd;!f||e.da!=a.MS_EYE_CONTROLS&&e.da!=a.MS_TARGET_CONTROLS||(c&&(e=d(b,T),f.Sa+=e[1],f.La+=e[1]),f.Sa=J.angle_wrap_periodic(f.Sa,-Math.PI,Math.PI),f.La=J.angle_wrap_periodic(f.La,-Math.PI,Math.PI))}function z(b){var c=b.d;if(y(b)&&c.H[0].type===a.xc){if(c.da===a.MS_TARGET_CONTROLS)var d=R.dist(c.g,c.Nb),c=d/c.Sg*c.Tg;else c.cb&&c.da===a.MS_HOVER_CONTROLS?(d=R.distance(c.g,c.lc),c=d/c.Sg*c.Tg):c=b.d.H[0].top;for(var e in b.d.H)d=b.d.H[e],d.top=c,O(d,d.va);k(b)}}function E(a,b,c,e,
f){var g=a.d,k=b,h=c;if(e||f)a=d(a,aa),e&&(k=b-a[0]),f&&(h=c-a[1]);if(k||h)b=ca.identity(fa),k&&(k=ca.setAxisAngle(J.AXIS_Y,k,ia),ca.multiply(b,k,b)),h&&(k=J.quat_to_dir(g.quat,J.AXIS_X,w),h=ca.setAxisAngle(k,h,ia),ca.normalize(h,h),ca.multiply(b,h,b)),ca.multiply(b,g.quat,g.quat)}function A(a,b,c,e,f){var g=a.d,k=b,h=c;if(e||f){var l=d(a,aa);e&&(k=b-l[0]);f&&(h=c-l[1])}u(a,a.d.Nb,k,h);a=d(a,aa);a=J.angle_wrap_periodic(a[1],-Math.PI,Math.PI);g.Gk=Math.abs(a)>Math.PI/2}function n(a,b,c,f,g){var k=
a.d,h=b,l=c;if(f||g){var m=d(a,aa);f&&(h=b-m[0]);g&&(l=c-m[1])}k.Ql||(h=0);u(a,k.lc,h,l);l&&e(a)}function u(a,b,c,d){var e=a.d;if(c||d){var f=ca.identity(fa);c&&(c=ca.setAxisAngle(J.AXIS_Y,c,ia),ca.multiply(f,c,f));a=L(a);d&&(!a||a&&e.cb)&&(a=J.quat_to_dir(e.quat,J.AXIS_X,w),d=ca.setAxisAngle(a,d,ia),ca.normalize(d,d),ca.multiply(f,d,f));J.iz(e.g,b,f,e.g);ca.multiply(f,e.quat,e.quat)}}function e(a){var b=a.d;if(b.cb){var c=d(a,T)[1];a=a.d;a.Kb.La-a.Kb.Sa?(c=(a.Kb.La-c)/(a.Kb.La-a.Kb.Sa),c=Math.max(c,
0)):c=0;c=c*(a.Af-a.Pd)+a.Pd;a=J.quat_to_dir(b.quat,J.AXIS_MY,w);R.normalize(a,a);R.scale(a,c,a);R.subtract(b.lc,a,b.g)}}function O(b,c,d){switch(b.type){case a.Sb:if(!c)throw"No aspect ratio";b.va=c;case a.Dd:Z.perspective(J.vk(b.kc),b.va,b.Qa,b.Za,b.pa);break;case a.xc:if(!c)throw"No aspect ratio";b.va=c;case a.le:c=b.top*b.va;Z.ortho(-c,c,-b.top,b.top,b.Qa,b.Za,b.pa);break;case a.nf:Z.ortho(b.left,b.right,b.bottom,b.top,b.Qa,b.Za,b.pa);break;case a.mb:case a.wb:if(!c)throw"No aspect ratio";b.va=
c;var e=Math.tan(b.kc*Math.PI/360);c=b.Qa*e;var f=b.va*b.Mi*e;b.type==a.mb?(e=f-b.sd/2,f+=b.sd/2):(e=f+b.sd/2,f-=b.sd/2);e=-(b.Qa/b.Mi*e);f*=b.Qa/b.Mi;Z.frustum(e,f,-c,c,b.Qa,b.Za,b.pa);b.left=e;b.right=f;break;case a.lb:return;default:throw"Wrong camera type: "+b.type;}d||(Z.multiply(b.pa,b.ja,b.ef),F(b),I(b))}function I(a){Z.copy(a.ja,a.od);a.od[12]=0;a.od[13]=0;a.od[14]=0;a.od[15]=1;Z.multiply(a.pa,a.od,a.od);Z.invert(a.od,a.od)}function F(a){Z.copy(a.ja,a.Eh);Z.multiply(a.pa,a.Eh,a.Eh);Z.invert(a.Eh,
a.Eh)}function t(b,c,d,e,f){e||(e=new Float32Array(24));c||(c=b.Qa);d||(d=b.Za);var g,k,h,l,m,n,q,r;switch(b.type){case a.lb:throw"Extraction from NONE camera is not possible";case a.Sb:case a.Dd:g=c*Math.tan(b.kc*Math.PI/360);l=-g;k=g*b.va;h=-k;m=d/c*g;r=-m;n=m*b.va;q=-n;break;case a.xc:case a.le:h=b.top*b.va;g=m=b.top;k=n=h;l=r=-b.top;h=q=-h;break;case a.nf:g=m=b.top;k=n=b.right;l=r=b.bottom;h=q=b.left;break;case a.mb:case a.wb:m=c/b.Qa;g=c*Math.tan(b.kc*Math.PI/360);l=-g;k=b.right*m;h=b.left*m;
q=d/c;m=g*q;r=-m;n=k*q;q*=h;break;default:throw"Wrong camera type: "+b.type;}e[0]=h;e[1]=l;e[2]=-c;e[3]=k;e[4]=l;e[5]=-c;e[6]=k;e[7]=g;e[8]=-c;e[9]=h;e[10]=g;e[11]=-c;e[12]=q;e[13]=r;e[14]=-d;e[15]=q;e[16]=m;e[17]=-d;e[18]=n;e[19]=m;e[20]=-d;e[21]=n;e[22]=r;e[23]=-d;f&&(c=qa,Z.invert(b.ja,c),J.Me(e,c,e,0));return e}function y(a){return"CAMERA"===a.type?!0:!1}function L(b){return y(b)&&b.d&&b.d.da==a.MS_HOVER_CONTROLS?!0:!1}function C(a,b){if(b.enable_csm){var c=b.csm_num;if(!a.Rh){var d=b.csm_num;
a.Rh=Array(d);for(var e=0;e<d;e++)a.Rh[e]=new Float32Array(3);a.Gl=new Float32Array(d)}for(d=0;d<c;d++){var e=0==d?a.Qa:H(b,a,d-1),f=H(b,a,d),e=t(a,e,f,ya),e=M.wx(e);a.Rh[d].set(e.D);a.Gl[d]=e.za;a.op[d]=R.length(e.D);a.sk[d]=K(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,d)}}else a.sk[0]=b.first_cascade_blur_radius}function H(a,b,c){var d=a.csm_num,e=J.clamp(a.csm_first_cascade_border,b.Qa,b.Za);a=J.clamp(a.csm_last_cascade_border,b.Qa,b.Za);return J.clamp(K(e,a,d,c),b.Qa,b.Za)}function K(a,
b,c,d){switch(d){case 0:break;case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,d/(c-1))}return a}var M=p("__boundings");p("__config");var G=p("__constraints"),v=p("__print"),N=p("__scenes"),J=p("__util"),R=p("vec3"),V=p("vec4"),ca=p("quat"),U=p("mat3"),Z=p("mat4");a.lb=10;a.Sb=20;a.xc=30;a.Dd=40;a.le=50;a.nf=60;a.mb=70;a.wb=80;a.MS_STATIC=0;a.MS_ANIMATION=1;a.MS_TARGET_CONTROLS=2;a.MS_EYE_CONTROLS=3;a.MS_HOVER_CONTROLS=4;var T=new Float32Array(2),aa=new Float32Array(2),w=new Float32Array(3),ha=
new Float32Array(3),ma=new Float32Array(3),fa=new Float32Array(4),ia=new Float32Array(4),S=new Float32Array(4),P=new Float32Array(4),ga=new Float32Array(16),qa=new Float32Array(16),ya=new Float32Array(24);a.$u=function(f){var g=f.d,B=f.data;switch(B.type){case "PERSP":var k=b(a.Sb);if(B.angle_y)var h=B.angle_y/Math.PI*180;l(k,h,B.clip_start,B.clip_end);break;case "ORTHO":k=b(a.xc),l(k,B.ortho_scale/2,B.clip_start,B.clip_end)}k.name=f.name;g.Bs=!1;g.da=c(B.b4w_move_style);g.dof_distance=f.data.dof_distance;
g.Bf=f.data.dof_object;g.dof_front=f.data.b4w_dof_front;g.dof_rear=f.data.b4w_dof_rear;g.dof_power=f.data.b4w_dof_power;g.Ql=f.data.b4w_enable_hover_hor_rotation;g.H=[k];if(g.da==a.MS_TARGET_CONTROLS||g.da==a.MS_EYE_CONTROLS||g.da==a.MS_HOVER_CONTROLS)g.Tn=f.data.b4w_trans_velocity,g.Sn=f.data.b4w_rot_velocity,g.Un=f.data.b4w_zoom_velocity;g.da==a.MS_TARGET_CONTROLS&&(g.Nb.set(B.b4w_target),B=J.quat_to_dir(g.quat,J.AXIS_Z,w),g.Gk=0<B[1]);B=f.d;h=B.da;if(h===a.MS_TARGET_CONTROLS||h===a.MS_EYE_CONTROLS||
h===a.MS_HOVER_CONTROLS){var m=f.data,t=null,x=null,P=null;h===a.MS_TARGET_CONTROLS||h===a.MS_EYE_CONTROLS?(m.b4w_use_panning&&(B.Hs=m.b4w_use_panning),m.b4w_use_horizontal_clamping&&(t={left:m.b4w_rotation_left_limit,right:m.b4w_rotation_right_limit}),m.b4w_use_vertical_clamping&&(x={La:m.b4w_rotation_down_limit,Sa:m.b4w_rotation_up_limit}),h===a.MS_TARGET_CONTROLS&&(B.cb=m.b4w_use_distance_limits&&m.b4w_distance_min<=m.b4w_distance_max,B.cb&&(B.Pd=m.b4w_distance_min,B.Af=m.b4w_distance_max))):h===
a.MS_HOVER_CONTROLS&&(m.b4w_use_horizontal_clamping&&m.b4w_horizontal_translation_min<=m.b4w_horizontal_translation_max&&(t={left:m.b4w_horizontal_translation_min,right:m.b4w_horizontal_translation_max}),m.b4w_use_vertical_clamping&&m.b4w_vertical_translation_min<=m.b4w_vertical_translation_max&&(x={La:m.b4w_vertical_translation_min,Sa:m.b4w_vertical_translation_max}),B.cb=m.b4w_use_distance_limits&&m.b4w_hover_angle_min<=m.b4w_hover_angle_max&&m.b4w_distance_min<=m.b4w_distance_max,B.cb&&(P={La:m.b4w_hover_angle_min,
Sa:m.b4w_hover_angle_max},B.Pd=m.b4w_distance_min,B.Af=m.b4w_distance_max));var u=t;u&&h==a.MS_EYE_CONTROLS&&(u.left*=-1,u.right*=-1);if(u=x)switch(h){case a.MS_TARGET_CONTROLS:u.La*=-1;u.Sa*=-1;break;case a.MS_HOVER_CONTROLS:var z=-u.La;u.La=-u.Sa;u.Sa=z}(u=P)&&h==a.MS_HOVER_CONTROLS&&(u.La*=-1,u.Sa*=-1);B.Wb=t;B.wd=x;B.Kb=P;r(f,"LOCAL"==m.b4w_horizontal_clamping_type);q(f,"LOCAL"==m.b4w_vertical_clamping_type)}if(g.da===a.MS_HOVER_CONTROLS)if(g=f.d,g.cb){B=f.d;h=J.quat_to_dir(B.quat,J.AXIS_MY,w);
m=S;m.set(J.AXIS_Y);m[3]=0;h=J.line_plane_intersect(m,0,B.g,h,B.lc);if(!h||100<R.len(h))B.lc[0]=B.g[0],B.lc[1]=0,B.lc[2]=B.g[2];B=d(f,T);g=J.se(B[1],g.Kb.Sa,g.Kb.La);0<B[1]&&v.warn("Active hover camera has wrong orientation");g?n(f,0,g):e(f)}else g.Ql=!1;if(k.type==a.xc)switch(f=f.d,f.da){case a.MS_TARGET_CONTROLS:f.Sg=R.dist(f.g,f.Nb);f.Tg=f.H[0].top;break;case a.MS_HOVER_CONTROLS:f.cb&&(f.Sg=R.dist(f.g,f.lc),f.Tg=f.H[0].top)}};a.nb=b;a.UB=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.yb);
case "DEPTH":return Boolean(a.Cc);case "SCREEN":return!Boolean(a.yb)&&!Boolean(a.Cc);default:throw"Wrong attachment type: "+b;}};a.zk=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.yb=c;break;case "DEPTH":a.Cc=c;break;case "SCREEN":a.yb=null;a.Cc=null;break;default:throw"Wrong attachment type: "+b;}};a.KC=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.yb;case "DEPTH":return a.Cc;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.Uq=function(b,c){if(b.type!=
a.Sb||c!=a.mb&&c!=a.wb)throw"make_stereo(): wrong camera type";b.type=c;h(b,6,.065)};a.Fz=h;a.get_camera_angles=d;a.Xp=f;a.get_camera_angles_char=function(a,b){d(a,b);b[0]=J.angle_wrap_0_2pi(b[0]+Math.PI);b[1]*=-1;return b};a.get_angles=function(a,b){var c=a.d,d=J.quat_to_dir(c.quat,J.AXIS_MY,w),e=Math.asin(d[1]/R.length(d));0==d[0]&&0==d[2]?c=0:(Math.abs(e)>Math.PI/4&&(d=0>=e?J.quat_to_dir(c.quat,J.AXIS_MZ,ha):J.quat_to_dir(c.quat,J.AXIS_Z,ha)),c=Math.atan(Math.abs(d[0]/d[2])),0<d[2]&&(c=Math.PI-
c),0<d[0]&&(c=2*Math.PI-c));b[0]=c;b[1]=e;return b};a.pn=l;a.xz=function(b,c,d,e,f,g,k){switch(b.type){case a.nf:b.left=c;b.right=d;b.bottom=e;b.top=f;b.Qa=g;b.Za=k;break;default:v.error("set_frustum_asymmetric(): Unsupported camera type: "+b.type)}};a.get_move_style=function(a){return a.d.da};a.DD=g;a.ED=m;a.Xr=function(a,b,c){var d=w;d[0]=0;d[1]=-1;d[2]=0;R.transformQuat(d,c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var e=ha;e[0]=0;e[1]=0;e[2]=-1;R.transformQuat(e,c,e);m(a,b,d,e)};a.Jw=function(a,b,c,
d,e){d[0]=a[0];d[1]=a[1];d[2]=a[2];Z.lookAt(a,b,c,qa);Z.invert(qa,qa);Z.rotateX(qa,Math.PI/2,qa);U.fromMat4(qa,ga);ca.fromMat3(ga,e)};a.GA=k;a.FA=function(b){var c=b.d,e=b.d;if(e.da===a.MS_TARGET_CONTROLS||e.da===a.MS_EYE_CONTROLS){if(e.Wb){var f=e.Wb.left,g=e.Wb.right,k=d(b,T);(k=e.da==a.MS_TARGET_CONTROLS?J.se(k[0],f,g):J.se(k[0],g,f))&&(e.da==a.MS_TARGET_CONTROLS?A(b,k,0):E(b,k,0))}e.wd&&(f=e.wd.La,g=e.wd.Sa,k=d(b,T),(k=e.da==a.MS_TARGET_CONTROLS?J.se(k[1],g,f):J.se(k[1],f,g))&&(e.da==a.MS_TARGET_CONTROLS?
A(b,0,k):E(b,0,k)));e.da===a.MS_TARGET_CONTROLS&&e.cb&&(k=b.d,f=R.subtract(k.g,k.Nb,w),g=R.length(f),g>k.Af?(R.scale(f,k.Af/g,f),R.add(k.Nb,f,k.g)):g<k.Pd&&(g=J.quat_to_dir(k.quat,J.AXIS_MY,ha),R.scale(g,100*k.Pd,g),R.add(f,g,f),R.scale(f,-k.Pd/R.length(f),f),R.add(k.Nb,f,k.g)))}e.da===a.MS_HOVER_CONTROLS&&(e=b.d,k=e.cb?e.lc:e.g,e.Wb&&(f=J.clamp(k[0],e.Wb.left,e.Wb.right)-k[0],k[0]+=f,e.cb&&(e.g[0]+=f)),e.wd&&(f=J.clamp(k[2],e.wd.La,e.wd.Sa)-k[2],k[2]+=f,e.cb&&(e.g[2]+=f)),e=b.d,e.cb&&(k=d(b,T)[1],
k=J.se(k,e.Kb.Sa,e.Kb.La),J.quat_to_dir(e.quat,J.AXIS_MY,w),k&&n(b,0,k)));z(b);switch(c.da){case a.MS_TARGET_CONTROLS:G.jz(c.g,c.quat,c.Nb);G.correct_up(b,J.AXIS_Y);break;case a.MS_EYE_CONTROLS:b.Oa||G.correct_up(b,J.AXIS_Y)}x(b)};a.On=x;a.Ny=r;a.Ry=q;a.NA=z;a.rotate_eye_camera=E;a.rotate_target_camera=A;a.rotate_hover_camera=n;a.Sx=e;a.eD=function(b){switch(b.type){case a.Sb:case a.xc:case a.mb:case a.wb:return!0;default:return!1}};a.hx=function(b){b=b.d.H[0];switch(b.type){case a.Sb:case a.Dd:case a.mb:case a.wb:return Math.PI*
b.kc/180;default:return v.error("get_min_fov(): Unsupported camera type: "+b.type),0}};a.ig=O;a.Vo=I;a.Wo=F;a.Gw=t;a.Ku=function(a){a=a.d;var b=M.zd();b.min_x=-1;b.max_x=1;b.min_y=-1;b.max_y=1;b.min_z=-1;b.max_z=1;a.Ib=b;var c=M.El(1,[0,0,0]);a.Lc=c;a.jl=M.kp(1,b);a.ll=M.mp(1,b);a.kl=M.lp(1,b)};a.is_camera=y;a.is_target_camera=function(b){return y(b)&&b.d&&b.d.da==a.MS_TARGET_CONTROLS?!0:!1};a.is_eye_camera=function(b){return y(b)&&b.d&&b.d.da==a.MS_EYE_CONTROLS?!0:!1};a.is_hover_camera=L;a.Nn=C;
a.ew=H;a.project_point=function(b,c,d){b=b.d.H[0];switch(b.type){case a.Sb:case a.Dd:case a.xc:case a.le:case a.mb:case a.wb:var e=S;e.set(c);e[3]=1;V.transformMat4(e,b.ef,e);c=-e[1]/e[3];d[0]=(e[0]/e[3]+1)/2*b.width;d[1]=(c+1)/2*b.height;2<d.length&&(d[2]=(e[2]/Math.abs(e[3])+1)/2);return d;default:return v.error("Non-compatible camera"),d}};a.ux=function(a){return a.d.H[0]};a.Kj=function(b,c){switch(b.type){case a.Sb:case a.Dd:case a.mb:case a.wb:var d=Math.tan(J.vk(b.kc)/2);switch(c){case "LEFT":return-d*
b.va;case "RIGHT":return d*b.va;case "TOP":return d;case "BOTTOM":return-d}break;case a.xc:case a.le:switch(c){case "LEFT":return-b.top*b.va;case "RIGHT":return b.top*b.va;case "TOP":return b.top;case "BOTTOM":return-b.top}break;case a.nf:switch(c){case "LEFT":return b.left;case "RIGHT":return b.right;case "TOP":return b.top;case "BOTTOM":return b.bottom}break;default:J.ma("Unknown camera type")}};a.dy=function(b){switch(b.type){case a.xc:case a.le:case a.nf:return!0;default:return!1}};a.get_fov=
function(b,c){switch(b.type){case a.Sb:case a.Dd:case a.mb:case a.wb:var d=J.vk(b.kc);return c?d*b.va:d;default:return 0}}};b4w.module.__lights=function(a,p){function c(a){return{name:"",index:0,type:a,direction:new Float32Array(3),color:new Float32Array(3),Bg:new Float32Array(3),Uc:0,lg:0,dx:!1,zp:!1,og:!0,cf:!0,Ae:1,distance:25,uC:"INVERSE_SQUARE"}}function b(a){a.Bg[0]=a.color[0]*a.Ae;a.Bg[1]=a.color[1]*a.Ae;a.Bg[2]=a.color[2]*a.Ae}var h=p("__util"),d=p("vec3");a.YC=c;a.gy=function(a){var l=a.data,g=c(l.type);g.name=a.name;g.og=l.use_diffuse;g.cf=l.use_specular;var m=h.quat_to_dir(a.d.quat,h.AXIS_Y,[]);d.normalize(m,
m);g.direction[0]=m[0];g.direction[1]=m[1];g.direction[2]=m[2];g.color[0]=l.color[0];g.color[1]=l.color[1];g.color[2]=l.color[2];g.Ae=l.energy;b(g);g.distance=l.distance;if("POINT"===g.type||"SPOT"===g.type)g.distance=l.distance;"SPOT"===g.type?(g.lg=l.spot_blend,g.Uc=l.spot_size):"POINT"===g.type&&(g.Uc=Math.PI/2);g.dx=l.b4w_generate_shadows;g.zp=l.b4w_dynamic_intensity;a.fa=g};a.zz=function(a,c){a.color[0]=c[0];a.color[1]=c[1];a.color[2]=c[2];b(a)};a.Bz=function(a,b){a.lg=b};a.Az=function(a,b){a.distance=
b};a.Cz=function(a,b){a.Uc=b};a.Ur=function(a,c){a.Ae=c;b(a)};a.ym=function(a){return"LAMP"===a.type?!0:!1};a.KA=function(a){if("LAMP"!=a.type)throw"Wrong light object";var b=a.fa;b&&h.quat_to_dir(a.d.quat,h.AXIS_Y,b.direction)}};b4w.module.__scenes=function(a,p){function c(){Lb||(Lb=b(xa));return Lb}function b(a){for(var b=0;b<a.length;b++){var c=a[b];if(!c.Yc||!c.Yc.length)return c}return null}function h(){if(!db)throw"No active scene available";return db}function d(a,b,c,d){for(var e=null,f=0;f<b.length;f++){var g=b[f];if((c?g.origin_name:g.name)==a&&g.d.ad==d){e=g;break}}return e}function f(a,b){b||(b="ALL");var c=[];l(a.objects,b,c);return c}function l(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];"ALL"!=b&&b!=e.type||
c.push(e);(e=e.dupli_group)&&l(e.objects,b,c)}}function g(b){if("NONE"==sa.Re||!b.b4w_render_shadows)return!1;var c=!1,d=!1;if(0==ha(b,"LAMP",a.DATA_ID_ALL).length)return!1;b=ha(b,"MESH",a.DATA_ID_ALL);for(var e=0;e<b.length;e++){var f=b[e];f.b4w_shadow_cast&&(c=!0);f.b4w_shadow_receive&&(d=!0);if(c&&d)return!0}return!1}function m(a){if(!a.ra)return!1;a=a.ra.LAMP;for(var b=0;b<a.length;b++)if("SUN"==a[b].fa.type)return!0;return!1}function k(a){if(!sa.shore_smoothing)return!1;a=ma(a);for(var b=0;b<
a.length;b++){var c=a[b];if(c.b4w_water&&c.b4w_water_shore_smoothing)return!0}return!1}function x(b){var c=ma(b),d=[];b=ha(b,"MESH",a.DATA_ID_ALL);for(var e=0;e<c.length;e++){var f=c[e];if(f.b4w_water){for(var g={},k=0;k<b.length;k++)for(var B=b[k],h=B.data.materials,l=0;l<h.length;l++)h[l]==f&&(g.hf=B.location[1]);if(sa.Uh)for(g.Tb=f.b4w_water_fog_color.slice(0),g.Tb.push(f.b4w_water_fog_density),f.b4w_water_dynamic?(g.Hg=!0,g.waves_height=f.b4w_waves_height,g.waves_length=f.b4w_waves_length,g.dst_noise_scale0=
f.b4w_water_dst_noise_scale0,g.dst_noise_scale1=f.b4w_water_dst_noise_scale1,g.dst_noise_freq0=f.b4w_water_dst_noise_freq0,g.dst_noise_freq1=f.b4w_water_dst_noise_freq1,g.dir_min_shore_fac=f.b4w_water_dir_min_shore_fac,g.dir_freq=f.b4w_water_dir_freq,g.dir_noise_scale=f.b4w_water_dir_noise_scale,g.dir_noise_freq=f.b4w_water_dir_noise_freq,g.dir_min_noise_fac=f.b4w_water_dir_min_noise_fac,g.dst_min_fac=f.b4w_water_dst_min_fac,g.waves_hor_fac=f.b4w_water_waves_hor_fac):(g.Hg=!1,g.waves_height=0,g.waves_length=
0),g.sj=null,g.ul=null,g.vl=new Float32Array(2),g.Bk=null,f=f.texture_slots,k=0;k<f.length;k++)B=f[k].texture,"VORONOI"==B.type&&(g.sj=B.noise_scale,g.vl.set([.3,.7]),g.ul=B.noise_intensity),!0===B.b4w_shore_dist_map&&(g.Bk=B.image,g.lh=B.image.size[0],g.Nz=B.b4w_shore_boundings,g.Yg=B.b4w_max_shore_dist);else g.waves_height=0,g.waves_length=0,g.sj=null,g.ul=null,g.vl=null,g.Tb=null,g.Hg=!1;d.push(g)}}if(0<d.length){g=d[0];if(!g.Hg)for(e=0;e<d.length;e++)d[e].Hg&&(g=d[e]);return g}return null}function r(a){function b(a){if(a){a=
a.nodes;for(var d=0;d<a.length;d++){var e=a[d];"GROUP"==e.type&&e.node_group&&b(e.node_group.node_tree);"GROUP"==e.type&&"B4W_REFRACTION"==e.node_tree_name&&(c.kd=!0)}}}var c={};a=ma(a);for(var d=0;d<a.length;d++){var e=a[d];e.b4w_refractive&&(c.kd=!0);e.node_tree&&b(e.node_tree)}return c}function q(b){if(!sa.xk||!b.b4w_render_reflections)return!1;var c=[];b=ha(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++){var e=b[d];if(e.b4w_reflective){var f;a:{e=e.constraints;for(f=0;f<e.length;f++){var g=
e[f];if("LOCKED_TRACK"==g.type&&"REFLECTION PLANE"==g.name){f=g.target;break a}}f=null}f&&(e=f.location,f=f.d.quat,g=new Float32Array(4),za.vA(e,f,za.AXIS_Y,g),c.push(g))}}return c}function z(a,b){var c={},d=a.world.b4w_sky_settings;c.Nr=d.render_sky;c.procedural_skydome=d.procedural_skydome&&b;c.use_as_environment_lighting=d.use_as_environment_lighting;c.mh=d.color;c.rayleigh_brightness=d.rayleigh_brightness;c.mie_brightness=d.mie_brightness;c.spot_brightness=d.spot_brightness;c.scatter_strength=
d.scatter_strength;c.rayleigh_strength=d.rayleigh_strength;c.mie_strength=d.mie_strength;c.rayleigh_collection_power=d.rayleigh_collection_power;c.mie_collection_power=d.mie_collection_power;c.mie_distribution=d.mie_distribution;c.Pb=d.reflexible;c.Db=d.reflexible_only;!b&&d.procedural_skydome&&Ea.warn("There is no sun on the scene. Procedural sky won't be rendered");return c}function E(a){var b={};a=a.world.b4w_ssao_settings;b.radius_increase=a.radius_increase;b.Rx=a.hemisphere;b.Uu=a.blur_depth;
b.No=a.blur_discard_value;b.influence=a.influence;b.dist_factor=a.dist_factor;b.lz=a.samples;return b}function A(a){var b={};a=a.world.b4w_bloom_settings;b.blur=a.blur;b.ww=a.edge_lum;b.key=a.key;return b}function n(a){var b={};a=a.world.b4w_motion_blur_settings;b.bk=a.motion_blur_decay_threshold;b.ck=a.motion_blur_factor;return b}function u(a){var b={};a=a.world.b4w_color_correction_settings;b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b}
function e(a){var b={};a=a.world.b4w_god_rays_settings;b.Vx=a.intensity;b.Xg=a.max_ray_length;b.th=a.steps_per_pass;return b}function O(a){var b={};a=a.world;b.Le=a.b4w_outline_color;b.kk=a.b4w_outline_factor;return b}function I(a,b){var c=a.world,d=c.light_settings,e={};e.Be=d.environment_energy;e.Qn=d.use_environment_light;e.Sl=d.environment_color;e.De=c.horizon_color.slice(0);e.lf=c.zenith_color.slice(0);e.ZA=c.use_sky_paper;e.YA=c.use_sky_blend;e.$A=c.use_sky_real;e.tn=null;e.Tl=null;if(e.Qn&&
"SKY_TEXTURE"==e.Sl&&!(b.Nr&&b.procedural_skydome&&b.use_as_environment_lighting)){for(var d=null,f=0;f<c.texture_slots.length;f++)if(c.texture_slots[f].texture.b4w_use_as_environment_lighting){d=c.texture_slots[f];break}d?e.Tl=d:(Ea.warn("environment lighting is set to 'Sky Texture', but there is no world texture with 'Sky Texture Usage' property set to 'ENVIRONMENT_LIGHTING'"),e.Qn=!1)}for(f=0;f<c.texture_slots.length;f++)if(c.texture_slots[f].texture.b4w_use_as_skydome){e.tn=c.texture_slots[f];
break}return e}function F(b){if(!sa.Ya)return!1;var c=!1,d=!1;b=ha(b,"MESH",a.DATA_ID_ALL);for(var e=0;e<b.length;e++){for(var f=b[e],g=f.data.materials,k=0;k<g.length;k++)g[k].b4w_terrain&&(c=!0);f=f.particle_systems;for(k=0;k<f.length;k++)g=f[k].settings,"HAIR"==g.type&&g.b4w_dynamic_grass&&(d=!0);if(c&&d)return!0}return!1}function t(b){if(Ma.outlining_overview_mode)return!0;if(sa.enable_selectable)switch(b.b4w_enable_object_selection){case "OFF":return!1;case "ON":return!0;case "AUTO":b=ha(b,"MESH",
a.DATA_ID_ALL);for(var c=0;c<b.length;c++)if(b[c].d.hg)return!0;return!1}else return!1}function y(b){if(Ma.outlining_overview_mode)return!0;if(sa.enable_outlining)switch(b.b4w_enable_outlining){case "OFF":return!1;case "ON":return!0;case "AUTO":b=ha(b,"MESH",a.DATA_ID_ALL);for(var c=0;c<b.length;c++)if(b[c].d.Ab)return!0;return!1}else return!1}function L(b){b=ha(b,"MESH",a.DATA_ID_ALL);for(var c=0;c<b.length;c++)for(var d=b[c].data.materials,e=0;e<d.length;e++){var f=d[e],g=f.game_settings.alpha_blend;
if(f.b4w_render_above_all&&"OPAQUE"!=g&&"CLIP"!=g)return!0}return!1}function C(b){b=ha(b,"EMPTY",a.DATA_ID_ALL);for(var c=0;c<b.length;c++){var d=b[c];if(d.b4w_anchor&&d.b4w_anchor.detect_visibility)return!0}return!1}function H(a,b,c){var d=ua.dh(a,b);ua.ge(a,d,function(a,b,d){if(d.Ka){switch(d.K){case "COLOR":case "CUBEMAP":a=b.j.yb;break;case "DEPTH":a=b.j.Cc;break;case "SCREEN":a=null;break;default:throw"Wrong slink";}switch(d.ca){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":break;
default:if(!a)throw"Connection of SCREEN is forbidden";if(a.ff)throw"Batch texture can't use renderbuffer";ja.ap(c.Rb,d.ca)&&da.hj(c,a,d.ca)}}});for(a=0;a<b.na.length;a++){var d=b.na[a],e=b.td[a];switch(d.ca){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":break;default:if(e.ff)throw"Batch texture can't use renderbuffer";ja.ap(c.Rb,d.ca)&&da.hj(c,e,d.ca)}}}function K(a,b,c,d,e){switch(a.type){case "MAIN_OPAQUE":M(a,b,c,"OPAQUE",d,e);break;case "MAIN_BLEND":M(a,
b,c,"BLEND",d,e);break;case "MAIN_XRAY":M(a,b,c,"XRAY",d,e);break;case "MAIN_REFLECT":for(var f=b.d,g=b.n,k=0;k<g.length;k++){var B=g[k];if(("MAIN"==B.type||"NODES"==B.type||"PARTICLES"==B.type)&&"REFLECT"==B.Fb){if(!e){G(B,a,b,c,"REFLECT",d);var h=B.Na;ja.v(h,"DISABLE_FOG",0);ja.v(h,"WATER_EFFECTS",0);"special_skydome.glslf"==ja.aq(h)&&ja.v(h,"REFLECTION_PASS",1);ja.v(h,"SHADOW_SRC","SHADOW_SRC_NONE");ja.v(h,"TEXTURE_NORM",0);N(d,B);da.vb(B);J(B)}a.p.push({W:!0,ib:f,o:B})}}break;case "DEPTH":f=b.d;
b=b.n;for(g=0;g<b.length;g++)if(k=b[g],"DEPTH"==k.type&&!k.bc&&"DEPTH"==k.Fb){if(!e){var B=k,l=a,h=f,m=c,W=d,n=B.Na;if(va.Qx(m,l,"SHADOW_CAST"))if(B.Eb){if("DEPTH"!=sa.Re)throw"Wrong shadows type";ja.v(n,"SHADOW_SRC","SHADOW_SRC_DEPTH");ja.v(n,"SHADOW_DST","SHADOW_DST_MASK");da.gl(B,W.d.nd);va.xx(m,l)}else ja.v(n,"SHADOW_SRC","SHADOW_SRC_NONE"),ja.v(n,"SHADOW_DST","SHADOW_DST_MASK");else ja.v(n,"SHADOW_SRC","SHADOW_SRC_NONE"),ja.v(n,"SHADOW_DST","SHADOW_DST_NONE");B.Ya&&(l=va.Ha(m,"GRASS_MAP"))&&
V(B,l,h);da.vb(B);J(B)}a.p.push({W:!0,ib:f,o:k});H(c,a,k);R(k)}break;case "SHADOW_CAST":f=!1;g=b.d;b=b.n;k=va.Ha(c,"GRASS_MAP");for(B=0;B<b.length;B++)if(h=b[B],"DEPTH"==h.type&&"SHADOW_CAST"==h.Fb){f=!0;if(!e){if("DEPTH"!=sa.Re)throw"Wrong shadows type";ja.v(h.Na,"SHADOW_SRC","SHADOW_SRC_NONE");ja.v(h.Na,"SHADOW_DST","SHADOW_DST_DEPTH");h.Ya&&k&&V(h,k,g);da.ea(h,"SHADOW_TEX_RES",ja.t(d.d.nd.csm_resolution));da.vb(h);J(h)}a.p.push({W:!0,ib:g,o:h})}f&&U(a,va.Ha(c,"MAIN_OPAQUE"),a.p,d,!0);break;case "COLOR_PICKING":T(a,
b,e);break;case "COLOR_PICKING_XRAY":T(a,b,e);break;case "OUTLINE_MASK":c=b.d;d=b.n;for(b=0;b<d.length;b++)f=d[b],"COLOR_ID"==f.type&&"OUTLINE"==f.Fb&&(e||(da.ea(f,"USE_OUTLINE",1),da.vb(f),J(f)),a.p.push({W:!0,ib:c,o:f}));break;case "GRASS_MAP":c=b.d;d=b.n;for(b=0;b<d.length;b++)f=d[b],"GRASS_MAP"==f.type&&(e||(da.vb(f),J(f)),a.p.push({W:!0,ib:c,o:f}),f=a.j,h=c.Wa,g=a.Vb[0],k=a.Vb[1],B=a.Vb[2],0==g&&0==k?(g=h.min_y,k=h.max_y):(g=Math.min(g,h.min_y),k=Math.max(k,h.max_y)),h=1E-4*(k-g),a.Vb[0]=g-h,
a.Vb[1]=k+h,La.pn(f,B/2,-k,-g,B/2),La.ig(f));break;case "WIREFRAME":for(d=b.d,b=b.n,f=0;f<b.length;f++)g=b[f],"WIREFRAME"==g.type&&(e||(g.Ya&&(k=va.Ha(c,"GRASS_MAP"))&&V(g,k,d),da.vb(g),J(g)),a.p.push({W:!0,ib:d,o:g}),H(c,a,g),R(g))}}function M(a,b,c,d,e,f){for(var g=b.d,k=b.n,B=0;B<k.length;B++){var h=k[B];h.bc||h.Db||"MAIN"!=h.type&&"NODES"!=h.type&&"PARTICLES"!=h.type||!("OPAQUE"==h.Fb&&"OPAQUE"==d||"BLEND"==h.Fb&&"BLEND"==d||"XRAY"==h.Fb&&"XRAY"==d)||(f||(G(h,a,b,c,d,e),N(e,h),da.vb(h),J(h)),
a.p.push({W:!0,ib:g,o:h}),H(c,a,h),R(h))}a.p.sort(function(a,b){var c;if(a.o&&b.o){c=a.o.Ga;var d=b.o.Ga;(c=c==d?0:c>d?1:-1)||(c=a.o.Yf,d=b.o.Yf,c=c==d?0:c>d?1:-1)}else c=0;return c})}function G(a,b,c,d,e,f){c=c.d;if("OPAQUE"===e)var g=va.Ha(d,"SHADOW_CAST")&&a.Eb?"SHADOW_SRC_MASK":"SHADOW_SRC_NONE";else if("BLEND"===e||"XRAY"===e)if(va.Ha(d,"SHADOW_CAST")&&a.Eb)switch(sa.Re){case "DEPTH":g="SHADOW_SRC_DEPTH";break;default:throw"Wrong shadows type";}else g="SHADOW_SRC_NONE";else if("REFLECT"===e)g=
"SHADOW_SRC_NONE";else throw"Wrong main subscene type";e=a.Na;var k=f.d.nd;ja.v(e,"SHADOW_SRC",g);da.gl(a,k);g=b.Xf;ja.v(e,"NUM_LIGHTS",g);ja.v(e,"NUM_LFACTORS",0==g%2?g/2:Math.floor(g/2)+1);"special_skydome.glslf"==ja.aq(e)&&ja.v(e,"REFLECTION_PASS",0);ja.v(e,"SSAO_ONLY",0);b.Ua&&b.Wc?ja.v(e,"WATER_EFFECTS",1):ja.v(e,"WATER_EFFECTS",0);b.Ua&&b.uf&&c.uf?(ja.v(e,"CAUSTICS",1),ja.v(e,"CAUST_SCALE",b.Yo),ja.v(e,"CAUST_SPEED",ja.t(b.Zo,2)),ja.v(e,"CAUST_BRIGHT",b.Xo)):ja.v(e,"CAUSTICS",0);b.Ua&&(ja.v(e,
"WAVES_HEIGHT",ja.t(b.jf)),ja.v(e,"WAVES_LENGTH",ja.t(b.tg)),ja.v(e,"WATER_LEVEL",ja.t(b.hf)));a.Rc&&va.Ha(d,"MAIN_REFLECT")&&-1===a.Gb.indexOf("u_mirrormap")?ja.v(e,"REFLECTIVE",1):ja.v(e,"REFLECTIVE",0);(k=va.Ha(d,"SKY"))?a.Fr?(g=k.j.yb,da.hj(a,g,"u_sky")):sa.tk?(a.hc=k.hc,ja.v(e,"PROCEDURAL_FOG",1)):ja.v(e,"PROCEDURAL_FOG",0):ja.v(e,"PROCEDURAL_FOG",0);g=f.d.bo;g.Qn&&(ja.v(e,"USE_ENVIRONMENT_LIGHT",1),"SKY_TEXTURE"==g.Sl?(g=g.Tl?da.lx(g.Tl,!1):k.j.yb,ja.v(e,"SKY_TEXTURE",1),da.hj(a,g,"u_sky_texture")):
"SKY_COLOR"==g.Sl&&ja.v(e,"SKY_COLOR",1));a.Ya&&(g=va.Ha(d,"GRASS_MAP"))&&V(a,g,c);a.jn?(sa.Uh&&ja.v(e,"USE_REFRACTION_CORRECTION",1),"NODES"==a.type?(ja.v(e,"REFRACTIVE",1),f.d.kd?ja.v(e,"USE_REFRACTION",1):ja.v(e,"USE_REFRACTION",0)):f.d.kd?ja.v(e,"REFRACTIVE",1):ja.v(e,"REFRACTIVE",0)):(ja.v(e,"REFRACTIVE",0),ja.v(e,"USE_REFRACTION",0),ja.v(e,"USE_REFRACTION_CORRECTION",0));a.gf&&(a.Zn&&va.Ha(d,"DEPTH")?ja.v(e,"SHORE_SMOOTHING",1):ja.v(e,"SHORE_SMOOTHING",0),a.water_dynamic&&b.Ua&&b.jf?ja.v(e,
"DYNAMIC",1):ja.v(e,"DYNAMIC",0));"PARTICLES"==a.type&&(ja.v(e,"SIZE_RAMP_LENGTH",a.tr),ja.v(e,"COLOR_RAMP_LENGTH",a.kr));if(!a.Ef)for(b=a.M,d=0;d<b.length;d++)if(g=b[d],"SCENE"==g.source)for(c=0;c<xa.length;c++)for(var k=xa[c],B=xa[c].Yc,h=0;h<B.length;h++)B[h].d==g&&ua.m(eb,k,f,null);if(a.Ug){b=0;for(var l in a.Ug)b++;a.Cm=new Float32Array(3*b);a.Am=new Float32Array(3*b);a.zm=new Float32Array(3*b);a.Bm=new Float32Array(4*b);ja.v(e,"NUM_LAMP_LIGHTS",b);for(d=0;d<f.ra.LAMP.length;d++)v(a,f.ra.LAMP[d])}}
function v(a,b){var c=b.uuid;if(c in a.Ug){c=a.Ug[c];a.Cm.set(b.d.g,3*c);a.Am.set(b.fa.direction,3*c);a.zm.set(b.fa.Bg,3*c);var d=Fb,e=b.fa;d[0]=-1;d[1]=-1;d[2]=-1;d[3]=e.cf?1:0;switch(e.type){case "POINT":d[2]=e.distance;break;case "SPOT":d[2]=e.distance;var f=d[0]=Math.cos(e.Uc/2);d[1]=e.lg*(1-f)}a.Bm.set(d,4*c)}}function N(b,c){var d=ha(b,"LAMP",a.DATA_ID_ALL);c.Na.Gm=[];for(var e=Z(d)||d[0],f=0;f<d.length;f++){var g=d[f].fa;if("SPOT"==g.type||"POINT"==g.type)var k=Math.cos(g.Uc/2);if("SPOT"==
g.type)var B=g.lg*(1-k);var h=g.index;c.Na.Gm.push({type:g.type,index:h,iy:Math.floor(h/2),hy:0==h%2?"rg":"ba",Uc:k,lg:B,distance:g.distance,cy:g.og||g.cf,Uw:h==e.fa.index})}}function J(a){var b=a.Rb.attributes,c=a.R.Ob,d;for(d in b)c[d]||za.ma('missing data for "'+d+'" attribute');if("MAIN"==a.type||"NODES"==a.type)b=ja.Ix(a.Rb.Wn),10<b&&("MAIN"==a.type&&Ea.warn("Varying limit exceeded for main shader - "+b+', materials: "'+a.Fc.join(", ")+'"'),"NODES"==a.type&&(d=c=0,a.rg&&(c=za.ed(a.rg)),a.eb&&
(d=za.ed(a.eb)),Ea.warn("Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', materials: "'+a.Fc.join(", ")+'"')))}function R(a){8<a.M.length&&Ea.warn("too many textures used - "+a.M.length+' (max 8), materials "'+a.Fc.join(", ")+'"')}function V(a,b,c){a.Vb=b.Vb;var d=b.Vb[0],e=b.Vb[1],f=b.Vb[2];c=c.Ib;c=Math.max(c.max_x-c.min_x,c.max_z-c.min_z);f=0==f?c:Math.max(f,c);b.Vb[2]=f;b=b.j;La.pn(b,f/2,-e,-d,f/2);La.ig(b);d=a.lm||0;d=0==d?c:Math.max(d,c);a.lm=d}function ca(a){var b=P(a,
"MAIN_OPAQUE"),c=!0;ua.S(a.d.rb,function(d,e){"SHADOW_CAST"===e.type&&(U(e,b,e.p,a,c),c=!1)})}function U(b,c,d,e,f){if(0!=d.length){var g=b.j;c=c.j;var k=ha(e,"LAMP",a.DATA_ID_ALL),k=Z(k)||k[0],B=k.d;La.Xr(g,B.g,B.quat);Wa.copy(c.Ce,g.Ce);ab.copy(c.ja,g.$r);if("SPOT"==k.fa.type||"POINT"==k.fa.type)La.ig(g,g.va);else{k=Ca;Q.zd(k);for(B=0;B<d.length;B++){var h=d[B].ib;0==B?Q.jp(h.Wa,k):Q.Bp(k,h.Wa)}d=Q.Fw(k,ec);za.Me(d,g.ja,d);if(e.d.nd.enable_csm){e=Wa.copy(c.Rh[b.Fl],Aa);k=ab.invert(c.ja,Ba);za.Me(e,
k,e);za.Me(e,g.ja,e);b=c.Gl[b.Fl];if(f)for(Ka=0,f=2;f<d.length;f+=3)Ka=Math.min(Ka,d[f]);f=Ca;f.max_x=e[0]+b;f.max_y=e[1]+b;f.max_z=0;f.min_x=e[0]-b;f.min_y=e[1]-b;f.min_z=Ka}else{b=f=Ca;c=ea;c.set(d);e=sb/9;d=ab.identity(Ba);ab.rotate(d,e,za.AXIS_MZ,d);B=k=-1;for(h=0;10>h;h++){var l=Q.Pu(c,Ra),m=(l.max_x-l.min_x)*(l.max_y-l.min_y);if(-1==k||m<k)k=m,B=h,Q.jp(l,b);za.Me(c,d,c)}b=B*e;0<b&&(c=ab.identity(Ba),ab.rotate(c,b,za.AXIS_MZ,c),ab.multiply(c,g.ja,g.ja));b=f.max_x-f.min_x;c=f.max_y-f.min_y;b&&
c&&(e=Math.abs(b-c)/2,2<b/c?(f.max_y+=e,f.min_y-=e):2<c/b&&(f.max_x+=e,f.min_x-=e));f.max_x+=.005;f.max_y+=.005;f.max_z+=.005;f.min_x-=.005;f.min_y-=.005;f.min_z-=.005}La.xz(g,f.min_x,f.max_x,f.min_y,f.max_y,-f.max_z,-f.min_z);La.ig(g)}za.Fp(g.ef,g.cm)}}function Z(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.data.b4w_generate_shadows)return c}return!1}function T(a,b,c){var d=b.d;b=b.n;for(var e=0;e<b.length;e++){var f=b[e];"COLOR_ID"==f.type&&("COLOR_PICKING"==a.type&&"COLOR_ID"==f.Fb||"COLOR_PICKING_XRAY"==
a.type&&"COLOR_ID_XRAY"==f.Fb)&&(c||(da.ea(f,"USE_OUTLINE",0),da.vb(f),J(f)),a.p.push({W:!0,ib:d,o:f}))}}function aa(a,b){for(var c=S(b,Pa),d=a.fa,e=a.d,f=d.index,g=0;g<c.length;g++){var k=c[g];k.Qf.set(e.g,3*f);k.Of.set(d.direction,3*f);k.Nf.set(d.Bg,3*f);switch(d.type){case "SUN":if(k.us.set(e.quat),k.ts=d.Bg,"SKY"===k.type){var B=Aa;B[0]=B[1]=B[2]=1;var h=Math.acos(Wa.dot(k.Fk,B)),B=Math.acos(Wa.dot(d.direction,B));k.ek=Math.floor(h/.025)!=Math.floor(B/.025)?!0:!1;Wa.copy(d.direction,k.Fk);w(b,
k)}else Wa.copy(d.direction,k.Fk);case "HEMI":case "POINT":case "SPOT":break;default:Ea.error("unknown light type: "+d.type)}h=Na;h[0]=d.og?1:0;h[1]=d.cf?1:0;k.Pf.set(h,2*f);k.Ea=!0;for(h=0;h<k.p.length;h++)B=k.p[h].o,B.Ug&&v(B,a)}}function w(a,b){ob.Vh(b);if(b.ek)for(var c=S(a,["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY"]),d=0;d<c.length;d++)for(var e=c[d].p,f=0;f<e.length;f++){var g=e[f];g.W&&(g=g.o,da.cv(g)&&ob.CA(g))}}function ha(b,c,d){if(!b.ra)throw"Access to uninitialized scene";b=b.ra[c];if(d==
a.DATA_ID_ALL)return b;c=[];for(var e=0;e<b.length;e++){var f=b[e];f.d.ad==d&&c.push(f)}return c}function ma(b){var c=[];b=ha(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++)for(var e=b[d].data,f=0;f<e.materials.length;f++){var g=e.materials[f];-1==c.indexOf(g)&&c.push(g)}return c}function fa(a,b,c){for(var d=a.d,e=a.camera.d.H,f=0;f<e.length;f++){var g=e[f];La.ig(g,b/c);d.kn&&La.Nn(g,d.nd)}d.kn&&(d.fk=!0,P(a,"DEPTH").Ea=!0,P(a,"MAIN_BLEND").Ea=!0);va.wA(d.rb,function(d,e,f){if(d.Ch){var g=d.We*
b,k=d.We*c;if(e)for(e=0;e<f.na.length;e++)f.na[e]==d&&Va.resize(d.oa,g,k);else Va.mi(d.oa)&&Va.resize(d.oa,g,k),d=f.j,d.width=g,d.height=k,"DOF"==f.type&&ga(a,{dof_power:f.j.dof_power,dof_on:f.j.dof_on}),ia(f,1/b,1/c)}})}function ia(a,b,c){a=a.p;for(var d=0;d<a.length;d++){var e=a[d].o;e&&da.Ki(e,b,c)}}function S(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];ua.S(a.d.rb,function(a,b){b.type==e&&c.push(b)})}return c}function P(a,b){return va.Ha(a.d.rb,b)}function ga(a,b){var c=P(a,"DOF");if(!c)return Ea.error("DOF is not enabled on scene. Check camera settings"),
0;var d=a.d.rb;"boolean"==typeof b.dof_on&&(c.j.dof_on=parseFloat(b.dof_on));"number"==typeof b.dof_distance&&(c.j.dof_distance=b.dof_distance);"number"==typeof b.dof_front&&(c.j.dof_front=b.dof_front);"number"==typeof b.dof_rear&&(c.j.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){c.j.dof_power=b.dof_power;for(var e=va.pb(d,c,"POSTPROCESSING"),d=va.pb(d,e,"POSTPROCESSING"),e=[e,d],d=0;d<e.length;d++){var f=e[d].p[0].o;f&&(da.jg(f,c.j.dof_power),ia(e[d],1/c.j.width,1/c.j.height))}}c.Ea=!0}
function qa(a,b){var c=P(db,"MAIN_OPAQUE");if(!c||!c.Ua)return Ea.error("get_water_surface_level() - no water parameters on this scene"),0;var d=c.jf,e=c.tg,f=c.hf,g=c.Ua;if(!d||!g.Hg)return g.hf;var k=Wa.length(c.Ui),B=c.time;k&&(B*=k);var h=Na;h[0]=20/e*(a-.25*B);h[1]=20/e*(b-.25*B);k=za.$o(h);h[0]=17/e*(b+.1*B);h[1]=17/e*(a+.1*B);var h=za.$o(h),k=k+h-1,l=g.dst_noise_scale0,h=g.dst_noise_scale1,m=g.dst_noise_freq0,W=g.dst_noise_freq1,n=Na;n[0]=l*(a+m*B);n[1]=l*(b+m*B);l=za.vn(n);n[0]=h*(b-W*B);
n[1]=h*(a-W*B);h=za.vn(n);h*=d*l;if(c.Nk)if(W=(a-c.Te[0])/c.Ue[0],n=(c.Te[1]+b)/c.Ue[1],W+=.5,n+=.5,1<W||0>W||1<n||0>n)d=h;else var W=za.Wp(db.d.qn,c.lh,W,n),l=g.dir_freq,q=g.dir_noise_scale,r=g.dir_noise_freq,m=g.dir_min_noise_fac,n=g.dst_min_fac,c=e/c.Yg/Math.PI,q=[q/e*(a+r*B),q/e*(b+r*B)],e=Math.sqrt(W),d=d*Math.max(W,g.dir_min_shore_fac)*Math.sin(e/c+l*B)*Math.max(za.vn(q),m),g=Math.max(e,n),d=d*(1-g)+h*g,k=k*W;else d=h;return f+(d+.05*k)}function ya(a,b){a.ki&&"POSTPROCESSING"==a.type&&b.W!=
a.W&&(a.W=b.W);b.W||"OUTLINE"!=a.type||(a.Pl=0)}function ba(a,b,c,d){var e=ua.hb(a,b);La.zk(e.j,c,d);e.hl=!0;ua.bf(a,b,function(b,e,f){f.Ka&&f.K==c&&va.lv(f)&&Y(a,b,f.ca,d)});ua.ge(a,b,function(b,e,f){f.Ka&&f.K==c&&f.K==f.ca&&ba(a,b,c,d)})}function Y(a,b,c,d){a=ua.hb(a,b).p;for(b=0;b<a.length;b++)da.fz(a[b].o,d,c)}function B(a){var b=P(a,"GRASS_MAP");if(b){var c=b.j,d=a.camera.d,e=d.g;a=Aa;a[0]=0;a[1]=-b.Vb[2]/2;a[2]=0;Wa.transformQuat(a,d.quat,a);a[0]+=e[0];a[1]=0;a[2]+=e[2];b=Gb;b[0]=0;b[1]=0;b[2]=
0;b[3]=1;La.Xr(c,a,b)}}function W(a,b){ua.S(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.na[0]||!d.td[0])throw"Wrong MOTION_BLUR subscene";var e=d.na[0],f=d.td[0];d.td[0]=d.j.yb;ua.bf(a,c,function(b,c,d){d.Ka&&Y(a,b,d.ca,f)});ba(a,c,e.K,f);Y(a,c,e.ca,d.td[0]);d.Wq=Math.exp(-b/d.ck)}})}function na(b,c){var d=0,e=b.gu;0==e.Hn&&(e.Hn=c);var f=c-e.Hn;if(e.Mr&&f/e.Gc>=e.Mr)a.clear_outline_anim(b);else{f%=e.Gc;if(f<e.fr)switch(e=f/(e.fr/5),f=Math.floor(e),f){case 0:d=(e-f)/2;break;case 1:d=(e-f)/2+.5;
break;case 2:d=1;break;case 3:d=1-(e-f)/2;break;case 4:d=.5-(e-f)/2}b.d.Qc=d}}function oa(a){ua.S(a.d.rb,function(a,b){b.Ea=!0})}function pa(a){if("WIND"==a.field.type){a=a.d;za.quat_to_dir(a.quat,za.AXIS_Y,wa);Wa.normalize(wa,wa);Wa.scale(wa,a.am,wa);a=xa;for(var b=0;b<a.length;b++)for(var c=S(a[b],cc),d=0;d<c.length;d++)c[d].Ui.set(wa)}}function Ga(a){var b=h();if(b=P(b,"OUTLINE"))b.Le.set(a),b.Ea=!0}var da=p("__batch"),Q=p("__boundings"),La=p("__camera"),la=p("__config"),ra=p("__constraints"),
Ia=p("__data"),ta=p("__debug"),lb=p("__geometry"),ua=p("__graph"),mb=p("__hud"),Fa=p("__objects");p("__particles");var nb=p("__physics"),$a=p("__prerender"),Ja=p("__primitives"),Ea=p("__print"),ob=p("__renderer"),va=p("__scenegraph"),Pb=p("__sfx"),ja=p("__shaders"),Va=p("__textures"),za=p("__util"),Wa=p("vec3"),ab=p("mat4"),sa=la.q,Ma=la.Ab,Vb=la.Hd,Wb="ARMATURE CAMERA EMPTY LAMP MESH SPEAKER".split(" "),Kb=["ARMATURE","EMPTY","MESH","SPEAKER"],Eb="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH OUTLINE_MASK WIREFRAME".split(" ");
a.BB=Eb;var Pa="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY LUMINANCE_TRUNCED".split(" "),ib=["MAIN_OPAQUE","SSAO","MAIN_BLEND","MAIN_XRAY","MAIN_REFLECT"],cc="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GOD_RAYS OUTLINE_MASK WIREFRAME".split(" "),sc=["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY","MAIN_REFLECT"],dc=0,Lb=null,db=null,xa=[],eb=null,Xa=[],Qa=0,xb=0,pb=1,yb=0,zb=0,sb=Math.PI/2;a.mf=0;a.Rk=1;a.Sk=2;a.DATA_ID_ALL=
-1;var Na=new Float32Array(2),Aa=new Float32Array(3);new Float32Array(4);var Fb=new Float32Array(4),Gb=new Float32Array(4),Ba=new Float32Array(16),ec=new Float32Array(24),ea=new Float32Array(24),Ca=Q.zd(),Ra=Q.zd(),wa=new Float32Array(3),Ka=null;a.set_active=function(a){db=a;Pb.uz(a)};a.Qy=function(a,b){var c=a.d,d=va.Tv(c.rb);if(a==b){fa(a,Qa,xb);for(var e=0;e<d.length;e++)a.d.eg.push(d[e])}else for(e=a.Yc[0],fa(a,e.d.kg,e.d.kg),e=0;e<d.length;e++)b.d.eg.push(d[e]);d=S(a,cc);for(e=0;e<d.length;e++)d[e].Ui.set(wa);
for(e=0;e<c.eg.length;e++)"SHADOW_CAST"==c.eg[e].type&&ob.Vh(c.eg[e])};a.fi=c;a.Wl=b;a.get_active=h;a.Z=function(){return db?!0:!1};a.Jj=function(a){return a.camera};a.ei=function(){return xa};a.Ax=function(){if(1==xa.length)return xa;for(var a=[],b=0;b<xa.length;b++){var c=xa[b];if(!c.Yc.length){b=ua.dh(eb,c);b=ua.rs(eb,b,ua.fo);b=ua.Jn(b);ua.S(b,function(b,c){a.push(c)});break}}return a};a.fd=function(b,c,e,f){for(var g=xa,k=null,B=0;B<g.length;B++){var h=ha(g[B],"ALL",a.DATA_ID_ALL);switch(b){case a.mf:k=
d(c,h,!1,e);break;case a.Rk:k=null;(h=d(c,h,!1,f))&&h.dupli_group&&(k=d(e,h.dupli_group.objects,!0,f));break;case a.Sk:for(var k=null,l=0;l<c.length;l++)if((k=d(c[l],h,0!=l,e))&&k.dupli_group)h=k.dupli_group.objects;else break}if(k)break}return k};a.yu=function(a,b,c){for(var d in Kb){var e=Kb[d],g=f(a,e),k=b.d.Dh,B=!1;for(d=0;d<c.length;d++)if(B=!0,c[d].d&&c[d].d.Mf){for(var h=0;h<k.length;h++)k[h]==c[d]&&(B=!1);B&&k.push(c[d])}e in b.ra||(b.ra[e]=[]);for(h=0;h<g.length;h++)za.is_armature(g[h])&&
g[h].proxy||(b.ra.ALL.push(g[h]),b.ra[e].push(g[h]))}};a.su=function(b,c){b.ra={ALL:[]};for(var d in Wb){var B=Wb[d],h=f(b,B);b.ra[B]=[];for(var l=0;l<h.length;l++)za.is_armature(h[l])&&h[l].proxy||(b.ra.ALL.push(h[l]),b.ra[B].push(h[l]))}b.Yc=b.Yc||[];b.d=b.d||{};B=b.d;h=b.camera.d;d=b.world.b4w_shadow_settings;l=B.nd={};d.csm_resolution>sa.hd?(l.csm_resolution=sa.hd,Ea.error("Shadow map texture has unsupported size. Changed to "+sa.hd+".")):l.csm_resolution=d.csm_resolution;l.self_shadow_polygon_offset=
d.self_shadow_polygon_offset;l.self_shadow_normal_offset=d.self_shadow_normal_offset;l.enable_csm=d.b4w_enable_csm;var W=ha(b,"LAMP",a.DATA_ID_ALL);if(W=Z(W)||W[0])l.Dm=W.fa.type,l.Uc=W.fa.Uc,l.distance=W.fa.distance,"SPOT"!=l.Dm&&"POINT"!=l.Dm||!l.enable_csm||(Ea.warn("Generating shadows for SPOT or POINT light. Disabling Cascaded Shadow Maps"),l.enable_csm=!1);l.enable_csm?(l.csm_num=d.csm_num,l.csm_first_cascade_border=d.csm_first_cascade_border,l.first_cascade_blur_radius=d.first_cascade_blur_radius,
l.csm_last_cascade_border=d.csm_last_cascade_border,l.last_cascade_blur_radius=d.last_cascade_blur_radius,l.fade_last_cascade=d.fade_last_cascade,l.blend_between_cascades=d.blend_between_cascades):(l.csm_num=1,l.csm_first_cascade_border=d.csm_first_cascade_border,l.first_cascade_blur_radius=d.first_cascade_blur_radius,l.csm_last_cascade_border=d.csm_last_cascade_border,l.last_cascade_blur_radius=d.last_cascade_blur_radius,l.fade_last_cascade=!1,l.blend_between_cascades=!1);B.Dh=[];for(d=0;d<c.length;d++)c[d].d&&
c[d].d.Mf&&B.Dh.push(c[d]);d=b.world.b4w_fog_color;B.Tb=new Float32Array([d[0],d[1],d[2],b.world.b4w_fog_density]);B.vh=m(b);B.Dk=z(b,B.vh);B.bo=I(b,B.Dk);B.Kq=ha(b,"LAMP",a.DATA_ID_ALL).length;B.Ua=x(b);B.py=r(b);B.he=L(b);B.lu=C(b);B.br=0;h.H[0].type!=La.Sb&&sa.anaglyph_use?(Ea.warn("Anaglyph stereo is disabled for the non-perspective camera"),d=!1):d=sa.anaglyph_use;B.anaglyph_use=d;B.kn=sa.Uh&&g(b);B.yC=b.world.b4w_fog_color;B.shore_smoothing=k(b);B.Xy=q(b);B.Tu=A(b);B.ty=n(b);B.av=u(b);B.Lx=
e(b);B.Hy=O(b);B.Gg=sa.Gg&&(0<h.dof_distance||h.Bf);B.Ya=F(b);B.$g=sa.$g&&b.b4w_enable_motion_blur;B.Dg=sa.Dg&&b.b4w_enable_color_correction;B.antialiasing=sa.antialiasing&&b.b4w_enable_antialiasing;B.zg=sa.zg&&b.b4w_enable_bloom&&B.vh;B.Xe=sa.Xe&&b.b4w_enable_ssao;B.fA=E(b);B.Pg=sa.Pg&&b.b4w_enable_god_rays&&B.vh;B.kd=sa.kd&&b.b4w_render_refractions;B.qw=sa.Uh;B.sv=t(b);B.outline=y(b);d=b.Yc.sort(function(a,b){return b.d.kg-a.d.kg});B.rb=va.Sv(B,h,d);B.eg=[];B.fk=!1;B.Wm=!1;xa.push(b);eb||(eb=ua.create());
ua.C(eb,b)};a.Al=f;a.im=function(a){return a.d.rb};a.Vw=function(a){ua.S(a,function(b,c){var d=null;switch(c.type){case "POSTPROCESSING":d=da.np(c.zi);break;case "SSAO":d=da.Zv(c);break;case "SSAO_BLUR":d=da.$v(c);da.Ki(d,1/c.j.width,1/c.j.height);break;case "DEPTH_PACK":d=da.Jv();break;case "REFRACT":case "COPY":d=da.np("NONE");break;case "GOD_RAYS":va.pb(a,c,"WIREFRAME")||va.pb(a,c,"MAIN_BLEND")||va.pb(a,c,"GOD_RAYS");d=da.Lv(c.ur,c.gf,c.th);break;case "GOD_RAYS_COMBINE":va.pb(a,c,"WIREFRAME")||
va.pb(a,c,"MAIN_BLEND");va.pb(a,c,"GOD_RAYS");d=da.Mv();break;case "MOTION_BLUR":d=da.Qv(c.bk);break;case "DOF":d=da.Kv();da.jg(d,c.j.dof_power);for(var e=va.pb(a,c,"POSTPROCESSING"),f=va.pb(a,e,"POSTPROCESSING"),g=[e,f],B=0;B<g.length;B++){var k=g[B].p;(e=k[0].o)&&da.jg(e,c.j.dof_power)}break;case "OUTLINE":g=va.pb(a,c,"POSTPROCESSING");B=va.pb(a,g,"POSTPROCESSING");e=va.pb(a,B,"POSTPROCESSING");f=va.pb(a,e,"POSTPROCESSING");d=da.Rv();g=[B,g];for(B=0;B<g.length;B++)k=g[B].p,(k=k[0].o)&&da.jg(k,c.Oo);
g=[f,e];for(B=0;B<g.length;B++)k=g[B].p,(k=k[0].o)&&da.jg(k,c.Ep*c.kk);break;case "COMPOSITING":d=da.Hv();break;case "ANTIALIASING":d=da.Dv();break;case "LANCZOS":d=da.Nv(c.jD);break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=da.Xv(c.type);break;case "ANAGLYPH":d=da.Bv();break;case "SKY":d=da.Wv();da.Ki(d,1/c.j.width,1/c.j.height);break;case "LUMINANCE":d=da.Ov();break;case "AVERAGE_LUMINANCE":d=da.Ev();break;case "LUMINANCE_TRUNCED":d=
da.Pv();break;case "BLOOM_BLUR":d=da.Fv(c.zi);da.Ki(d,1/c.j.width,1/c.j.height);break;case "BLOOM":d=va.pb(a,c,"BLOOM_BLUR");g=[va.pb(a,d,"BLOOM_BLUR"),d];for(B=0;B<g.length;B++)k=g[B].p,(k=k[0].o)&&da.jg(k,c.bloom_blur);d=da.Gv();break;case "VELOCITY":d=da.cw();break;case "ANCHOR_VISIBILITY":d=da.Cv()}d&&(e={W:!0,ib:Fa.Aj("NONE"),o:d},J(d),c.p.push(e),H(a,c,d),R(d))})};a.append_object=function(a,b,c){switch(b.type){case "MESH":var d=a.d.rb,e=b.d;!va.Ha(d,"SHADOW_CAST")&&e.Eb&&(e.Eb=!1);e=S(a,Eb);
c&&(nb.has_physics(b)&&nb.append_object(b,a),a.ra.ALL.push(b),a.ra[b.type].push(b),b.ua&&b.ua.dupli_group.objects&&(b.origin_name=b.name,b.ua.dupli_group.objects.push(b)));for(var f=0;f<e.length;f++)K(e[f],b,d,a,c);break;case "LAMP":b.fa.index=a.d.br++;c=S(a,Pa);for(d=0;d<c.length;d++)c[d].Xf++;aa(b,a)}};a.remove_object=function(a){if(!a.d.wm)return!1;var b=h();Ia.Py(b,a,!1);var c=b.ra.ALL.indexOf(a);-1!=c&&b.ra.ALL.splice(c,1);c=b.ra[a.type].indexOf(a);-1!=c&&b.ra[a.type].splice(c,1);a.ua&&a.ua.dupli_group.objects&&
(c=a.ua.dupli_group.objects.indexOf(a),-1!=c&&a.ua.dupli_group.objects.splice(c,1));ra.fv(a)&&ra.remove(a);return!0};a.HB=K;a.nn=function(a){a.d.fk=!0};a.qx=function(a,b){for(var c=a.d.nd,d=new Float32Array(c.csm_num),e=0;e<c.csm_num;e++)d[e]=La.ew(c,b,e);return d};a.hide_object=function(a){a.d.Rg=!0};a.show_object=function(a){a.d.Rg=!1};a.is_hidden=function(a){return a.d.Rg};a.az=function(a,b,c){b=b.d;a=S(a,Eb);for(var d=0;d<a.length;d++)for(var e=a[d].p,f=e.length-1;0<=f;f--){var g=e[f];g.ib==b&&
(g.o&&c&&lb.cp(g.o.R),e.splice(f,1))}};a.check_object=function(a,b){return b.ra[a.type]&&-1<b.ra[a.type].indexOf(a)?!0:!1};a.Tz=function(a){var b=a.ra.LAMP;if(b.length==a.d.br){for(var c=[],d=0;d<b.length;d++)c[b[d].fa.index]=d;for(d=0;d<c.length-1;d++)for(var e=d+1;e<c.length;e++){var f=b[c[d]].fa,g=b[c[e]].fa;if(g.og&&g.cf&&(!f.og||!f.cf)||!f.og&&(g.og||!f.cf&&g.cf))f=c[d],c[d]=c[e],c[e]=f}for(d=0;d<c.length;d++)b[c[d]].fa.index=d,aa(b[c[d]],a)}};a.mg=aa;a.cleanup=function(){for(var a=0;a<xa.length;a++){var b=
xa[a];ua.S(b.d.rb,function(a,b){if("SINK"!=b.type){var c=b.j;ob.cz(c.Td,c.yb,c.Cc,c.width,c.height);for(var c=b.p,d=0;d<c.length;d++){var e=c[d].o;e&&da.rv(e)}}});b.d.rb=[];b.d.eg=[]}db=Lb=null;xa.length=0;eb=null;Xa.length=0;wa[0]=0;wa[1]=0;wa[2]=0};a.Tq=function(a,b,c){a=La.Gw(a,a.Qa,a.Za,null,!0);var d=Ja.$w(a);a=Fa.Aj("DYNAMIC");a.Wa=a.Ib={max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12};a.xb=a.Lc=Q.Ru();var e=a.xb.za;a.tf=a.sf=Q.Dl([e,0,0],[0,e,0],[0,0,e],a.xb.D);c=da.Vv(d,
c);b.p.push({W:!0,ib:a,o:c})};a.Da=ha;a.OC=function(a){return[a.frame_start,a.frame_end]};a.Yr=function(a,b,c,d,e){Qa=a;xb=b;pb=c;yb=e;zb=d;db&&fa(db,a,b)};a.Ki=ia;a.lA=S;a.ia=P;a.get_environment_colors=function(a){a=S(a,Pa)[0];var b=a.De,c=a.lf,d=[],e=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];e[0]=c[0];e[1]=c[1];e[2]=c[2];return[a.Be,d,e]};a.set_environment_colors=function(a,b,c,d){a=S(a,Pa);for(var e=0;e<a.length;e++){var f=a[e];isNaN(b)||(f.Be=b);c&&f.De.set(c);d&&f.lf.set(d);f.Ea=!0}};a.get_sky_params=
function(a){if(a=P(a,"SKY")){var b={};b.color=Array(3);Wa.copy(a.mh,b.color);b.procedural_skydome=a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=a.mie_collection_power;
b.mie_distribution=a.mie_distribution;return b}return null};a.set_sky_params=function(a,b){var c=P(a,"SKY");c&&("number"==typeof b.procedural_skydome&&(c.procedural_skydome=b.procedural_skydome),"number"==typeof b.use_as_environment_lighting&&(c.use_as_environment_lighting=b.use_as_environment_lighting),"object"==typeof b.color&&c.mh.set(b.color),"number"==typeof b.rayleigh_brightness&&(c.rayleigh_brightness=b.rayleigh_brightness),"number"==typeof b.mie_brightness&&(c.mie_brightness=b.mie_brightness),
"number"==typeof b.spot_brightness&&(c.spot_brightness=b.spot_brightness),"number"==typeof b.scatter_strength&&(c.scatter_strength=b.scatter_strength),"number"==typeof b.rayleigh_strength&&(c.rayleigh_strength=b.rayleigh_strength),"number"==typeof b.mie_strength&&(c.mie_strength=b.mie_strength),"number"==typeof b.rayleigh_collection_power&&(c.rayleigh_collection_power=b.rayleigh_collection_power),"number"==typeof b.mie_collection_power&&(c.mie_collection_power=b.mie_collection_power),"number"==typeof b.mie_distribution&&
(c.mie_distribution=b.mie_distribution),c.Ea=!0,c.ek=!0,w(a,c))};a.get_fog_color_density=function(a,b){var c=b||[],d=S(a,ib)[0].Tb;c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.set_fog_color_density=function(a,b){for(var c=S(a,ib),d=0;d<c.length;d++){var e=c[d];e.Tb.set(b);e.Ea=!0}};a.get_ssao_params=function(a){var b=P(a,"SSAO");a=P(a,"SSAO_BLUR");if(!b)return null;var c=b.p[0].o,d={};d.ssao_quality=da.qb(c,"SSAO_QUALITY")[1];d.ssao_hemisphere=b.ssao_hemisphere;d.ssao_blur_depth=a.ssao_blur_depth;
d.No=a.ssao_blur_discard_value;d.radius_increase=b.qh;d.influence=b.ph;d.dist_factor=b.oh;d.ssao_only=b.ssao_only;d.ssao_white=da.qb(c,"SSAO_WHITE")[1];return d};a.set_ssao_params=function(a,b){var c=P(a,"SSAO"),d=P(a,"SSAO_BLUR");if(!c)return Ea.error("SSAO is not enabled on scene"),0;if("string"==typeof b.ssao_quality){var e=c.p[0].o;da.ea(e,"SSAO_QUALITY",b.ssao_quality);da.vb(e,!0)}"number"==typeof b.ssao_hemisphere&&(e=c.p[0].o,da.ea(e,"SSAO_HEMISPHERE",b.ssao_hemisphere),da.vb(e,!0));"number"==
typeof b.ssao_blur_depth&&(e=d.p[0].o,da.ea(e,"SSAO_BLUR_DEPTH",b.ssao_blur_depth),da.vb(e,!0));"number"==typeof b.ssao_blur_discard_value&&(d.ssao_blur_discard_value=b.ssao_blur_discard_value);"number"==typeof b.qh&&(c.qh=b.qh);"number"==typeof b.ph&&(c.ph=b.ph);"number"==typeof b.oh&&(c.oh=b.oh);if("number"==typeof b.ssao_only){c=P(a,"MAIN_OPAQUE");c.ssao_only=b.ssao_only;for(var f=0;f<c.p.length;f++)e=c.p[f].o,da.ea(e,"SSAO_ONLY",b.ssao_only),da.vb(e,!0)}"number"==typeof b.ssao_white&&(e=c.p[0].o,
da.ea(e,"SSAO_WHITE",b.ssao_white),da.vb(e,!0));c.Ea=!0;d.Ea=!0};a.get_dof_params=function(a){a=P(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.j.dof_distance;b.dof_front=a.j.dof_front;b.dof_rear=a.j.dof_rear;b.dof_power=a.j.dof_power;return b};a.set_dof_params=ga;a.get_god_rays_params=function(a){var b=S(a,["GOD_RAYS"]);a=P(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].Xg;c.god_rays_intensity=a.god_rays_intensity;c.god_rays_steps=da.qb(b[0].p[0].o,"STEPS_PER_PASS")[1];
return c};a.set_god_rays_params=function(a,b){var c=S(a,["GOD_RAYS"]),d=P(a,"GOD_RAYS_COMBINE");if(!c||!d)return Ea.error("God Rays are not enabled on scene"),0;"number"==typeof b.god_rays_intensity&&(d.god_rays_intensity=b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var e=b.god_rays_max_ray_length,f=0;f<c.length;f++)c[f].Xg=e,c[f].wk=e/c[f].th/(f+1),c[f].Ea=!0;if("number"==typeof b.god_rays_steps)for(var g=ja.t(b.god_rays_steps,1),e=c[0].Xg,f=0;f<c.length;f++){c[f].th=g;
c[f].wk=e/g/(f+1);c[f].Ea=!0;var B=c[f].p[0].o;da.ea(B,"STEPS_PER_PASS",g);da.vb(B,!0)}d.Ea=!0};a.get_bloom_params=function(a){var b=P(a,["LUMINANCE_TRUNCED"]);a=P(a,"BLOOM");if(!b||!a)return null;var c={};c.bloom_key=b.bloom_key;c.bloom_edge_lum=b.bloom_edge_lum;c.bloom_blur=a.bloom_blur;return c};a.set_bloom_params=function(a,b){var c=P(a,"LUMINANCE_TRUNCED"),d=P(a,"BLOOM");if(!c||!d)return Ea.error("Bloom is not enabled on scene"),0;"number"==typeof b.bloom_key&&(c.bloom_key=b.bloom_key,c.Ea=!0);
"number"==typeof b.bloom_edge_lum&&(c.bloom_edge_lum=b.bloom_edge_lum,c.Ea=!0);if("number"==typeof b.bloom_blur)for(var e=a.d.rb,c=va.pb(e,d,"BLOOM_BLUR"),e=va.pb(e,c,"BLOOM_BLUR"),c=[c,e],e=0;e<c.length;e++){var f=c[e].p[0].o;f&&(da.jg(f,b.bloom_blur),ia(c[e],1/d.j.width,1/d.j.height))}};a.get_wind_params=function(){var a=wa,b=Wa.length(a);if(0==b)return null;var c={};c.wind_dir=180*Math.atan(a[0]/a[2])/Math.PI;c.wind_strength=b;return c};a.set_wind_params=function(b,c){for(var d=ha(b,"ALL",a.DATA_ID_ALL),
e=0;e<d.length;e++){var f=d[e];if("EMPTY"===f.type&&f.field&&"WIND"===f.field.type)var g=f}if(!g)return Ea.error("There is no wind on the scene"),0;d=g.d;"number"==typeof c.wind_dir&&(Aa=[0,c.wind_dir/180*Math.PI,-Math.PI/2],za.euler_to_quat(Aa,Gb),d.quat.set(Gb),pa(g));"number"==typeof c.wind_strength&&(d.am=c.wind_strength,pa(g));oa(b)};a.pz=function(a){a.d.Wm=!0};a.get_water_surface_level=qa;a.get_water_mat_params=function(a,b){var c=P(a,"MAIN_OPAQUE");if(c&&(b.waves_height=c.jf,b.waves_length=
c.tg,c.Wc)){b.water_fog_density=c.Wc[3];var d=b.water_fog_color=[];d[0]=c.Wc[0];d[1]=c.Wc[1];d[2]=c.Wc[2]}};a.set_water_params=function(a,b){var c=P(a,"MAIN_OPAQUE");if(!c||!c.Ua)return Ea.error("set_water_params() - no water parameters on this scene"),null;c=c.Ua;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&(c.dst_noise_freq0=b.dst_noise_freq0);"number"==
typeof b.dst_noise_freq1&&(c.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);"number"==typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=b.dir_noise_scale);"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&
(c.waves_hor_fac=b.waves_hor_fac);"number"==typeof b.water_dynamic&&(c.Hg=b.water_dynamic);for(var d=S(a,sc),e=0;e<d.length;e++){var f=d[e];"number"==typeof b.water_fog_density&&c.Tb&&(f.Wc[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&c.Tb&&f.Wc.set(b.water_fog_color);"number"==typeof b.waves_height&&(f.jf=b.waves_height);"number"==typeof b.waves_length&&(f.tg=b.waves_length);f.Ea=!0}};a.get_shore_dist=function(a,b){var c=P(db,"MAIN_OPAQUE");if(!c.Nk)return 100;var d=c.Yg,e=c.hf,f=
(a[0]-c.Te[0])/c.Ue[0],g=(c.Te[1]+a[2])/c.Ue[1],f=f+.5,g=g+.5;if(1<f||0>f||1<g||0>g)e=1;else return c=d*za.Wp(db.d.qn,c.lh,f,g),e=(e-a[1])*b,e=Math.sqrt(c*c+e*e)};a.update=function(a,b){for(var c=h().camera.d,d=0;d<xa.length;d++){var e=xa[d],f=e.d.rb;if(e.d.Ua)var g=c.g[1]-qa(c.g[0],c.g[2]);for(var k=e.d.Dh,l=0;l<k.length;l++){var m=k[l].d,n=m.Ja,q=m.Kg+m.Ca;if(n){var r=Math.round(n.currentTime*m.Ub),t=m.Ca/m.Ub;if(r<m.Ca-(sa.Lf?5:0)||k[l].d.ng&&r>q)n.currentTime=t;!m.ng&&r>q&&n.pause();2<=n.readyState&&
!n.paused&&Va.TA(m)}else if(m.ih){n=Math.min(m.ih.length,m.Kg+m.Ca);if(m.de<m.Ca||m.ng&&m.de>=n)m.de=m.Ca;!m.ng&&m.de>=n&&(m.jh=!1);n=Math.round(a*Vb.Ia/m.Ub)*m.Tr;n!=dc&&m.jh&&(Va.QA(m),m.de++);dc=n}}ua.S(f,function(b,c){-1<cc.indexOf(c.type)&&(c.time=a);e.d.Ua&&(c.tl=g)})}for(d=0;d<xa.length;d++)if(e=xa[d],l=e.d,c=l.eg,l.fk&&(ca(e),l.fk=!1),l.Wm&&(B(e),l.Wm=!1),c.length){e.b4w_enable_motion_blur&&W(l.rb,b);if(l.outline){for(var x=0,d=0;d<e.ra.MESH.length;d++)l=e.ra.MESH[d],x+=l.d.Qc,-1!=Xa.indexOf(l)&&
na(l,a);ua.S(e.d.rb,function(a,b){"OUTLINE"===b.type&&(b.Pl=x)})}f=null;for(l=0;l<c.length;l++)"OUTLINE_MASK"==c[l].type&&(f=l);for(l=0;l<c.length;l++)k=c[l],$a.fn(k),null!==f&&ya(k,c[f]),ob.Vh(k)}sa.show_hud_debug_info&&mb.Oz(xa,b)};a.gm=function(a){var b=[];ua.S(a.d.rb,function(a,c){b.push(c)});return b};a.apply_outline_anim=function(a,b,c,d){a.gu={Hn:0,fr:b,Gc:c,Mr:d};-1==Xa.indexOf(a)&&Xa.push(a)};a.clear_outline_anim=function(a){a.d.Qc=0;a=Xa.indexOf(a);-1!=a&&Xa.splice(a,1)};a.dC=function(){Xa=
[]};a.get_cam_water_depth=function(){var a=P(db,"MAIN_BLEND"),b=db;return a||b.d.Ua?a.tl:null};a.get_object_data_id=function(a){return a.d.ad};a.Fs=oa;a.Kz=function(a,b){switch(b){case "WM_NONE":a.W=!1;break;case "WM_OPAQUE_WIREFRAME":case "WM_TRANSPARENT_WIREFRAME":case "WM_FRONT_BACK_VIEW":case "WM_DEBUG_SPHERES":for(var c=0;c<a.p.length;c++)a.p[c].o.wireframe_mode=ta.no[b];a.W=!0}a.Ga="WM_TRANSPARENT_WIREFRAME"==b;a.Ea=!0};a.Jz=function(a,b){for(var c=0;c<a.p.length;c++)a.p[c].o.wireframe_edge_color=
b,a.Ea=!0};a.xo=function(a,b){for(var c=0;c<b.length;c++)a.ra.ALL.push(b[c]),a.ra.MESH.push(b[c])};a.Ds=pa;a.pick_object=function(b,d){var e=c();if(!e)return Ea.error("No active scene"),null;var f=P(e,"COLOR_PICKING");if(f){b-=zb;d-=yb;b*=pb;d*=pb;$a.fn(f);ob.Vh(f);var g=P(e,"COLOR_PICKING_XRAY");g?($a.fn(g),ob.Vh(g),f=g.j):f=f.j;d=f.height-d;for(var B=ob.Kr(f.Td,b,d),f=ha(e,"MESH",a.DATA_ID_ALL),g=0;g<f.length;g++){var k=f[g].d,h=k.yj;if(h&&3>Math.abs(255*h[0]-B[0])&&3>Math.abs(255*h[1]-B[1])&&3>
Math.abs(255*h[2]-B[2]))return k.Ab&&k.er&&(Ma.outlining_overview_mode?(Ga(Ma.Le),k.Qc=Ma.Qc,a.apply_outline_anim(f[g],Ma.jk,Ma.lk,Ma.mk)):(Ga(e.world.b4w_outline_color),k.Qc=e.world.b4w_outline_factor,e=k.ti,a.apply_outline_anim(f[g],e.jk,e.lk,e.mk))),f[g]}}else Ea.error("Color picking is not available");return null};a.set_outline_color=Ga;a.Kx=function(){return wa};a.Cx=function(b){var c=[];b=ha(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++){var e=b[d];e.d.hg&&c.push(e)}return c};a.get_meta_tags=
function(a){var b={title:"",description:""};a.b4w_tags&&(b.title=a.b4w_tags.title,b.description=a.b4w_tags.description);return b};a.zA=function(){for(var b=db,c=ha(b,"MESH",a.DATA_ID_ALL),d=0;d<c.length;d++)for(var e=c[d].n,f=0;f<e.length;f++){var g=e[f];if("MAIN"==g.type||"NODES"==g.type)N(b,g),da.vb(g)}};a.gq=function(){return pb}};b4w.module.__physics=function(a,p){function c(a,b){for(var d=a.yc,e=0;e<d.length;e++)d[e].d.Lk&&b.push(d[e]),c(d[e],b)}function b(a,b){if(U)switch(a){case y.ct:U.l.Ss=!0;y.s(y.Ft,Date.now()-performance.now(),J.gd,J.Yu?R.Op:0);break;case y.dt:F.log(b);break;case y.Zs:F.error(b);break;case y.$s:t.fbmsg.apply(this,b.slice(1));break;case y.ht:var c=h(b.body_id);if(c){var d=b.trans,e=b.quat,f=b.linvel,g=b.angvel,c=c.l;c.Hl=b.time;H.set_sep(d,1,e,c.Il);G.copy(f,c.Qq);G.copy(g,c.yo)}break;case y.ft:(d=h(b.chassis_hull_body_id))&&
H.set_sep(b.trans,1,b.quat,d.i.Bi[b.prop_ind]);break;case y.at:if(c=h(b[1]))d=b[4],c=c.zc.nj[b[2]],C.set_translation(c,b[3]),C.set_rotation(c,d),C.A(c);break;case y.it:if(c=h(b[1]))c.i.speed=b[2];break;case y.Ws:for(var d=b.body_id_a,c=b.body_id_b,e=b.result,f=b.coll_point,d=parseInt(d),g=U.l.p,k=0;k<g.length;k++)for(var l=g[k].sb,m=0;m<l.Zc.length;m++){for(var n=l.Zc[m],q=n.ok,r=!1,x=0;x<q.length;x++){var u=q[x];if(u[0]===d&&u[1]===c){n.xr[x]=e;r=!0;break}}if(r){q=n.xr;for(x=r=0;x<q.length;x++)r=
r||q[x];n.callback(r,f)}}break;case y.Xs:if(c=h(b[1]))c=c.l,c.xj&&c.xj(b[2]);break;case y.gt:if(c=h(b.body_id))for(c=c.l,e=b.from,f=b.to,g=b.local,k=b.body_id_b_hit,l=b.cur_result,m=0;m<c.Ne.length;m++)if(q=c.Ne[m],K.wj(q.K,e)&&K.wj(q.ca,f)&&q.local==g){for(d in q.be)q.be[d]=1;-1!=k&&(q.be[k]=l);for(var n=q.gc,x=q.callback,q=q.be,r=!1,u=1,z=0;z<U.l.p.length;z++){var v=U.l.p[z].sb;if(("ANY"==n||v.id==n)&&v.N in q&&1!==q[v.N]){r=!0;u=q[v.N];break}}x(r,u)}break;case y.et:console.log("Physics message ping: ",
performance.now()-b[1]);break;case y.bt:V=b[1];break;case y.Ys:console.log(b[1]);break;default:F.error("Wrong message: "+a)}}function h(a){return T[a]||null}function d(){aa.body++;return aa.body}function f(a){return{N:a,Nm:0,Vj:!1,Ve:!0,gD:!1,is_character:!1,Yx:!1,zj:null,id:"",fC:{},Zc:[],xj:null,Ne:[],Hl:0,Il:new Float32Array([0,0,0,1,0,0,0,1]),Qq:new Float32Array(3),yo:new Float32Array(3),rj:new Float32Array(3),qj:new Float32Array(4)}}function l(a,b){switch(a){case "BOX":var c=b.Ib;break;case "CYLINDER":c=
b.ll;break;case "CONE":c=b.kl;break;case "SPHERE":c=b.Lc;break;case "CAPSULE":c=b.jl}return c}function g(a){if(!a)return null;var b={};"number"===typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.D&&(b.center=a.D);"number"===typeof a.za&&(b.radius=a.za);"number"===typeof a.height&&
(b.height=a.height);return b}function m(a,b,c,d){var e=a.d.g,f=b.d.T,g=new Float32Array(16);N.invert(f,g);f=new Float32Array(3);G.transformMat4(e,g,f);switch(b.i.type){case 10:b=b.b4w_vehicle_settings;a=a.d.Ib;y.s(y.kt,c,f,b.suspension_rest_length,b.roll_influence,(a.max_y-a.min_y)/2,d);break;case 20:y.s(y.jt,c,f,a.MD)}}function k(a){return a.l&&a.l.zj?!0:!1}function x(a,b,c,d,e,f,g,k,h,l){var m;aa.ip++;m=aa.ip.toString(16);y.s(y.rt,m,a,k,b.l.N,c,d,e.l.N,f,g,h,l);b.l.zj=m}function r(a){var b=a.l;
if(b&&(0===b.Nm||!0===b.Vj||!1===b.Ve||"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type)&&(a.d.g[0]!=a.l.rj[0]||a.d.g[1]!=a.l.rj[1]||a.d.g[2]!=a.l.rj[2]||a.d.quat[0]!=a.l.qj[0]||a.d.quat[1]!=a.l.qj[1]||a.d.quat[2]!=a.l.qj[2])){a.l.rj.set(a.d.g);a.l.qj.set(a.d.quat);var b=a.l,c=y.bq(y.aj);c.body_id=a.l.N;c.trans=a.d.g;"DYNAMIC"===b.type?(c.quat=ha,v.identity(ha)):c.quat=a.d.quat;y.s(y.aj,c)}a=a.yc;for(b=0;b<a.length;b++)r(a[b])}function q(a,b,c,d,e){e=e||new Float32Array(3);a=a.d.quat;e[0]=b;e[1]=c;e[2]=
d;G.transformQuat(e,a,e)}function z(a,b,c,d){if(!c&&!d)throw"At least one destination required";for(var e=0;e<b.l.p.length;e++){var f=b.l.p[e];if("ANY"==a||f.sb.id==a)f=f.sb.N,c&&-1==c.indexOf(f)&&c.push(f),d&&(d[f]=0)}}function E(a,b){y.s(y.Bd,a);if(b.length){for(var c={},d=0;d<b.length;d++){var e=b[d],f=K.Co(e.K)+K.Co(e.ca)+String(e.local);c[f]=c[f]||{K:e.K,ca:e.ca,local:e.local,Po:[]};var g=c[f].Po,k;for(k in e.be)-1==g.indexOf(k)&&g.push(k)}for(f in c)d=c[f].K,e=c[f].ca,k=c[f].local,g=c[f].Po,
y.s(y.lo,a,d,e,k,g)}else y.s(y.lo,a,null,null,!1,null)}function A(a,b){if(b.sh){var c=a.l.N,d=b.Ig*b.Np,e=b.Oh*b.Ro,f=-b.rh*b.An*2*Math.PI/b.ns;b.Aq&&(f*=-1);switch(b.type){case 10:y.s(y.Bd,c);y.s(y.Vt,c,d,e,f);break;case 20:y.s(y.Bd,c),y.s(y.Ut,c,d,e,f)}}}function n(a){return a.b4w_vehicle&&"CHASSIS"==a.b4w_vehicle_settings.part?!0:!1}function u(a){return a.b4w_vehicle&&"HULL"==a.b4w_vehicle_settings.part?!0:!1}function e(a){return a.b4w_character?!0:!1}function O(a){return a.b4w_floating&&"MAIN_BODY"==
a.b4w_floating_settings.part?!0:!1}var I=p("__config");p("__constraints");var F=p("__print"),t=p("__debug"),y=p("__ipc");p("__renderer");var L=p("__scenes"),C=p("__transform"),H=p("__tsr"),K=p("__util"),M=p("__version"),G=p("vec3"),v=p("quat"),N=p("mat4"),J=I.sb,R=I.q,V=0,ca=null,U=null,Z=[],T={},aa={body:0,ip:0,shape:0},w=new Float32Array(3),ha=new Float32Array(4),ma=new Float32Array(4),fa=new Float32Array(16),ia=new Float32Array(8),S=new Float32Array(8);a.Tx=function(a){if(U)F.warn("Multiple physics scenes are currently not supported");
else{a.l={Ss:!1,p:[]};var c=J.Pi+M.timestamp();F.log("%cLOAD PHYSICS","color: #0a0",c,"Max FPS: "+J.gd);ca=new Worker(c);y.init(ca,b);U=a}};a.mv=function(a){return a.l?a.l.Ss:!0};a.cleanup=function(){if(U){ca.terminate();U=ca=null;Z.length=0;T={};for(var a in aa)aa[a]=0}};a.append_object=function(a,b){var h=a.d;if(!h)throw"No object render: "+a.name;if(a.parent&&h.Lk)return null;var q=[];h.Lk&&c(a,q);if(n(a)||u(a)||e(a)||O(a)||a.b4w_collision){var r,t=a,B=h.zr,W=t.d,z=t.game,p=d();if("CAMERA"==t.type)var w=
z.use_collision_bounds?z.collision_bounds_type:"BOX",S=l(w,W),E=W.bi,Q=W.Wh,E=.5,Q=0;else"EMPTY"==t.type?(w="EMPTY",S=null,Q=E=0):(w=z.use_collision_bounds?z.collision_bounds_type:"BOX",S=l(w,W),E=W.bi,Q=W.Wh);var C=W.g,J=W.quat,H=z.use_ghost,I=z.use_sleep,R=z.mass,M=z.velocity_min,V=z.velocity_max,aa=z.damping,ca=z.rotation_damping,ha=z.collision_group,ia=z.collision_mask,Ja=W.Lc.za,Ea=g(S),ob=t.b4w_correct_bounding_offset,va;var Pb=w;if(q.length){var ja=[],Va={};Va.quat=new Float32Array([0,0,0,
1]);Va.trans=new Float32Array(3);Va.worker_bounding=Ea;Va.bounding_type=Pb;ja.push(Va);N.invert(W.T,fa);v.invert(W.quat,ma);for(var za=0;za<q.length;za++){var Wa={},ab=q[za],sa=ab.game.collision_bounds_type,Ma=new Float32Array(4),Vb=new Float32Array(3);G.transformMat4(ab.d.g,fa,Vb);v.multiply(ma,ab.d.quat,Ma);Wa.trans=Vb;Wa.quat=Ma;Wa.bounding_type=sa;Wa.worker_bounding=g(l(sa,ab.d));ja.push(Wa)}va=ja}else va=[];y.s(y.nt,p,C,J,B,H,I,R,M,V,aa,ca,ha,ia,w,Ea,Ja,E,Q,va,ob);Z.push(t);T[p]=t;var Wb=f(p);
Wb.type=B;Wb.Nm=R;Wb.Vj=H;r=Wb;a.l=r;var Kb={o:null,sb:r};b.l.p.push(Kb)}else for(var Eb=a.n||[],Pa=0;Pa<Eb.length;Pa++){var ib=Eb[Pa],cc;if(cc="PHYSICS"==ib.type){var sc;a:{for(var dc=b.l.p,Lb=0;Lb<dc.length;Lb++){var db=dc[Lb].o;if(db&&db.id==ib.id){sc=!0;break a}}sc=!1}cc=!sc}if(cc)if(ib.tc.I)if(ib.gf&&b.d.Ua){var xa=ib,eb=U,Xa=L.ia(eb,"MAIN_OPAQUE");y.s(y.vt,Xa.hf);if(Xa.Ua&&xa.iB){var Qa={};Qa.dst_noise_scale0=xa.dst_noise_scale0;Qa.dst_noise_scale1=xa.dst_noise_scale1;Qa.dst_noise_freq0=xa.dst_noise_freq0;
Qa.dst_noise_freq1=xa.dst_noise_freq1;Qa.dir_min_shore_fac=xa.dir_min_shore_fac;Qa.dir_freq=xa.dir_freq;Qa.dir_noise_scale=xa.dir_noise_scale;Qa.dir_noise_freq=xa.dir_noise_freq;Qa.dir_min_noise_fac=xa.dir_min_noise_fac;Qa.dst_min_fac=xa.dst_min_fac;Qa.waves_hor_fac=xa.waves_hor_fac;var xb=Xa.jf,pb=Xa.tg;Xa.Nk?y.s(y.ko,Qa,Xa.Ue[0],Xa.Ue[1],Xa.Te[0],Xa.Te[1],Xa.Yg,xb,pb,Xa.lh,eb.d.qn):y.s(y.ko,Qa,0,0,0,0,0,xb,pb,0,null)}}else{var yb;if(ib.XA){var zb=a,sb=ib,Na=d(),Aa=sb.tc;y.s(y.tt,Na,Aa.w[0].a_position,
Aa.aa||null,zb.d.g,sb.ep,sb.fp);var Fb=f(Na);Fb.Vj=!0;yb=Fb}else{var Gb=a,Ba=ib,ec=d(),ea=Ba.tc;y.s(y.ut,ec,ea.w[0].a_position,ea.aa||null,Gb.d.g,Ba.bi,Ba.Wh,Ba.ep,Ba.fp);yb=f(ec)}r=yb;r.id=ib.gc;Kb={o:ib,sb:r};b.l.p.push(Kb)}else F.error("Object "+a.name+" has collision material with no assigned vertices")}if(n(a)||u(a)){var Ca=a,Ra=Ca.l.N;n(Ca)?(Ca.i.type=10,y.s(y.ot,Ra,Ca.i.oA,Ca.i.qA,Ca.i.pA,Ca.i.kB,Ca.i.sy)):u(Ca)&&(Ca.i.type=20,y.s(y.mt,Ra,Ca.i.Yl,Ca.i.Xn,Ca.i.Yn));if(Ca.i.dg){var wa=Ca.i.dg;
switch(Ca.i.type){case 10:m(wa[1],Ca,Ra,!0);m(wa[0],Ca,Ra,!0);m(wa[3],Ca,Ra,!1);m(wa[2],Ca,Ra,!1);break;case 20:for(var Ka=0;Ka<wa.length;Ka++)m(wa[Ka],Ca,Ra,!1)}}Ca.l.id=Ca.b4w_vehicle_settings.name;A(a,a.i)}else if(e(a)){var vb=a.d,wb=a.l,Xb=vb.Ib.max_y-vb.Ib.min_y,Yb=wb.N,Oa=a.b4w_character_settings,Qb=Oa.walk_speed,Hb=Oa.run_speed,Zb=Oa.step_height,Rb=Oa.jump_strength,kc=Oa.waterline,lc=K.sw(a);y.s(y.pt,Yb,lc,Xb,Qb,Hb,Zb,Rb,kc);wb.is_character=!0}else if(O(a)){var bb=a,mc=bb.l.N;y.s(y.st,mc,bb.zc.Yl,
bb.zc.Xn,bb.zc.Yn);if(bb.zc.nj)for(var nc=bb.zc.nj,hb=0;hb<nc.length;hb++){var fc=nc[hb],D=fc.d.g,Mb=bb.d.T,qb=new Float32Array(16);N.invert(Mb,qb);var Sa=new Float32Array(3);G.transformMat4(D,qb,Sa);y.s(y.lt,mc,Sa,fc.Vu)}bb.l.Yx=!0}else a.b4w_collision&&(r.id=a.b4w_collision_id);for(Pa=0;Pa<Z.length;Pa++)if(a=Z[Pa],a.l){var jb=a;if(!k(jb))for(var X=0;X<jb.constraints.length;X++){var Ha=jb.constraints[X],Za=Ha.target,tb=Ha.pivot_type;if("RIGID_BODY_JOINT"==Ha.type&&Za.l){var Ta=new Float32Array([Ha.pivot_x,
Ha.pivot_y,Ha.pivot_z]),Ab,Da=new Float32Array([Ha.axis_x,Ha.axis_y,Ha.axis_z]);Ab=K.euler_to_quat(Da,new Float32Array(4));var tc=N.fromRotationTranslation(Ab,Ta,new Float32Array(16)),$b=N.multiply(jb.d.T,tc,new Float32Array(16)),ac=N.invert(Za.d.T,new Float32Array(16)),Sb=N.multiply(ac,$b,ac),Gc=K.Wg(Sb),uc=K.matrix_to_quat(Sb),cb=Ha,Ya={};Ya.use_limit_x=cb.use_limit_x;Ya.use_limit_y=cb.use_limit_y;Ya.use_limit_z=cb.use_limit_z;Ya.use_angular_limit_x=cb.use_angular_limit_x;Ya.use_angular_limit_y=
cb.use_angular_limit_y;Ya.use_angular_limit_z=cb.use_angular_limit_z;Ya.limit_max_x=cb.limit_max_x;Ya.limit_min_x=cb.limit_min_x;Ya.limit_max_y=cb.limit_max_y;Ya.limit_min_y=cb.limit_min_y;Ya.limit_max_z=cb.limit_max_z;Ya.limit_min_z=cb.limit_min_z;Ya.limit_angle_max_x=cb.limit_angle_max_x;Ya.limit_angle_min_x=cb.limit_angle_min_x;Ya.limit_angle_max_y=cb.limit_angle_max_y;Ya.limit_angle_min_y=cb.limit_angle_min_y;Ya.limit_angle_max_z=cb.limit_angle_max_z;Ya.limit_angle_min_z=cb.limit_angle_min_z;
x(tb,jb,Ta,Ab,Za,Gc,uc,Ya,null,null)}}}};a.Lw=h;a.update=function(){for(var a=0;a<Z.length;a++){var b=Z[a],c=b.l;if(c.Ve&&c.Hl){var d=performance.now()/1E3-c.Hl,d=Math.min(d,10/J.gd),d=d-1/J.gd;R.zy&&(d=0);var e=ia;H.Ux(c.Il,d,c.Qq,c.yo,ia);C.Hz(b,e);C.A(b);r(b);if(b.i)for(var c=b,d=c.i.dg,e=c.d.ub,f=ia,g=0;g<d.length;g++){var k=d[g];H.multiply(e,c.i.Bi[g],f);C.set_tsr(k,f);C.A(k)}b.i&&b.i.sh&&(c=b.i,d=c.sh)&&(e=b.i.os,k=fa,f=b.d.g,g=b.d.quat,K.Ln(b.i.ps,g,f,k),K.Wg(k,d.d.g),K.matrix_to_quat(k,d.d.quat),
k=ha,K.Mn(e,g,f,k),e=ma,v.setAxisAngle(k,-c.rh*c.An*2*Math.PI,e),v.multiply(e,d.d.quat,d.d.quat),C.A(d));b.i&&b.i.xn&&(c=b.i,d=c.xn)&&(f=b.i.js,e=fa,g=b.d.g,k=b.d.quat,K.Ln(b.i.ks,k,g,e),K.Wg(e,d.d.g),K.matrix_to_quat(e,d.d.quat),e=ha,K.Mn(f,k,g,e),f=ma,g=Math.abs(c.speed)*c.hs,g>c.Qm&&(g=c.Qm),v.setAxisAngle(e,-g,f),v.multiply(f,d.d.quat,d.d.quat),C.A(d));b.i&&b.i.En&&(c=b.i,d=c.En)&&(e=b.i.vs,k=fa,f=b.d.g,g=b.d.quat,K.Ln(b.i.ws,g,f,k),K.Wg(k,d.d.g),K.matrix_to_quat(k,d.d.quat),b=ha,K.Mn(e,g,f,b),
e=ma,v.setAxisAngle(b,-Math.abs(c.Ig)*c.vp,e),v.multiply(e,d.d.quat,d.d.quat),C.A(d))}}if(a=U)a=L.ia(a,"MAIN_OPAQUE"),a.Ua&&0<a.Ua.waves_height&&(b=G.length(a.Ui),y.s(y.Tt,a.time*b))};a.fx=function(){return U};a.pause=function(){U&&y.s(y.Gt)};a.resume=function(){U&&y.s(y.Jt)};a.enable_simulation=function(a){a=a.l;if(!a)throw"No object physics";if(!a.Ve){var b=a.N;a.Ve=!0;y.s(y.Et,b)}};a.disable_simulation=function(a){a=a.l;if(!a)throw"No object physics";if(a.Ve){var b=a.N;a.Ve=!1;y.s(y.Dt,b)}};a.has_physics=
function(a){return a.l?!0:!1};a.has_dynamic_physics=function(a){return(a=a.l)&&a.Ve&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.Nm&&0==a.Vj?!0:!1};a.has_simulated_physics=function(a){return(a=a.l)&&a.Ve?!0:!1};a.set_gravity=function(a,b){y.s(y.St,a.l.N,b)};a.Ox=k;a.apply_constraint=x;a.clear_constraint=function(a){a=a.l;y.s(y.It,a.zj);a.zj=null};a.pull_to_constraint_pivot=function(b,c,d,e,f,g){c=H.create_sep(c,1,d,ia);f=H.create_sep(f,1,g,S);H.invert(c,c);H.multiply(f,c,c);C.get_tsr(e,f);H.multiply(f,
c,c);C.set_tsr(b,c);C.A(b);a.set_transform(b,b.d.g,b.d.quat)};a.set_transform=function(a,b,c){H.set_sep(a.d.g,1,a.d.quat,a.l.Il);var d=y.bq(y.aj);d.body_id=a.l.N;d.trans=b;d.quat=c;y.s(y.aj,d)};a.sync_transform=r;a.apply_velocity=function(a,b,c,d){q(a,b,c,d,w);a=a.l.N;y.s(y.Bd,a);b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var e=Math.abs(w[0]),f=Math.abs(w[1]),g=Math.abs(w[2]);w[0]=e?w[0]/e*Math.max(e,b):0;w[1]=f?w[1]/f*Math.max(f,c):0;w[2]=g?w[2]/g*Math.max(g,d):0;y.s(y.mo,a,w[0],w[1],w[2])};a.apply_velocity_world=
function(a,b,c,d){a=a.l.N;y.s(y.Bd,a);y.s(y.mo,a,b,c,d)};a.apply_force=function(a,b,c,d){q(a,b,c,d,w);a=a.l.N;y.s(y.Bd,a);y.s(y.wt,a,w[0],w[1],w[2])};a.apply_torque=function(a,b,c,d){q(a,b,c,d,w);a=a.l.N;y.s(y.Bd,a);y.s(y.yt,a,w[0],w[1],w[2])};a.set_character_move_dir=function(a,b,c){a=a.l.N;y.s(y.Bd,a);y.s(y.Mt,a,b,c)};a.set_character_move_type=function(a,b){y.s(y.Nt,a.l.N,b)};a.set_character_walk_velocity=function(a,b){y.s(y.Rt,a.l.N,b)};a.set_character_run_velocity=function(a,b){y.s(y.Pt,a.l.N,
b)};a.set_character_fly_velocity=function(a,b){y.s(y.Kt,a.l.N,b)};a.character_jump=function(a){y.s(y.zt,a.l.N)};a.character_rotation_inc=function(a,b,c){y.s(y.At,a.l.N,b,c)};a.set_character_rotation=function(a,b,c){y.s(y.Ot,a.l.N,b,c)};a.set_character_rotation_h=function(a,b){y.s(y.Lt,a.l.N,b)};a.set_character_rotation_v=function(a,b){y.s(y.Qt,a.l.N,b)};a.bC=function(){return!1};a.$B=function(){return!1};a.YB=function(){F.error("check_collision() deprecated");return!1};a.ZB=function(){F.error("check_collision_any() deprecated");
return!1};a.aC=function(){F.error("check_ray_hit() deprecated");return!1};a.SD=function(){F.error("update_object_coords() deprecated")};a.append_collision_test=function(a,b,c,d){var e=a.l,f=e.N;b=b||"ANY";for(var g=0;g<e.Zc.length;g++){var k=e.Zc[g];if(k.gc==b&&k.callback==c)return}g=[];a=a.l.N;k=[];z(b,U,k,null);for(var h=0;h<k.length;h++){var l=k[h];a<l?g.push([a,l]):a>l&&g.push([l,a])}k={gc:b,callback:c,ok:g,xr:new Uint8Array(g.length),Vm:d||!1};e.Zc.push(k);y.s(y.Bd,f);y.s(y.qt,g,d)};a.remove_collision_test=
function(a,b,c){a=a.l;b=b||"ANY";for(var d=0;d<a.Zc.length;d++){var e=a.Zc[d];if(e.gc==b&&e.callback==c){a.Zc.splice(d,1);d--;for(var e=e.ok,f=U.l.p,g=0;g<f.length;g++)for(var k=f[g].sb,h=0;h<k.Zc.length;h++)for(var l=k.Zc[h],m=0;m<l.ok.length;m++)for(var n=l.ok[m],q=0;q<e.length;q++){var r=e[q];n[0]===r[0]&&n[1]===r[1]&&(e.splice(q,1),q--)}e.length&&y.s(y.Ht,e)}}};a.apply_collision_impulse_test=function(a,b){var c=a.l;c?(y.s(y.xt,c.N),c.xj=b):F.error("Object "+a.name+" has no physics")};a.clear_collision_impulse_test=
function(a){var b=a.l;b?(y.s(y.Bt,b.N),b.xj=null):F.error("Object "+a.name+" has no physics")};a.append_ray_test=function(a,b,c,d,e,f){var g=a.l;if(g){a=g.N;b=b||"ANY";c={K:new Float32Array(c),ca:new Float32Array(d),local:e,callback:f,gc:b,be:{}};z(b,U,null,c.be);delete c.be[a];for(var k in c.be)c.be[k]=1;g.Ne.push(c);E(a,g.Ne)}else F.error("Object "+a.name+" has no physics")};a.remove_ray_test=function(a,b,c,d,e){if(b=a.l){a=b.N;for(var f=0;f<b.Ne.length;f++){var g=b.Ne[f];K.wj(g.K,c)&&K.wj(g.ca,
d)&&g.local==e&&(b.Ne.splice(f,1),f--)}E(a,b.Ne)}else F.error("Object "+a.name+" has no physics")};a.vehicle_throttle=function(a,b){var c=a.i;c.Ig=b;A(a,c)};a.vehicle_steer=function(a,b){var c=a.i;c.rh=b;A(a,c)};a.vehicle_brake=function(a,b){var c=a.i;c.Oh=b;A(a,c)};a.is_vehicle_chassis=n;a.is_vehicle_hull=u;a.Xx=function(a){if(!a.b4w_vehicle)return!1;a=a.b4w_vehicle_settings.part;return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==a?!0:!1};a.Wx=function(a){return a.b4w_vehicle?
"BOB"==a.b4w_vehicle_settings.part?!0:!1:!1};a.Zx=function(a){return a.b4w_floating?"BOB"==a.b4w_floating_settings.part?!0:!1:!1};a.Fq=function(a){return a.b4w_vehicle&&"STEERING_WHEEL"==a.b4w_vehicle_settings.part?!0:!1};a.Eq=function(a){return a.b4w_vehicle&&"SPEEDOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.Gq=function(a){return a.b4w_vehicle&&"TACHOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.get_vehicle_speed=function(a){return a.i.speed};a.lB=function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;
case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};a.is_character=e;a.fD=O;a.vx=function(){return V};a.jw=function(){y.s(y.Ct)};a.$y=function(a){var b=Z.indexOf(a);-1!=b?(Z.splice(b,1),a.l&&delete T[a.l.N]):F.error("Object ",a.name," doesn't have bounding physics")}};b4w.module.__data=function(a,p){function c(a,b){for(var c=fa(a,b.id),d=0;d<c.length;d++){var e=c[d];"MESH"==e.type&&delete e.data.submeshes}ja[b.id]=null;Va[b.id]=null}function b(a,b,c){var d;a instanceof ArrayBuffer&&(a=B.hq(a));d=a.width;a=a.height;Q.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(za)&&c&&Q.warn("image",b,"is not from app root.")}function h(a,b,c,d,e,g){d=b.r;if(!d)throw"Nothing requested";oa.enqueue([[d,oa.AT_JSON,d]],function(d,
g,k,B){if(d){Q.log("%cLOAD METADATA","color: #616",B);f(d);for(var h in d)a[h]=d[h];(d=a.binaries[0].binfile)?b.Lo=d:(na.bs(b,"load_binaries"),na.bs(b,"prepare_bindata"));if(a.b4w_export_errors)for(d=0;d<a.b4w_export_errors.length;d++)Q.Cw(a.b4w_export_errors[d]);if(a.b4w_export_warnings)for(d=0;d<a.b4w_export_warnings.length;d++)Q.Dw(a.b4w_export_warnings[d]);e(b,c)}else b.Sq(b.id,!1)},null,function(a){g(b,c,a)})}function d(a,b,c,d,e,f){d=aa(b.r)+b.Lo;if(!d)throw"Binary data is missing";oa.enqueue([[d,
oa.AT_ARRAYBUFFER,d]],function(d,f,g,k){d&&(Q.log("%cLOAD BINARY","color: #616",k),a.bin_data=d,e(b,c))},null,function(a){f(b,c,a)})}function f(a){var b=Ja.Sm.split(".").map(function(a){return a|0}),c=a.b4w_format_version.split(".").map(function(a){return a|0});c[0]<b[0]&&Fa.ma("Incompatible file version: "+a.b4w_format_version+", required: "+Ja.Sm+". Reexport scene with the latest B4W addon to fix it.");c[1]<b[1]&&Q.warn("Version mismatch. File version: "+ +a.b4w_format_version+", required: "+Ja.Sm+
". Some compatibility issues can occur. Reexport scene with the latest B4W addon to fix it.")}function l(a,b,c,d,e){d=a.bin_data;var f=a.binaries[0],k=a.objects,B=a.meshes;a=a.actions;for(var h=Fa.hv(),l=["indices"],m=["normal","tangent"],n=["color","group"],W=["position","texcoord","texcoord2"],q=0;q<B.length;q++)for(var r=B[q].submeshes,x=0;x<r.length;x++)for(var t in r[x]){var u=r[x][t][1];if(-1!=l.indexOf(t)){var z=4*r[x][t][0]+f["int"],v=r[x],p=t,na=d;if(h)var A=new Uint32Array(na,z,u);else for(var A=
new Uint32Array(u),na=new DataView(na),w=0;w<u;w++)A[w]=na.getUint32(z+4*w,!0);v[p]=A}else if(-1!=W.indexOf(t))z=4*r[x][t][0]+f["float"],r[x][t]=g(d,z,u,h);else if(-1!=m.indexOf(t)){z=2*r[x][t][0]+f["short"];v=r[x];p=t;na=d;A=new Float32Array(u);na=new DataView(na);for(w=0;w<u;w++)A[w]=na.getInt16(z+2*w,!0)/32767;v[p]=A}else if(-1!=n.indexOf(t)){z=2*r[x][t][0]+f.ushort;v=r[x];p=t;na=d;A=new Float32Array(u);na=new DataView(na);for(w=0;w<u;w++)A[w]=na.getUint16(z+2*w,!0)/65535;v[p]=A}}for(t=0;t<k.length;t++)for(B=
k[t].particle_systems,l=0;l<B.length;l++)m=B[l],m.transforms=g(d,4*m.transforms[0]+f["float"],m.transforms[1],h);for(k=0;k<a.length;k++){t=a[k];var B=t.fcurves,m=t.frame_range,l=m[0],m=m[1],n=qa.kx(l,m),W=null,r=q=!1,S;for(S in B)q|=-1<S.indexOf("rotation_euler"),r|=-1<S.indexOf("rotation_quaternion");for(S in B)if(q&&r&&-1<S.indexOf("rotation_euler"))delete B[S];else{var x=B[S],P;for(P in x)u=x[P],z=g(d,f["float"]+4*u.bin_data_pos[0],u.bin_data_pos[1],h),v=new Float32Array(n),null===W&&(W=new Int8Array(n)),
qa.Hu(u,z,v,W,l,m),u.ec=v;-1<S.indexOf("rotation_euler")&&qa.Kw(B,S)}t.cu=W}e(b,c)}function g(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d[e]=a.getFloat32(b+4*e,!0)}return d}function m(a,b,c,d,e){0===b.id&&(Wa=a);var f=a.cameras,g=a.groups,B=a.materials,h=a.meshes,l=a.node_groups,m=a.objects,W=a.particles,q=a.scenes,r=a.speakers,t=a.textures,u=a.worlds;l||(Q.warn('"node_groups" datablock undefined. reexport main scene.'),l=a.node_groups=
[]);for(var z="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),v={},p=0;p<z.length;p++)for(var na=a[z[p]],w=0;w<na.length;w++){var S=na[w];v[S.uuid]=S}for(var P=0;P<q.length;P++){for(var E=q[P],oa=E.objects,y=0;y<oa.length;y++)n(oa,y,v);E.camera&&n(E,"camera",v);E.world&&n(E,"world",v)}for(P=0;P<g.length;P++)for(var Y=g[P].objects,y=0;y<Y.length;y++)n(Y,y,v);for(P=0;P<m.length;P++){var N=m[P];N.dupli_group&&
n(N,"dupli_group",v);N.parent&&n(N,"parent",v);if(N.animation_data){var ga=N.animation_data;ga.action&&n(ga,"action",v);if(ga.nla_tracks)for(y=0;y<ga.nla_tracks.length;y++)for(var C=ga.nla_tracks[y],ba=0;ba<C.strips.length;ba++)C.strips[ba].action&&n(C.strips[ba],"action",v)}switch(N.type){case "MESH":if(!N.data)throw"mesh not found for object "+N.name;n(N,"data",v);for(var pa=N.modifiers,y=0;y<pa.length;y++){var G=pa[y];"ARMATURE"==G.type?n(G,"object",v):"CURVE"==G.type&&n(G,"object",v)}var J=N.particle_systems;
if(J)for(y=0;y<J.length;y++)n(J[y],"settings",v);break;case "ARMATURE":n(N,"data",v);for(var F=N.pose.bones,I=N.data.bones,y=0;y<F.length;y++){var la=F[y];la.bone=I[la.bone];for(var O=la.parent_recursive,ba=0;ba<O.length;ba++)O[ba]=F[O[ba]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":n(N,"data",v)}var R=N.constraints;if(R)for(y=0;y<R.length;y++){var L=R[y];L.target&&n(L,"target",v)}var M=N.lod_levels;if(M)for(y=0;y<M.length;y++){var ya=M[y];ya.object&&n(ya,"object",v)}}for(P=0;P<h.length;P++)for(var D=
h[P].materials,y=0;y<D.length;y++)n(D,y,v);for(P=0;P<B.length;P++){for(var T=B[P],Ia=T.texture_slots,y=0;y<Ia.length;y++)n(Ia[y],"texture",v);var V=T.node_tree;V&&A(V,v)}for(P=0;P<l.length;P++)(V=l[P].node_tree)&&A(V,v);for(P=0;P<t.length;P++){var aa=t[P],ca=aa.type;"IMAGE"!=ca&&"ENVIRONMENT_MAP"!=ca||n(aa,"image",v)}for(P=0;P<f.length;P++){var ta=f[P];ta.dof_object&&n(ta,"dof_object",v)}for(P=0;P<r.length;P++){var Za=r[P];Za.sound&&n(Za,"sound",v);if(Za.animation_data&&(ga=Za.animation_data,ga.action&&
n(ga,"action",v),ga.nla_tracks))for(y=0;y<ga.nla_tracks.length;y++)for(C=ga.nla_tracks[y],ba=0;ba<C.strips.length;ba++)C.strips[ba].action&&n(C.strips[ba],"action",v)}for(P=0;P<W.length;P++){for(var tb=W[P],Ia=tb.texture_slots,y=0;y<Ia.length;y++)n(Ia[y],"texture",v);tb.dupli_group&&n(tb,"dupli_group",v);tb.dupli_object&&n(tb,"dupli_object",v)}for(P=0;P<u.length;P++)if(Ia=u[P].texture_slots)for(y=0;y<Ia.length;y++)n(Ia[y],"texture",v);La.ev(a);for(var Ta=a.textures,Ab=k(a)?a.scenes[0].b4w_anisotropic_filtering:
x().b4w_anisotropic_filtering,Da=0;Da<Ta.length;Da++)k(a)||"SCENE"!=Ta[Da].b4w_source_type||(Ta[Da].b4w_source_id=""),ua.aw(Ta[Da],Ab,a.scenes);for(var lb={},U=a.objects,ha=0;ha<U.length;ha++){var ja=U[ha];if("MESH"===ja.type&&!ja.particle_systems.length)for(var ma=ja.data,Pb=ma.name,Z=ma.submeshes,Ea=ma.materials,mb=0;mb<Z.length;mb++)0!==Z[mb].base_length||lb[Pb]||(Ea[mb]&&Q.warn('material "'+Ea[mb].name+'" is not assigned to any face (object "'+ja.name+'").'),lb[Pb]=!0)}for(var sa=a.meshes,za=
0;za<sa.length;za++){var Va=sa[za];Va.materials.length||Va.uv_textures.length&&Q.warn('mesh "'+Va.name+'" has a UV map but has no exported material.')}a.materials.push({name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,
emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",
use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]});for(var ab=a.meshes,Ma=Fa.keysearch("name","DEFAULT",a.materials),Pa=0;Pa<ab.length;Pa++){var Kb=ab[Pa];0==Kb.materials.length&&Kb.materials.push(Ma)}for(var Eb=a.actions,Vb=b.id,hc=0;hc<Eb.length;hc++){var Ob=Eb[hc];Ob.eu=Vb;qa.nu(Ob)}for(var xc=a.scenes,pc=0;pc<xc.length;pc++){for(var ic=xc[pc],
Jc=ra.Al(ic,"ALL"),Oc=[],Bb=0;Bb<Jc.length;Bb++)for(var Ub=Jc[Bb].particle_systems,rb=0;rb<Ub.length;rb++){var Cb=Ub[rb].settings;if("HAIR"==Cb.type)if("OBJECT"==Cb.render_type)Ga.Pn(Cb.dupli_object,!0);else if("GROUP"==Cb.render_type){for(var yc=Cb.dupli_group,$c=ra.Al(ic,"EMPTY"),bc=0;bc<$c.length;bc++)$c[bc].dupli_group==yc&&Oc.push($c[bc]);for(bc=0;bc<yc.objects.length;bc++)Ga.Pn(yc.objects[bc],!0)}else Q.warn("render type",Cb.render_type,"not supported for particle systems ("+Cb.name+").")}for(Bb=
0;Bb<Oc.length;Bb++)K(Oc[Bb],[ic])}ia(a,b.id);for(var Kc=a.scenes,ad=0;ad<Kc.length;ad++){for(var rd=Kc[ad],qc=[],zc=[],Pc=Kc[ad].objects,Db=0;Db<Pc.length;Db++){var Lc=Pc[Db];H(Pc,Lc,qc,zc);var bd=Lc.dupli_group;if(bd)for(var Ac=bd.objects,Qc=0;Qc<Ac.length;Qc++)H(Ac,Ac[Qc],qc,zc)}for(Db=0;Db<zc.length;Db++)K(zc[Db],[rd]);for(Db=0;Db<qc.length;Db++)Fa.Bu(qc[Db][0],qc[Db][1])}ia(a,b.id);var fb=fa(a,b.id);La.Lu(fb,a.scenes);for(Da=0;Da<fb.length;Da++){var Bc=fb[Da];!k(a)&&Bc.parent&&-1<Wb.indexOf(Bc.parent.type)&&
(Bc.parent="");Ga.Pn(Bc,!1);Bc.d.ad=b.id}for(var Rc=0;Rc<fb.length;Rc++){var Cc=fb[Rc];if("MESH"==Cc.type){var cd=qa.get_first_armature_object(Cc);if(cd){var Mc=cd.d;if(Mc.pe){var Sc=Cc.d.Bc,dd=[],Tc;for(Tc in Sc){var pd=Sc[Tc];dd.push(4*pd.Th,4*pd.Qo)}Mc.Vq.push(dd)}Mc.Ck.push(Cc.d)}}}for(var ed=-1,Ib=0;Ib<fb.length;Ib++){var Dc=fb[Ib],Jb=Dc.d;if(Fa.is_mesh(Dc)&&Jb.li){var Nc=Jb.Pc;Nc>ed&&(ed=Nc)}}for(Ib=0;Ib<fb.length;Ib++)if(Dc=fb[Ib],Jb=Dc.d,Fa.is_mesh(Dc)&&Jb.li){Jb.Pc=ed;var fd=Dc,Ec=Jb.Pc,
gd=Ja.Pc,Uc=fd.d;Ec>2*gd?Fa.ma('too many bones for "'+fd.name+'"'):Ec>gd?(Q.warn('too many bones for "'+fd.name+'" / '+Ec+" bones (max "+gd+"). Blending between frames will be disabled."),Uc.ai=!1):Uc.ai=!0;Uc.ai=Uc.ai&&!va.Pp}for(var qd=0;qd<fb.length;qd++){var jc=fb[qd];if(Fa.is_mesh(jc)){var wd=jc.lod_levels.length;if(wd)for(var id=jc,Fc=0;Fc<wd;Fc++){var Vc=jc.lod_levels[Fc].object;if(!Vc){id.d.Yj=!0;id.d.He=jc.lod_levels[Fc].distance;break}Vc.d.Tf=jc.d.Tf;id.d.He=jc.lod_levels[Fc].distance;Vc.d.pi=
jc.lod_levels[Fc].distance;if(jc.lod_levels[Fc+1])Vc.d.He=jc.lod_levels[Fc+1].distance;else{Vc.d.Yj=!0;Vc.d.He=1E4;break}id.d.Yj=!1;id=Vc}}}for(var sd=0;sd<fb.length;sd++){var ka=fb[sd];if(ka.b4w_vehicle){var gb=ka.b4w_vehicle_settings;if("CHASSIS"==gb.part){ka.i={};ka.i.Np=gb.force_max;ka.i.Ro=gb.brake_max;ka.i.oA=gb.suspension_compression;ka.i.qA=gb.suspension_stiffness;ka.i.pA=gb.suspension_damping;ka.i.kB=gb.wheel_friction;ka.i.CD=gb.roll_influence;ka.i.sy=gb.max_suspension_travel_cm;ka.i.Ig=
0;ka.i.Oh=1;ka.i.rh=0;ka.i.speed=0;ka.i.dg=[];ka.i.Bi=[];ka.i.sh=null;for(var xd=ka.ua?ka.ua.dupli_group.objects:fb,Wc=0;Wc<xd.length;Wc++){var Ua=xd[Wc];if(Ua.b4w_vehicle){var kb=Ua.b4w_vehicle_settings;if(da.Xx(Ua)&&gb.name==kb.name){var yd=da.lB(Ua.b4w_vehicle_settings.part);ka.i.dg[yd]=Ua;ka.i.Bi[yd]=new Float32Array(8)}else if(da.Fq(Ua)&&gb.name==kb.name){ka.i.sh=Ua;ka.i.An=kb.steering_max;ka.i.ns=kb.steering_ratio;ka.i.Aq=kb.inverse_control;var ub=$a.invert(ka.d.T,new Float32Array(16)),kd=$a.multiply(ub,
Ua.d.T,ub);ka.i.ps=kd;var Xc=new Float32Array([1,0,0,0]);nb.transformMat4(Xc,kd,Xc);ka.i.os=Xc}else if(da.Eq(Ua)&&gb.name==kb.name){ka.i.xn=Ua;ka.i.hs=kb.speed_ratio;ka.i.Qm=kb.max_speed_angle;var ub=$a.invert(ka.d.T,new Float32Array(16)),ld=$a.multiply(ub,Ua.d.T,ub);ka.i.ks=ld;var Yc=new Float32Array([1,0,0,0]);nb.transformMat4(Yc,ld,Yc);ka.i.js=Yc}else if(da.Gq(Ua)&&gb.name==kb.name){ka.i.En=Ua;ka.i.vp=kb.delta_tach_angle;var ub=$a.invert(ka.d.T,new Float32Array(16)),md=$a.multiply(ub,Ua.d.T,ub);
ka.i.ws=md;var Zc=new Float32Array([1,0,0,0]);nb.transformMat4(Zc,md,Zc);ka.i.vs=Zc}}}if(4!=ka.i.dg.length)throw"Not enough wheels for chassis "+ka.name;}else if("HULL"==gb.part){ka.i={};ka.i.dg=[];ka.i.Bi=[];ka.i.Np=gb.force_max;ka.i.Ro=gb.brake_max;ka.i.Yl=gb.floating_factor;ka.i.Xn=gb.water_lin_damp;ka.i.Yn=gb.water_rot_damp;ka.i.Ig=0;ka.i.Oh=1;ka.i.rh=0;ka.i.speed=0;ka.i.sh=null;for(var zd=ka.ua?ka.ua.dupli_group.objects:fb,Wc=0;Wc<zd.length;Wc++)Ua=zd[Wc],Ua.b4w_vehicle&&(kb=Ua.b4w_vehicle_settings,
da.Wx(Ua)&&gb.name==kb.name?(ka.i.dg.push(Ua),ka.i.Bi.push(new Float32Array(8))):da.Fq(Ua)&&gb.name==kb.name?(ka.i.sh=Ua,ka.i.An=kb.steering_max,ka.i.ns=kb.steering_ratio,ka.i.Aq=kb.inverse_control,ub=$a.invert(ka.d.T,new Float32Array(16)),kd=$a.multiply(ub,Ua.d.T,ub),ka.i.ps=kd,Xc=new Float32Array([1,0,0,0]),nb.transformMat4(Xc,kd,Xc),ka.i.os=Xc):da.Eq(Ua)&&gb.name==kb.name?(ka.i.xn=Ua,ka.i.hs=kb.speed_ratio,ka.i.Qm=kb.max_speed_angle,ub=$a.invert(ka.d.T,new Float32Array(16)),ld=$a.multiply(ub,Ua.d.T,
ub),ka.i.ks=ld,Yc=new Float32Array([1,0,0,0]),nb.transformMat4(Yc,ld,Yc),ka.i.js=Yc):da.Gq(Ua)&&gb.name==kb.name&&(ka.i.En=Ua,ka.i.vp=kb.delta_tach_angle,ub=$a.invert(ka.d.T,new Float32Array(16)),md=$a.multiply(ub,Ua.d.T,ub),ka.i.ws=md,Zc=new Float32Array([1,0,0,0]),nb.transformMat4(Zc,md,Zc),ka.i.vs=Zc))}}}for(var td=0;td<fb.length;td++){var rc=fb[td];if(rc.b4w_floating){var nd=rc.b4w_floating_settings;if("MAIN_BODY"==nd.part){rc.zc={};rc.zc.Yl=nd.floating_factor;rc.zc.Xn=nd.water_lin_damp;rc.zc.Yn=
nd.water_rot_damp;rc.zc.nj=[];for(var Ad=rc.ua?rc.ua.dupli_group.objects:fb,ud=0;ud<Ad.length;ud++){var hd=Ad[ud];if(hd.b4w_floating){var Bd=hd.b4w_floating_settings;da.Zx(hd)&&nd.name==Bd.name&&(rc.zc.nj.push(hd),hd.Vu=hd.b4w_floating_settings.synchronize_position)}}}}}for(Da=0;Da<a.scenes.length;Da++){var vd=a.scenes[Da];ob.enabled&&vd.b4w_enable_physics&&(k(a)||!da.has_physics(x())&&vd==ra.Wl(a))&&da.Tx(vd)}e(b,c)}function k(a){return a==Wa?!0:!1}function x(){return ra.Wl(Wa.scenes)}function r(a,
b,c,d,e){!k(a)&&1<a.scenes.length&&(a.scenes=[ra.Wl(a.scenes)],Q.warn("loading data contains multiple scenes.","Only the first one will be loaded."));d=x();-1==va.Ia&&(va.Ia=d.fps);for(var f=0;f<a.scenes.length;f++){var g=a.scenes[f];if(k(a)&&!g.camera)throw"Scene check failed: No camera";for(var B=ra.Al(g,"MESH"),h=0;h<B.length;h++){var l=B[h],m=La.Eu(l);m&&(a.meshes.push(m),l.data=m)}for(var h=fa(a,b.id),l=a.meshes,m=l.slice(0),n=0;n<h.length;n++){var W=h[n];"MESH"==W.type&&(W=m.indexOf(W.data),
-1<W&&m.splice(W,1))}for(n=0;n<m.length;n++)l.splice(l.indexOf(m[n]),1);k(a)?(ra.su(g,a.textures),g.d.Dh.length&&(b.rm=!0),g.b4w_enable_audio&&ta.Fo(g),h=ra.im(g),l=g.b4w_batch_grid_size):(ra.yu(g,d,a.textures),g.b4w_enable_audio&&!d.h&&ta.Fo(d),h=ra.im(d),l=d.b4w_batch_grid_size);m=[];ya.bx(h,l,B,d.d.bo,d.d.Dk,m,d.d.Kq);k(a)?(ra.xo(g,m),ra.Vw(h)):ra.xo(d,m)}d=a.materials;if(Ea.Kl&&Ja.Gs)for(a=0;a<d.length;a++){B=d[a];h=B.texture_slots;for(f=0;f<h.length;f++)if(l=h[f],m=l.texture,"IMAGE"==m.type||
"ENVIRONMENT_MAP"==m.type)g=m.image,g.dc||(-1<g.filepath.indexOf(".dds")?g.dc=!0:(g.dc=!m.b4w_disable_compression&&!l.use_map_normal&&"ENVIRONMENT_MAP"!=m.type&&!m.b4w_shore_dist_map&&"MOVIE"!=g.source,g.dc&&(g.filepath+=".dds")));if(f=B.node_tree)for(B=f.nodes,f=0;f<B.length;f++)g=B[f],"TEXTURE"==g.type&&(h=g.texture)&&(g=h.image)&&!g.dc&&(g.dc=h.d.fj&&!h.b4w_disable_compression&&"MOVIE"!=g.source,g.dc&&(g.filepath+=".dds"))}else for(a=a.images,d=0;d<a.length;d++)f=a[d],f.dc=Boolean("FILE"==f.source&&
-1<f.filepath.indexOf(".dds"));e(b,c)}function q(a,b,c,d,e){d=a.groups;a=a.objects;for(var f={},g={},k={},B={},h=0;h<d.length;h++){var l=d[h];f[l.uuid]=l;k[l.uuid]=l}for(h=0;h<a.length;h++)l=a[h],g[l.uuid]=l,B[l.uuid]=l;z(a,null,B,k);for(var m in k)m in f||d.push(k[m]);for(m in B)m in g||a.push(B[m]);e(b,c)}function z(a,b,c,d){for(var e=[],f=0;f<a.length;f++){var g=a[f],k=c[g.uuid];if(g=k.proxy){b&&-1==e.indexOf(g.uuid)&&e.push(g.uuid);for(var B=c[g.uuid],h=B.constraints,g=0;g<h.length;g++){var l=
Fa.xf(h[g]);l.name+="_CLONE";k.constraints.push(l)}"b4w_proxy_inherit_anim"in k&&!k.b4w_proxy_inherit_anim||(k.animation_data&&(B.animation_data=Fa.xf(k.animation_data)),B.b4w_use_default_animation=k.b4w_use_default_animation,B.b4w_auto_skel_anim=k.b4w_auto_skel_anim,B.b4w_anim_behavior=k.b4w_anim_behavior,B.b4w_cyclic_animation=k.b4w_cyclic_animation)}}for(f=0;f<e.length;f++)k=Fa.jm(a,"uuid",e[f]),-1<k&&a.splice(k,1);e={};for(f=0;f<a.length;f++)g=a[f],k=c[g.uuid],b&&(h=Fa.xf(k),k="origin_name"in
k?k.origin_name:k.name,h.name=b+"*"+k,h.origin_name=k,E(h),c[h.uuid]=h,e[g.uuid]=h.uuid,g.uuid=h.uuid),k=c[g.uuid],k.dupli_group&&(g=k.dupli_group,h=d[g.uuid],B=Fa.xf(h),B.name=Fa.Jk(h.name+"_CLONE"),B.uuid=pa.uq("Group"+B.name),d[B.uuid]=B,g.uuid=B.uuid,z(B.objects,k.name,c,d));if(b)for(f=0;f<a.length;f++){g=a[f];k=c[g.uuid];k.parent&&k.parent.uuid in e?k.parent.uuid=e[k.parent.uuid]:k.parent&&(Q.warn("Object's \""+k.name+'" parent is not in dupli group. Disabling parenting.'),k.parent=null);h=k.constraints;
for(g=0;g<h.length;g++)b=h[g],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);b=k.modifiers;for(g=0;g<b.length;g++)d=b[g],d.object&&d.object.uuid in e&&(d.object.uuid=e[d.object.uuid]);if((k=k.lod_levels)&&k.length)for(g=0;g<k.length;g++)b=k[g],b.object&&b.object.uuid in e&&(b.object.uuid=e[b.object.uuid])}for(var m in e)ab[m]=e[m]}function E(a){a.uuid=pa.uq("Object"+a.name)}function A(a,b){for(var c=a.nodes,d=0;d<c.length;d++){var f=c[d];"TEXTURE"==f.type&&f.texture&&n(f,"texture",
b);"LAMP"==f.type&&f.lamp&&(f.lamp.uuid in ab&&(f.lamp.uuid=ab[f.lamp.uuid]),b[f.lamp.uuid]||(f.lamp=null));"GROUP"==f.type&&f.node_group&&n(f,"node_group",b)}f=a.links;for(d=0;d<f.length;d++){var g=f[d];u(g,"from_node",c);u(g,"to_node",c);e(g,"from_socket",g.from_node.outputs);e(g,"to_socket",g.to_node.inputs)}if(c=a.animation_data)if(c.action&&n(c,"action",b),c.nla_tracks)for(d=0;d<c.nla_tracks.length;d++)for(f=c.nla_tracks[d],g=0;g<f.strips.length;g++)f.strips[g].action&&n(f.strips[g],"action",
b)}function n(a,b,c){(c=c[a[b].uuid])||Q.error("Dangling link found:",b,a);a[b]=c}function u(a,b,c){c=Fa.keysearch("name",a[b].name,c);a[b]=c}function e(a,b,c){c=Fa.keysearch("identifier",a[b].identifier,c);a[b]=c}function O(a,c,d,e,f,g){if(!Ja.do_not_load_resources){for(var k=aa(c.r),B=a.images,h={},l=[],m=0;m<B.length;m++){var n=B[m],W=n.uuid;if("FILE"===n.source||"MOVIE"===n.source){var q=I(n,a.textures);if(!q.length)Q.warn("image ",n.name," has no users.");else if(!(q[0].b4w_shore_dist_map||"MOVIE"===
n.source&&Ja.Jp)){q=ha(k+n.filepath);if("FILE"===n.source){var r=n.dc?oa.AT_ARRAYBUFFER:oa.AT_IMAGE_ELEMENT;Ea.Rm&&Ja.Mk&&(q=oa.Li(q),"dds"==q[1]?(q=oa.Li(q[0]),q=q[0]+".min50."+q[1]+".dds"):q=q[0]+".min50."+q[1])}else"MOVIE"===n.source&&(Ja.Ic?(q=oa.Li(q),q=q[0]+".altconv.seq",r=oa.Xi):(q=oa.Li(q),r=ta.detect_video_container(q[1]),q=r!=q[1]?q[0]+".altconv."+r:q[0]+"."+r,r=oa.Yi));l.push([W,r,q]);h[W]=n}}}l.length?(e.vq=0,oa.enqueue(l,function(f,k,B,m){if(f){if(B==oa.Yi||B==oa.Xi){if(B==oa.Yi)var n=
f.videoWidth,W=f.videoHeight;else n=f.images[0].width,W=f.images[0].height;Q.log("%cLOAD VIDEO "+n+"x"+W,"color: #"+(2048<n||2048<W?"a00":1024<n||1024<W?"aa0":"0a0"),m);-1==m.indexOf(za)&&Q.warn("video",m,"is not from app root.")}else b(f,m,!0);k=h[k];m=I(k,a.textures);for(n=0;n<m.length;n++){var W=m[n],q=W.image.filepath;B==oa.Xi?(W.d.Tr=f.Ub,ua.Oi(W.d,f.images,k.dc,q)):ua.Oi(W.d,f,k.dc,q)}}f=++e.vq/l.length;g(c,d,f)},function(){Q.log("%cLOADED ALL IMAGES","color: #0a0");f(c,d)})):f(c,d)}}function I(a,
b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}function F(a,b,c,d,e,f){if(!Ja.do_not_load_resources){a=fa(a,b.id);for(var g=aa(b.r),k=[],B={},h=0;h<a.length;h++){var l=a[h];if(t(l)){var m=l.data.sound,n=m.uuid;"BACKGROUND_MUSIC"==ta.km(l)?(n=Fa.Tp(),b.qm=!0):"NONE"!=ta.km(l)&&Ja.yq&&(b.tm=!0);if(!(n in B)){B[n]=[];m=ha(g+m.filepath);switch(ta.fs(l)){case ta.Qk:var W=oa.AT_AUDIOBUFFER;break;case ta.co:W=oa.AT_AUDIO_ELEMENT}var m=oa.Li(m),q=ta.detect_audio_container(m[1]),
m=q!=m[1]?m[0]+".altconv."+q:m[0]+"."+q;k.push([n,W,m])}B[n].push(l)}}k.length?oa.enqueue(k,function(a,e,g,h){if(a)for(Q.log("%cLOAD SOUND","color: #0aa",h),-1==h.indexOf(za)&&Q.warn("sound",h,"is not from app root."),e=B[e],g=0;g<e.length;g++)ta.RA(e[g],a);a=++d.Uz/k.length;f(b,c,a)},function(){Q.log("%cLOADED ALL SOUNDS","color: #0aa");e(b,c)}):e(b,c)}}function t(a){return ta.Xd(a)&&ta.fs(a)!=ta.eo?!0:!1}function y(a,b){for(var c=ra.Da(a,"SPEAKER",ra.DATA_ID_ALL),d=0;d<c.length;d++){var e=c[d];
ta.Xd(e)&&(ta.is_cyclic(e)||b)&&ta.play_def(e)}}function L(a){a=a.d.Dh;for(var b=0;b<a.length;b++)Ja.Ic&&a[b].use_auto_refresh?a[b].d.jh=!0:a[b].d.Ja&&a[b].use_auto_refresh&&a[b].d.Ja.play()}function C(a,b,c,d,e){Ia.start();Q.log("%cSTART NLA","color: #0a0");e(b,c)}function H(a,b,c,d){if(b.lod_levels&&b.lod_levels.length)for(var e=b.lod_levels.length,f=0;f<e;f++){var g=b.lod_levels[f],k=g.object;if(k){var B=Fa.vj(k);B.name=b.name+"_LOD_"+String(f+1);E(B);B.lod_levels=[];c.push([a,B]);d.push(k);g.object=
B}}}function K(a,b){for(var c=0;c<b.length;c++){for(var d=b[c].objects,e=0;e<d.length;e++){var f=d[e].dupli_group;f&&(f=f.objects,g=f.indexOf(a),-1<g&&f.splice(g,1))}var g=d.indexOf(a);-1<g&&d.splice(g,1)}}function M(a,b,c,d,e){d=!0;for(var f=0;f<a.scenes.length;f++)if(!da.mv(a.scenes[f])){d=!1;break}d&&(e(b,c),Q.log("%cPHYSICS READY","color: #0a0"))}function G(a,b,c,d,e){d=x();for(var f=0;f<a.scenes.length;f++){var g=a.scenes[f],B=k(a)?da.has_physics(g):da.has_physics(d)||da.has_physics(g);k(a)||
(g=d);for(var h=0;h<Kb.length;h++)for(var l=ra.Da(g,Kb[h],ra.DATA_ID_ALL),m=0;m<l.length;m++){var n=l[m];n.d.ad==b.id&&ob.enabled&&B&&(da.append_object(n,g),b.Hm&&da.has_physics(n)&&da.disable_simulation(n))}}e(b,c)}function v(a,c,d,e,f){var g={};e=[];for(var k=a.scenes,B=0;B<a.scenes.length;B++){var h=k[B];if(h.d.Ua&&(h=h.d.Ua.Bk)&&"FILE"===h.source){var l=h.uuid,m=ha(aa(c.r)+h.filepath);e.push([l,h.dc?oa.AT_ARRAYBUFFER:oa.AT_IMAGE_ELEMENT,m]);g[l]=h}}e.length?oa.enqueue(e,function(c,d,e,f){if(c){b(c,
f,!0);d=g[d];f=I(d,a.textures);for(e=0;e<f.length;e++){var B=f[e];ua.Oi(B.d,c,d.dc,B.image.filepath)}for(e=0;e<k.length;e++)if(f=k[e],f.d.Ua.Bk===d){var h=c,l=document.createElement("canvas"),B=d.size[0],m=d.size[1];l.width=B;l.height=m;l=l.getContext("2d");l.drawImage(h,0,0);h=l.getImageData(0,0,B,m).data;l=new Float32Array(4);l[0]=1/16581375;l[1]=1/65025;l[2]=1/255;l[3]=1;for(var B=B*m,m=new Float32Array(B),n=0;n<B;n++)m[n]=l[1]*h[4*n+2]+l[2]*h[4*n+3];f.d.qn=m}}},function(){f(c,d)}):f(c,d)}function N(a,
c,d,e,f){if(Ja.antialiasing&&Ja.smaa){e=a.scenes[0];a=[];for(var g=["SMAA_EDGE_DETECTION","SMAA_BLENDING_WEIGHT_CALCULATION","SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"],k=0;k<g.length;k++){var B=ra.ia(e,g[k]);B&&a.push(B)}if(a.length){e=[];k=oa.AT_IMAGE_ELEMENT;e.push(["SEARCH_TEXTURE",k,ba.Mb.smaa_search_texture_path]);e.push(["AREA_TEXTURE",k,ba.Mb.smaa_area_texture_path]);for(k=0;k<a.length;k++)if(g=a[k],"SMAA_BLENDING_WEIGHT_CALCULATION"==g.type){a=g.na;for(k=0;k<a.length;k++)if(g=a[k],"u_search_tex"==
g.ca)var h=g.oa;else if("u_area_tex"==g.ca)var l=g.oa;break}e.length?oa.enqueue(e,function(a,c,d,e){a&&(b(a,e,!1),c="SEARCH_TEXTURE"==c?h:l,c.source="IMAGE",c.Jo=!0,ua.Oi(c,a,-1!=e.indexOf(".dds")?1:0,e),ua.on(c,ua.G,ua.G))},function(){f(c,d)}):f(c,d)}else f(c,d)}else f(c,d)}function J(a,b,c,d){for(c=0;c<a.scenes.length;c++){var e=a.scenes[c];k(a)||(e=x());for(var f=ra.Da(e,"LAMP",ra.DATA_ID_ALL),g=0;g<f.length;g++){var B=f[g];B.d.ad==b.id&&(b.Hm&&Fa.is_mesh(B)&&ra.hide_object(B),d.Zk.push({Sr:e,
obj:B}))}f=ra.Da(e,"ALL",ra.DATA_ID_ALL);for(g=0;g<f.length;g++)B=f[g],"LAMP"!=B.type&&B.d.ad==b.id&&(b.Hm&&Fa.is_mesh(B)&&ra.hide_object(B),d.Zk.push({Sr:e,obj:B}))}}function R(a,b,c,d,e,f){e=d.Zk;var g=d.dr;e.length?(a=e[g].obj,g=e[g].Sr,ra.append_object(g,a,!1),-1!=Eb.indexOf(a.type)&&g.b4w_enable_audio&&ta.append_object(a,g),ga.Bq(a)&&ga.append(a),d=++d.dr/e.length,"LAMP"==a.type&&ra.Tz(g)):d=1;f(b,c,d)}function V(a,b,c,d,e){if(k(a)){d=ra.Ax();for(var f=ra.fi(),g=0;g<d.length;g++){var B=d[g];
ra.Qy(B,f);B.b4w_use_nla&&Ia.OA(B,B.b4w_nla_cyclic)}ra.set_active(f)}else ra.Fs(x());a=fa(a,b.id);Ga.MA(a);e(b,c)}function ca(a,b,c,d,e){if(k(a))for(d=0;d<a.scenes.length;d++)a.scenes[d].b4w_use_nla||L(a.scenes[d]),y(a.scenes[d]);else a.scenes[0].b4w_use_nla||L(x()),y(x());e(b,c)}function U(a,b,c,d,e){Ja.Lf&&(b.rm||b.qm||b.tm)?sa||Z(a,e,b,c):e(b,c)}function Z(a,b,c,d){var e=Pa.canvas.parentElement;Vb=e.style.zIndex;e.style.zIndex="999";sa=document.createElement("div");sa.style.position="relative";
sa.style.height="88px";sa.style.width="88px";var f=Math.round(Pa.canvas.offsetWidth/2-44);sa.style.top=Math.round(Pa.canvas.offsetHeight/2-44).toString()+"px";sa.style.left=f.toString()+"px";sa.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAABYCAYAAABxlTA0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAhOSURBVHic7Z1tjFxVGcd/z1AKsbzotoW0IQqFhpSXFlugxbbGRkNSLJEQLVJttH7VEl8+oCYYExLFDxilJib6AWshtlterN20hkBKsNitpFVapB9YIzGBWEq3+IKCLf374Tx3587szGxn5577Mt1fcnN37r1zznP+c/a55557znOMkiDJgLnAADDT9+ktOQYwChwHTvh+tGl7zcyUp/3tsCIzlzQdWAwsA24CLs4o6X8ALwDDwEEz+19G6XZN7gJLugi4mSDqh4HzUqffBN6gXkPT++RvaKzhM5v2lwCzUmm+C/yRIPYfzOyfMcrVjlwE9n//lcAngQVALXV6hFD435vZ3zLK74PARwg/4lWpU6eBI8Au4Lk83Eh0gSUtBDYA8/3QaeAlYB8wbGbHIuc/myD0LcB11H/cEeBhM3sxZv7RBJZ0OfBF4EY/9CawDdhrZv+Kle8ENl0IrADuou5GDhKE/muMPDMXWNIs4PPAxz39t4FBYGeRN5s0fnO9HVgLzAAE7AG2ZP0flZnAkmrAOuBOYDpwEhgCBouqsRPhNXotsAY4l2DzDoLQ72WRRyYCS7oAuJfQKohWG2Lhfno9sIqgySHg+6WoGJIuk/QzSUOSHpF0TdE2TRZJ13gZhiT93FsjhRq0RNI2N2iTpEsKNSgDJM2S9GMv06CkGyf+Vnsm7SIk3QF8idDs2Qc8aGbv9GJMWZB0HvBVQttdhFbGE5NJq2uBJU0DvgJ8wg9tBR4ty7N /lkhaS/DNBjwDbDKzU7Ez/bL/+zwh6aNRMysBkpZK2u5l/lrszNZ4Ro9LujpqZiVC0ryUyHfGyuQGSTsk7ZS0PEomJcZr8k7ferrxtUp8rqSt/guuyzTxCiFpbap1cUZNuNpEF0iaAXwHuAB4HvhVb2ZWFzMbBH4HvA+4z58EO9JRYH/8vRe4DPgL8MN+bC10yY8IWswBviXpnE4XT1SDP0d44/AWcL+ZvZuJiRXGNbifoMlCQjOueyTNlvSk+5zrMrSxL/DH6p2u0ex213WqwesJPUzPm9lLmVtYcczsZUKn1rl0qMUtBZZ0BaFn6RSwOYaBfcIWQhfnKtdsHO1q8AbC4+Fvzez1SMZVHu+OHSJotaHVNeMElrSIcGP7L6GfIRqSdklaEDOPHBgkvLVZ7No10CCwv/1NfonHzeytyMatBg5JekjSwIRXlxDvlB/0jxtcw9ZIWumthl9KOj+2cWrkuKSN3ltXKSRNl/QL125l+lyzi7jV91sL6NsdAB4i1OjVOefdE/4yd5t/vDV9bkxgfyS+HngPeC4368azANhVQf+8lzDm43rXEmiswUuAacCfzezfORvXikr5Z/fFLxM0vCk5nhb4Ft8P52jXREwDNgKvVMQ/J9olWgaB3fAlfmx/zkadCVXxz4nAS3xwy1gNXkjognvVzI4WYdkZUmr/bGZ/B14FzgdugLrAy3xfJvfQiTL750TDZQA1bxgvbTpZBcrqnxMXu1SS1QijDGcCo2Y2Upxdk6Zs/nmEMFj8YmBOjSAuQNU7dUrhn/2NT6LlzBqNE0v6gTL450TLvhQYivfPiZYD/SpwQlH++awROCFv/9wgcHKTO97m4n4iL/+caHnW1OA0efjnlje5s6EGp4npnxtq8BQRqZGqzkUaUgCjwD3AQjPbnXHaiZajaYHL1mkSi1PAJmC+mcUasT7mdqdxdtXg3cA3zOxI5HwSLU+kBe7nGnyEIGzWrqAdYzW4RuqOl1PmeRLTz3 ZirOnbrzX4FPBT4LtmVkT7vq8FzsvPdqKlwHMLMiYr8vaznUi0PF4DjhH88ICkq9p/p7QU5Wdb4hoOEOIGvV7zHvix90iFWdY9ebRnJ0PyAnm/mSl5VB5uOll2dhNq7D0F3cQ60fCGPhH4EPAf4IqSz5g/AtxmZrcVfBNriaRLgcuBd4A/gQvs/14H/LoyuolS+dkOJNodSMLnpHvT9vm+TG6irH62HYl2iZakO5sPEAp0raQZZvZ2npa1oAzt2TPGZ31eS9DwheT4WA12QQ8TRF+Rt4EpSu1nO7AcOAc4nK6czR3uT/n+7mR0YI5Uxc+Ow7X6rH98Kn2uWeC9hKE/s4BPxTcNqJ6fbcXtBM1GCBq2R9Ki1JT9i2JaVfQwpyyQdKHqgaE6T+MC8FiOBwnjhe+OaVwF/WwrkuiBB1vFwWz30vNhQrSl1ZLmRDSu0vgk8DV4ZKpW17QU2ANl7iG0KL4Qy8A+IJkwv6ddcNFOr+2Tic4rpsIZjEchwuEqgkZb2l3XVmCf6Pykf/ymQlTVKRhzDd8mTALf0SlG50QDTx4hhOd+PyFGTd5t49KhEBXwPoImhwkataWjwGZ2GngAeA24EogbmK3k+HyWrwPzgKPA9zJptytEWE3aenf1nGBFkbTONdgu6UNZJ75Y0m88Tk0ZuzSjImm56oHp4pRf0h3+Cz4maV6UTEqIpCu9zEOSPtPNd7saXWlmvwaeJsxk/IGkm7v5fhXxMj5AKPOzZra9m+/3Gt5WwGYze6zbdKqApE8THrSS8LY/MbOT3aSRVYDmPYTYuqVYZaBXvDm6kfAg0VOA5l4NSYcYf7CE84a7RtKAlyWTEONZGJQOkr9ZFY4rLOlqL0NmQfJjLfPwLGGZhzeySD82PlRhPfAxMl7mYWqhkiosVJJGU0vtNJDnYlHHgEcJi0UVshyEQiy4FYSwvUnE1GotFtWMxi93dhJ4kTDgcH/ssWXeslnq2yKCK4CqL3eWRu0X7BPwC mGg3HDGC/Yt820+9XL234J9zajzkpNHCcEsTlBfZvJE02eoLzf5Ad/Sn+cCl6bS7P8lJ9uhqUVT80N9uuzv/wFReZvk3/McjgAAAABJRU5ErkJggg==')";
Ma=document.createElement("div");Ma.style.position="relative";Ma.style.height=Pa.canvas.offsetHeight.toString()+"px";Ma.style.width=Pa.canvas.offsetWidth.toString()+"px";Ma.style.background="rgba(0, 0, 0, 0.5)";Ma.style.zIndex="999";e.appendChild(Ma);Ma.appendChild(sa);sa.addEventListener("click",function(){c.rm&&(ua.play(),ua.pause(),ua.reset());if(c.qm){if(k(a))for(var e=0;e<a.scenes.length;e++)y(a.scenes[e],!0);else y(x(),!0);ta.pause()}c.tm&&ta.Ly();T();b(c,d)},!1)}function T(){if(sa){var a=Pa.canvas.parentElement;
a.style.zIndex=Vb;Ma.removeChild(sa);a.removeChild(Ma);sa=Ma=null;Vb=0}}function aa(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function w(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}function ha(a){var b=a.split("://",2);
return 1<b.length?(b[1]=w(b[1]),b.join("://")):w(a)}function ma(a,b,c){qa.is_animated(b)&&qa.remove(b);ra.clear_outline_anim(b);da.has_physics(b)&&(da.disable_simulation(b),da.$y(b));Y.check_sensor_manifold(b)&&Y.remove_sensor_manifold(b);ra.az(a,b,c);ta.Xd(b)&&ta.Wz(b);ga.Bq(b)&&ga.remove(b)}function fa(a,b){Va[b]||ia(a,b);return Va[b]}function ia(a,b){for(var c=a.scenes,d=[],e=0;e<c.length;e++)S(c[e].objects,0,k(a),d);Va[b]=[];for(e=0;e<d.length;e++)for(var c=d[e],f=0;f<c.length;f++)for(var g=c[f],
B=0;B<g.length;B++)Va[b].push(g[B])}function S(a,b,c,d){d[b]=d[b]||[];for(var e=d[b],f=0;f<a.length;f++){var g=a[f],k=P(g);e[k]=e[k]||[];(c||-1==Wb.indexOf(g.type))&&-1==e[k].indexOf(g)&&e[k].push(g);(g=g.dupli_group)&&S(g.objects,b+1,c,d)}}function P(a){return(a=a.parent||qa.get_first_armature_object(a))?1+P(a):0}var ga=p("__anchors"),qa=p("__animation"),ya=p("__batch"),ba=p("__config"),Y=p("__controls"),B=p("__dds"),W=p("__extensions");p("__lights");var na=p("__loader"),oa=p("__assets"),pa=p("__md5"),
Ga=p("__objects"),da=p("__physics"),Q=p("__print"),La=p("__reformer"),la=p("__renderer"),ra=p("__scenes"),Ia=p("__nla"),ta=p("__sfx"),lb=p("__shaders"),ua=p("__textures"),mb=p("__nodemat"),Fa=p("__util"),nb=p("vec4"),$a=p("mat4"),Ja=ba.q,Ea=ba.Id,ob=ba.sb,va=ba.Hd,Pb=ba.Tc,ja=null,Va=null,za="",Wa=!1,ab={},sa=null,Ma=null,Vb=0,Wb=["LAMP","CAMERA"],Kb=["MESH","CAMERA","EMPTY"],Eb=["SPEAKER"],Pa=null;a.is_primary_loaded=function(a){return na.is_primary_loaded(a)};a.update=function(){na.PA(ja)};a.qc=
function(a){Pa=a};a.LA=function(a,b){if(sa){Ma.style.height=b.toString()+"px";Ma.style.width=a.toString()+"px";var c=Math.round(a/2-44);sa.style.top=Math.round(b/2-44).toString()+"px";sa.style.left=c.toString()+"px"}};a.load=function(a,b,e,f,g){var k={load_main:{Ma:na.ke,Va:!1,J:[],ab:!1,bb:500,tb:!1,Xa:h},duplicate_objects:{Ma:na.Xc,Va:!1,J:["load_main"],ab:!1,bb:50,tb:!1,Xa:q},load_binaries:{Ma:na.ke,Va:!1,J:["load_main"],ab:!1,bb:500,tb:!1,Xa:d},prepare_bindata:{Ma:na.Xc,Va:!1,J:["duplicate_objects",
"load_binaries"],ab:!1,bb:0,tb:!1,Xa:l},prepare_root_datablocks:{Ma:na.Xc,Va:!1,J:["duplicate_objects","prepare_bindata"],ab:!1,bb:150,tb:!1,Xa:m},prepare_root_scenes:{Ma:na.Xc,Va:!1,J:["prepare_root_datablocks"],ab:!1,bb:350,tb:!1,Xa:r},load_smaa_textures:{Ma:na.ke,Va:!0,J:["prepare_root_scenes"],ab:!1,bb:10,tb:!0,Xa:N},load_shoremap:{Ma:na.ke,Va:!0,J:["prepare_root_scenes"],ab:!1,bb:10,tb:!0,Xa:v},load_textures:{Ma:na.ke,Va:!0,J:["prepare_root_scenes"],ab:!0,bb:500,tb:!1,Xa:O,wf:{vq:0}},wait_physics_workers:{Ma:na.ke,
Va:!0,J:["load_shoremap"],ab:!1,bb:20,tb:!1,vf:M},add_physics_objects:{Ma:na.Xc,Va:!1,J:["wait_physics_workers"],ab:!1,bb:20,tb:!1,Xa:G},add_objects:{Ma:na.Xc,Va:!1,J:["add_physics_objects"],ab:!1,bb:800,tb:!1,Xa:J,vf:R,Ph:V,wf:{Zk:[],dr:0}},load_speakers:{Ma:na.ke,Va:!0,J:["add_objects"],ab:!0,bb:30,tb:!1,Xa:F,wf:{Uz:0}},mobile_media_start:{Ma:na.Xc,Va:!Ja.Lf,J:["load_textures","load_speakers"],ab:!0,bb:5,tb:!1,Xa:U,vf:U},synchronize_media:{Ma:na.Xc,Va:!0,J:["mobile_media_start"],ab:!0,bb:70,tb:!1,
Xa:ca},start_nla:{Ma:na.Xc,Va:!0,J:["mobile_media_start"],ab:!1,bb:5,tb:!1,Xa:C}},B=na.eq();B||(B=na.Uv(),ja=[],Va=[],ab={});ja[B.ud.length]={};return na.bw(k,a,b,e,c,f||Pb.Ho,Ja.do_not_load_resources,g)};a.unload=function(a){var b=na.eq();if(!b||!b.ud.length||a&&!na.sA(b.ud[a]))Q.error("Unable to unload data!");else{if(0==a)Q.log("%cUNLOAD ALL","color: #00a"),ga.cleanup(),qa.cleanup(),ta.cleanup(),Ia.cleanup(),ra.cleanup(),na.cleanup(),da.cleanup(),Ga.cleanup(),Fa.cleanup(),la.cleanup(),mb.cleanup(),
lb.cleanup(),Y.cleanup(),W.cleanup(),oa.cleanup(),ua.cleanup(),Va=null,ab={},Wa=!1,ja=null;else{Q.log("%cUNLOAD DATA "+a,"color: #00a");qa.Zy(a);for(var b=ra.ei(),c=0;c<b.length;c++)for(var d=b[c],e=ra.Da(d,"ALL",ra.DATA_ID_ALL),f=e.length-1;0<=f;f--){var g=e[f];if(g.d.ad==a){ma(d,g,!0);e.splice(f,1);var k=ra.Da(d,g.type,ra.DATA_ID_ALL),g=k.indexOf(g);-1!=g&&k.splice(g,1)}}}T()}};a.Py=ma;a.set_debug_resources_root=function(a){za=a}};b4w.module.__batch=function(a,p){function c(a){a={type:a,Fb:"",id:0,bz:0,eh:"",M:[],Gb:[],Fc:[],yf:[],rg:null,eb:{},Rb:null,Na:null,Go:[],nc:null,R:null,Bc:null,vd:!1,Eg:!1,sp:!1,wireframe_mode:0,num_vertices:0,num_triangles:0,Hq:0,Iq:0,iq:0,lm:0,Vb:new Float32Array(3),hc:new Float32Array(16),Ga:!1,gp:!1,V:!1,he:!1,Aa:!1,qg:!1,bd:!1,rc:!1,bc:!1,Eb:!1,Pb:!1,Db:!1,Rc:!1,Ya:!1,Fr:!1,Qd:ca.Ih,je:ca.Ed,Ah:0,Gn:new Float32Array(2),u:new Float32Array(2),Ef:!1,gn:"",GD:"",jq:!1,nq:0,kq:0,oq:0,pq:0,mq:new Float32Array(3),
lq:new Float32Array(3),If:!1,Gd:0,Rd:0,xe:1,fg:0,gs:0,nh:1,bg:0,we:0,ne:1,ar:0,Tm:0,Yf:0,Lr:0,Od:Array(2),cc:new Float32Array(3),$e:new Float32Array(3),qd:new Float32Array(3),ob:new Float32Array(4),Oc:new Float32Array(4),Ug:null,Cm:null,Am:null,zm:null,Bm:null,gf:!1,water_dynamic:!1,Zn:!1,Os:!1,Ps:0,Qs:0,Ns:0,Gh:.1,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,Mp:new Float32Array(2),Lp:new Float32Array(2),Zl:new Float32Array(2),shallow_water_col:new Float32Array(3),shore_water_col:new Float32Array(3),
Wf:null,jn:!1,pr:0,lr:0,an:0,or:0,rr:0,qr:0,mr:0,nr:0,bn:0,ir:0,hr:0,tr:0,kr:0,nk:new Float32Array(3),sr:new Float32Array(8),jr:new Float32Array(16)};a.ob[3]=1;a.gp=!0;a.V=!0;a.Ah=1;return a}function b(a){switch(a.type){case "MAIN":case "NODES":case "PARTICLES":a.Fb=a.Ga?a.he?"XRAY":"BLEND":"OPAQUE";break;case "DEPTH":a.Fb="DEPTH";break;case "COLOR_ID":a.Fb=a.he?"COLOR_ID_XRAY":"COLOR_ID"}}function h(a,b){for(var c=[],e=ma.Ha(b,"SHADOW_CAST"),f=ma.Ha(b,"MAIN_REFLECT"),g=ma.Ha(b,"OUTLINE_MASK"),k=
ma.Ha(b,"COLOR_PICKING"),h=0;h<a.n.length;h++){var l=a.n[h],m=null;"DEPTH"==l.type&&e&&l.rc&&(m=d(l),m.Fb="SHADOW_CAST");"MAIN"!=l.type&&"NODES"!=l.type&&"PARTICLES"!=l.type||!f||l.Ga||!l.Pb||(m=d(l),m.Fb="REFLECT");"COLOR_ID"==l.type&&(g&&k?(m=d(l),m.Fb="OUTLINE"):g&&!k&&(l.Fb="OUTLINE"));m&&(m.Ef=!0,H(m,a.d.id),c.push(m))}a.n.push.apply(a.n,c)}function d(a){var b=a.R,c=a.nc;a.R=null;a.nc=null;var d=T.Av(a);a.R=b;d.R=b;a.nc=c;d.nc=c;return d}function f(a,b,c){for(var d=[],e=0;e<a.length;e++){var f=
a[e],k=f.d,h=m(f.data.b4w_bounding_box),l=f.data.b4w_bounding_cylinder_radius,n=f.data.b4w_bounding_sphere_radius,q=f.data.b4w_bounding_sphere_center,r=f.data.b4w_bounding_ellipsoid_axes,t=f.data.b4w_bounding_ellipsoid_center;if(k.Kd){var n=Math.max(Math.abs(h.max_x),Math.abs(h.min_x)),l=Math.max(Math.abs(h.max_y),Math.abs(h.min_y)),x=Math.max(Math.abs(h.max_z),Math.abs(h.min_z)),x=Math.sqrt(n*n+l*l+x*x),n=Math.sqrt(n*n+l*l);h.max_x=h.max_y=h.max_z=x;h.min_x=h.min_y=h.min_z=-x;l=n;n=x;q[0]=q[1]=q[2]=
0;r[0]=r[1]=r[2]=x;t[0]=t[1]=t[2]=0}k.Ib=h;x=N.pl(h,k.T);k.Wa=x;var x=k,u=l;x.ll=N.mp(u,h);x.jl=N.kp(l,h);x.kl=N.lp(u,h);q=N.El(n,q);k.Lc=q;q=N.rl(q,k.T);k.xb=q;r=N.Dl([r[0],0,0],[0,r[1],0],[0,0,r[2]],t);k.sf=r;r=N.ql(r,k.ub);k.tf=r;d=d.concat(g(f,k,b,c))}return d}function l(a,b,c,d){for(var e=[],f=[],k={},h=0;h<a.length;h++){var l=a[h],n=l.d,q=m(l.data.b4w_bounding_box),r=N.pl(q,n.T),x=N.El(l.data.b4w_bounding_sphere_radius,l.data.b4w_bounding_sphere_center),t=N.rl(x,n.T),u=l.data.b4w_bounding_ellipsoid_axes,
u=N.Dl([u[0],0,0],[0,u[1],0],[0,0,u[2]],l.data.b4w_bounding_ellipsoid_center),z=N.ql(u,n.ub);n.Ib=q;n.Wa=r;n.Lc=x;n.xb=t;n.sf=u;n.tf=z;q={};q.rc=n.rc;q.bc=n.bc;q.Eb=n.Eb;q.hg=n.hg;q.ik=n.ik;q.Ab=n.Ab;q.hk=n.hk;q.ti=n.ti;q.Pb=n.Pb;q.Db=n.Db;q.Rc=n.Rc;q.uf=n.uf;q.xd=n.xd;q.Yd=n.Yd;q.Cb=n.Cb;q.Kd=n.Kd;q.Nh=n.Nh;q.Ya=n.Ya;q.Fg=n.Fg;q.Ej=n.Ej;q.Zd=n.Zd;q.Vf=n.Vf;q.$j=n.$j;q.mc=n.mc;q.Uf=n.Uf;q.ak=n.ak;q.bd=n.bd;r=n.xb.D;q.Mx=0==c?[0,0]:[Math.floor(r[0]/c),Math.floor(r[2]/c)];q.He=n.He;q.pi=n.pi;q.Tf=n.Tf;
n=JSON.stringify(q);k[n]=k[n]||[];k[n].push(l)}for(var v in k){q=JSON.parse(v);c=k[v];var l=T.Aj("STATIC"),p;for(p in q)l[p]=q[p];l.ad=a[0].d.ad;l.yd=0;l.kf=0;l.ve=0;l.ue=0;l.re=0;l.Rg=!1;for(h=0;h<c.length;h++)n=c[h],0==h?(l.Wa=P.wa(n.d.Wa),l.xb=P.wa(n.d.xb),l.sf=P.wa(n.d.sf),l.tf=P.wa(n.d.tf)):(N.Bp(l.Wa,n.d.Wa),N.Bw(l.xb,n.d.xb));l.Ib=P.wa(l.Wa);l.Lc=P.wa(l.xb);f.push({Qb:l,ae:c})}for(a=0;a<f.length;a++)for(k=f[a].Qb,h=f[a].ae,v=0;v<h.length;v++){p=h[v];c=g(p,k,b,d);l=C(p.d)||C(k);n={};k.xd&&(n.au_center_pos=
[l[0],l[1],l[2]],n.au_wind_bending_amp=[p.d.yd],n.au_wind_bending_freq=[p.b4w_wind_bending_freq],n.au_detail_bending_amp=[p.b4w_detail_bending_amp],n.au_detail_bending_freq=[p.b4w_detail_bending_freq],n.au_branch_bending_amp=[p.b4w_branch_bending_amp]);for(q=0;q<c.length;q++)t=c[q].Qb,r=c[q].tc,x=c[q].o,t.Wj?t.Kd?ca.iA(r,l):ca.ss(r,l):("COLOR_ID"==x.type&&(t=c[q].Qb=p.d,x.eh=p.uuid,I(x,t),H(x,P.Ag(t,0))),r=ca.ss(r,l),ca.hA(r,n));e=e.concat(c)}return e}function g(a,b,d,e){for(var f=[],g=k(d,b),h=P.Ag(b,
0),l=a.data,m=l.materials,n=0;n<g.length;n++){var q=g[n];if(!a.b4w_do_not_render||"PHYSICS"==q)for(var r=0;r<m.length;r++){var u=m[r];if(("LENS_FLARES"!=u.name||0!=e)&&!ca.rq(l,r)){var z=c(q);if(x(z,u,!0)){z.Qd=b.vd||b.bd?ca.Zi:ca.Ih;I(z,b);for(var v=z,p=a.particle_systems,A=0;A<p.length;A++){var w=p[A].settings.b4w_vcol_from_name,S=p[A].settings.b4w_vcol_to_name;""!==w&&""!==S&&(v.eb[w]={Hf:!1,src:[{name:w,Dc:7}]})}"DYNAMIC"==b.type&&(z.eh=a.uuid);H(z,h);v=ca.Hp(l,r,z.yf,z.Bc,z.eb,z.rg);"LENS_FLARES"==
u.name&&(v=aa.Oy(v));f.push({o:z,tc:v,Ec:[u.name],Qb:b,Sc:[a]})}}}}g=a.particle_systems;if(0<g.length&&f.length){e=!0;for(n=0;n<g.length;n++)if(g[n].settings.use_render_emitter){e=!1;break}n=f[0].o;g=f[0].tc;l=[];m=a.particle_systems;q=a.data;for(r=0;r<m.length;r++)if(u=m[r],z=u.settings,z.count)if("EMITTER"==z.type){if("DYNAMIC"==b.type){v=c("PARTICLES");p=q.materials;A=u.settings.material-1;A>=p.length&&(R.warn('Wrong material used for rendering particle system "'+u.name+'"'),A=0);p=p[A];"HALO"===
u.settings.render_type&&(v.If=!0);x(v,p);I(v,b);A=v;w=u;switch(w.settings.b4w_billboard_align){case "VIEW":t(A,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":t(A,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":t(A,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":t(A,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";}t(A,"BILLBOARD",0);fa.v(A.Na,"WORLD_SPACE","WORLD"==w.settings.b4w_coordinate_system?1:0);v.bd=!0;v.eh=a.name+"_"+z.uuid;
v.gn=u.name;H(v,h);v.nc=u;z=aa.Zw(v,q,u,a.d.ub);aa.wz(v,u,p);l.push({o:v,tc:z,Ec:[p.name],Qb:b,Sc:[a]})}}else if("HAIR"==z.type){v=P.Rj(u.seed);z.b4w_dynamic_grass&&(b.Fg=!0);if(u.transforms.length)var E=u.transforms;else for(var p=ca.fm(g,z.count,!1,v),E=new Float32Array(4*p.length),y=0;y<p.length;y++)A=.75+.5*P.Hc(v),E[4*y]=p[y][0],E[4*y+1]=p[y][1],E[4*y+2]=p[y][2],E[4*y+3]=A;p=ma.Ha(d,"GRASS_MAP")?!0:!1;if("OBJECT"==z.render_type)A=[k(d,z.dupli_object.d,!0)],u=L(a,b,n,g,[z.dupli_object],A,[E],
z,u,p,v,!1),l=l.concat(u);else if("GROUP"==z.render_type){w=z.dupli_group.objects;S=!1;A=[];for(y=0;y<w.length;y++){var N=k(d,z.dupli_group.objects[y].d,!0);A.push(N)}if(z.use_whole_group){S=E;E=w;y={};for(N=0;N<S.length;N+=4)for(var Y=0;Y<E.length;Y++){var C=ga.create();ga.scale(E[Y].d.g,E[Y].d.scale,C);var ba=ga.clone([S[N],S[N+1],S[N+2]]);ga.add(ba,C,ba);y[Y]||(y[Y]=new Float32Array(S.length));y[Y][N]=ba[0];y[Y][N+1]=ba[1];y[Y][N+2]=ba[2];y[Y][N+3]=S[N+3]}E=y;S=!0}else if(z.use_group_count){for(var ba=
w,G=z.dupli_weights,y=v,N={},Y=[],C=0;C<ba.length;C++)for(var J=ba[C],J=J.origin_name||J.name,F=0;F<G.length;F++){var O=G[F];J==O.name.split(": ")[0]&&Y.push(O)}G.length!=Y.length&&R.error("dupli weights match failed");for(C=0;C<E.length;C+=4){var K,G=Y;K=[0];for(ba=0;ba<G.length;ba++)K[ba+1]=K[ba]+G[ba].count;G=K[K.length-1]*P.Hc(y);for(ba=J=0;ba<K.length;ba++)if(G>=K[ba]&&G<K[ba+1]){J=ba;break}K=J;N[K]=N[K]||[];N[K].push(E[C],E[C+1],E[C+2],E[C+3])}for(K in N)N[K]=new Float32Array(N[K]);E=N}else{y=
v;N=w.length;Y={};for(C=0;C<E.length;C+=4){var qa=Math.floor(N*P.Hc(y));Y[qa]=Y[qa]||[];Y[qa].push(E[C],E[C+1],E[C+2],E[C+3])}for(qa in Y)Y[qa]=new Float32Array(Y[qa]);E=Y}u=L(a,b,n,g,w,A,E,z,u,p,v,S);l=l.concat(u)}"INSTANCE"==z.b4w_wind_bend_inheritance&&(a.d.yd=0)}else throw"Unknown particle settings type";a=l;f=e?a:f.concat(a)}return f}function m(a){return{max_x:a.max_x,min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}}function k(a,b,c){var d=["MAIN","NODES"];(b.hg&&ma.Ha(a,
"COLOR_PICKING")||b.Ab&&ma.Ha(a,"OUTLINE_MASK"))&&!c&&d.push("COLOR_ID");ma.Ha(a,"WIREFRAME")&&d.push("WIREFRAME");d.push("PHYSICS");(ma.Ha(a,"DEPTH")||ma.Ha(a,"SHADOW_CAST"))&&d.push("DEPTH");ma.Ha(a,"GRASS_MAP")&&d.push("GRASS_MAP");if(b.bc||b.Db)for(a=null,b.bc&&(a=["MAIN","NODES","COLOR_ID","PHYSICS","WIREFRAME"]),b.Db&&(b=["COLOR_ID","PHYSICS","DEPTH","WIREFRAME"],a=null!==a?P.Iu(a,b):b),b=a,a=0;a<b.length;a++)c=d.indexOf(b[a]),-1!==c&&d.splice(c,1);return d}function x(a,b,c){var d,f;switch(a.type){case "MAIN":if(b.b4w_do_not_render||
b.use_nodes)a=!1;else{q(a,b);var g=b.game_settings.alpha_blend;a.he=b.b4w_render_above_all&&"OPAQUE"!=g&&"CLIP"!=g;a.Yf=b.offset_z;a.$e.set([1,1,1]);var k=b.texture_slots;qa.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.ob);switch(b.name){case "LENS_FLARES":M(a,"special_lens_flares.glslv","special_lens_flares.glslf");F(a,"a_position");F(a,"a_texcoord");var h=c?[1,1,1,0]:null,h=z(k[0],h);G(a,h);break;default:M(a,"main.glslv","main.glslf");var l=E("use_map_color_diffuse",k),
m=E("use_map_color_spec",k),x=E("use_map_normal",k),v=E("use_map_mirror",k),p=E("use_stencil",k),g=l[0],m=m[0],x=x[0],v=v[0],l=l[1],k=p[0]&&E("use_rgb_to_intensity",k)[0];if(g){switch(g.blend_type){case "MIX":t(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":t(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}h="IMAGE"==g.texture.d.source&&c?[a.ob[0],a.ob[1],a.ob[2],1]:"ENVIRONMENT_MAP"==g.texture.d.source&&c?[.8,.8,.8,1]:null;h=z(g,h);G(a,h,"u_colormap0");a.we=g.diffuse_color_factor;
a.ne=g.use_map_alpha?g.alpha_factor:0;a.$e.set(g.scale)}p=g&&g==m;m&&(p||(h=c?[.5,.5,.5,1]:null,h=z(m,h),G(a,h,"u_specmap0")),a.gs=m.specular_color_factor);if(x){F(a,"a_normal");F(a,"a_tangent");h=c?[.5,.5,1,1]:null;h=z(x,h);G(a,h,"u_normalmap0");a.ar=x.normal_factor;var w=x.texture;if(w.b4w_use_map_parallax&&ba.vi){var h=fa.t(w.b4w_parallax_steps),S=fa.t(w.b4w_parallax_lod_dist);t(a,"PARALLAX",1);t(a,"PARALLAX_STEPS",h);t(a,"PARALLAX_LOD_DIST",S);a.bg=w.b4w_parallax_scale}}v&&(h=c?[0,0,.5,1]:null,
h=z(v,h),G(a,h,"u_mirrormap"),a.Tm=v.mirror_factor);if(w=g&&l&&k?1:0)h=c?[.8,.8,.8,1]:null,h=z(l,h),G(a,h,"u_colormap1"),h=c?[.5,.5,.5,1]:null,h=z(k,h),G(a,h,"u_stencil0");(c=g||m||x)&&a.$e.set(c.scale);t(a,"TEXTURE_SPEC",void 0==m?0:1);t(a,"TEXTURE_MIRROR",void 0==v?0:1);t(a,"ALPHA_AS_SPEC",p?1:0);t(a,"TEXTURE_STENCIL_ALPHA_MASK",w);F(a,"a_position");F(a,"a_normal");(g||m||x)&&F(a,"a_texcoord");if(b.b4w_water){a.gf=!0;a.Zn=b.b4w_water_shore_smoothing;a.water_dynamic=b.b4w_water_dynamic;c=b.texture_slots;
M(a,"special_water.glslv","special_water.glslf");F(a,"a_position");F(a,"a_texcoord");F(a,"a_normal");F(a,"a_tangent");ba.Rs?(F(a,"a_polyindex"),a.V=!0,a.wireframe_edge_color=[0,0,0],t(a,"DEBUG_WIREFRAME",1)):t(a,"DEBUG_WIREFRAME",0);p=E("use_map_normal",c);v=E("use_map_mirror",c)[0];p.length&&(w=z(p[0]),G(a,w,"u_normalmap0"),a.Gh=b.b4w_water_norm_uv_velocity);t(a,"NUM_NORMALMAPS",p.length);a.Wf=Array(p.length);for(w=0;w<p.length;w++)a.Wf[w]=new Float32Array(2),a.Wf[w].set([p[w].scale[0],p[w].scale[1]]);
v?(t(a,"TEXTURE_MIRROR",1),p=z(v),G(a,p,"u_mirrormap"),a.Tm=v.mirror_factor):t(a,"TEXTURE_MIRROR",0);v=null;for(w=0;w<c.length;w++)if(d=c[w],!0===d.texture.b4w_water_foam){v=d;break}v&&ba.Jg?(t(a,"FOAM",1),p=z(v),G(a,p,"u_foam"),a.foam_factor=b.b4w_foam_factor,a.Mp.set(v.texture.b4w_foam_uv_freq),a.Lp.set(v.texture.b4w_foam_uv_magnitude),a.Zl[0]=v.scale[0],a.Zl[1]=v.scale[1]):t(a,"FOAM",0);for(w=0;w<c.length;w++)if(d=c[w],!0===d.texture.b4w_shore_dist_map){f=d;break}f&&ba.$k?(f=z(f),G(a,f,"u_shore_dist_map"),
t(a,"SHORE_PARAMS",1),f=d.texture.b4w_shore_boundings,t(a,"MAX_SHORE_DIST",fa.t(d.texture.b4w_max_shore_dist)),t(a,"SHORE_MAP_SIZE_X",fa.t(f[0]-f[1])),t(a,"SHORE_MAP_SIZE_Y",fa.t(f[2]-f[3])),t(a,"SHORE_MAP_CENTER_X",fa.t((f[0]+f[1])/2)),t(a,"SHORE_MAP_CENTER_Y",fa.t((f[2]+f[3])/2))):t(a,"SHORE_PARAMS",0);b.b4w_generated_mesh&&ba.Uh?(t(a,"GENERATED_MESH",1),a.Os=!0,a.Ps=b.b4w_water_num_cascads,a.Qs=b.b4w_water_subdivs,a.Ns=b.b4w_water_detailed_dist):t(a,"GENERATED_MESH",0);if(b.b4w_water_dynamic){d=
fa.t(b.b4w_water_dst_noise_scale0);f=fa.t(b.b4w_water_dst_noise_scale1);c=fa.t(b.b4w_water_dst_noise_freq0);var v=fa.t(b.b4w_water_dst_noise_freq1),p=fa.t(b.b4w_water_dir_min_shore_fac),w=fa.t(b.b4w_water_dir_freq),h=fa.t(b.b4w_water_dir_noise_scale),S=fa.t(b.b4w_water_dir_noise_freq),P=fa.t(b.b4w_water_dir_min_noise_fac),y=fa.t(b.b4w_water_dst_min_fac),N=fa.t(b.b4w_water_waves_hor_fac);t(a,"DST_NOISE_SCALE_0",d);t(a,"DST_NOISE_SCALE_1",f);t(a,"DST_NOISE_FREQ_0",c);t(a,"DST_NOISE_FREQ_1",v);t(a,"DIR_MIN_SHR_FAC",
p);t(a,"DIR_FREQ",w);t(a,"DIR_NOISE_SCALE",h);t(a,"DIR_NOISE_FREQ",S);t(a,"DIR_MIN_NOISE_FAC",P);t(a,"DST_MIN_FAC",y);t(a,"WAVES_HOR_FAC",N)}n(a,b);u(a,b);a.shallow_water_col.set(b.b4w_shallow_water_col);a.shore_water_col.set(b.b4w_shore_water_col);a.shallow_water_col_fac=b.b4w_shallow_water_col_fac;a.shore_water_col_fac=b.b4w_shore_water_col_fac;t(a,"ABSORB",fa.t(b.b4w_water_absorb_factor));t(a,"SSS_STRENGTH",fa.t(b.b4w_water_sss_strength));t(a,"SSS_WIDTH",fa.t(b.b4w_water_sss_width));d=a.Na;f=a.yf;
a.Na=d;a.yf=f}"HALO"===b.type&&(d=b.halo,M(a,"halo.glslv","halo.glslf"),t(a,"NUM_RINGS",d.ring_count),t(a,"NUM_LINES",d.line_count),t(a,"NUM_STARS",d.star_tip_count),t(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0),a.yf=["a_position"],a.nq=d.size,a.kq=d.hardness/20,a.mq.set(d.b4w_halo_rings_color),a.lq.set(d.b4w_halo_lines_color),a.oq=1/b.b4w_halo_stars_blend_height,a.pq=b.b4w_halo_stars_min_height,a.jq=!0);t(a,"TEXCOORD",0);t(a,"NORMAL_TEXCOORD",0);g&&r(a,g,"TEXTURE_COLOR0_CO");l&&r(a,l,"TEXTURE_COLOR1_CO");
k&&r(a,k,"TEXTURE_STENCIL_ALPHA_MASK_CO");m&&r(a,m,"TEXTURE_SPEC_CO");x&&r(a,x,"TEXTURE_NORM_CO");t(a,"SHADELESS",b.use_shadeless?1:0);a.qg=b.use_shadeless}g=b.game_settings.alpha_blend;t(a,"ALPHA","OPAQUE"===g?0:1);t(a,"ALPHA_CLIP","CLIP"===g?1:0);t(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(t(a,"VERTEX_COLOR",1),F(a,"a_color")):t(a,"VERTEX_COLOR",0);a.Gd=b.ambient;a.xe=b.diffuse_intensity;a.Rd=b.emit;a.qd.set(b.specular_color);a.nh=b.specular_alpha;n(a,
b);u(a,b);b.b4w_wettable?t(a,"WETTABLE",1):t(a,"WETTABLE",0);A(a,b);a.jn=b.b4w_refractive;a.Lr=b.b4w_refr_bump;a=!0}break;case "NODES":a=e(a,b);break;case "DEPTH":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type)a=!1;else if(q(a,b),a.Ga)a=!1;else{M(a,"depth.glslv","depth.glslf");F(a,"a_position");F(a,"a_normal");g=b.game_settings.alpha_blend;t(a,"ALPHA","OPAQUE"===g?0:1);a.$e.set([1,1,1]);if((b=E("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===g){a.$e.set(b.scale);
t(a,"TEXTURE_COLOR",1);F(a,"a_texcoord");if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==b.texture.d.source)g=z(b),G(a,g,"u_colormap0");"NONE"==b.texture.d.source&&(g=z(b),G(a,g,"u_colormap0"))}else t(a,"TEXTURE_COLOR",0);a=!0}break;case "PHYSICS":b.b4w_collision?(a.XA=b.b4w_use_ghost,a.gc=b.b4w_collision_id,a.ep=b.b4w_collision_group,a.fp=b.b4w_collision_mask,a.bi=b.physics.friction,a.Wh=b.physics.elasticity,a=!0):b.b4w_water?(a.gf=!0,a.iB=b.b4w_water_dynamic,a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,
a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=b.b4w_water_dir_noise_freq,a.dir_min_noise_fac=b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,a=!0):a=!1;break;case "COLOR_ID":if("LENS_FLARES"===b.name||
b.b4w_do_not_render||"HALO"===b.type)a=!1;else{q(a,b);a.je=ca.Ed;a.V=!0;a.Ga=!1;g=b.game_settings.alpha_blend;a.he=b.b4w_render_above_all&&"OPAQUE"!=g&&"CLIP"!=g;M(a,"color_id.glslv","color_id.glslf");F(a,"a_position");g=b.game_settings.alpha_blend;t(a,"ALPHA","OPAQUE"===g?0:1);a.$e.set([1,1,1]);if((b=E("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===g){a.$e.set(b.scale);t(a,"TEXTURE_COLOR",1);F(a,"a_texcoord");if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==b.texture.d.source)g=z(b),G(a,
g,"u_colormap0");"NONE"==b.texture.d.source&&(g=z(b),G(a,g,"u_colormap0"))}else t(a,"TEXTURE_COLOR",0);a=!0}break;case "GRASS_MAP":!b.b4w_terrain||b.b4w_do_not_render?a=!1:(q(a,b),a.Ga=!1,a.je=ca.Ed,a.V=!0,M(a,"grass_map.glslv","grass_map.glslf"),F(a,"a_position"),g=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,b=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,a.eb.a_grass_size={Hf:!0,src:[]},g?(a.eb.a_grass_size.src.push({name:g,Dc:4}),t(a,"DYNAMIC_GRASS_SIZE",1)):t(a,"DYNAMIC_GRASS_SIZE",
0),a.eb.a_grass_color={Hf:!0,src:[]},b?(a.eb.a_grass_color.src.push({name:b,Dc:7}),t(a,"DYNAMIC_GRASS_COLOR",1)):t(a,"DYNAMIC_GRASS_COLOR",0),a=!0);break;case "WIREFRAME":"LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type?a=!1:(M(a,"wireframe.glslv","wireframe.glslf"),F(a,"a_position"),F(a,"a_normal"),F(a,"a_polyindex"),a.V=!0,a.wireframe_mode=0,a.wireframe_edge_color=[0,0,0],a=!0);break;case "PARTICLES":if(b.b4w_do_not_render)a=!1;else{g=b.texture_slots;if(a.If)M(a,"particles_color.glslv",
"particles_color.glslf");else if(M(a,"particles_texture.glslv","particles_texture.glslf"),g=E("use_map_color_diffuse",g)[0]){t(a,"TEXTURE_COLOR",1);switch(g.blend_type){case "MIX":t(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":t(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.we=g.diffuse_color_factor;a.ne=g.use_map_alpha?g.alpha_factor:0;g=z(g);G(a,g)}qa.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.ob);a.Gd=b.ambient;a.xe=b.diffuse_intensity;
a.Rd=b.emit;a.qd.set(b.specular_color);a.nh=b.specular_alpha;F(a,"a_position");F(a,"a_normal");g=b.game_settings.alpha_blend;t(a,"ALPHA","OPAQUE"===g?0:1);t(a,"ALPHA_CLIP","CLIP"===g?1:0);t(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);n(a,b);u(a,b);q(a,b);g=b.game_settings.alpha_blend;a.he=b.b4w_render_above_all&&"OPAQUE"!=g&&"CLIP"!=g;a.Yf=b.offset_z;a=!0}break;default:throw"Wrong batch type: "+a.type;}return a}function r(a,b,c){switch(b.texture_coords){case "UV":case "ORCO":t(a,c,"TEXTURE_COORDS_UV_ORCO");
t(a,"TEXCOORD",1);break;case "NORMAL":t(a,c,"TEXTURE_COORDS_NORMAL");t(a,"NORMAL_TEXCOORD",1);break;default:t(a,c,0)}}function q(a,b){var c=b.game_settings,d=c.alpha_blend;switch(d){case "ALPHA_SORT":a.Ga=!0;a.je=ca.oo;a.V=!0;break;case "ALPHA":a.Ga=!0;a.je=ca.Ed;a.V=!0;break;case "CLIP":a.Ga=!1;a.je=ca.Ed;a.V=!0;break;case "ADD":a.Ga=!0;a.je=ca.Ed;a.V=!1;break;case "OPAQUE":a.Ga=!1;a.je=ca.Ed;a.V=!0;break;default:throw Error("Unknown alpha blend mode: "+d);}a.Aa=c.use_backface_culling}function z(a,
b){var c=a.texture,d=c.d,c=c.image;d&&b&&c&&ia.Oi(d,b,c.dc,c.filepath);return d}function E(a,b){for(var c=[],d=b.length,e=0;e<d;e++){var f=b[e];1==f[a]&&f.texture&&f.texture.d&&c.push(f)}return c}function A(a,b){var c=b.raytrace_transparency;a.Oc[0]=c.fresnel;a.Oc[1]=1-c.fresnel_factor/5;c=b.raytrace_mirror;a.fg=c.reflect_factor;a.Oc[2]=c.fresnel;a.Oc[3]=1-c.fresnel_factor/5}function n(a,b){var c,d=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":t(a,"SPECULAR_SHADER","SPECULAR_PHONG");c=
b.specular_hardness;break;case "WARDISO":t(a,"SPECULAR_SHADER","SPECULAR_WARDISO");c=b.specular_slope;break;case "TOON":t(a,"SPECULAR_SHADER","SPECULAR_TOON");c=b.specular_toon_size;d=b.specular_toon_smooth;break;default:R.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.cc[0]=b.specular_intensity;a.cc[1]=c;a.cc[2]=d}function u(a,b){switch(b.diffuse_shader){case "LAMBERT":t(a,"DIFFUSE_SHADER","DIFFUSE_LAMBERT");a.Od[0]=0;a.Od[1]=0;break;case "OREN_NAYAR":t(a,
"DIFFUSE_SHADER","DIFFUSE_OREN_NAYAR");a.Od[0]=b.roughness;a.Od[1]=0;break;case "FRESNEL":t(a,"DIFFUSE_SHADER","DIFFUSE_FRESNEL");a.Od[0]=b.diffuse_fresnel;a.Od[1]=b.diffuse_fresnel_factor;break;default:R.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.name+'")'),a.Od[0]=0,a.Od[1]=0}}function e(a,b){if(!b.use_nodes||b.b4w_do_not_render)return!1;var c=Z.tv(b.node_tree,b.uuid,!1,b.name);if(!c)return R.error('Failed to create node graph for material "'+b.name+'", disable nodes'),
O(a,b),!0;M(a,"nodes.glslv","nodes.glslf");var d=b.game_settings.alpha_blend;t(a,"ALPHA","OPAQUE"===d?0:1);t(a,"ALPHA_CLIP","CLIP"===d?1:0);t(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);F(a,"a_position");q(a,b);a.Yf=b.offset_z;d=b.game_settings.alpha_blend;a.he=b.b4w_render_above_all&&"OPAQUE"!=d&&"CLIP"!=d;qa.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.ob);a.Rd=b.emit;a.Gd=b.ambient;A(a,b);b.b4w_wettable?t(a,"WETTABLE",1):t(a,"WETTABLE",0);a.Na.Ym=Z.uv(c);
var e=!1;U.S(c,function(b,c){switch(c.type){case "GEOMETRY_UV":var d=c.data.name,f=c.data.value;a.rg||(a.rg={});a.rg[f]=d;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":d=c.data.name;a.eb[d]={Hf:!0,src:[{name:c.data.value}]};f=0;if("GEOMETRY_VC"==c.type)f=7;else for(var g=0;g<c.Ra.length;g++){var k="RGB".indexOf(c.Ra[g].identifier);-1<k&&(f|=1<<2-k)}a.eb[d].src[0].Dc=f;break;case "GEOMETRY_NO":F(a,"a_normal");break;case "MATERIAL":case "MATERIAL_EXT":d=c.data.value;
F(a,"a_normal");t(a,"DIFFUSE_SHADER","DIFFUSE_"+d.rw);t(a,"SPECULAR_SHADER","SPECULAR_"+d.Zz);t(a,"SHADELESS_MAT",d.qg?1:0);a.qg=d.qg;a.nh=d.nh;e=!0;break;case "TEXTURE_COLOR":case "TEXTURE_ENVIRONMENT":d=c.data.name;f=c.data.value;!1!==f.d.fj&&(f.d.fj="TEXTURE_ENVIRONMENT"!=c.type?!0:!1);G(a,f.d,d);break;case "TEXTURE_NORMAL":case "B4W_PARALLAX":t(a,"CALC_TBN_SPACE",1);F(a,"a_normal");F(a,"a_tangent");d=c.data.name;f=c.data.value;f.d.fj=!1;G(a,f.d,d);break;case "LAMP":c.data&&(a.Ug=c.data);break;
case "B4W_REFRACTION":a.jn=!0}});e||(a.qg=!0);return!0}function O(a,b){M(a,"main.glslv","main.glslf");var c=b.game_settings.alpha_blend;t(a,"ALPHA","OPAQUE"===c?0:1);t(a,"ALPHA_CLIP","CLIP"===c?1:0);t(a,"SHADELESS",1);F(a,"a_position");F(a,"a_normal");qa.set(1,0,1,1,a.ob);t(a,"VERTEX_COLOR",0);a.Yf=b.offset_z;q(a,b)}function I(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.Wj?t(a,"AU_QUALIFIER","attribute"):t(a,"AU_QUALIFIER","uniform"),t(a,"STATIC_BATCH",0)):(t(a,"AU_QUALIFIER","attribute"),t(a,
"STATIC_BATCH",1));"WIREFRAME"==a.type&&(V.Ex()?t(a,"WIREFRAME_QUALITY",1):t(a,"WIREFRAME_QUALITY",0),a.Eg?(t(a,"DEBUG_SPHERE",1),a.sp?t(a,"DEBUG_SPHERE_DYNAMIC",1):t(a,"DEBUG_SPHERE_DYNAMIC",0)):t(a,"DEBUG_SPHERE",0),t(a,"ALPHA",1));b.vd&&(a.vd=b.vd);b.xd?(""!==b.Yd?(a.eb.a_bending_col_main={Hf:!0,src:[{name:b.Yd,Dc:4}]},F(a,"a_bending_col_main"),""!==b.Cb.Oq&&""!==b.Cb.Nq&&""!==b.Cb.gr?(a.eb.a_bending_col_detail={Hf:!0,src:[{name:b.Cb.Oq,Dc:4},{name:b.Cb.Nq,Dc:2},{name:b.Cb.gr,Dc:1}]},F(a,"a_bending_col_detail"),
F(a,"a_normal"),t(a,"DETAIL_BEND",1)):t(a,"DETAIL_BEND",0),t(a,"MAIN_BEND_COL",1)):t(a,"MAIN_BEND_COL",0),t(a,"WIND_BEND",1)):t(a,"WIND_BEND",0);b.lj?t(a,"BEND_CENTER_ONLY",1):t(a,"BEND_CENTER_ONLY",0);t(a,"BILLBOARD_PRES_GLOB_ORIENTATION",b.Su|0);b.Kd?t(a,"BILLBOARD",1):t(a,"BILLBOARD",0);b.Kd&&b.Wj?t(a,"HAIR_BILLBOARD",1):t(a,"HAIR_BILLBOARD",0);b.ol?t(a,"BILLBOARD_SPHERICAL",1):t(a,"BILLBOARD_SPHERICAL",0);switch(b.Nh){case "RANDOM":t(a,"BILLBOARD_RANDOM",1);t(a,"BILLBOARD_JITTERED",0);break;case "JITTERED":t(a,
"BILLBOARD_RANDOM",0);t(a,"BILLBOARD_JITTERED",1);break;default:t(a,"BILLBOARD_RANDOM",0),t(a,"BILLBOARD_JITTERED",0)}b.Ya&&ba.$k?t(a,"DYNAMIC_GRASS",1):t(a,"DYNAMIC_GRASS",0);a.Ya=b.Ya;a.bd=b.bd;a.rc=b.rc;a.bc=b.bc;a.Eb=b.Eb&&!a.qg&&!(a.Ga&&ba.wp);a.Pb=b.Pb;a.Db=b.Db;a.Rc=b.Rc;b.li?(F(a,"a_influence"),t(a,"SKINNED",1),b.ai?t(a,"FRAMES_BLENDING",1):t(a,"FRAMES_BLENDING",0),t(a,"MAX_BONES",b.Pc)):(t(a,"SKINNED",0),t(a,"FRAMES_BLENDING",0));b.Ok?(t(a,"VERTEX_ANIM",1),ba.Ls?t(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",
.5):t(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):t(a,"VERTEX_ANIM",0);if(b.li&&b.Ok)throw"Skinning and vertex animation are mutually exlusive";b.Ej?t(a,"DISABLE_FOG",1):t(a,"DISABLE_FOG",0);b.Bc&&(a.Bc=b.Bc);if("NODES"==a.type){for(var c=a.Na.Ym,d=b.Vf,e=b.Uf,f=0;f<c.length;f++){var g=c[f];switch(g.id){case "VALUE":var k=g.pk[0];if(k)for(var h=0;h<d.length;h+=2)if(d[h]==k){g.ze.push(["VALUE_IND",d[h+1]]);break}break;case "RGB":if(k=g.pk[0])for(h=0;h<e.length;h+=2)if(e[h]==k){g.ze.push(["RGB_IND",
e[h+1]]);break}}}t(a,"NUM_VALUES",b.Zd.length);t(a,"NUM_RGBS",b.mc.length)}}}function F(a,b){var c=a.yf;-1==c.indexOf(b)&&c.push(b)}function t(a,b,c){fa.v(a.Na,b,c)}function y(a,b){if("PHYSICS"==a.type)a.tc=b;else{var c=a.je,d=a.Qd;a.jq&&(b=ca.Hw(b));a.Os&&(b=w.cx(a.Ps,a.Qs,a.Ns));c=ca.kA(b,c,d,a.eb);a.R=c;a.bd||c.Qj||a.vd||(c.Ee=null,c.Vc=null);c=b.w.length;a.num_vertices=b.I*c;a:switch(a.Qd){case ca.Ih:case ca.$i:case ca.Zi:d=!0;break a;default:d=!1}d?ca.$x(b)?a.num_triangles=b.aa.length/3*c:a.num_triangles=
b.I/3*c:a.num_triangles=0}}function L(a,b,d,e,f,g,k,h,l,m,n,q){var r=[],t=h.b4w_dynamic_grass;if(!m&&t)return r;for(var u="INSTANCE"==h.b4w_wind_bend_inheritance,v="INSTANCE"==h.b4w_shadow_inheritance,z="INSTANCE"==h.b4w_reflection_inheritance,p=[],w=[],A=0;A<f.length;A++){var E=f[A],y=P.vj(b);y.Kd=h.b4w_hair_billboard;y.Nh=h.b4w_hair_billboard_type;y.ol="SPHERICAL"==h.b4w_hair_billboard_geometry;y.Ya=t;y.Wj=!0;y.Zd=E.d.Zd;y.Vf=E.d.Vf;y.mc=E.d.mc;y.Uf=E.d.Uf;u?(y.xd=E.d.xd,y.Vi=E.d.Vi,y.kf=E.d.kf,
y.ve=E.d.ve,y.Yd=E.d.Yd,y.ue=E.d.ue,y.re=E.d.re,y.yd=E.d.yd,y.Cb=E.d.Cb,y.lj=!1):(y.xd=a.d.xd,y.Vi=a.d.Vi,y.kf=a.d.kf,y.ve=a.d.ve,y.Yd=a.d.Yd,y.ue=a.d.ue,y.re=a.d.re,y.yd=a.d.yd,y.Cb=a.d.Cb,y.lj=!0);v?(y.rc=E.d.rc,y.bc=E.d.bc,y.Eb=E.d.Eb):(y.rc=a.d.rc,y.bc=a.d.bc,y.Eb=a.d.Eb);z?(y.Pb=E.d.Pb,y.Db=E.d.Db,y.Rc=E.d.Rc):(y.Pb=a.d.Pb,y.Db=a.d.Db,y.Rc=a.d.Rc);p.push(y);var N=k[A];N||(N=new Float32Array);q&&P.Rj(l.seed,n);for(var Y=new Float32Array(3),C=new Float32Array([0,0,0,1]),ba=[],G=0;G<N.length;G+=
4){Y[0]=N[G];Y[1]=N[G+1];Y[2]=N[G+2];var J=N[G+3];if(h.b4w_initial_rand_rotation){switch(h.b4w_rotation_type){case "XYZ":var F=new Float32Array([P.Hc(n),P.Hc(n),P.Hc(n)]);ga.normalize(F,F);break;case "Z":F=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+h.b4w_rotation_type;}ya.setAxisAngle(F,h.b4w_rand_rotation_strength*(2*Math.PI*P.Hc(n)-Math.PI),C)}var K=S.create_sep(Y,J,C);ba.push(K)}w.push(ba)}for(var O={},A=0;A<f.length;A++){var L=g[A],y=p[A],M=P.Ag(y,0),ba=
w[A];if(ba.length)for(var T=f[A].data,V=T.materials,G=0;G<V.length;G++)if(!ca.rq(T,G))for(var aa=0;aa<L.length;aa++){var U=c(L[aa]),ha=V[G];if(x(U,ha,!0)){U.Qd=ca.Ih;I(U,y);U.eh=h.uuid;"JITTERED"==h.b4w_hair_billboard_type&&(U.Hq=h.b4w_hair_billboard_jitter_amp,U.Iq=h.b4w_hair_billboard_jitter_freq);t&&(U.iq=h.b4w_dynamic_grass_scale_threshold);u||(delete U.eb.a_bending_col_main,delete U.eb.a_bending_col_detail);H(U,M);var ia=ca.Hp(T,G,U.yf,U.Bc,U.eb,U.rg),fa=[];if(y.xd||y.Ya||y.Kd)fa.au_wind_bending_amp=
[y.yd],fa.au_wind_bending_freq=[y.kf],fa.au_detail_bending_freq=[y.ve],fa.au_detail_bending_amp=[y.ue],fa.au_branch_bending_amp=[y.re];var ma=ca.my(ia,fa,ba),Z=ma,xa=ba;Z.F.au_center_pos=new Float32Array(3*Z.I);for(var eb=xa.length,Xa=Z.I/eb,Qa=0;Qa<eb;Qa++)for(var xb=xa[Qa],pb=3*Xa*Qa,yb=0;yb<Xa;yb++)Z.F.au_center_pos[pb+3*yb]=xb[0],Z.F.au_center_pos[pb+3*yb+1]=xb[1],Z.F.au_center_pos[pb+3*yb+2]=xb[2];ma=Z;if(y.lj){var zb=ma,sb=a.d.T;zb.F.a_emitter_center=new Float32Array(3*zb.I);var Na=qa.fromValues(0,
0,0,1);qa.transformMat4(Na,sb,Na);for(var Aa=0;Aa<zb.I;Aa++)zb.F.a_emitter_center[3*Aa]=Na[0],zb.F.a_emitter_center[3*Aa+1]=Na[1],zb.F.a_emitter_center[3*Aa+2]=Na[2];ma=zb}var Fb=h.b4w_vcol_from_name,Gb=h.b4w_vcol_to_name,Ba=U,ec=d,ea=!u,Ca=T,Ra=[];if(""!==Fb&&""!==Gb){var wa,Ka=Gb,vb=Ba.eb,wb=[],Xb=void 0;for(Xb in vb)for(var Yb=vb[Xb].src,Oa=0,Qb=0;Qb<Yb.length;Qb++){var Hb=Yb[Qb].Dc;Ka==Yb[Qb].name&&wb.push(Xb,Hb,Oa);Oa+=P.gg(Hb)}wa=wb;if(0<wa.length)for(var Zb=0;Zb<wa.length;Zb+=3)Ra.push({Xh:Fb,
Hj:7,qk:wa[Zb],rk:wa[Zb+1],Fj:wa[Zb+2]});else ca.Nx(Ba.yf,"a_color")&&Gb==Ca.active_vcol_name&&Ra.push({Xh:Fb,Hj:7,qk:"a_color",rk:7,Fj:0})}ea&&("a_bending_col_main"in ec.eb&&Ra.push({Xh:"a_bending_col_main",Hj:4,qk:"a_bending_col_main",rk:4,Fj:0}),"a_bending_col_detail"in ec.eb&&Ra.push({Xh:"a_bending_col_detail",Hj:7,qk:"a_bending_col_detail",rk:7,Fj:0}));for(var Rb=ma,kc=ba,lc=e,bb=Ra,mc=U.eb,nc=!1,hb=0;hb<bb.length;hb++){var fc=bb[hb].Xh,D=lc.F[fc];if(D&&0<D.length){nc=!0;break}}if(nc){var Mb,
qb=a.d.Ib,Sa=lc.w[0].a_position,jb=kc,X=O,Ha=new Float32Array(3),Za=new Float32Array(3),tb=new Uint32Array(jb.length);if(!("verts_indices"in X)){X.Md=new Float32Array(3);X.Jd=new Float32Array(3);X.Vn=new Uint32Array(Sa.length/3);X.qi=new Uint32Array(Sa.length/3);X.Md[0]=(qb.max_x-qb.min_x)/20;X.Md[1]=(qb.max_y-qb.min_y)/20;X.Md[2]=(qb.max_z-qb.min_z)/20;X.Jd[0]=qb.min_x;X.Jd[1]=qb.min_y;X.Jd[2]=qb.min_z;for(var Ta=0;Ta<Sa.length/3;Ta++){var Ab=P.trunc((Sa[3*Ta]-X.Jd[0])/X.Md[0]),Da=P.trunc((Sa[3*
Ta+1]-X.Jd[1])/X.Md[1]),tc=P.trunc((Sa[3*Ta+2]-X.Jd[2])/X.Md[2]),Ab=P.clamp(Ab,0,19),Da=P.clamp(Da,0,19),tc=P.clamp(tc,0,19);X.Vn[Ta]=Ta;X.qi[Ta]=tc*Math.pow(20,2)+20*Da+Ab}ca.es(X.qi,X.Vn,ca.Tk,!0);X.sg=new Uint32Array(Math.pow(20,3));for(Ta=0;Ta<X.qi.length;Ta++)X.sg[X.qi[Ta]]++;delete X.qi;for(Ta=1;Ta<X.sg.length;Ta++)X.sg[Ta]+=X.sg[Ta-1]}for(var $b=0;$b<jb.length;$b++){Ha[0]=jb[$b][0];Ha[1]=jb[$b][1];Ha[2]=jb[$b][2];for(var ac=1E10,Sb=-1,Gc=P.trunc((Ha[0]-X.Jd[0])/X.Md[0]),uc=P.trunc((Ha[1]-X.Jd[1])/
X.Md[1]),cb=P.trunc((Ha[2]-X.Jd[2])/X.Md[2]),Gc=P.clamp(Gc,0,19),uc=P.clamp(uc,0,19),cb=P.clamp(cb,0,19),Ya=cb*Math.pow(20,2)+20*uc+Gc,od=X.sg[Ya],Nb=0==Ya?0:X.sg[Ya-1];Nb<od;Nb++){var vc=X.Vn[Nb];Za[0]=Sa[3*vc];Za[1]=Sa[3*vc+1];Za[2]=Sa[3*vc+2];ga.sub(Za,Ha,Za);var oc=ga.sqrLen(Za);oc<=ac&&(ac=oc,Sb=vc)}if(-1==Sb)for(Nb=0;Nb<Sa.length/3;Nb++)Za[0]=Sa[3*Nb],Za[1]=Sa[3*Nb+1],Za[2]=Sa[3*Nb+2],ga.sub(Za,Ha,Za),oc=ga.sqrLen(Za),oc<=ac&&(ac=oc,Sb=Nb);tb[$b]=Sb}Mb=tb;for(var Hc=Rb.I/kc.length,hb=0;hb<bb.length;hb++){var Tb=
bb[hb].qk,Ic=bb[hb].rk,fc=bb[hb].Xh,jd=bb[hb].Hj,D=lc.F[fc];switch(Tb){case "a_bending_col_main":var wc=1;break;case "a_bending_col_detail":wc=3;break;case "a_color":wc=3;break;default:for(var gc=wc=0;gc<mc[Tb].src.length;gc++)wc+=P.gg(mc[Tb].src[gc].Dc)}if(D&&0<D.length){var hc=P.gg(jd),Ob=P.gg(Ic),xc=jd&Ic,pc=P.Qr(xc);xc!=Ic&&R.error("Wrong color extraction from "+fc+" to "+Tb+".");if("a_bending_col_main"==Tb||"a_bending_col_detail"==Tb)Rb.F[Tb]=new Float32Array(Rb.I*Ob);for(gc=0;gc<kc.length;gc++){var ic=
Mb[gc],Jc=ic*hc,Oc=gc*Hc*wc;if(-1!=ic)for(var Bb=0;Bb<Hc;Bb++)for(var Ub=Bb*wc,rb=0;rb<pc.length;rb++)pc[rb]&&(Rb.F[Tb][Oc+Ub+(bb[hb].Fj+P.Hi(Ic,rb))]=D[Jc+P.Hi(jd,rb)])}}else Rb.F[Tb]=new Float32Array(0)}}ma=Rb;r.push({o:U,tc:ma,Ec:[ha.name],Qb:y,Sc:[a]})}}}return r}function C(a){return S.create_sep(a.g,a.scale,a.quat)}function H(a,b){for(var c=null,d=null,e=0;e<a.M.length;e++){var f=a.M[e].Ld;f&&(c||(c={}),c[e]=f,a.M[e].Ld=null);if(f=a.M[e].Ja)d||(d={}),d[e]=f,a.M[e].Ja=null}a.id=0;a.bz=b;a.id=
P.Ag(a,b);if(c)for(var g in c)a.M[g].Ld=c[g];if(d)for(g in d)a.M[g].Ja=d[g]}function K(a,b,d,e,f){var g=c("WIREFRAME");M(g,"wireframe.glslv","wireframe.glslf");g.wireframe_mode=0;g.Eg=!0;g.V=!0;g.eh=d;f&&(g.sp=!0);I(g,b);H(g,P.Ag(b,0));e?(b=w.Vp(1,a.D),ca.nz(b,[a.pf[0],a.qf[1],a.rf[2]],a.D)):b=w.Vp(a.za,a.D);ca.Cn(b,1,!0);b.F.a_polyindex=ca.Gp(b);y(g,b);return g}function M(a,b,c){a.Na={Ri:b,$h:c,ye:[],Gm:[],Ym:[]};fa.vz(a.Na)}function G(a,b,c){1==a.M.length&&0==a.Gb.length&&a.Gb.push("default0");
c=c||"default"+String(a.M.length);-1==a.Gb.indexOf(c)&&(a.M.push(b),a.Gb.push(c));a.Rb&&ha.Eo(a)}function v(a){if(!a.Na)throw"No shaders info for batch "+a.name;a.Rb=fa.ox(a.Na);ha.Mu(a.Rb);ha.Do(a);ha.Eo(a)}var N=p("__boundings"),J=p("__config"),R=p("__print"),V=p("__extensions"),ca=p("__geometry"),U=p("__graph"),Z=p("__nodemat"),T=p("__objects"),aa=p("__particles"),w=p("__primitives");p("__reformer");var ha=p("__renderer"),ma=p("__scenegraph"),fa=p("__shaders"),ia=p("__textures"),S=p("__tsr"),P=
p("__util"),ga=p("vec3"),qa=p("vec4"),ya=p("quat"),ba=J.q,Y=["MAIN","NODES"];a.XC=c;a.bx=function(a,d,e,g,k,m,n){for(var q=[],r=[],x=[],u=0;u<e.length;u++){var v=e[u];T.Xb(v)?r.push(v):x.push(v)}u=[];u=u.concat(f(r,a,n));r=u=u.concat(l(x,a,d,n));u=[];v=[];x={};for(d=0;d<r.length;d++){var p=r[d].o,A=r[d].Qb,S=null;if(p.id in x){var E=x[p.id],C=v[E].o,ga=v[E].Qb,J=null,H=null;for(n=0;n<p.M.length;n++){var I=p.M[n].Ld;I&&(J||(J={}),J[n]=I,p.M[n].Ld=null);if(I=p.M[n].Ja)H||(H={}),H[n]=I,p.M[n].Ja=null}P.qs(p,
C)&&P.qs(A,ga)&&(S=v[E]);if(J)for(n in J)p.M[n].Ld=J[n];if(H)for(n in H)p.M[n].Ja=H[n];if(!S){do p.id++;while(x[p.id])}}S||(S={o:p,Qb:r[d].Qb,Sc:[],Dn:[],Ec:[]},x[p.id]=v.length,v.push(S));S.Sc=S.Sc.concat(r[d].Sc);r[d].tc&&r[d].tc.I&&S.Dn.push(r[d].tc);S.Ec=S.Ec.length?S.Ec.concat(r[d].Ec):r[d].Ec;ca.es(S.Ec,S.Dn,ca.Xt,!1)}for(d=0;d<v.length;d++){r=v[d].Dn;if(0==r.length)n=P.gb(P.Jk("%empty"));else if(1==r.length)n=r[0];else{x=[];for(n=0;n<r.length;n++)ca.ay(r[n])||x.push(n);if(x.length<r.length)for(n=
0;n<x.length;n++)ca.Cn(r[x[n]]);n=ca.jA(r)}u.push({o:v[d].o,Qb:v[d].Qb,tc:n,Ec:v[d].Ec,Sc:v[d].Sc})}q.push.apply(q,u);for(u=0;u<q.length;u++)q[u].o.Fc=q[u].Ec,y(q[u].o,q[u].tc);for(u=0;u<q.length;u++)if(d=q[u].o,"STATIC"==q[u].Qb.type&&"COLOR_ID"!=d.type)v=T.xq(P.Jk("%meta"),"MESH",!0),v.d=q[u].Qb,v.n=[d],m.push(v);else for(r=[],n=0;n<q[u].Sc.length;n++)if(v=q[u].Sc[n],-1==r.indexOf(v.name)){for(x=0;x<v.n.length;x++)if(v.n[x]==d)throw"Batch already exist in object";v.n.push(d);r.push(v.name)}if(ba.wireframe_debug){for(u=
0;u<q.length;u++)if(d=q[u].Qb,"DYNAMIC"==d.type&&(v=q[u].Sc[0],-1<Y.indexOf(q[u].o.type))){r=!1;for(n=0;n<v.n.length;n++)v.n[n].Eg&&(r=!0);r||(d=K(d.sf,d,v.name,!0,!0),v.n.push(d))}for(u=0;u<m.length;u++)v=m[u],d=v.d,-1<Y.indexOf(v.n[0].type)&&(d=K(d.Lc,d,v.name,!1),v.n.push(d))}k.Nr&&(d=c("MAIN"),M(d,"special_skydome.glslv","special_skydome.glslf"),k.procedural_skydome?(t(d,"USE_SKY_TEXTURE",1),d.Fr=!0):(g.tn&&(t(d,"USE_SKY_TEXTURE",1),q=z(g.tn,null),G(d,q,"u_sky")),g.YA&&t(d,"USE_SKY_BLEND",1),
g.ZA&&t(d,"USE_SKY_PAPER",1),g.$A&&t(d,"USE_SKY_REAL",1)),k.Pb&&(d.Pb=!0,k.Db&&(d.Db=!0)),F(d,"a_position"),d.Yf=99999,g=w.ax(),y(d,g),v=T.xq(P.Jk("%meta"),"MESH",!0),v.d=T.Aj("DYNAMIC"),v.d.Fg=!0,v.d.Ib=N.zd(),v.d.Lc=N.Wi(),v.d.Wa=N.zd(),v.d.xb=N.Wi(),v.n=[d],m.push(v));for(u=0;u<e.length;u++)for(n=0;n<e[u].n.length;n++)b(e[u].n[n]);for(u=0;u<m.length;u++)for(n=0;n<m[u].n.length;n++)b(m[u].n[n]);for(u=0;u<e.length;u++)h(e[u],a);for(u=0;u<m.length;u++)h(m[u],a)};a.jB=function(a,b,c){if(b)b=c*(b.max_y-
b.min_y);else throw"No bounding box for mesh";return 0==b?0:.5*(Math.sqrt(2*Math.sqrt(4*b*Math.tan(a/180*Math.PI)+1)+2)/2-1)/b};a.Ou=m;a.lx=z;a.gl=function(a,b){t(a,"CSM_SECTION0",0);t(a,"CSM_SECTION1",0);t(a,"CSM_SECTION2",0);t(a,"CSM_SECTION3",0);for(var c=0;c<b.csm_num;c++)t(a,"CSM_SECTION"+String(c),1);t(a,"SHADOW_TEX_RES",fa.t(b.csm_resolution));t(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:0);t(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)};a.ea=t;a.qb=function(a,b){return fa.sx(a.Na,
b)};a.BA=H;a.hj=G;a.fz=function(a,b,c){c=a.Gb.indexOf(c);-1<c&&(a.M[c]=b)};a.Vv=function(a,b){var d=c("MAIN");d.Ga=!0;qa.set(b[0],b[1],b[2],.5,d.ob);d.Qd=ca.$i;y(d,a);M(d,"main.glslv","main.glslf");t(d,"SHADELESS",1);v(d);return d};a.vb=v;a.cv=function(a){return a.Rb.wi.length?a.Rb.dn.u_cube_fog?!0:!1:!1};a.Jv=function(){var a=c("DEPTH_PACK");a.Aa=!0;a.V=!1;var b=w.$a();y(a,b);M(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");v(a);return a};a.np=function(a){var b=c("POSTPROCESSING");
M(b,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":t(b,"POST_EFFECT","POST_EFFECT_NONE");b.u[0]=1;b.u[1]=1;break;case "GRAYSCALE":t(b,"POST_EFFECT","POST_EFFECT_GRAYSCALE");b.u[0]=1;b.u[1]=1;break;case "X_BLUR":t(b,"POST_EFFECT","POST_EFFECT_X_BLUR");b.u[0]=1;b.u[1]=0;break;case "Y_BLUR":t(b,"POST_EFFECT","POST_EFFECT_Y_BLUR");b.u[0]=0;b.u[1]=1;break;case "X_EXTEND":t(b,"POST_EFFECT","POST_EFFECT_X_EXTEND");b.u[0]=1;b.u[1]=0;break;case "Y_EXTEND":t(b,
"POST_EFFECT","POST_EFFECT_Y_EXTEND");b.u[0]=0;b.u[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}b.Aa=!0;b.V=!1;a=w.$a();y(b,a);v(b);return b};a.hC=function(){var a=c("EDGE");a.V=!1;a.Aa=!0;a.u[0]=1;a.u[1]=1;var b=w.$a();y(a,b);M(a,"postprocessing/postprocessing.glslv","postprocessing/edge.glslf");v(a);return a};a.Zv=function(a){var b=c("SSAO");b.V=!1;b.Aa=!0;b.u[0]=1;b.u[1]=1;var d=w.$a();y(b,d);M(b,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");t(b,"SSAO_QUALITY",
"SSAO_QUALITY_"+a.ls);t(b,"SSAO_HEMISPHERE",a.ssao_hemisphere?1:0);a={texture:ia.ex(a)};d={width:4,height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,203,0,117,73,12,0])};a=z(a,d);G(b,a,"u_ssao_special_tex");v(b);return b};a.$v=function(a){var b=c("SSAO_BLUR");b.V=!1;b.Aa=!0;b.u[0]=1;b.u[1]=1;var d=w.$a();y(b,d);M(b,"postprocessing/postprocessing.glslv",
"postprocessing/ssao_blur.glslf");t(b,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);v(b);return b};a.Kv=function(){var a=c("DOF");a.V=!1;a.Aa=!0;a.u[0]=1;a.u[1]=1;var b=w.$a();y(a,b);M(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");t(a,"DEPTH_RGBA",1);v(a);return a};a.Rv=function(){var a=c("OUTLINE");a.V=!1;a.Aa=!0;a.u[0]=1;a.u[1]=1;var b=w.$a();y(a,b);M(a,"postprocessing/postprocessing.glslv","postprocessing/outline.glslf");v(a);return a};a.Lv=function(a,b,d){var e=c("GOD_RAYS");
e.V=!1;e.Aa=!0;e.u[0]=1;e.u[1]=1;var f=w.Ww();y(e,f);M(e,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");t(e,"DEPTH_RGBA",a?1:0);t(e,"WATER_EFFECTS",b?1:0);t(e,"STEPS_PER_PASS",fa.t(d,1));v(e);return e};a.Mv=function(){var a=c("GOD_RAYS_COM");a.V=!1;a.Aa=!0;a.u[0]=1;a.u[1]=1;var b=w.$a();y(a,b);M(a,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");v(a);return a};a.Wv=function(){var a=c("SKY");a.V=!1;a.Aa=!0;a.u[0]=1;a.u[1]=1;var b=w.Xw();y(a,b);M(a,"procedural_skydome.glslv",
"procedural_skydome.glslf");t(a,"WATER_EFFECTS",1);v(a);return a};a.Dv=function(){var a=c("ANTIALIASING");a.V=!1;a.Aa=!0;a.u[0]=1;a.u[1]=1;a.Ah=1/ba.resolution_factor;var b=w.$a();y(a,b);M(a,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");t(a,"AA_METHOD","AA_METHOD_FXAA_QUALITY");v(a);return a};a.Xv=function(a){var b=c("SMAA"),d=w.$a();y(b,d);M(b,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");t(b,"AA_METHOD","AA_METHOD_SMAA_HIGH");t(b,"SMAA_PASS",a);t(b,"SMAA_PREDICATION",
0);t(b,"SMAA_REPROJECTION",0);v(b);b.V=!1;b.Aa=!0;b.u[0]=1;b.u[1]=1;b.Ah=1/ba.resolution_factor;return b};a.Nv=function(a){var b=c("LANCZOS");b.V=!1;b.Aa=!0;b.Ah=1/ba.resolution_factor;"LANCZOS_X"==a?(b.u[0]=1,b.u[1]=0):"LANCZOS_Y"==a&&(b.u[0]=0,b.u[1]=1);a=w.$a();y(b,a);M(b,"postprocessing/postprocessing.glslv","postprocessing/lanczos.glslf");v(b);return b};a.Hv=function(){var a=c("COMPOSITING");a.V=!1;a.Aa=!0;a.u[0]=1;a.u[1]=1;var b=w.$a();y(a,b);M(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");
v(a);return a};a.Qv=function(a){var b=c("MOTION_BLUR");b.Aa=!0;b.V=!1;var d=w.$a();y(b,d);M(b,"postprocessing/postprocessing.glslv","postprocessing/motion_blur.glslf");t(b,"BLUR_DECAY_THRESHOLD",fa.t(a));v(b);return b};a.Bv=function(){var a=c("ANAGLYPH");a.Aa=!0;a.V=!1;var b=w.$a();y(a,b);M(a,"postprocessing/postprocessing.glslv","postprocessing/anaglyph.glslf");v(a);return a};a.Ov=function(){var a=c("LUMINANCE");a.V=!1;a.Aa=!0;a.u[0]=1;a.u[1]=1;var b=w.$a();y(a,b);M(a,"postprocessing/postprocessing.glslv",
"postprocessing/luminance.glslf");v(a);return a};a.Ev=function(){var a=c("LUMINANCE");a.V=!1;a.Aa=!0;a.u[0]=1;a.u[1]=1;var b=w.$a();y(a,b);M(a,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf");v(a);return a};a.Pv=function(){var a=c("LUMINANCE_X_BLUR");a.V=!1;a.Aa=!0;a.u[0]=1;a.u[1]=1;var b=w.$a();y(a,b);M(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");v(a);return a};a.Fv=function(a){var b=c("POSTPROCESSING");switch(a){case "X_BLUR":b.u[0]=
1;b.u[1]=0;break;case "Y_BLUR":b.u[0]=0;b.u[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+a;}b.Aa=!0;b.V=!1;a=w.$a();y(b,a);M(b,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");v(b);return b};a.Gv=function(){var a=c("BLOOM");a.V=!1;a.Aa=!0;a.u[0]=1;a.u[1]=1;var b=w.$a();y(a,b);M(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");v(a);return a};a.cw=function(){var a=c("VELOCITY");a.V=!1;a.Aa=!0;a.u[0]=1;a.u[1]=1;var b=w.$a();
y(a,b);M(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");v(a);return a};a.Cv=function(){var a=c("ANCHOR_VISIBILITY");a.V=!0;a.Aa=!0;a.u[0]=1;a.u[1]=1;a.Qd=ca.io;M(a,"anchors.glslv","anchors.glslf");var b=w.Up(1);y(a,b);t(a,"ANCHOR_NUM",1);v(a);a.yi=new Float32Array(0);return a};a.AA=function(a,b){var c=b.length/3;if(c!=a.yi.length/3){var d=w.Up(c);y(a,d);t(a,"ANCHOR_NUM",c);v(a)}a.yi=b};a.Ki=function(a,b,c){var d=a.Ah;a.Gn[0]=b*a.u[0]*d;a.Gn[1]=c*a.u[1]*d};a.jg=function(a,
b){a.Ah=b};a.Y=function(a,b,c){for(var d=0;d<a.n.length;d++)if(a.n[d].type==c&&!a.n[d].Ef&&-1!=a.n[d].Fc.indexOf(b))return a.n[d];return null};a.jc=function(a,b,c){for(var d=0;d<a.n.length;d++)if(a.n[d].type==c&&a.n[d].Ef&&-1!=a.n[d].Fc.indexOf(b))return a.n[d];return null};a.Vr=function(a,b){a.ob.set(b.ob);a.xe=b.xe;a.qd.set(b.qd);a.cc.set(b.cc);a.Rd=b.Rd;a.Gd=b.Gd;a.we=b.we;a.ne=b.ne;a.fg=b.fg;a.Oc.set(b.Oc);a.bg=b.bg;a.shallow_water_col.set(b.shallow_water_col);a.shallow_water_col_fac=b.shallow_water_col_fac;
a.shore_water_col.set(b.shore_water_col);a.shore_water_col_fac=b.shore_water_col_fac;a.foam_factor=b.foam_factor;a.Gh=b.Gh};a.VB=function(a,b){for(var c=a.n,d=0;d<c.length;d++)if(c[d].type==b)return!0;return!1};a.rv=function(a){for(var b=a.M,c=0;c<b.length;c++)ia.pw(b[c].Ta);ca.cp(a.R)}};b4w.module.__nodemat=function(a,p){function c(a,c,e,g){if(c in P)return P[c];for(var k=T.create(),h=a.nodes,n=a.links,r=a.animation_data,u=0;u<h.length;u++)if(!A(k,h[u],0,r,g))return P[c]=null;if(e&&-1==z(a,k,"GROUP_OUTPUT","group"))return null;u=v(k);if(!N(k,n,u))return null;if(e)return k;for(u=0;u<n.length;u++)for(e=n[u],g=f(e.from_node,k),h=f(e.to_node,k),r=0;r<g.length;r++)for(var t=0;t<h.length;t++){for(var p=g[r],w=h[t],S=T.hb(k,p),y=T.hb(k,w),E=k,C=y,y=[],ga=e.from_socket.identifier,G=e.to_socket.identifier,
J=S.Ra,S=0;S<J.length;S++)if(J[S].identifier==ga){y.push(S);break}C=C.J;for(S=0;S<C.length;S++)if(C[S].identifier==G){y.push(S);break}2==y.length&&T.qe(E,p,w,y)}d(k);a=z(a,k,"OUTPUT","material");if(-1==a)return P[c]=null;l(k);k=T.rs(k,a,T.fo);b(k);m(k);x(k);q(k);return P[c]=k}function b(a){T.S(a,function(b,c){for(var d=c.J,e=c.Ra,f=0;f<d.length;f++)h(a,d[f],b,f,1);for(f=0;f<e.length;f++)h(a,e[f],b,f,0)})}function h(a,b,c,d,e){if(b.Lb){var f=!0;T.af(a,function(a,b,g){if(!e&&a==c&&g[0]==d||e&&b==c&&
g[1]==d)f=!1});f&&(b.Lb=!1)}}function d(a){var b=[];T.S(a,function(c,d){switch(d.type){case "B4W_TRANSLUCENCY":T.af(a,function(a,e,f){a==c&&"Translucency"==d.Ra[f[0]].name&&b.push(a,e,[f[0]+1,f[1]+1])})}});for(var c=0;c<b.length;c+=3)T.qe(a,b[c],b[c+1],b[c+2])}function f(a,b){var c=[];T.S(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;throw"Node not found";}function l(a){var b=[];T.S(a,function(a,c){"B4W_PARALLAX"!=c.type&&"REROUTE"!=c.type||b.push(a,c)});for(var c=0;c<b.length;c+=
2){var d=b[c],e=b[c+1];if("B4W_PARALLAX"==e.type){var f=g(a,d);if(-1!=f){var k=T.Lj(a,f,0);T.hh(a,f,d,-1);-1!=k&&T.hh(a,k,f,-1);d=T.hb(a,f);e.data=d.data;e.L[0]=d.L[0];T.Gi(a,f)}e.J.splice(1,1)}else if("REROUTE"==e.type){for(var e=T.Lj(a,d,0),h=T.fh(a,d),f=[],k=[],l=[],m=0;m<h;m++){var n=T.Ng(a,d,m),q=k.indexOf(n);-1!=q?l[q]+=1:(k.push(n),l.push(1),f.push(d,n))}if(-1!=e)for(h=T.Mg(a,e,d,0)[0],m=0;m<k.length;m++)for(n=0;n<l[m];n++)q=T.Mg(a,d,k[m],n)[1],T.qe(a,e,k[m],[h,q]);for(m=0;m<f.length;m+=2)T.hh(a,
f[m],f[m+1],-1)}}}function g(a,b){for(var c=a.la,d=0;d<c.length;d+=3)if(c[d+1]==b&&1==c[d+2][1])return c[d];return-1}function m(a){var b=[];T.S(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_UV"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],f=b[d+1],g=!0,k=0;k<c.length;k++){var h=c[k];if(r(f,h.fc)){g=[];k=T.fh(a,e);for(n=0;n<k;n++){var l=T.Ng(a,e,n),m=T.Mg(a,e,l,0);g.push(e,l,m);
T.qe(a,h.id,l,m)}for(var n=0;n<g.length;n+=3)T.hh(a,g[n],g[n+1],0);T.Gi(a,e);g=!1;break}}g&&(h={id:e,fc:f},c.push(h))}}function k(a){for(var b={},c=0;c<a.Fa.length;c+=2){var d=a.Fa[c];b[d]=[]}for(c=0;c<a.la.length;c+=3){var e=a.la[c],f=a.la[c+1];b[f].push(e);b[f].push(b[e])}for(d in b)b[d]=JSON.stringify(b[d]).match(/\d+/g)||[],b[d]=b[d].map(function(a){return parseInt(a)});return b}function x(a){var b=[];T.S(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});if(b.length){for(var c=
k(a),d=[],e=0;e<b.length;e+=2){for(var f=b[e],g=b[e+1],h=!0,l=0;l<d.length;l++){var m=d[l];if(!(3<=m.Zg.length||!r(g,m.fc)||-1<c[f].indexOf(m.id)||-1<c[m.id].indexOf(f))){for(var n=!1,q=0;q<m.Zg.length;q++){var u=m.Zg[q].id;if(-1<c[f].indexOf(u)||-1<c[u].indexOf(f)){n=!0;break}}if(!n){for(var l=[],u=T.wq(a,f),x={},q=0;q<u;q++)n=T.Lj(a,f,q),n in x||(x[n]=0),h=T.Mg(a,n,f,x[n]++),l.push(n,f,h);for(var u=[],x=T.fh(a,f),t={},q=0;q<x;q++)n=T.Ng(a,f,q),n in t||(t[n]=0),h=T.Mg(a,f,n,t[n]++),u.push(f,n,h);
h=l.concat(u);for(q=0;q<h.length;q+=3)T.hh(a,h[q],h[q+1],0);T.Gi(a,f);q={id:f,fc:g,xw:l,yw:u};m.Zg.push(q);h=!1;break}}}h&&(m={id:f,fc:g,Zg:[]},d.push(m))}for(e=0;e<d.length;e++){m=d[e];c=m.Zg.length;for(l=0;l<c;l++){g=m.Zg[l];q=g.fc;f=g.xw;g=g.yw;m.fc.J[l+1].Lb=q.J[0].Lb;m.fc.J[l+1].Pa=q.J[0].Pa;m.fc.Ra[2*(l+1)].Lb=q.Ra[0].Lb;m.fc.Ra[2*(l+1)].Pa=q.Ra[0].Pa;m.fc.Ra[2*(l+1)+1].Lb=q.Ra[1].Lb;m.fc.Ra[2*(l+1)+1].Pa=q.Ra[1].Pa;for(q=0;q<f.length;q+=3)n=f[q],h=f[q+2],h[1]+=l+1,T.qe(a,n,m.id,h);for(q=0;q<
g.length;q+=3)n=g[q+1],h=g[q+2],h[0]+=2*(l+1),T.qe(a,m.id,n,h);m.fc.ze.push(["USE_uv"+(l+2),1])}T.Gi(a,m.id);T.dl(a,m.id,m.fc)}}}function r(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":case "GEOMETRY_UV":return a.data.value==b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":return!0;case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value==b.data.value;default:return!1}}function q(a){var b=[];T.S(a,function(a,c){"GEOMETRY_VC"==c.type&&
b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=b[c],e=b[c+1],f=!1,g=[],k=[],h=[[],[],[]],l=T.fh(a,d),m=0;m<l;m++){var n=T.Ng(a,d,m);if("SEPRGB"!=T.hb(a,n).type){f=!1;break}g.push(d,n);for(var q={},r=T.fh(a,n),f=0;f<r;f++){var u=T.Ng(a,n,f);u in q||(q[u]=0);var x=T.Mg(a,n,u,q[u]++);g.push(n,u);h[x[0]].push(d,u,x)}k.push(n);f=!0}if(f){for(m=d=l=0;m<h.length;m++)h[m].length&&(l++,d|=1<<2-m);if(l){e.type+=l;e.Ra=[];for(m=0;m<h.length;m++)if(h[m].length)for(e.Ra.push({Pa:0,identifier:"RGB"[m],Lb:!0,
name:"RGB"[m]}),f=0;f<h[m].length;f+=3)h[m][f+2][0]=w.Hi(d,m);for(m=0;m<g.length;m+=2)T.hh(a,g[m],g[m+1],0);for(m=0;m<k.length;m++)T.Gi(a,k[m]);for(m=0;m<h.length;m++)for(f=0;f<h[m].length;f+=3)T.qe(a,h[m][f],h[m][f+1],h[m][f+2])}}}}function z(a,b,c,d){a=a.nodes;for(var e=null,g=0;g<a.length;g++){var k=a[g];k.type==c&&(e=k)}return e?f(e,b)[0]:(Z.error('No "'+c+'" node in node '+d),-1)}function E(a,b,c,d){return{name:a,type:b,inputs:c,outputs:d}}function A(a,b,c,d,e){var f=b.name,g=b.type,k=[],h=[],
l=[],m=[],q=null,r=[];switch(g){case "CAMERA":h=[];l=K(b);break;case "COMBRGB":case "COMBHSV":h=H(b);l=K(b);break;case "GEOMETRY":a:{for(var g=b.outputs,x=0;x<g.length;x++)if(g[x].is_linked){g=!0;break a}g=!1}if(!g)return!0;g=I(b,c);if(!g)return Z.error("Geometry output is not supported"),!1;switch(g){case "GEOMETRY_UV":if(!b.uv_layer)return Z.error('Missing uv layer in node "',b.name,'"'),!1;q=O("param_GEOMETRY_UV_a");x=O("param_GEOMETRY_UV_v");k.push(M(q));k.push(M(x));l.push(y(b,"UV"));m.push(M(x));
q={name:q,value:b.uv_layer};break;case "GEOMETRY_VC":if(!b.color_layer)return Z.error("Missing vertex color layer in node ",b.name),!1;q=O("param_GEOMETRY_VC_a");x=O("param_GEOMETRY_VC_v");k.push(M(q));k.push(M(x));l.push(y(b,"Vertex Color"));m.push(M(x));q={name:q,value:b.color_layer};break;case "GEOMETRY_NO":l.push(y(b,"Normal"));break;case "GEOMETRY_FB":l.push(y(b,"Front/Back"));break;case "GEOMETRY_VW":l.push(y(b,"View"));break;case "GEOMETRY_GL":l.push(y(b,"Global"))}break;case "GROUP":x=b.node_tree_name;
switch(x){case "B4W_LINEAR_TO_SRGB":if(!n(b,[1],[1])){q=u(b,e);break}g="B4W_LINEAR_TO_SRGB";break;case "B4W_NORMAL_VIEW":case "B4W_VECTOR_VIEW":if(!n(b,[1],[1])){q=u(b,e);break}g="B4W_VECTOR_VIEW";break;case "B4W_SRGB_TO_LINEAR":if(!n(b,[1],[1])){q=u(b,e);break}g="B4W_SRGB_TO_LINEAR";break;case "B4W_REFLECT":if(!n(b,[1,1],[1])){q=u(b,e);break}g="B4W_REFLECT";break;case "B4W_REFRACTION":if(!n(b,[1,0],[1])){q=u(b,e);break}g="B4W_REFRACTION";break;case "B4W_PARALLAX":if(!n(b,[1,1,0,0,0],[1])){q=u(b,
e);break}var g="B4W_PARALLAX",v=O("temp_texture");m.push(M(v));break;case "B4W_CLAMP":if(!n(b,[1],[1])){q=u(b,e);break}g="B4W_CLAMP";break;case "B4W_TRANSLUCENCY":if(!n(b,[0,0,0,0,0],[0])){q=u(b,e);break}g="B4W_TRANSLUCENCY";break;case "B4W_TIME":if(!n(b,[],[0])){q=u(b,e);break}g="B4W_TIME";break;case "B4W_SMOOTHSTEP":if(!n(b,[0,0,0],[0])){q=u(b,e);break}g="B4W_SMOOTHSTEP";break;default:q=u(b,e)}h=H(b);l=K(b);"B4W_TRANSLUCENCY"==x&&(x=C("TranslucencyParams","TranslucencyParams",[0,0,0,0]),x.Lb=l[0].Lb,
l.push(x));break;case "LAMP":q=b.lamp;if(!q)return Z.error("There is no lamp in node: "+b.name),!1;l.push(y(b,"Color"));l.push(y(b,"Light Vector"));l.push(y(b,"Distance"));l.push(y(b,"Visibility Factor"));q.uuid in ga?r.push(["LAMP_INDEX",String(ga[q.uuid])]):(ga[q.uuid]=qa,r.push(["LAMP_INDEX",String(qa++)]));q=ga;break;case "NORMAL":h=H(b);l=K(b);x=y(b,"Normal");m.push(M(O("param_NORMAL_Normal"),x.Pa,3));break;case "MAPPING":x=b.vector_type;g="MAPPING";h.push(t(b,"Vector"));l.push(y(b,"Vector"));
var v=b.rotation,z=b.scale,p=b.translation,S=fa.create(),E=w.Aw(v),P=new Float32Array([z[0],0,0,0,z[1],0,0,0,z[2]]);fa.multiply(E,P,S);S=w.oy(S,ia.create());switch(x){case "POINT":S[12]=p[0];S[13]=p[1];S[14]=p[2];break;case "TEXTURE":S[12]=p[0];S[13]=p[1];S[14]=p[2];S=ia.invert(S,S);break;case "NORMAL":ia.invert(S,S),ia.transpose(S,S)}switch(x){case "NORMAL":r.push(["MAPPING_IS_NORMAL",1]);case "TEXTURE":r.push(["MAPPING_TRS_MATRIX",aa.t(S,16)]);break;case "POINT":0!==ma.length(v)?r.push(["MAPPING_TRS_MATRIX",
aa.t(S,16)]):(0!==ma.length(z)&&r.push(["MAPPING_SCALE",aa.t(z,3)]),0!==ma.length(p)&&r.push(["MAPPING_TRANSLATION",aa.t(p,3)]));break;case "VECTOR":0!==ma.length(v)?r.push(["MAPPING_TRS_MATRIX",aa.t(S,16)]):0!==ma.length(z)&&r.push(["MAPPING_SCALE",aa.t(z,3)])}b.use_min&&r.push(["MAPPING_MIN_CLIP",aa.t(b.min,3)]);b.use_max&&r.push(["MAPPING_MAX_CLIP",aa.t(b.max,3)]);break;case "MATERIAL":case "MATERIAL_EXT":q=t(b,"Color");q.Pa.splice(3);h.push(q);(q=t(b,"Alpha"))?h.push(q):h.push(C("Alpha","Alpha",
1));q=t(b,"Spec");q.Pa.splice(3);h.push(q);x=t(b,"Normal");x.Pa.splice(3);h.push(x);l.push(y(b,"Color"));l.push(y(b,"Alpha"));l.push(y(b,"Normal"));"MATERIAL_EXT"==g&&((q=t(b,"Emit"))?h.push(q):h.push(C("Emit","Emit",0)),q=t(b,"Translucency"),q.Pa=0,q.name="Translucency",q.identifier="Translucency",q?h.push(q):h.push(C(q.name,q.identifier,q.Pa)),q=t(b,"Translucency"),q.Pa=[0,0,0,0],q.name="TranslucencyParams",q.identifier="TranslucencyParams",q?h.push(q):h.push(C(q.name,q.identifier,q.Pa)),q=t(b,
"Reflectivity"),v=t(b,"Ray Mirror"),q?v="Reflectivity":v?(q=v,v="Ray Mirror"):v="Reflectivity",q?h.push(q):h.push(C(v,v,0)),(q=t(b,"SpecTra"))?h.push(q):h.push(C("SpecTra","SpecTra",0)),l.push(y(b,"Diffuse")),l.push(y(b,"Spec")));v=0;switch(b.specular_shader){case "COOKTORR":case "PHONG":q=b.specular_hardness;break;case "WARDISO":q=b.specular_slope;break;case "TOON":q=b.specular_toon_size;v=b.specular_toon_smooth;break;default:Z.error("unsupported specular shader: "+b.specular_shader+' (material "'+
b.material_name+'")'),q=b.specular_hardness}switch(b.diffuse_shader){case "LAMBERT":p=z=0;break;case "OREN_NAYAR":z=b.roughness;p=0;break;case "FRESNEL":z=b.diffuse_fresnel;p=b.diffuse_fresnel_factor;break;default:Z.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.material_name+'")'),p=z=0}m.push(M(O("param_MATERIAL_diffuse"),[z,p],2));m.push(M(O("param_MATERIAL_spec"),[b.specular_intensity,q,v],3));q={name:b.name,value:{Zz:b.specular_shader,rw:b.diffuse_shader,qg:b.use_shadeless,
nh:b.specular_alpha}};x.Lb&&r.push(["USE_MATERIAL_NORMAL",1]);b.use_diffuse&&r.push(["USE_MATERIAL_DIFFUSE",1]);b.use_specular&&r.push(["USE_MATERIAL_SPECULAR",1]);break;case "MATH":switch(b.operation){case "ADD":g="MATH_ADD";break;case "SUBTRACT":g="MATH_SUBTRACT";break;case "MULTIPLY":g="MATH_MULTIPLY";break;case "DIVIDE":g="MATH_DIVIDE";break;case "SINE":g="MATH_SINE";break;case "COSINE":g="MATH_COSINE";break;case "TANGENT":g="MATH_TANGENT";break;case "ARCSINE":g="MATH_ARCSINE";break;case "ARCCOSINE":g=
"MATH_ARCCOSINE";break;case "ARCTANGENT":g="MATH_ARCTANGENT";break;case "POWER":g="MATH_POWER";break;case "LOGARITHM":g="MATH_LOGARITHM";break;case "MINIMUM":g="MATH_MINIMUM";break;case "MAXIMUM":g="MATH_MAXIMUM";break;case "ROUND":g="MATH_ROUND";break;case "LESS_THAN":g="MATH_LESS_THAN";break;case "GREATER_THAN":g="MATH_GREATER_THAN";break;case "MODULO":g="MATH_MODULO";break;case "ABSOLUTE":g="MATH_ABSOLUTE";break;default:return Z.error("Unsupported MATH operation: "+b.operation),!1}r.push(["MATH_USE_CLAMP",
Number(b.use_clamp)]);h=H(b);l=K(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":g="MIX_RGB_MIX";break;case "ADD":g="MIX_RGB_ADD";break;case "MULTIPLY":g="MIX_RGB_MULTIPLY";break;case "SUBTRACT":g="MIX_RGB_SUBTRACT";break;case "SCREEN":g="MIX_RGB_SCREEN";break;case "DIVIDE":g="MIX_RGB_DIVIDE";break;case "DIFFERENCE":g="MIX_RGB_DIFFERENCE";break;case "DARKEN":g="MIX_RGB_DARKEN";break;case "LIGHTEN":g="MIX_RGB_LIGHTEN";break;case "OVERLAY":g="MIX_RGB_OVERLAY";break;case "DODGE":g="MIX_RGB_DODGE";
break;case "BURN":g="MIX_RGB_BURN";break;case "HUE":g="MIX_RGB_HUE";break;case "SATURATION":g="MIX_RGB_SATURATION";break;case "VALUE":g="MIX_RGB_VALUE";break;case "COLOR":g="MIX_RGB_COLOR";break;case "SOFT_LIGHT":g="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":g="MIX_RGB_LINEAR_LIGHT";break;default:return Z.error("Unsupported MIX_RGB blend type: "+b.blend_type),!1}r.push(["MIX_RGB_USE_CLAMP",Number(b.use_clamp)]);h=H(b);l=K(b);break;case "OUTPUT":h=H(b);l=[];break;case "RGB":x=e+"%join%"+b.name;
x={name:"-1",value:x};m.push(x);l.push(y(b,"Color"));break;case "SEPRGB":case "SEPHSV":h=H(b);l=K(b);break;case "TEXTURE":g=F(b);if("TEXTURE_EMPTY"==g)l.push(y(b,"Color")),l.push(y(b,"Normal")),l.push(y(b,"Value"));else if("TEXTURE_ENVIRONMENT"==g)h.push(t(b,"Vector")),l.push(y(b,"Color")),l.push(y(b,"Value"));else{if("TEXTURE_NORMAL"==g&&"ENVIRONMENT_MAP"==b.texture.type)return Z.error("Wrong output for ENVIRONMENT_MAP texture: "+b.name),!1;for(z=0;4>z;++z)z?(q=C("Vector"+z,"Vector"+z,[0,0,0]),"TEXTURE_COLOR"==
g&&(x=C("Color"+z,"Color"+z,[0,0,0]),v=C("Value"+z,"Value"+z,0)),"TEXTURE_NORMAL"==g&&(x=C("Normal"+z,"Normal"+z,[0,0,0]),v=C("Value"+z,"Value"+z,0))):(q=t(b,"Vector"),"TEXTURE_COLOR"==g&&(x=y(b,"Color"),v=y(b,"Value")),"TEXTURE_NORMAL"==g&&(x=y(b,"Normal"),v=y(b,"Value"))),h.push(q),l.push(x),l.push(v)}v=O("param_TEXTURE_texture");m.push(M(v));q={name:v,value:b.texture};break;case "VALUE":g="VALUE";x=e+"%join%"+b.name;x={name:"-1",value:x};m.push(x);l.push(y(b,"Value"));break;case "VECT_MATH":switch(b.operation){case "ADD":g=
"VECT_MATH_ADD";break;case "SUBTRACT":g="VECT_MATH_SUBTRACT";break;case "AVERAGE":g="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":g="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":g="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":g="VECT_MATH_NORMALIZE";break;default:return Z.error("Unsupported VECT_MATH operation: "+b.operation),!1}h=H(b);l=K(b);break;default:h=H(b),l=K(b)}f={name:f,type:g,Ti:k,J:h,Ra:l,L:m,data:q,ze:r};T.dl(a,T.Sp(a),f);if(f="GEOMETRY"==b.type)a:{f=b.outputs;for(h=k=0;h<f.length;h++)if(f[h].is_linked&&
k++>c){f=!0;break a}f=!1}return f&&!A(a,b,++c,d,e)?!1:!0}function n(a,b,c){for(var d=a.inputs,e=a.outputs,f=a.node_tree_name,g=0;g<b.length;g++){var k=d[g],h=b[g];if(!k||k.default_value instanceof Array!=h)return Z.warn('Wrong inputs for custom node group "'+a.name+'" of type: "',f,'".Processing as general node group.'),!1}for(g=0;g<c.length;g++)if(b=e[g],d=c[g],!b||b.default_value instanceof Array!=d)return Z.warn('Wrong outputs for custom node group "'+a.name+'" of type: "',f,'".Processing as general node group.'),
!1;return!0}function u(a,b){var d=a.node_group.node_tree,f={},g;for(g in d)if("links"==g||"nodes"==g){f[g]=[];for(var k=0;k<d[g].length;k++){f[g][k]={};for(var h in d[g][k])if("links"==g){f[g][k][h]={};for(var l in d[g][k][h])f[g][k][h][l]=e(d[g][k][h][l])}else f[g][k][h]=e(d[g][k][h])}}else f[g]=e(d[g]);d=a.node_tree_name;if("B4W_REPLACE"==d||"B4W_LEVELS_OF_QUALITY"==d)g=E("Group input","GROUP_INPUT",[],a.inputs),k=E("Group output","GROUP_OUTPUT",a.outputs,[]),h=null,h="B4W_REPLACE"==d||"B4W_LEVELS_OF_QUALITY"==
d&&(ya.quality==ha.P_LOW||ya.$l)?{from_node:g,from_socket:g.outputs[1],to_node:k,to_socket:k.inputs[0]}:{from_node:g,from_socket:g.outputs[0],to_node:k,to_socket:k.inputs[0]},f.nodes=[g,k],f.links=[h];d=a.name;g=f.nodes;k=f.links;for(h=0;h<g.length;h++)g[h].name=G(g[h].type,d,g[h].name);for(h=0;h<k.length;h++)k[h].from_node.name=G(k[h].from_node.type,d,k[h].from_node.name),k[h].to_node.name=G(k[h].to_node.type,d,k[h].to_node.name);return{Ay:c(f,a.node_group.uuid,!0,b),By:f.links}}function e(a){var b=
typeof a;return"string"!=b&&"number"!=b&&"boolean"!=b&&a?w.vj(a):a}function O(a){S[a]||(S[a]=0);var b=a+S[a],b=b.replace(/ /g,"_").replace(/\//g,"_");S[a]++;return b}function I(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var f=c[e];if(f.is_linked&&!(d++<b))switch(f.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";case "View":return"GEOMETRY_VW";case "Global":return"GEOMETRY_GL";default:return null}}}
function F(a){if(!a.texture)return"TEXTURE_EMPTY";for(var b=a.outputs,c=!1,d=!1,e=!1,f=0;f<b.length;f++){var g=b[f];if(g.is_linked)switch(g.identifier){case "Color":c=!0;break;case "Normal":d=!0;break;case "Value":e=!0;break;default:throw"Unknown texture output";}}if(c)return d&&Z.warn('Node "'+a.name+'" has both Color and Normal outputs. Normal will be omitted'),"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";if(d)return"TEXTURE_NORMAL";if(e)return"ENVIRONMENT_MAP"==a.texture.type?
"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR"}function t(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return L(e)}return null}function y(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return L(e)}return null}function L(a){var b=a.name,c=a.identifier,d=a.is_linked;a=a.default_value;a=w.is_vector(a)?a.slice(0):a;return{name:b,identifier:c,Lb:d,Pa:a}}function C(a,b,c){return{name:a,identifier:b,Lb:!1,Pa:c}}function H(a){for(var b=[],c=0;c<a.inputs.length;c++){var d=
L(a.inputs[c]);d.Pa.length&&d.Pa.splice(3);b.push(d)}return b}function K(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=L(a.outputs[c]);b.push(d)}return b}function M(a,b,c){b=null===b||void 0===b?null:aa.t(b,c);return{name:a,value:b}}function G(a,b,c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"%join%"+c}function v(a){var b=[];T.S(a,function(a,c){"GROUP"==c.type&&b.push(c)});return b}function N(a,b,c){for(var d=0;d<c.length;d++){var e=c[d].data.Ay,f=c[d].data.By;if(!e)return!1;
T.S(e,function(b,c){T.dl(a,T.Sp(a),c)});for(e=0;e<f.length;e++)b.push(f[e]);U(c[d],b,a)}return!0}function J(a,b,c,d,e,f){switch(a.type){case "GROUP":a.name==b&&d.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+"*GI*")||e.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||f.push(c)}}function R(a,b,c){for(var d=[],e=0;e<c.length;e++){for(var f=c[e],g=null,k=0;k<b.length;k++)if(f.from_socket.identifier==b[k].to_socket.identifier){g=b[k];break}g?(f.from_node=g.from_node,f.from_socket=g.from_socket):
d.push(f)}for(e=0;e<b.length;e++)a.splice(a.indexOf(b[e]),1);return d}function V(a,b){if(b.length)for(var c=b[0].from_node.name,d=0;d<a.length;d++)a[d].from_node.name==c&&b.push(a[d])}function ca(a,b,c,d){for(var e=0;e<d.length;e++){for(var g=d[e],k,h=0;h<c.J.length;h++)if(g.from_socket.identifier==c.J[h].identifier){k=c.J[h].Pa;break}for(var h=g,l=b,m=k,n=f(h.to_node,l),q=0;q<n.length;q++)for(var r=T.hb(l,n[q]),x=0;x<r.J.length;x++)if(r.J[x].identifier==h.to_socket.identifier){r.J[x].Pa=m;break}g=
a.indexOf(g);-1!=g&&a.splice(g,1)}}function U(a,b,c){for(var d=a.name,e=[],f=[],g=[],k=[],h=0;h<b.length;h++){var l=b[h];J(l.from_node,d,l,e,g,k);J(l.to_node,d,l,f,g,k)}f=R(b,f,g);e=R(b,k,e);V(b,f);ca(b,c,a,f);if(e.length){var m;T.S(c,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(d+"*GO*")||(m=b)});ca(b,c,m,e)}}var Z=p("__print"),T=p("__graph"),aa=p("__shaders"),w=p("__util"),ha=p("__config"),ma=p("vec3");p("vec4");var fa=p("mat3"),ia=p("mat4"),S={},P={},ga={},qa=0;new Float32Array(4);var ya=
ha.q;a.tv=c;a.uv=function(a){var b=[],c={};S={};var d=T.Jn(a);T.S(d,function(a,d){var e;e=[];for(var f=[],g=[],k=[],h=[],l=[],m=0;m<d.J.length;m++){var n=d.J[m];if(n.Lb)e.push(null),f.push(null);else{e.push(O("in_"+d.type+"_"+n.identifier));var q=aa.t(n.Pa,0);ya.Zr&&(0<=d.type.indexOf("MIX_RGB_")&&("Color1"==n.identifier||"Color2"==n.identifier||"Fac"==n.identifier)||0<=d.type.indexOf("MATH_")&&("Value"==n.identifier||"Value_001"==n.identifier)||0<=d.type.indexOf("VECT_MATH_")&&"Vector_001"==n.identifier)&&
(n=q,n=n.replace(/(,)/g,"$1 "),n=n.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3"),n=n.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1UNITY_VALUE_NODES$3"),q=n=n.replace(/\s+/g,""));f.push(q)}}for(m=0;m<d.Ra.length;m++)n=d.Ra[m],n.Lb?g.push(null):g.push(O("out_"+d.type+"_"+n.identifier));for(m=0;m<d.L.length;m++)n=d.L[m],k.push(n.name),h.push(n.value);for(m=0;m<d.Ti.length;m++)l.push(d.Ti[m].name);e={id:d.type,J:e,um:f,Ra:g,L:k,pk:h,Ti:l,ze:JSON.parse(JSON.stringify(d.ze))};b.push(e);
c[a]=e});T.af(d,function(a,b,e){var f=T.hb(d,a);T.hb(d,b);var g=f.Ra[e[0]];a=c[a].Ra;b=c[b].J;f=a[e[0]]||O("out_"+f.type+"_"+g.identifier);a[e[0]]=f;b[e[1]]=f});return b};a.cleanup=function(){for(var a in P)delete P[a];for(var b in ga)delete ga[b];qa=0}};b4w.module.__animation=function(a,p){function c(a,b){var c=a.B[b];c&&c.Xl&&c.Yh&&(c.Yh=!1,c.Xl(a))}function b(a,b,c){c=a.B[c];c.type=30;var d=b.frame_start,e=b.frame_end-d+1;c.start=d;c.length=e;c.ic=d;c.xg=b.name;for(e=d=0;e<a.data.b4w_vertex_anim.length;e++){var f=a.data.b4w_vertex_anim[e];if(f==b)break;else d+=f.frame_end-f.frame_start+1}c.Ks=d}function h(a,b,c){a=a.B[c];a.type=50;a.xg=b.name;c=b.settings;a.start=c.frame_start;a.length=c.frame_end-a.start;b.settings.b4w_cyclic||(a.length+=c.lifetime);
a.nc=b}function d(a){return a.replace(/_B4W_BAKED$/,"")}function f(a){switch(a){case "CYCLIC":return 10;case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:aa.ma("Wrong animation behavior")}}function l(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++){var d=a[c].node_tree;d&&g(d,b)}return b}function g(a,b){if(a.animation_data){var c=a.animation_data.action;c&&aa.ed(c.fcurves)&&b.push(c)}for(var c=a.nodes,d=0;d<c.length;d++){var e=c[d];e.node_group&&(e=e.node_group.node_tree)&&
g(e,b)}}function m(a){return aa.is_mesh(a)&&a.d.Ok?!0:!1}function k(a){a=a.modifiers;for(var b=0;b<a.length;b++){var c=a[b];if("ARMATURE"==c.type)return c.object}return null}function x(a,b,c){if(-1==b)for(b=0;8>b;b++){var d=a[b];d&&c(d)}else(d=a[b])&&c(d)}function r(a,b,d,e){O(a,b,d,e);c(a,d);a.d.pe&&(t(a,b),F(a,b))}function q(a,b,c){var d=b.frame_range,f=b.d,g=a.B[c];g.xg=b.name;g.Xk=d;g.vo=f.Ky;g.so=f.Qu;g.tj=f.tj;g.start=d[0];g.length=d[1]-d[0];g.ic=d[0];d=aa.ed(f.oj);if(aa.is_armature(a)&&d){g.type=
10;var k=z(a,b);k||(k=y(a,b,n(a)),a.Fd.push(b,k));g.g=k.g;g.ta=k.ta;var g=a.d,k=g.Ck,h=a.B[c],f=h.rn,l;a:{l=g.as;for(var m=0;m<l.length;m+=2)if(b==l[m]){l=l[m+1];break a}l=null}if(l)h.rn=l;else{for(h=0;h<k.length;h++)l=y(a,b,k[h].Bc),f.push(l);g.as.push(b,f)}g.pe&&(b=g.Ik,c>b[1]?(g=b[1],b[1]=c,b[0]=g):c>b[0]&&c<b[1]&&(b[0]=c),E(a))}else if(U.Xd(a)&&(f.L.volume||f.L.pitch))g.volume=f.L.volume||null,g.pitch=f.L.pitch||null,g.type=40;else if("MESH"==a.type&&e(b)){g.type=60;f=z(a,b);if(!f){f=[];h=[];
l=[];var m=[],q=b.d,r=a.d.$j,x=a.d.ak;for(k in q.L){var v=b.name+"%join%"+k;u(k,v,q,h,f,r);u(k,v,q,m,l,x)}f={bB:f,values:h,gz:l,hz:m};a.Fd.push(b,f)}g.Yq=f.bB;g.$q=f.values;g.Xq=f.gz;g.Zq=f.hz}else if(k=f.L.tsr){g.type=20;f=z(a,b);if(!f){f=b.d.cr;h=[];l=[];for(m=0;m<f;m++)h.push(k.subarray(8*m,8*m+4)),l.push(k.subarray(8*m+4,8*m+8));f={g:h,ta:l};a.Fd.push(b,f)}g.g=f.g;g.ta=f.ta;R.Qg(a)&&R.SA(a,g.g,g.ta)}else return ca.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),
!1;aa.is_armature(a)&&!d&&A(a,c);return!0}function z(a,b){for(var c=a.Fd,d=0;d<c.length;d+=2)if(b==c[d])return c[d+1];return null}function E(a){var b=a.d.Ik;if(-1!=b[0]&&-1!=b[1]){var c=a.B;a=c[b[1]].ic;var d=Math.floor(a),e=a-d,b=c[b[0]];a=b.ic;d=Math.floor(a);b.ic=d+e}}function A(a,b){var c=a.d.Ik,d=c[1];c[0]=-1;c[1]=-1;if(-1!=b)for(var e=a.B;0<=d;d--){var f=e[d];if(f&&10==f.type)if(d>c[1])c[1]=d;else{d>c[0]&&(c[1]=d);break}}}function n(a){var b=a.data.bones;a=a.pose.bones;for(var c={},d=0;d<b.length;d++){var e=
b[d].name;c[e]={Qo:d,Th:d,en:aa.jm(a,"name",e),Ms:-1}}return c}function u(a,b,c,d,e,f){for(var g=0;g<f.length;g+=2)if(b==f[g]){e.push(f[g+1]);d.push(new Float32Array(c.L[a]));break}}function e(a){a=a.d;for(var b in a.L)if(-1!=b.indexOf("nodes"))return!0;return!1}function O(a,b,c,d){if((c=a.B[c])&&null!=c.type&&(c.play||d)){var e=a.d;d=c.ic;var f=c.start,g=c.length;d+=c.speed*b*fa.Ia;var k=c.type,h=c.speed;if(0<=h&&d>=f+g||0>h&&d<f)switch(c.Yh=!0,c.behavior){case 10:d=0<=h?(d-f)%g+f:f+g-1E-6;break;
case 20:d=0<=h?f:f+g-1E-6;c.play=!1;break;case 30:d=0<=h?f+g-1E-6:f,c.play=!1}c.ic=d;switch(k){case 10:if(!e.pe){d=I(c,d,ia);b=d[0];f=d[1];d=d[2];e.pc=c.ta[b];e.oc=c.ta[f];e.wc=c.g[b];e.vc=c.g[f];e.Ff=d;e=e.Ck;c=c.rn;for(g=0;g<e.length;g++)k=e[g],h=c[g],k.pc=h.ta[b],k.oc=h.ta[f],k.wc=h.g[b],k.vc=h.g[f],k.Ff=d;Z.A(a)}break;case 20:k=d=I(c,d,ia);(e=S)||(e=new Float32Array(4));var f=k[0],g=k[1],k=k[2],h=c.g,l=h[f][1],m=h[f][2],n=h[g][1],q=h[g][2];e[0]=(1-k)*h[f][0]+k*h[g][0];e[1]=(1-k)*l+k*n;e[2]=(1-
k)*m+k*q;f=d;(g=ga)||(g=new Float32Array(4));k=c.ta;ha.slerp(k[f[0]].subarray(0,4),k[f[1]].subarray(0,4),f[2],g);f=g;g=d[2];k=c.g;d=(1-g)*k[d[0]][3]+g*k[d[1]][3];c.Kn&&(g=P,Z.get_translation(a,g),aa.smooth_v(e,g,b,c.Kn,e));c.hn&&(g=qa,Z.get_rotation(a,g),aa.ds(f,g,b,c.hn,f));c=c.tj;c[0]&&Z.set_translation(a,e);c[1]&&Z.set_rotation(a,f);c[2]&&Z.set_scale(a,d);Z.A(a);V.sync_transform(a);break;case 30:(a=ia)||(a=Array(3));f=d-c.start;0>f&&(f=0);f>=c.length&&(f=c.length);b=Math.floor(f);d=b+1;f-=b;10!=
c.behavior&&d==c.length&&(d=--b,f=1);c=c.Ks;a[0]=b+c;a[1]=d+c;a[2]=f;d=ia;e.Rn=d[0];e.Js=d[2];break;case 40:d=I(c,d,ia);b=d[0];e=d[1];d=d[2];c.volume&&U.set_volume(a,(1-d)*c.volume[b]+d*c.volume[e]);c.pitch&&U.playrate(a,(1-d)*c.pitch[b]+d*c.pitch[e]);break;case 50:R.Gz(c.nc,d/fa.Ia);break;case 60:d=I(c,d,ia);b=d[0];e=d[1];d=d[2];h=c.$q;l=c.Yq;f=c.Zq;c=c.Xq;for(g=0;g<l.length;g++)m=h[g],k=l[g],a.d.Zd[k]=(1-d)*m[b]+d*m[e];for(g=0;g<c.length;g++)h=f[g],k=c[g],h=ma.lerp(h.subarray(3*b,3*b+3),h.subarray(3*
e,3*e+3),d,S),a.d.mc[k]=h[0],a.d.mc[k+1]=h[1],a.d.mc[k+2]=h[2];break;default:aa.ma("Unknown animation type:"+k)}}}function I(a,b,c){c||(c=Array(3));var d=a.Xk[0],e=a.Xk[1]-d;b-=d;0>b&&(b=0);b>=e&&(b=e);b/=a.vo;e=Math.floor(b);a=a.so[e]?b-e:0;c[0]=e;c[1]=e+1;c[2]=a;return c}function F(a,b){var c=a.d,d=c.oe,e=c.Ik,f=e[0],e=e[1];if(-1!=e){if(-1!=f){var g=a.B[f];if(g.play||0==b)var k=I(g,g.ic,ia),h=k[0],l=k[1],k=k[2],m=g.ta[h],n=g.ta[l],h=g.g[h],l=g.g[l];else d=1}else d=1;e=a.B[e];if(e.play||0==b)var k=
I(e,e.ic,ia),q=k[0],r=k[1],k=k[2];else if(-1!=f&&g.play)d=0;else return;f=e.ta[q];g=e.ta[r];q=e.g[q];e=e.g[r];if(1==d)c.pc.set(f),c.oc.set(g),c.wc.set(q),c.vc.set(e);else if(0==d)c.pc.set(m),c.oc.set(n),c.wc.set(h),c.vc.set(l);else{for(r=0;r<m.length;r+=4){for(var x=ga,u=qa,v=0;4>v;v++)x[v]=m[r+v],u[v]=f[r+v];ha.slerp(x,u,d,x);for(v=0;4>v;v++)c.pc[r+v]=x[v];for(v=0;4>v;v++)x[v]=n[r+v],u[v]=g[r+v];ha.slerp(x,u,d,x);for(v=0;4>v;v++)c.oc[r+v]=x[v]}aa.Mo(h,q,d,c.wc);aa.Mo(l,e,d,c.vc)}Z.A(a);d=c.Ck;m=
c.Vq;for(r=0;r<d.length;r++){n=d[r];h=m[r];for(l=0;l<h.length;l+=2)for(q=h[l],f=h[l+1],g=0;4>g;g++)n.pc[q+g]=c.pc[f+g],n.oc[q+g]=c.oc[f+g],n.wc[q+g]=c.wc[f+g],n.vc[q+g]=c.vc[f+g];n.Ff=k}}}function t(a,b){var c=a.d,d=c.oe,e=c.bl;if(0!=e){var d=c.al-d,f=e*b;aa.sign(d)==aa.sign(e)&&Math.abs(f)<Math.abs(d)?c.oe+=f:(c.oe=c.al,c.bl=0)}}function y(a,b,c){for(var d=a.pose.bones,e=[],f=[],g=b.d.cr,k=0;k<g;k++){for(var h=0;h<d.length;h++){var l=d[h],m=T.create(),n=b.d.oj[l.name];n&&T.copy(n.subarray(8*k,8*
k+8),m);l.qo=m;l.ej=!1}h=L(a,c);e.push(h.g);f.push(h.ta)}return{g:e,ta:f}}function L(a,b){var c=[],d=[],e=a.pose.bones,f=new Float32Array(4),g=new Float32Array(4),k;for(k in b){var h=b[k],l=h.Th,m=e[h.en],h=f,n=g,q=m.du,r=q[q.length-1],x=r.Wk;r.ej||T.identity(x);for(r=q.length-1;0<=r;r--){var m=q[r],u=m.Wk;if(m.ej)x=u;else{var v=m.ro,t=m.qo;T.invert(v,ya);T.multiply(t,ya,ya);T.multiply(v,ya,ya);T.multiply(x,ya,u);x=u;m.ej=!0}}m=m.Wk;h[0]=m[0];h[1]=m[1];h[2]=m[2];h[3]=m[3];n[0]=m[4];n[1]=m[5];n[2]=
m[6];n[3]=m[7];ha.normalize(n,n);for(h=0;4>h;h++)n=4*l+h,c[n]=f[h],d[n]=g[h]}c=new Float32Array(c);d=new Float32Array(d);return{g:c,ta:d}}function C(a){var b=[0,0,0],c;for(c in a)"location"==c?b[0]=1:"rotation_quaternion"==c?b[1]=1:"scale"==c&&(b[2]=1);return b}function H(a,b,c,d,e,f,g){var k=a+(b-a)/2,h=K(k,d,e,f,g)-c;return.02>Math.abs(h)?k:0<h?H(a,k,c,d,e,f,g):H(k,b,c,d,e,f,g)}function K(a,b,c,d,e){var f=1-a;return b*f*f*f+3*c*f*f*a+3*d*f*a*a+e*a*a*a}function M(a,b){if(!a.B.length)for(var c=0;8>
c;c++)a.B.push(null);a.B[b]={type:null,xg:null,Xk:null,vo:0,so:null,tj:null,ta:null,g:null,rn:[],play:!1,behavior:20,ic:0,start:0,length:0,Kn:0,hn:0,Yh:!1,Ks:null,speed:1,volume:null,pitch:null,$q:[],Yq:[],Zq:[],Xq:[]};a.Fd=a.Fd||[];-1==ba.indexOf(a)&&ba.push(a)}function G(a,b){Z.A(a);V.sync_transform(a);r(a,0,b,!0)}function v(a,c,d){d=d||0;if(aa.is_mesh(a)){var e=aa.keysearch("name",c,a.data.b4w_vertex_anim);if(e)return M(a,d),b(a,e,d),G(a,d),!0;if((e=aa.keysearch("name",c,a.particle_systems))&&
"EMITTER"==e.settings.type)return M(a,d),h(a,e,d),G(a,d),!0}if(e=aa.keysearch("name",c,Y)||aa.keysearch("name",c+"_B4W_BAKED",Y)){M(a,d);if(q(a,e,d))return G(a,d),!0;a.B[d]=null}ca.error('Unsupported object: "'+a.name+'" or animation name: "'+c+'"');return!1}function N(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c.use_nodes&&d&&d.animation_data)return!0}return!1}var J=p("__config"),R=p("__particles"),V=p("__physics"),
ca=p("__print");p("__scenes");var U=p("__sfx"),Z=p("__transform"),T=p("__tsr"),aa=p("__util"),w=p("__reformer");p("mat4");var ha=p("quat");p("vec4");var ma=p("vec3"),fa=J.Hd;a.OBJ_ANIM_TYPE_ARMATURE=10;a.OBJ_ANIM_TYPE_OBJECT=20;a.OBJ_ANIM_TYPE_VERTEX=30;a.OBJ_ANIM_TYPE_SOUND=40;a.OBJ_ANIM_TYPE_PARTICLES=50;a.OBJ_ANIM_TYPE_MATERIAL=60;a.SLOT_0=0;a.SLOT_1=1;a.SLOT_2=2;a.SLOT_3=3;a.SLOT_4=4;a.SLOT_5=5;a.SLOT_6=6;a.SLOT_7=7;a.SLOT_ALL=-1;a.AB_CYCLIC=10;a.AB_FINISH_RESET=20;a.AB_FINISH_STOP=30;var ia=
Array(3),S=new Float32Array(3),P=new Float32Array(3),ga=new Float32Array(4),qa=new Float32Array(4),ya=new Float32Array(8);new Float32Array(16);var ba=[],Y=[];a.frame_to_sec=function(a){return a/fa.Ia};a.update=function(a){for(var b=0;b<ba.length;b++){for(var d=ba[b],e=0;8>e;e++)O(d,a,e);d.d.pe&&(t(d,a),F(d,a))}for(b=0;b<ba.length;b++)for(d=ba[b],e=0;8>e&&d.B.length;e++)c(d,e)};a.gx=function(){return Y};a.get_anim_names=function(a){var b=[];if(m(a))for(var c=0;c<a.data.b4w_vertex_anim.length;c++)b.push(a.data.b4w_vertex_anim[c].name);
var f,c=[];for(f=0;f<Y.length;f++){var g=Y[f],k=g.d;aa.ed(g.d.oj)?"ARMATURE"==a.type&&c.push(g):k.L.volume||k.L.pitch?U.Xd(a)&&c.push(g):!e(g)&&aa.ed(g.fcurves)&&c.push(g)}"MESH"==a.type&&(c=c.concat(l(a)));f=c;for(c=0;c<f.length;c++)b.push(d(f[c].name));if(R.Qg(a)&&R.pm(a))for(c=0;c<a.particle_systems.length;c++)b.push(a.particle_systems[c].name);return b};a.gA=d;a.get_anim_type=function(a,b){var c=a.B[b];return c?c.type:null};a.apply_def=function(a){var c=0,d,e=[];if((d=a.animation_data)&&d.action&&
(d=d.action,aa.ed(d.fcurves))){var g=aa.ed(d.d.oj);"ARMATURE"!=a.type&&g||e.push(d)}U.Xd(a)&&a.data.animation_data&&a.data.animation_data.action&&e.push(a.data.animation_data.action);"MESH"==a.type&&(e=e.concat(l(a)));d=e;for(e=0;e<d.length;e++)g=d[e],M(a,c),q(a,g,c)?(G(a,c),a.B[c].behavior=f(a.b4w_anim_behavior),c++):a.B[c]=null;d=a.particle_systems;for(e=0;e<d.length;e++){var g=d[e],k=g.settings;"EMITTER"==k.type&&(M(a,c),h(a,g,c),G(a,c),a.B[c].behavior=f(a.b4w_anim_behavior),k.b4w_cyclic&&(a.B[c].behavior=
10),c++)}m(a)&&(M(a,c),b(a,a.data.b4w_vertex_anim[0],c),G(a,c),a.B[c].behavior=f(a.b4w_anim_behavior))};a.get_first_armature_object=k;a.play=function(a,b,c){x(a.B,c,function(a){a.play=!0;a.Xl=b?b:null;a.Yh=!1});a.d.pe&&E(a)};a.stop=function(a,b){x(a.B,b,function(a){a.play=!1;a.Xl=null;a.Yh=!1})};a.is_play=function(a,b){var c=a.B[b];return c?c.play:!1};a.set_current_frame_float=function(a,b,c){var d=a.B;if(-1==c)for(c=0;8>c;c++){var e=d[c];e&&(e.ic=b,r(a,0,c,!0))}else if(e=d[c])e.ic=b,r(a,0,c,!0)};
a.get_current_frame_float=function(a,b){var c=a.B[b];return c&&c.ic?c.ic:0};a.is_cyclic=function(a,b){var c=a.B[b];return c&&10==c.behavior};a.set_behavior=function(a,b,c){x(a.B,c,function(a){a.behavior=b})};a.get_behavior=function(a,b){var c=a.B[b];return c&&c.behavior};a.apply_smoothing=function(a,b,c,d){x(a.B,d,function(a){a.Kn=b||0;a.hn=c||0})};a.remove_slot_animation=function(a,b){if(-1==b)for(var c=0;8>c;c++)a.B[c]=null;else a.B[b]=null;a.d.pe&&A(a,b)};a.update_object_animation=r;a.Tj=function(a){if("ARMATURE"==
a.type||k(a))return!0;var b=a.animation_data;return b&&b.action||"SPEAKER"==a.type&&a.data.animation_data&&a.data.animation_data.action||R.Qg(a)&&R.pm(a)||"MESH"==a.type&&a.data.b4w_vertex_anim.length||N(a)?!0:!1};a.is_animated=function(a){return Boolean(a.B.length)};a.Xu=n;a.To=L;a.nu=function(a){function b(a,c){for(var d=0;d<c;d++){var e=a.subarray(8*d+4,8*d+8);ha.normalize(e,e)}}function c(a,b){if(-1<a.indexOf("location"))var d=0,e=b;else-1<a.indexOf("rotation_quaternion")?(d=4,e=0==b?3:b-1):-1<
a.indexOf("scale")?(d=3,e=0):(d=0,e=b);return d+e}function d(a,b,c,e,k){if(-1<c.search(f)){a=b;c=c.split('"')[1];var h=g}else 8==k?(c="tsr",h=g):h=1<k?new Float32Array(k):0;if(!a[c]){k=a;b=c;if("object"==typeof h&&h.length)for(var l=h.length,m=new Float32Array(e*l),n=0;n<e;n++)for(var q=0;q<l;q++)m[n*l+q]=h[q];else if("number"==typeof h)for(m=new Float32Array(e),n=0;n<e;n++)m[n]=h;else aa.ma("Wrong storage default value");k[b]=m}return a[c]}a.d={};var e=a.d;e.Ky=1/fa.Gf;var f=new RegExp(/pose.bones\[\".+\"\]/g),
g=T.create(),k=a.fcurves,h={},l={},m=0,n;for(n in k){var q=k[n],r;for(r in q){var x=q[r],u=x.ec;w.bv(x,a);x=x.num_channels;m||(m=u.length);for(var x=d(h,l,n,m,x),v=x.length/m,t=c(n,r|0),z=0;z<m;z++)x[z*v+t]=u[z]}}for(var p in h)"tsr"==p&&b(h[p],m);for(var A in l)b(l[A],m);e.L=h;e.oj=l;e.Qu=a.cu;e.cr=m;e.tj="tsr"in h?C(k):null;Y.push(a)};a.kx=function(a,b){return(b-a)*fa.Gf+1};a.Hu=function(a,b,c,d,e,f){var g,k,h=new Float32Array(2),l=new Float32Array(2),m=new Float32Array(2),n=new Float32Array(2),
q=b[1],r=b[2],x=b[a.last_frame_offset+1];a=b[a.last_frame_offset+2];for(var u=0,v=0,t=null;e<=f;e++)if(e<q)for(var z=0;z<fa.Gf;z++)c[u++]=r;else if(e>x)for(z=0;z<fa.Gf;z++)c[u++]=a;else{var p=b[v],A=3;0===p&&(A+=2);0===t&&(A+=2);var w=2===p?0:1;if(b[v+1]==b[v+A+1])t=p,v+=A;else{z=0;e==b[v+1]&&(w&&(d[u]=1),c[u]=b[v+2],u++,z++);if(e==x)for(;z<fa.Gf;z++)c[u++]=a;else for(h[0]=b[v+1],h[1]=b[v+2],0!==p?(l[0]=0,l[1]=0):0===t?(l[0]=b[v+5],l[1]=b[v+6]):(l[0]=b[v+3],l[1]=b[v+4]),0!==p?(m[0]=0,m[1]=0):(m[0]=
b[v+A+3],m[1]=b[v+A+4]),n[0]=b[v+A+1],n[1]=b[v+A+2];z<fa.Gf;z++){var S=e+z/fa.Gf;switch(p){case 0:g=h;k=l;var y=m,E=n,P=[],N=[],C=void 0,ga=void 0,G=void 0,C=void 0;P[0]=g[0]-k[0];P[1]=g[1]-k[1];N[0]=E[0]-y[0];N[1]=E[1]-y[1];G=E[0]-g[0];C=Math.abs(P[0]);ga=Math.abs(N[0]);0!=C+ga&&C+ga>G&&(C=G/(C+ga),k[0]=g[0]-C*P[0],k[1]=g[1]-C*P[1],y[0]=E[0]-C*N[0],y[1]=E[1]-C*N[1]);w&&(d[u]=1);c[u]=K(H(0,1,S,h[0],l[0],m[0],n[0]),h[1],l[1],m[1],n[1]);u++;break;case 1:k=h[0];y=h[1];g=E=(n[1]-y)/(n[0]-k);k=y-E*k;w&&
(d[u]=1);c[u]=g*S+k;u++;break;case 2:w&&(d[u]=1);c[u]=b[v+2];u++;break;default:aa.ma("Unknown keyframe intepolation mode: "+p)}}e+1==b[v+A+1]&&(t=p,v+=A)}}};a.wC=function(a){for(var b=0;b<a.length;b++)if(a[b].GB)return a[b];return!1};a.apply=v;a.Cu=function(a,b,c){c=c||0;var d=aa.keysearch("uuid",b,Y);if(d){M(a,c);if(q(a,d,c)){G(a,c);return}a.B[c]=null}ca.error('Unsupported object: "'+a.name+'" or animation uuid: "'+b+'"')};a.cB=function(a,b){var c=aa.keysearch("name",b,Y)||aa.keysearch("name",b+
"_B4W_BAKED",Y);return c?aa.ed(c.fcurves)?!0:!1:aa.keysearch("name",b,a.particle_systems)?!0:!1};a.get_slot_num_by_anim=function(a,b){for(var c=a.B,e=0;e<c.length;e++){var f=c[e];if(f&&d(f.xg)==d(b))return e}return-1};a.ix=function(a,b){var c=a.B[b];return c&&c.xg?d(c.xg):null};a.remove=function(a){a.B.length=0;a=ba.indexOf(a);-1!=a&&ba.splice(a,1)};a.Zy=function(a){for(var b=Y.length-1;0<=b;b--)Y[b].eu==a&&Y.splice(b,1)};a.apply_to_first_empty_slot=function(a,b){if(!a.B.length)return v(a,b,0)?0:
-1;for(var c=0;c<a.B.length;c++)if(!a.B[c])return v(a,b,c)?c:-1};a.set_skel_mix_factor=function(a,b,c){a.d.bl=(b-a.d.oe)/c;a.d.al=b};a.set_speed=function(a,b,c){x(a.B,c,function(a){a.speed=b})};a.get_speed=function(a,b){return a.B[b].speed};a.get_anim_start_frame=function(a,b){return a.B[b].start};a.get_anim_length=function(a,b){return a.B[b].length};a.qq=N;a.cleanup=function(){ba.length=0;Y.length=0};a.Kw=function(a,b){var c=a[b],d=(c[0]||c[1]||c[2]).ec.length,e=ga,f=S,g=Boolean(c[0]);g||(c[0]={ec:new Float32Array(d),
num_channels:8});var k=Boolean(c[1]);k||(c[1]={ec:new Float32Array(d),num_channels:8});var h=Boolean(c[2]);h||(c[2]={ec:new Float32Array(d),num_channels:8});c[3]={ec:new Float32Array(d),num_channels:8};for(var l=0;l<d;l++)f[0]=g?c[0].ec[l]:0,f[1]=k?c[1].ec[l]:0,f[2]=h?c[2].ec[l]:0,aa.euler_to_quat(f,e),c[0].ec[l]=e[3],c[1].ec[l]=e[0],c[2].ec[l]=e[1],c[3].ec[l]=e[2];d=b.replace("euler","quaternion");a[d]=c;delete a[b]}};b4w.module.__time=function(a,p){p("__util");var c=0,b=0,h=[],d=0,f=[];a.Wr=function(a){c=a;b=performance.now();for(a=0;a<h.length;a++){var d=h[a];c>d.Ul&&(h.splice(a,1),a--,d.callback())}for(a=0;a<f.length;a++){var d=f[a],m=1-(d.Ul-c)/d.duration,m=Math.min(m,1);d.callback(d.K+m*(d.ca-d.K));1==m&&(f.splice(a,1),a--)}};a.Og=function(){return c};a.set_timeout=function(a,f){var m;d++;m=d;h.push({id:m,callback:a,Ul:c+(performance.now()-b+f)/1E3});return m};a.uj=function(a){for(var b=0;b<h.length;b++)if(h[b].id==
a){h.splice(b,1);break}};a.animate=function(a,b,d,k){d/=1E3;f.push({callback:k,K:a,ca:b,Ul:c+d,duration:d});k(a)};a.reset=function(){b=c=0;d=h.length=0}};b4w.module.__transform=function(a,p){function c(a,b){var c=a.d;c.g[0]=b[0];c.g[1]=b[1];c.g[2]=b[2];c.scale=b[3];c.quat[0]=b[4];c.quat[1]=b[5];c.quat[2]=b[6];c.quat[3]=b[7]}function b(a){var c=a.d;"CAMERA"==a.type&&d.On(a);f.IA(a,F);"CAMERA"==a.type&&d.FA(a);var e=c.g,q=c.scale,u=c.quat;x.set_sep(e,q,u,c.ub);var p=c.T;n.identity(p);n.fromQuat(u,p);"CAMERA"!=a.type&&r.mz(p,q,p);p[12]=e[0];p[13]=e[1];p[14]=e[2];n.invert(p,c.zq);a.B.length&&g.pm(a)&&g.JA(a);c.Ib&&c.Wa&&(h.pl(c.Ib,p,c.Wa),h.rl(c.Lc,p,
c.xb),h.ql(c.sf,c.ub,c.tf),c.rc&&m.nn(m.get_active()));switch(a.type){case "SPEAKER":k.Yz(a,F);break;case "CAMERA":d.GA(a);m.Z()&&m.Jj(m.get_active())==a&&k.jy(m.get_active(),e,u,F);break;case "LAMP":l.KA(a);m.Z()&&m.mg(a,m.get_active());break;case "EMPTY":a.field&&m.Ds(a)}"LAMP"!=a.type&&"CAMERA"!=a.type||!m.Z()||(e=m.get_active(),m.nn(e),m.pz(e));if("MESH"==a.type){q=a.modifiers;u=null;for(e=0;e<q.length;e++)p=q[e],"ARMATURE"==p.type&&(u=p.object);u&&(x.invert(u.d.ub,I),x.multiply(I,c.ub,I),z.set(I[0],
I[1],I[2],I[3],c.fl),E.set(I[4],I[5],I[6],I[7],c.el))}a=a.yc;for(e=0;e<a.length;e++)b(a[e]);c.bm=!0}var h=p("__boundings"),d=p("__camera"),f=p("__constraints"),l=p("__lights"),g=p("__particles"),m=p("__scenes"),k=p("__sfx"),x=p("__tsr"),r=p("__util"),q=p("vec3"),z=p("vec4"),E=p("quat"),A=p("mat3"),n=p("mat4"),u=new Float32Array(3),e=new Float32Array(4),O=new Float32Array(9),I=new Float32Array(8),F=0;a.SPACE_WORLD=0;a.SPACE_LOCAL=1;a.update=function(a){F=a};a.set_translation=function(a,b){f.Vd(a)==
f.Ad?x.set_trans(b,f.Ud(a)):a.d.g.set(b)};a.get_translation=function(a,b){f.Vd(a)==f.Ad?q.copy(x.get_trans_view(f.Ud(a)),b):q.copy(a.d.g,b)};a.set_rotation=function(a,b){f.Vd(a)==f.Ad?x.set_quat(b,f.Ud(a)):a.d.quat.set(b)};a.get_rotation=function(a,b){f.Vd(a)==f.Ad?E.copy(x.get_quat_view(f.Ud(a)),b):E.copy(a.d.quat,b)};a.set_rotation_euler=function(a,b){if(f.Vd(a)==f.Ad){var c=r.euler_to_quat(b,e);x.set_quat(c,f.Ud(a))}else r.euler_to_quat(b,a.d.quat)};a.set_scale=function(a,b){f.Vd(a)==f.Ad?x.set_scale(b,
f.Ud(a)):a.d.scale=b};a.get_scale=function(a){return f.Vd(a)==f.Ad?x.get_scale(f.Ud(a)):a.d.scale};a.get_tsr=function(a,b){if(f.Vd(a)==f.Ad)x.copy(f.Ud(a),b);else{var c=a.d;x.set_sep(c.g,c.scale,c.quat,b)}};a.set_tsr=function(a,b){f.Vd(a)==f.Ad?x.copy(b,f.Ud(a)):c(a,b)};a.Hz=c;a.get_object_size=function(a){var b=a.d,c=a.data.b4w_bounding_box;a=b.scale*(c.max_x-c.min_x);var d=b.scale*(c.max_y-c.min_y),b=b.scale*(c.max_z-c.min_z);return.5*Math.sqrt(a*a+d*d+b*b)};a.get_object_center=function(a,b,c){c||
(c=new Float32Array(3));b?(b=a.d,q.copy(b.xb.D,c)):(b=a.d,a=a.data.b4w_bounding_box,c[0]=(a.max_x+a.min_x)/2,c[1]=(a.max_y+a.min_y)/2,c[2]=(a.max_z+a.min_z)/2,q.transformMat4(c,b.T,c));return c};a.move_local=function(a,b,c,d){a=a.d;u[0]=b;u[1]=c;u[2]=d;b=A.fromMat4(a.T,O);q.transformMat3(u,b,u);q.add(a.g,u,a.g)};a.A=b;a.distance=function(a,b){return q.dist(a.d.g,b.d.g)};a.Fy=function(a,b){return q.dist(a.d.g,b)};a.get_object_bounding_box=function(a){return{max_x:a.d.Wa.max_x,min_x:a.d.Wa.min_x,max_y:a.d.Wa.max_y,
min_y:a.d.Wa.min_y,max_z:a.d.Wa.max_z,min_z:a.d.Wa.min_z}}};b4w.module.__tsr=function(a,p){function c(a,b,c,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=b;d[4]=c[0];d[5]=c[1];d[6]=c[2];d[7]=c[3]}function b(a,b,c){var d=b[0],f=b[1],g=b[2],h=b[3],l=b[4],n=b[5],u=b[6];b=b[7];var e=a[0]*h,p=a[1]*h,I=a[2]*h;a=b*e+n*I-u*p;var h=b*p+u*e-l*I,F=b*I+l*p-n*e,e=-l*e-n*p-u*I;c[0]=a*b+e*-l+h*-u-F*-n;c[1]=h*b+e*-n+F*-l-a*-u;c[2]=F*b+e*-u+a*-n-h*-l;c[0]+=d;c[1]+=f;c[2]+=g;return c}var h=p("__util"),d=p("vec3"),f=p("quat");p("mat4");var l=new Float32Array(3),g=new Float32Array(4);
new Float32Array(16);a.create=function(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a};a.copy=function(a,b){b.set(a)};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.create_sep=function(a,b,d,f){f||(f=new Float32Array(8));c(a,b,d,f);return f};a.set_sep=c;a.set_trans=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2]};a.set_scale=function(a,b){b[3]=a};a.set_transcale=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3]};a.set_quat=function(a,b){b[4]=a[0];b[5]=
a[1];b[6]=a[2];b[7]=a[3]};a.get_trans_view=function(a){return a.subarray(0,3)};a.get_scale=function(a){return a[3]};a.get_quat_view=function(a){return a.subarray(4)};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var d=a[0],h=a[1],l=a[2];g[0]=a[4];g[1]=a[5];g[2]=a[6];g[3]=a[7];f.invert(g,g);var p=g[0],A=g[1],n=g[2],u=g[3],d=d*c,h=h*c,e=l*c,l=u*d+A*e-n*h,O=u*h+n*d-p*e,I=u*e+p*h-A*d,d=-p*d-A*h-n*e;b[0]=-(l*u+d*-p+O*-n-I*-A);b[1]=-(O*u+d*-A+I*-p-l*-n);b[2]=-(I*u+d*-n+l*-A-O*-p);b[3]=c;b[4]=p;
b[5]=A;b[6]=n;b[7]=u;return b};a.from_mat4=function(a,b){var d=h.Wg(a,l),f=h.Om(a),q=h.matrix_to_quat(a,g);c(d,f,q,b);return b};a.multiply=function(a,c,d){b(c,a,d);d[3]=a[3]*c[3];var f=a[4],g=a[5],h=a[6];a=a[7];var l=c[4],p=c[5],n=c[6];c=c[7];d[4]=f*c+a*l+g*n-h*p;d[5]=g*c+a*p+h*l-f*n;d[6]=h*c+a*n+f*p-g*l;d[7]=a*c-f*l-g*p-h*n;return d};a.transform_vec3=b;a.transform_vec3_inv=function(a,b,c){var d=b[3],f=a[0]-b[0],g=a[1]-b[1],h=a[2]-b[2];a=b[4];var l=b[5],n=b[6];b=b[7];var u=a*a+l*l+n*n+b*b,u=u?1/u:
0;a=-a*u;l=-l*u;n=-n*u;b*=u;var u=b*f+l*h-n*g,e=b*g+n*f-a*h,p=b*h+a*g-l*f,f=-a*f-l*g-n*h;c[0]=u*b+f*-a+e*-n-p*-l;c[1]=e*b+f*-l+p*-a-u*-n;c[2]=p*b+f*-n+u*-l-e*-a;c[0]/=d;c[1]/=d;c[2]/=d;return c};a.transform_vectors=function(a,b,c,d){d||(d=0);var f=a.length,g=b[0],h=b[1],l=b[2],n=b[3],u=b[4],e=b[5],p=b[6];b=b[7];for(var I=0;I<f;I+=3){var F=a[I]*n,t=a[I+1]*n,y=a[I+2]*n,L=b*F+e*y-p*t,C=b*t+p*F-u*y,H=b*y+u*t-e*F,F=-u*F-e*t-p*y;c[d+I]=L*b+F*-u+C*-p-H*-e;c[d+I+1]=C*b+F*-e+H*-u-L*-p;c[d+I+2]=H*b+F*-p+L*
-e-C*-u;c[d+I]+=g;c[d+I+1]+=h;c[d+I+2]+=l}return c};a.transform_dir_vectors=function(a,b,c,d){d||(d=0);var f=a.length,g=b[3],h=b[4],l=b[5],n=b[6];b=b[7];for(var u=0;u<f;u+=3){var e=a[u]*g,p=a[u+1]*g,I=a[u+2]*g,F=b*e+l*I-n*p,t=b*p+n*e-h*I,y=b*I+h*p-l*e,e=-h*e-l*p-n*I;c[d+u]=F*b+e*-h+t*-n-y*-l;c[d+u+1]=t*b+e*-l+y*-h-F*-n;c[d+u+2]=y*b+e*-n+F*-l-t*-h}return c};a.transform_dir_vec3=function(a,b,c){var d=b[3],f=b[4],g=b[5],h=b[6];b=b[7];var l=a[0]*d,n=a[1]*d,u=a[2]*d;a=b*l+g*u-h*n;var d=b*n+h*l-f*u,e=b*
u+f*n-g*l,l=-f*l-g*n-h*u;c[0]=a*b+l*-f+d*-h-e*-g;c[1]=d*b+l*-g+e*-f-a*-h;c[2]=e*b+l*-h+a*-g-d*-f;return c};a.transform_tangents=function(a,b,c,d){d||(d=0);var f=a.length,g=b[3],h=b[4],l=b[5],n=b[6];b=b[7];for(var u=0;u<f;u+=4){var e=a[u]*g,p=a[u+1]*g,I=a[u+2]*g,F=b*e+l*I-n*p,t=b*p+n*e-h*I,y=b*I+h*p-l*e,e=-h*e-l*p-n*I;c[d+u]=F*b+e*-h+t*-n-y*-l;c[d+u+1]=t*b+e*-l+y*-h-F*-n;c[d+u+2]=y*b+e*-n+F*-l-t*-h;c[d+u+3]=a[u+3]}return c};a.translate=function(a,b,c){var d=a[3],f=a[4],g=a[5],h=a[6],l=a[7],n=b[0]*
d,u=b[1]*d,e=b[2]*d;b=l*n+g*e-h*u;var d=l*u+h*n-f*e,p=l*e+f*u-g*n,n=-f*n-g*u-h*e;c[0]=a[0]+b*l+n*-f+d*-h-p*-g;c[1]=a[1]+d*l+n*-g+p*-f-b*-h;c[2]=a[2]+p*l+n*-h+b*-g-d*-f;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.interpolate=function(a,b,c,g){g||(g=new Float32Array(8));d.lerp(a.subarray(0,3),b.subarray(0,3),c,g.subarray(0,3));var h=a[3];g[3]=h+c*(b[3]-h);f.slerp(a.subarray(4),b.subarray(4),c,g.subarray(4));return g};a.tC=function(a,b,c,d){d||(d=new Float32Array(8));var g=a.subarray(0,
3),h=b.subarray(0,3),l=d.subarray(0,3);l[0]=h[0]*(c+1)-g[0]*c;l[1]=h[1]*(c+1)-g[1]*c;l[2]=h[2]*(c+1)-g[2]*c;d[3]=b[3]*(c+1)-a[3]*c;a=a.subarray(4);b=b.subarray(4);g=d.subarray(4);g[0]=b[0]*(c+1)-a[0]*c;g[1]=b[1]*(c+1)-a[1]*c;g[2]=b[2]*(c+1)-a[2]*c;g[3]=b[3]*(c+1)-a[3]*c;f.normalize(g,g);return d};a.Ux=function(a,b,c,d,f){f[0]=a[0]+b*c[0];f[1]=a[1]+b*c[1];f[2]=a[2]+b*c[2];f[3]=a[3];c=d[0];var g=d[1];d=d[2];var h=a[4],l=a[5],n=a[6],u=a[7];f[4]=.5*(c*u+g*n-d*l);f[5]=.5*(g*u+d*h-c*n);f[6]=.5*(d*u+c*l-
g*h);f[7]=.5*(-c*h-g*l-d*n);f[4]=a[4]+f[4]*b;f[5]=a[5]+f[5]*b;f[6]=a[6]+f[6]*b;f[7]=a[7]+f[7]*b;a=f[4];b=f[5];c=f[6];g=f[7];a=a*a+b*b+c*c+g*g;0<a&&(a=1/Math.sqrt(a),f[4]*=a,f[5]*=a,f[6]*=a,f[7]*=a)}};b4w.module.__util=function(a,p){function c(a,b,c){for(var d=[],e=c.length,f=0;f<e;f++){var g=c[f];g[a]==b&&d.push(g)}return d}function b(a,c){var d=a instanceof Array?[]:{},e;for(e in a)d[e]=!a[e]||"object"!=typeof a[e]||-1!=c.indexOf(a[e])||a[e]instanceof Float32Array?a[e]:b(a[e],c);return d}function h(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=Math.sqrt(b*b+c*c+d*d),f=1/f;a[0]=b*f;a[1]=c*f;a[2]=d*f;a[3]=e*f}function d(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function f(a,b){var c=b;switch(typeof a){case "number":return l(a,
c);case "string":return g(a,c);case "boolean":return l(a|0,c);case "function":case "undefined":return l(0,c);case "object":if(a){var d=a instanceof Array;if(a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength)for(d=0;d<a.length;d++)c=l(a[d],c);else if(d)for(d=0;d<a.length;d++)c=f(a[d],c);else for(var e in a)c=f(a[e],c)}else c=l(0,c)}return c}function l(a,b){var c=b;J[0]=a;c=(c<<5)-c+R[0];c&=c;c=(c<<5)-c+R[1];return c&c}function g(a,b){for(var c=b,d=0;d<a.length;d++)c=(c<<5)-c+a.charCodeAt(d),
c&=c;return c}function m(a){return(34*a+1)*a%289}function k(a){return a-Math.floor(a)}function x(a){return r((34*a+5)*a)}function r(a){return a-289*Math.floor(a/289)}function q(a){return a-7*Math.floor(a/7)}function z(a,b,c){a-=b;c-=b;return b+(a-Math.floor(a/c)*c)}function E(a){return z(a,0,2*Math.PI)}function A(a,b){if(a&&b){var c=a instanceof Array,d=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength,e=b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength;if(c!=b instanceof Array||
d!=e)return!1;if(c){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(!n(a[c],b[c]))return!1}else if(d){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(a[c]!=b[c])return!1}else{for(var f in a)if(!n(a[f],b[f]))return!1;for(f in b)if(!(f in a))return!1}return!0}return!(a||b)}function n(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return A(a,b);default:return!0}}var u=p("__print"),e=p("vec3"),O=p("vec4"),I=p("quat"),
F=p("mat3"),t=p("mat4"),y=0,L={},C=new Float32Array(3),H=new Float32Array(3),K=new Float32Array(4),M=new Float32Array(4),G=new Float32Array(9),v=new Float32Array(16),N=new Float32Array(16),J=new Float64Array(1),R=new Uint32Array(J.buffer),V=new Float32Array([0,0,0]),ca=new Float32Array([0,0,0,1]),U=new Float32Array([0,0,0,1,0,0,0,1]),Z=new Float32Array([1,0,0]),T=new Float32Array([0,1,0]),aa=new Float32Array([0,0,1]),w=new Float32Array([-1,0,0]),ha=new Float32Array([0,-1,0]),ma=new Float32Array([0,
0,-1]),fa=Math.floor(44488.07041494893);a.bu=V;a.Wt=ca;a.DB=U;a.AXIS_X=Z;a.AXIS_Y=T;a.AXIS_Z=aa;a.AXIS_MX=w;a.AXIS_MY=ha;a.AXIS_MZ=ma;a.keyfind=c;a.Mw=function(a,b){var c=a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.xA=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);d.set(b,c);return d};a.hv=function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.Iu=function(a,b){var c=[],d={},e=b.length,f,g;for(f=0;f<e;f++)d[b[f]]=
!0;e=a.length;for(f=0;f<e;f++)g=a[f],g in d&&c.push(g);return c};a.sign=function(a){return 0<a?1:0>a?-1:0};a.iD=function(a,b,c){for(var d=c.length,e=0;e<d;e++)if(c[e][a]==b)return!0;return!1};a.keysearch=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.hD=function(a,b,c,d,e){for(var f=0;f<e.length;f++){var g=e[f];if(g[a]==b&&g[c]==d)return g}return null};a.jm=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]==c)return d;return-1};a.Bu=function(a,b){for(var c=
0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.cC=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<a.length;d++)if(c==a[d])return!1;return!0};a.wD=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e.type==b&&c.push(e)}return c};a.uD=function(a,b){var d=c("name",b,a);1<d.length&&u.error("obj_by_name(): name resolution ambiguity");return d};a.vD=function(a,b){var d=c("name",b,a),e=d.length;1<e&&u.error("obj_by_name(): name resolution ambiguity");if(0>=e)return[];for(var f=[],
g=0;g<e;g++){var h=d[g];if("EMPTY"==h.type&&h.dupli_group)for(var h=h.dupli_group.objects,k=0;k<h.length;k++)f.push(h[k])}return d=d.concat(f)};a.uA=function(a,b,c,d){d||(d=new Float32Array(16));t.identity(d);d[12]=a;d[13]=b;d[14]=c};var ia=1;a.Uy=function(){ia=(69069*ia+5)%Math.pow(2,32);return Math.round(ia/65536)%32768/32767};a.eA=function(a){ia=a};a.Hc=function(a){var b=a[0]%fa*48271-3399*Math.floor(a[0]/fa);a[0]=0<b?b:b+2147483647;return(a[0]-1)/2147483646};a.Rj=function(a,b){b||(b=[]);b[0]=
5E4+Math.floor(a);return b};a.euler_to_quat=function(a,b){var c=Math.cos(a[1]/2),d=Math.cos(a[2]/2),e=Math.cos(a[0]/2),f=Math.sin(a[1]/2),g=Math.sin(a[2]/2),h=Math.sin(a[0]/2);b[0]=f*g*e+c*d*h;b[1]=f*d*e+c*g*h;b[2]=c*g*e-f*d*h;b[3]=c*d*e-f*g*h;return b};a.Aw=function(a){var b=F.create(),c=Math.cos(a[0]),d=Math.cos(a[1]),e=Math.cos(a[2]),f=Math.sin(a[0]),g=Math.sin(a[1]);a=Math.sin(a[2]);var h=c*e,k=c*a,l=f*e,m=f*a;b[0]=d*e;b[1]=d*a;b[2]=-g;b[3]=g*l-k;b[4]=g*m+h;b[5]=d*f;b[6]=g*h+m;b[7]=g*k-l;b[8]=
d*c;return b};a.quat_to_euler=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=e*e,h=c*d+e*f;.499999<h?(b[0]=0,b[1]=2*Math.atan2(c,f),b[2]=Math.PI/2):-.499999>h?(b[0]=0,b[1]=-2*Math.atan2(c,f),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*c*f-2*d*e,1-2*c*c-2*g),b[1]=Math.atan2(2*d*f-2*c*e,1-2*d*d-2*g),b[2]=Math.asin(2*c*d+2*e*f));return b};a.quat_to_dir=function(a,b,c){c||(c=new Float32Array(3));e.transformQuat(b,a,c);return c};a.oC=function(a,b,c){c||(c=new Float32Array(4));a=e.normalize(a,C);var d=e.dot(b,
a);a=e.cross(b,a,H);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};a.vA=function(a,b,c,d){d||(d=new Float32Array(4));e.transformQuat(c,b,d);d[3]=-e.dot(a,d)};a.sw=function(a){var b=a.d.quat;switch(a.type){case "CAMERA":C[0]=0;C[1]=-1;C[2]=0;e.transformQuat(C,b,C);H[0]=0;H[1]=0;H[2]=-1;break;case "MESH":C[0]=0;C[1]=0;C[2]=1;e.transformQuat(C,b,C);H[0]=0;H[1]=0;H[2]=1;break;case "EMPTY":C[0]=0,C[1]=1,C[2]=0,e.transformQuat(C,b,C),
H[0]=0,H[1]=1,H[2]=0}C[1]=0;e.normalize(C,C);a=e.dot(C,H);return Math.acos(a)*(0<-C[0]*H[2]?-1:1)};a.Mo=function(a,b,c,d){if(0!=c){d=d||[];for(var e=0;e<a.length;e++)d[e]=(1-c)*a[e]+c*b[e]}};a.QD=function(){y++;return y.toString(16)};a.Jk=function(a){L[a]||(L[a]=0);var b=a+L[a];L[a]++;return b};a.Mc=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.gb=function(a){var b={a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};
return{name:a,I:0,aa:null,w:[],F:b,X:[]}};a.xf=function(a){return JSON.parse(JSON.stringify(a))};a.eC=function(a,c){var d=[],e;for(e in c){var f=c[e];if(f)for(var g=0;g<f.length;g++)d.push(f[g])}return b(a,d)};a.wa=function(b){var c=b instanceof Array?[]:{},d;for(d in b)c[d]=b[d]&&"object"==typeof b[d]?b[d]instanceof Float32Array?new Float32Array(b[d]):b[d]instanceof Uint32Array?new Uint32Array(b[d]):b[d]instanceof Uint16Array?new Uint16Array(b[d]):a.wa(b[d]):b[d];return c};a.vj=function(a){var b=
a instanceof Array?[]:{},c;for(c in a)b[c]=a[c]&&"object"==typeof a[c]?a[c]instanceof Float32Array?new Float32Array(a[c]):a[c]instanceof Uint32Array?new Uint32Array(a[c]):a[c]instanceof Uint16Array?new Uint16Array(a[c]):a[c]instanceof Array?a[c].slice(0):a[c]:a[c];return b};a.is_mesh=function(a){return"MESH"===a.type?!0:!1};a.Uj=function(a){return"EMPTY"===a.type?!0:!1};a.is_armature=function(a){return"ARMATURE"===a.type?!0:!1};a.matrix_to_quat=function(a,b){b||(b=new Float32Array(4));F.fromMat4(a,
G);var c=G[0],d=G[3],e=G[6],f=G[1],g=G[4],h=G[7],k=G[2],l=G[5],m=G[8],c=Math.sqrt(c*c+d*d+e*e)||1,f=Math.sqrt(f*f+g*g+h*h)||1,k=Math.sqrt(k*k+l*l+m*m)||1;G[0]/=c;G[3]/=c;G[6]/=c;G[1]/=f;G[4]/=f;G[7]/=f;G[2]/=k;G[5]/=k;G[8]/=k;I.fromMat3(G,b);return b};a.Wg=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.Om=function(a){K[0]=.577350269189626;K[1]=.577350269189626;K[2]=.577350269189626;K[3]=0;O.transformMat4(K,a,K);return O.length(K)};a.Fp=function(a,b){var c=b.left,
d=b.right,e=b.top,f=b.bottom,g=b.Qa,k=b.Za;c[0]=a[3]+a[0];c[1]=a[7]+a[4];c[2]=a[11]+a[8];c[3]=a[15]+a[12];d[0]=a[3]-a[0];d[1]=a[7]-a[4];d[2]=a[11]-a[8];d[3]=a[15]-a[12];e[0]=a[3]-a[1];e[1]=a[7]-a[5];e[2]=a[11]-a[9];e[3]=a[15]-a[13];f[0]=a[3]+a[1];f[1]=a[7]+a[5];f[2]=a[11]+a[9];f[3]=a[15]+a[13];g[0]=a[3]+a[2];g[1]=a[7]+a[6];g[2]=a[11]+a[10];g[3]=a[15]+a[14];k[0]=a[3]-a[2];k[1]=a[7]-a[6];k[2]=a[11]-a[10];k[3]=a[15]-a[14];h(c);h(d);h(e);h(f);h(g);h(k)};a.$z=function(a,b,c){return c<-d(a,b.left)||c<-d(a,
b.right)||c<-d(a,b.top)||c<-d(a,b.bottom)||c<-d(a,b.Qa)||c<-d(a,b.Za)?!0:!1};a.zw=function(a,b,c,f,g){h=e.dot(c,b.Za);k=e.dot(f,b.Za);l=e.dot(g,b.Za);h=Math.sqrt(h*h+k*k+l*l);if(h<-d(a,b.Qa)||h<-d(a,b.Za))return!0;var h=e.dot(c,b.left),k=e.dot(f,b.left),l=e.dot(g,b.left);if(Math.sqrt(h*h+k*k+l*l)<-d(a,b.left))return!0;h=e.dot(c,b.right);k=e.dot(f,b.right);l=e.dot(g,b.right);if(Math.sqrt(h*h+k*k+l*l)<-d(a,b.right))return!0;h=e.dot(c,b.top);k=e.dot(f,b.top);l=e.dot(g,b.top);if(Math.sqrt(h*h+k*k+l*l)<
-d(a,b.top))return!0;h=e.dot(c,b.bottom);k=e.dot(f,b.bottom);l=e.dot(g,b.bottom);return Math.sqrt(h*h+k*k+l*l)<-d(a,b.bottom)?!0:!1};a.Me=function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k+b[12];c[d+f+1]=b[1]*g+b[5]*h+b[9]*k+b[13];c[d+f+2]=b[2]*g+b[6]*h+b[10]*k+b[14]}};a.fB=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k;c[d+f+1]=b[1]*g+b[5]*h+b[9]*k;c[d+f+2]=b[2]*g+
b[6]*h+b[10]*k}};a.rA=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=4){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k;c[d+f+1]=b[1]*g+b[5]*h+b[9]*k;c[d+f+2]=b[2]*g+b[6]*h+b[10]*k;c[d+f+3]=a[f+3]}};a.dB=function(a,b,c){c||(c=new Float32Array(3));K[0]=a[0];K[1]=a[1];K[2]=a[2];K[3]=0;O.transformMat4(K,b,K);c[0]=K[0];c[1]=K[1];c[2]=K[2]};a.xC=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";var d=a[0].length;if(!d)throw"flatten(): Wrong or empty subarray";b||
(b=new Float32Array(c*d));for(var e=0;e<c;e++)for(var f=0;f<d;f++)b[e*d+f]=a[e][f];return b};a.eB=function(a){for(var b=[],c=0;c<a.length;c+=3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);b[c/3]=d}return b};a.mj=function(b,c,d,e){if(e<d)return d;var f=d+Math.floor((e-d)/2);return b[f]>c?a.mj(b,c,d,f-1):b[f]<c?a.mj(b,c,f+1,e):f};a.te=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0};a.wj=function(a,b){for(var c=0;c<a.length;c++)if(1E-7<Math.abs(a[c]-b[c]))return!1;return!0};
a.mz=function(a,b,c){c||(c=new Float32Array(16));for(var d=0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15]};a.Ln=function(a,b,c,d){d||(d=new Float32Array(16));b=t.fromRotationTranslation(b,c,v);t.multiply(b,a,d)};a.transform_vec3=function(a,b,c,d,f){f||(f=new Float32Array(3));c=t.fromRotationTranslation(c,d,v);1!==b&&(d=t.identity(N),b=e.set(b,b,b,C),t.scale(d,b,d),t.multiply(c,d,c));e.transformMat4(a,c,f);return f};a.Mn=function(a,b,c,d){d||(d=new Float32Array(4));b=t.fromRotationTranslation(b,
c,v);O.transformMat4(a,b,d)};a.$C=function(a,b,c,d,f){f||(f=new Float32Array(3));b=t.fromRotationTranslation(c,d,v);t.invert(b,b);e.transformMat4(a,b,f);return f};a.ND=function(a,b,c){c||(c=new Float32Array(16));t.fromRotationTranslation(b,a,c);a=a[3];for(b=0;12>b;b++)c[b]*=a;return c};a.sD=function(b,c,d){a.Wg(b,c);c[3]=a.Om(b);a.matrix_to_quat(b,d)};a.Co=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.iz=function(a,b,c,d){d||(d=new Float32Array(3));e.subtract(b,
a,C);e.transformQuat(C,c,C);e.subtract(b,C,d)};a.Yw=function(){var a=new Float32Array([0,0,0]),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16),g=new Float32Array(16);t.lookAt(a,[-1,0,0],[0,-1,0],b);t.scale(b,[-1,1,1],b);t.scale(b,[-1,1,-1],c);t.lookAt(a,[0,-1,0],[0,0,-1],d);t.scale(d,[1,1,-1],d);t.scale(d,[1,-1,-1],e);t.lookAt(a,[0,0,-1],[0,-1,0],f);t.scale(f,[-1,1,1],f);t.scale(f,[-1,1,-1],g);return[b,c,d,e,f,g]};a.Ag=function(a,
b){return f(a,b)};a.hash_code=f;a.TC=g;a.rD=function(a,b,c){var d=b[0],e=b[1];b=b[2];var f,g,h,k,l,m,n,q,r,u,v,x;if(!c||a===c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;f=a[0];g=a[1];h=a[2];k=a[3];l=a[4];m=a[5];n=a[6];q=a[7];r=a[8];u=a[9];v=a[10];x=a[11];c[0]=f;c[1]=g;c[2]=h;c[3]=k;c[4]=l;c[5]=m;c[6]=n;c[7]=q;c[8]=r;c[9]=u;c[10]=v;c[11]=x;c[12]=f*d+l*e+r*b+a[12];c[13]=g*d+m*e+u*b+a[13];c[14]=h*d+n*
e+v*b+a[14];c[15]=k*d+q*e+x*b+a[15];return c};a.oy=function(a,b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.quat_to_angle_axis=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.vk=function(a){return a*
Math.PI/180};a.nw=function(a){return 180*a/Math.PI};a.vn=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],c=Math.floor(a[0]+b),d=Math.floor(a[1]+b),e=.211324865405187*c+.211324865405187*d,b=a[0]-c+e;a=a[1]-d+e;var f=b>a?1:0,g=1-f,e=b+.211324865405187-f,h=a+.211324865405187-g,l=b+-.577350269189626,n=a+-.577350269189626,c=c%289,d=d%289,q=m(m(d)+c),g=m(m(d+g)+c+f),r=m(m(d+1)+c+1),c=Math.max(.5-(b*b+a*a),0),d=Math.max(.5-(e*e+h*h),0),f=Math.max(.5-(l*l+n*n),0),u=2*k(.024390243902439*q)-1,
v=2*k(.024390243902439*g)-1,x=2*k(.024390243902439*r)-1,q=Math.abs(u)-.5,g=Math.abs(v)-.5,r=Math.abs(x)-.5,u=u-Math.floor(u+.5),v=v-Math.floor(v+.5),x=x-Math.floor(x+.5),c=c*c*c*c*(1.79284291400159-.85373472095314*(u*u+q*q)),d=d*d*d*d*(1.79284291400159-.85373472095314*(v*v+g*g)),f=f*f*f*f*(1.79284291400159-.85373472095314*(x*x+r*r));return 130*(c*(u*b+q*a)+d*(v*e+g*h)+f*(x*l+r*n))};a.$o=function(a){var b=1/7,c=b/2,d=r(Math.floor(a[0])),e=r(Math.floor(a[1])),f=k(a[0]);a=k(a[1]);var g=f-.5,h=f-1.5,
f=a-.5;a-=1.5;var l=x(d),m=x(d+1),n=l,d=m,l=x(l+e),m=x(m+e),n=x(n+e+1),d=x(d+e+1),e=g+.7*(q(l)*b+c),u=h+.7*(q(m)*b+c),g=g+.7*(q(n)*b+c),h=h+.7*(q(d)*b+c),l=f+.7*(q(Math.floor(l*b))*b+c),f=f+.7*(q(Math.floor(m*b))*b+c),n=a+.7*(q(Math.floor(n*b))*b+c),b=a+.7*(q(Math.floor(d*b))*b+c);return Math.min(e*e+l*l,u*u+f*f,g*g+n*n,h*h+b*b)};a.quat_project=function(a,b,c,d,f){f||(f=new Float32Array(4));a=e.transformQuat(b,a,C);b=c[0];var g=c[1];c=c[2];G[0]=g*g+c*c;G[1]=-g*b;G[2]=-c*b;G[3]=-b*g;G[4]=b*b+c*c;G[5]=
-c*g;G[6]=-b*c;G[7]=-g*c;G[8]=b*b+g*g;e.transformMat3(a,G,a);e.normalize(a,a);I.rotationTo(d,a,f);return f};a.cam_quat_to_mesh_quat=function(a,b){b||(b=new Float32Array(4));var c=K,d=M,c=I.setAxisAngle([0,1,0],Math.PI,I.create()),d=I.setAxisAngle([1,0,0],Math.PI/2,I.create());I.multiply(c,d,c);I.multiply(a,c,b);return b};a.cleanup=function(){y=0;L={}};a.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};a.smooth=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.smooth_v=function(a,b,c,
d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);for(d=0;d<e.length;d++)e[d]=(1-c)*a[d]+c*b[d];return e};a.ds=function(a,b,c,d,e){e||(e=new Float32Array(a.length));I.slerp(a,b,Math.exp(-c/d),e)};a.aD=function(a){return"object"===typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?!0:!1};a.is_vector=function(a,b){if(a instanceof Array||a.buffer&&a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.correct_cam_quat_up=function(a,b){var c=F.fromQuat(a,G);H[0]=0;H[1]=1;H[2]=
0;C[0]=c[3];C[1]=c[4];C[2]=c[5];var d=e.cross(H,C,C);e.normalize(d,d);var f=c[7];!b&&0<f&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);H[0]=c[0];H[1]=c[1];H[2]=c[2];e.normalize(H,H);I.rotationTo(H,d,M);I.multiply(M,a,a)};a.Wp=function(a,b,c,d){c=c*b-.5;var e=d*b-.5;d=c-Math.floor(c);var f=e-Math.floor(e);c=Math.floor(c);var e=Math.floor(e),g=b-1,h=a[e*b+c],k=a[e*b+Math.min(c+1,g)],l=a[Math.min(e+1,g)*b+c];a=a[Math.min(e+1,g)*b+Math.min(c+1,g)];return(h*(1-d)+k*d)*(1-f)+(l*(1-d)+a*d)*f};a.gg=function(a){for(var b=
0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.Qr=function(a){for(var b=[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=1);return b};a.Hi=function(a,b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&0<(a&2)&&c++;return c};a.Tp=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.ed=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};a.random_from_array=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*
a.length);return a[b]};a.xz_direction=function(a,b,c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=0;c[2]=a[2]-b[2];e.normalize(c,c)};a.OD=function(a,b,c){var d=a[0],e=a[1];a=a[2];var f=b[0],g=b[1],h=b[2];b=b[3];var k=g*a-h*e,l=h*d-f*a,m=f*e-g*d,n=g*m-h*l,h=h*k-f*m,f=f*l-g*k;c[0]=d+2*k*b+2*n;c[1]=e+2*l*b+2*h;c[2]=a+2*m*b+2*f;return c};a.ma=function(a){a&&u.error.apply(u,arguments);throw"panic: see above for possible error messages";};a.angle_wrap_periodic=z;a.angle_wrap_0_2pi=E;a.hm=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};
a.qs=function(a,b){for(var c in a){var d=!0,e=a[c],f=b[c];switch(typeof e){case "number":case "string":case "boolean":d=e==f;break;case "object":d=A(e,f)}if(!d)return!1}return!0};a.Ty=function(a,b){var c=a[0],d=a[2],e=a[3];b[0]=a[1];b[1]=d;b[2]=e;b[3]=c};a.Rp=function(a){a+=1;132651<a&&u.error("Color ID pool depleted");var b=Math.floor(a/2601);a%=2601;var c=Math.floor(a/51);return new Float32Array([b/51,c/51,a%51/51])};a.line_plane_intersect=function(a,b,c,d,e){K.set(a);K[3]=b;M.set(d);M[3]=0;a=O.dot(K,
M);if(0==a)return null;M.set(c);M[3]=1;a=-O.dot(K,M)/a;e[0]=c[0]+a*d[0];e[1]=c[1]+a*d[1];e[2]=c[2]+a*d[2];return e};a.gC=function(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b};a.kz=function(a,b,c){var d=e.dot(a,b);-.9999999>d?(e.cross(Z,a,C),1E-6>e.length(C)&&e.cross(T,a,C),e.normalize(C,C),I.setAxisAngle(C,Math.PI,c)):(e.cross(a,b,C),c.set(C),c[3]=1+d,I.normalize(c,c));return c};a.se=function(a,b,c){if(b==c)return c-a;a=E(a);b=E(b);c=E(c);var d=Math.abs(b-c);if(.001>d||.001>Math.abs(d-2*Math.PI))return 0;
b=2*Math.PI-b;c=E(c+b);a=E(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0};a.smooth_step=function(a){return a*a*(3-2*a)}};b4w.module.__sfx=function(a,p){function c(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;A.warn("deprecated WebAudio implementation");return null}A.warn("WebAudio is not supported");return null}function b(a,b,c){var d=a.h;if("NONE"!=d.behavior){c||(c=0);var e=d.loop,k=d.pitch;if(d.src&&(e||0<=c)){d.il=Math.floor(5E4*Math.random());var m=C.currentTime+b;d.sc=m;d.state=20;h(a);"POSITIONAL"==d.behavior||"BACKGROUND_SOUND"==d.behavior?(b=C.createBufferSource(),
b.buffer=d.src,b.playbackRate.value=k,e?(d.kb&&d.kb.disconnect(),b.loop=!0,b.start(m),d.duration=0):(e=b.buffer?b.buffer.duration:0,c>e?(e=m+c+d.Sd,b.loop=!0,b.start(m),b.stop(e),d.duration=c):(b.loop=!1,b.start(m),d.duration=e)),b.connect(d.Yb),d.kb=b,f(d),l(d)):"BACKGROUND_MUSIC"==d.behavior&&(n.uj(d.ml),n.uj(d.nl),c=function(){var b=a.h,c=b.src;c&&(c.volume=1,c.loop=b.loop,b.kb=b.kb||C.createMediaElementSource(c),b.kb.connect(b.Yb),20==b.state&&(c.currentTime&&(c.currentTime=0),c.play()))},0==
b?c():d.ml=n.set_timeout(c,1E3*b),d.duration=e?0:z(a));g(d,m)}}}function h(a){var b=a.h;if(!b.Yb){var c=a.d.g;a=a.d.quat;if(O.dk){var d=C.createBiquadFilter();d.type="peaking"}else d=null;var e=C.createGain();switch(b.behavior){case "POSITIONAL":var f=C.createPanner();"string"!=typeof f.panningModel?(f.panningModel=f.EQUALPOWER,f.distanceModel=f.INVERSE_DISTANCE):(f.panningModel="equalpower",f.distanceModel="inverse");f.setPosition(c[0],c[1],c[2]);b.Em.set(c);c=I;u.quat_to_dir(a,u.AXIS_MY,c);f.setOrientation(c[0],
c[1],c[2]);b.direction.set(c);f.refDistance=b.dist_ref;f.maxDistance=b.dist_max;f.rolloffFactor=b.attenuation;f.coneInnerAngle=b.wv;f.coneOuterAngle=b.xv;f.coneOuterGain=b.yv;var g=C.createGain();g.gain.value=q(b);d?(f.connect(d),d.connect(g)):f.connect(g);g.connect(e);b.Yb=f;if(b.Fh){var h=C.createGain();e.connect(h);h.connect(C?H.h.Yb:null)}else h=null,e.connect(C?H.h.Yb:null);break;case "BACKGROUND_SOUND":f=null;g=C.createGain();g.gain.value=q(b);d?(b.Yb=d,d.connect(g)):b.Yb=g;g.connect(e);b.Fh?
(h=C.createGain(),e.connect(h),h.connect(C?H.h.Yb:null)):(h=null,e.connect(C?H.h.Yb:null));break;case "BACKGROUND_MUSIC":h=f=null,g=C.createGain(),g.gain.value=q(b),d?(b.Yb=d,d.connect(g)):b.Yb=g,g.connect(e),e.connect(C?H.h.Yb:null)}b.ui=f;b.dd=d;b.Lg=g;b.Df=e;b.Ir=h}}function d(a){var c=a.h,d=c.duration,c=c.delay+c.ow*Math.random();b(a,c,d)}function f(a){a.Fh&&a.Ir.gain.cancelScheduledValues(a.sc);a.xi&&a.kb.playbackRate.cancelScheduledValues(a.sc);a.Si=a.sc}function l(a){if(a.Fh||a.xi){var b=a.Ir,
c=a.kb,d=c.buffer?c.buffer.duration:0;if(d){var e=a.sc;M[0]=a.il;for(var f=0;5>f;){var g=a.pitch+a.xi*u.Hc(M);if(e>=a.Si){if(a.Fh){var h=1-u.clamp(a.Fh,0,1)*Math.random();b.gain.setValueAtTime(h,e)}a.xi&&c.playbackRate.setValueAtTime(g,e);f++}e+=d/g}a.Si=e-.001}}}function g(a,b){if(a.Vl||a.Sd){var c=a.Df;c.gain.cancelScheduledValues(b);a.Vl?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.Vl)):c.gain.setValueAtTime(1,b);a.Sd&&!a.loop&&(c.gain.setValueAtTime(1,b+a.duration),c.gain.linearRampToValueAtTime(0,
b+a.duration+a.Sd))}}function m(a){if("SPEAKER"!=a.type)throw"Wrong object type";var b=a.h;if(20==b.state||40==b.state){var c=b.Df,d=C.currentTime;b.Sd&&(c.gain.setValueAtTime(c.gain.value,d),c.gain.linearRampToValueAtTime(0,d+b.Sd));"BACKGROUND_MUSIC"==b.behavior?b.src&&(n.uj(b.ml),n.uj(b.nl),b.nl=n.set_timeout(function(){var b=a.h.src;b&&(b.currentTime&&(b.currentTime=0),b.pause())},1E3*b.Sd)):(c=b.kb,b.duration<c.buffer.duration?b.Sd&&20==b.state?c.stop(d+b.Sd):20==b.state&&(c.stop(0),c.disconnect()):
c.disconnect(),b.sc=0,b.cn=0,b.sl=0);b.state=30}}function k(a){a=a.h;if(20==a.state){var b=C.currentTime;a.cn=b;if("BACKGROUND_MUSIC"==a.behavior){var c=a.src;c&&c.pause()}else{if(b>a.sc){M[0]=a.il;for(var d=a.kb.buffer.duration,e=a.sc;e<b;)c=a.pitch+a.xi*u.Hc(M),e+=d/c;c*=d/c-(e-b)}else c=0;a.sl=c;a.kb.stop(0);a.kb.disconnect();f(a)}a.state=40}}function x(a){var b=a.h;if(40==b.state){var c=C.currentTime;b.sc+=c-b.cn;if("BACKGROUND_MUSIC"==b.behavior)b.src.play();else{a=a.h;var d=C.createBufferSource();
d.loop=a.kb.loop;d.buffer=a.kb.buffer;d.playbackRate.value=a.kb.playbackRate.value;a.ui?d.connect(a.ui):d.connect(a.Lg);a.kb=d;b.Si=c;b.kb.start(b.sc,b.sl);l(b)}g(b,b.sc);b.state=20}}function r(a){return!a.h||20!=a.h.state&&40!=a.h.state&&30!=a.h.state?!1:!0}function q(a){return a.muted?0:a.volume}function z(a){a=a.h;return(a=a.src)?a.duration:0}var E=p("__config"),A=p("__print"),n=p("__time"),u=p("__util"),e=p("vec3"),O=E.Tc;a.eo=10;a.Qk=20;a.co=30;var I=new Float32Array(3),F=new Float32Array(3),
t=new Float32Array(3),y=[],L=[],C=null,H=null,K=[],M=[1],G=null;a.init=function(){var a=document.createElement("audio"),b=document.createElement("video");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&(y.push("ogg"),y.push("ogv")),""!=a.canPlayType("audio/mpeg")&&y.push("mp3"),""!=a.canPlayType("audio/mp4")&&(y.push("mp4"),y.push("m4v")),""!=a.canPlayType("audio/webm")&&y.push("webm"));b.canPlayType&&(""!=b.canPlayType("video/ogg")&&L.push("ogv"),""!=b.canPlayType("video/mp4")&&L.push("m4v"),""!=
b.canPlayType("video/webm")&&L.push("webm"));(C=O.$n?c():null)&&A.log("%cINIT WEBAUDIO: "+C.sampleRate+"Hz","color: #00a")};a.Fo=function(a){var b={Rf:new Float32Array(3),Rq:new Float32Array(3),Vg:new Float32Array(3)};a.h=b;if(C){var c=C.createGain(),d=C.createGain();b.Lg=c;b.Df=d;c.connect(d);d.connect(C.destination);if(a.b4w_enable_dynamic_compressor){var d=C.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;d.threshold.value=e.threshold;d.knee.value=e.knee;d.ratio.value=e.ratio;d.attack.value=
e.attack;d.release.value=e.release;d.connect(c);b.Qh=d;b.Yb=d}else b.Qh=null,b.Yb=c;c=C.listener;c.dopplerFactor=a.audio_doppler_factor;c.speedOfSound=a.audio_doppler_speed;b.muted=!1;b.volume=1;b.Cf=0}};a.uz=function(a){H=a};a.detect_audio_container=function(a){a||(a="ogg");return-1<y.indexOf(a)?a:"ogg"==a&&-1<y.indexOf("mp4")?"mp4":"mp3"==a&&-1<y.indexOf("ogg")?"ogg":"mp4"==a&&-1<y.indexOf("ogg")?"ogg":"ogv"==a&&-1<y.indexOf("m4v")?"m4v":"webm"==a&&-1<y.indexOf("m4v")?"m4v":"m4v"==a&&-1<y.indexOf("webm")?
"webm":""};a.detect_video_container=function(a){a||(a="webm");return-1<L.indexOf(a)?a:"ogv"==a&&-1<L.indexOf("m4v")?"m4v":"webm"==a&&-1<L.indexOf("m4v")?"m4v":"m4v"==a&&-1<L.indexOf("webm")?"webm":""};a.append_object=function(a){if("SPEAKER"!=a.type)throw"Wrong speaker object";var b=a.data;a.h={};switch(b.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":a.h.behavior=C?b.b4w_behavior:"NONE";break;case "BACKGROUND_MUSIC":var c=a.h,d;C?(window.MediaElementAudioSourceNode?d=!0:(A.warn("MediaElementAudioSourceNode not found"),
d=!1),d=d?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):d="NONE";c.behavior=d;break;default:throw"Wrong speaker behavior";}b.sound||(a.h.behavior="NONE");a.h.tw=b.b4w_disable_doppler;a.h.muted=b.muted;a.h.volume=b.volume;a.h.pitch=b.pitch;a.h.attenuation=b.attenuation;a.h.dist_ref=b.distance_reference;a.h.dist_max=b.distance_max||1E4;a.h.wv=b.cone_angle_inner;a.h.xv=b.cone_angle_outer;a.h.yv=b.cone_volume_outer;a.h.cyclic=b.b4w_cyclic_play;a.h.loop=b.b4w_loop;a.h.delay=b.b4w_delay;a.h.ow=b.b4w_delay_random;
a.h.Fh=b.b4w_volume_random;a.h.xi=b.b4w_pitch_random;a.h.Vl=b.b4w_fade_in;a.h.Sd=b.b4w_fade_out;a.h.sc=0;a.h.cn=0;a.h.sl=0;a.h.duration=0;a.h.Si=0;a.h.il=1;a.h.src=null;a.h.state=10;a.h.Em=new Float32Array(3);a.h.direction=new Float32Array(3);a.h.wn=new Float32Array(3);a.h.ml=-1;a.h.nl=-1;a.h.Cf=0;K.push(a)};a.fs=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";switch(b.h.behavior){case "POSITIONAL":return a.Qk;case "BACKGROUND_SOUND":return a.Qk;case "BACKGROUND_MUSIC":return a.co;case "NONE":return a.eo;
default:throw"Wrong speaker behavior";}};a.RA=function(a,b){var c=a.h;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.Ly=function(){var a=C.createBufferSource();a.buffer=C.createBuffer(1,22050,22050);a.connect(C.destination);a.start(0)};a.kw=function(a,b,c){C?C.decodeAudioData(a,b,c):c()};a.Wz=function(a){m(a);delete a.h;K.splice(K.indexOf(a),1)};a.cleanup=function(){for(var a=0;a<K.length;a++){var b=
K[a].h;"BACKGROUND_MUSIC"==b.behavior?(b=b.src)&&b.pause():b.kb&&b.kb.disconnect()}H&&H.h&&(a=H.h,a.Rf[0]=0,a.Rf[1]=0,a.Rf[2]=0,a.Vg[0]=0,a.Vg[1]=0,a.Vg[2]=0);H=null;K.splice(0);G=null};a.update=function(a){if(C&&0!=K.length){for(var b=0;b<K.length;b++){var c=K[b],e=c.h,f=C.currentTime;C&&!e.loop&&e.cyclic&&20==e.state&&e.duration&&e.sc+e.duration<f&&d(c);20==e.state&&3>e.Si-f&&l(e)}G&&G.ee.length&&(-1==G.Ka||a>G.wo+G.yp[G.Ka])&&(b=G,-1<b.Ka&&m(b.ee[b.Ka]),-1==b.Ka&&b.random?c=Math.round(Math.random()*
(b.ee.length-1)):b.random?(c=1+Math.round(Math.random()*(b.ee.length-2)),c=(b.Ka+c)%b.ee.length):c=(b.Ka+1)%b.ee.length,d(b.ee[c]),b.Ka=c,b.wo=a)}};a.play=b;a.play_def=d;a.stop=m;a.is_play=function(a){return 20==a.h.state};a.Vz=k;a.Xz=x;a.playrate=function(a,b){var c=a.h;c.pitch=b;!r(a)||"POSITIONAL"!=c.behavior&&"BACKGROUND_SOUND"!=c.behavior||(c.kb.playbackRate.value=b,f(c),l(c))};a.get_playrate=function(a){return a.h.pitch};a.cyclic=function(a,b){a.h.cyclic=Boolean(b)};a.is_cyclic=function(a){return a.h.cyclic};
a.jy=function(a,b,c,d){if(C&&a.h){var f=I;f[0]=0;f[1]=-1;f[2]=0;e.transformQuat(f,c,f);F[0]=0;F[1]=0;F[2]=-1;e.transformQuat(F,c,F);c=C.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(f[0],f[1],f[2],F[0],F[1],F[2]);a.h.Rq.set(f);d&&(t[0]=(b[0]-a.h.Rf[0])/d,t[1]=(b[1]-a.h.Rf[1])/d,t[2]=(b[2]-a.h.Rf[2])/d,u.smooth_v(t,a.h.Vg,d,.3,t),c.setVelocity(t[0],t[1],t[2]),a.h.Vg.set(t));a.h.Rf.set(b)}};a.listener_reset_speed=function(a,b){if(C&&H.h){var c=I;b?c.set(b):c.set(H.h.Rq);e.scale(c,a,c);C.listener.setVelocity(c[0],
c[1],c[2]);H.h.Vg.set(c)}};a.Yz=function(a,b){var c=a.h;if(r(a)&&"POSITIONAL"==c.behavior){var d=a.d.g,e=c.ui;e.setPosition(d[0],d[1],d[2]);var f=I;u.quat_to_dir(a.d.quat,u.AXIS_MY,f);e.setOrientation(f[0],f[1],f[2]);f=c.Em;!c.tw&&b&&(F[0]=(d[0]-f[0])/b,F[1]=(d[1]-f[1])/b,F[2]=(d[2]-f[2])/b,u.smooth_v(F,c.wn,b,.3,F),e.setVelocity(F[0],F[1],F[2]),c.wn.set(F));f.set(d)}};a.speaker_reset_speed=function(a,b,c){var d=a.h;if(r(a)&&"POSITIONAL"==d.behavior){var f=I;c?f.set(c):f.set(d.direction);e.scale(f,
b,f);d.ui.setVelocity(f[0],f[1],f[2]);d.wn.set(f);d.Em.set(a.d.g)}};a.Xd=function(a){return a.h?!0:!1};a.km=function(a){return a.h.behavior};a.check_active_speakers=function(){for(var a=0;a<K.length;a++)if(r(K[a]))return!0;return!1};a.Dz=function(a){var b=H.h;b&&(b.volume=a,C&&(b.Lg.gain.value=q(b)))};a.yx=function(){var a=H.h;return a?a.volume:0};a.set_volume=function(a,b){var c=a.h;c.volume=b;r(a)&&(c.Lg.gain.value=q(c))};a.get_volume=function(a){return a.h.volume};a.mute=function(a,b){a.h.muted=
Boolean(b);r(a)&&(a.h.Lg.gain.value=q(a.h))};a.is_muted=function(a){return a.h.muted};a.yy=function(a){var b=H.h;b&&(b.muted=Boolean(a),C&&(b.Lg.gain.value=q(b)))};a.by=function(){var a=H.h;return a?a.muted:!1};a.get_speaker_objects=function(){return K};a.pause=function(){for(var a=0;a<K.length;a++)k(K[a])};a.resume=function(){for(var a=0;a<K.length;a++)x(K[a])};a.set_compressor_params=function(a,b){if(a.h&&a.h.Qh){var c=a.h.Qh;c.threshold.value=b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;
c.attack.value=b.attack;c.release.value=b.release}};a.get_compressor_params=function(a){if(!a.h||!a.h.Qh)return null;a=a.h.Qh;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};a.duck=function(a,b,c){if(r(a)){a=a.h;var d=a.Df,e=C.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(b,e+c);a.Cf=c}};a.unduck=function(a){if(r(a)){a=a.h;var b=a.Df,c=C.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,
c+a.Cf);a.Cf=0}};a.vw=function(a,b){if(C){var c=H.h,d=c.Df,e=C.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+b);c.Cf=b}};a.yA=function(){if(C){var a=H.h,b=a.Df,c=C.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.Cf);a.Cf=0}};a.apply_playlist=function(a,b,c){G={Ka:-1,wo:0,random:c,ee:[],yp:[]};for(c=0;c<a.length;c++){var d=a[c],e=z(d);0==e?A.warn("Ignoring speaker with zero duration: "+d.name):(m(d),d.h.cyclic=!1,G.ee.push(d),
G.yp.push(e+b))}};a.get_duration=z;a.clear_playlist=function(){if(G)for(var a=G.ee,b=0;b<a.length;b++)m(a[b]);G=null};a.get_positional_params=function(a){return(a=a.h)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.set_positional_params=function(a,b){var c=a.h;if(c&&"POSITIONAL"==c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=b.attenuation;var d=c.ui;d&&(d.refDistance=c.dist_ref,d.maxDistance=c.dist_max,d.rolloffFactor=
c.attenuation)}};a.set_filter_params=function(a,b){var c=a.h;c&&c.dd&&(c.dd.frequency.value=b.freq,c.dd.Q.value=b.Q,c.dd.gain.value=b.gain)};a.get_filter_params=function(a){return(a=a.h)&&a.dd?{freq:a.dd.frequency.value,Q:a.dd.Q.value,gain:a.dd.gain.value}:null};a.get_filter_freq_response=function(a,b,c,d){a=a.h;if(!a||!a.dd)return null;a.dd.getFrequencyResponse(b,c,d)}};b4w.module.vec3=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array,c=Math.random;a.create=function(){var a=new p(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var c=new p(3);c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.fromValues=function(a,c,d){var f=new p(3);f[0]=a;f[1]=c;f[2]=d;return f};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.set=function(a,c,d,f){f[0]=a;f[1]=c;f[2]=d;return f};a.add=function(a,c,d){d[0]=a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];return d};
a.subtract=function(a,c,d){d[0]=a[0]-c[0];d[1]=a[1]-c[1];d[2]=a[2]-c[2];return d};a.sub=a.subtract;a.multiply=function(a,c,d){d[0]=a[0]*c[0];d[1]=a[1]*c[1];d[2]=a[2]*c[2];return d};a.mul=a.multiply;a.divide=function(a,c,d){d[0]=a[0]/c[0];d[1]=a[1]/c[1];d[2]=a[2]/c[2];return d};a.div=a.divide;a.min=function(a,c,d){d[0]=Math.min(a[0],c[0]);d[1]=Math.min(a[1],c[1]);d[2]=Math.min(a[2],c[2]);return d};a.max=function(a,c,d){d[0]=Math.max(a[0],c[0]);d[1]=Math.max(a[1],c[1]);d[2]=Math.max(a[2],c[2]);return d};
a.scale=function(a,c,d){d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;return d};a.scaleAndAdd=function(a,c,d,f){f[0]=a[0]+c[0]*d;f[1]=a[1]+c[1]*d;f[2]=a[2]+c[2]*d;return f};a.distance=function(a,c){var d=c[0]-a[0],f=c[1]-a[1],l=c[2]-a[2];return Math.sqrt(d*d+f*f+l*l)};a.dist=a.distance;a.squaredDistance=function(a,c){var d=c[0]-a[0],f=c[1]-a[1],l=c[2]-a[2];return d*d+f*f+l*l};a.sqrDist=a.squaredDistance;a.length=function(a){var c=a[0],d=a[1];a=a[2];return Math.sqrt(c*c+d*d+a*a)};a.len=a.length;a.squaredLength=
function(a){var c=a[0],d=a[1];a=a[2];return c*c+d*d+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];return c};a.inverse=function(a,c){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];return c};a.normalize=function(a,c){var d=a[0],f=a[1],l=a[2],d=d*d+f*f+l*l;0<d&&(d=1/Math.sqrt(d),c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d);return c};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]};a.cross=function(a,c,d){var f=a[0],l=a[1];a=a[2];var g=c[0],m=c[1];c=c[2];d[0]=l*c-a*m;d[1]=
a*g-f*c;d[2]=f*m-l*g;return d};a.lerp=function(a,c,d,f){var l=a[0],g=a[1];a=a[2];f[0]=l+d*(c[0]-l);f[1]=g+d*(c[1]-g);f[2]=a+d*(c[2]-a);return f};a.random=function(a,h){a=a||1;var d=2*c()*Math.PI,f=2*c()-1,l=Math.sqrt(1-f*f)*a;h[0]=Math.cos(d)*l;h[1]=Math.sin(d)*l;h[2]=f*a;return h};a.transformMat4=function(a,c,d){var f=a[0],l=a[1];a=a[2];var g=c[3]*f+c[7]*l+c[11]*a+c[15],g=g||1;d[0]=(c[0]*f+c[4]*l+c[8]*a+c[12])/g;d[1]=(c[1]*f+c[5]*l+c[9]*a+c[13])/g;d[2]=(c[2]*f+c[6]*l+c[10]*a+c[14])/g;return d};a.transformMat3=
function(a,c,d){var f=a[0],l=a[1];a=a[2];d[0]=f*c[0]+l*c[3]+a*c[6];d[1]=f*c[1]+l*c[4]+a*c[7];d[2]=f*c[2]+l*c[5]+a*c[8];return d};a.transformQuat=function(a,c,d){var f=a[0],l=a[1],g=a[2];a=c[0];var m=c[1],k=c[2];c=c[3];var x=c*f+m*g-k*l,r=c*l+k*f-a*g,q=c*g+a*l-m*f,f=-a*f-m*l-k*g;d[0]=x*c+f*-a+r*-k-q*-m;d[1]=r*c+f*-m+q*-a-x*-k;d[2]=q*c+f*-k+x*-m-r*-a;return d};a.rotateX=function(a,c,d,f){var l=[],g=[];l[0]=a[0]-c[0];l[1]=a[1]-c[1];l[2]=a[2]-c[2];g[0]=l[0];g[1]=l[1]*Math.cos(d)-l[2]*Math.sin(d);g[2]=
l[1]*Math.sin(d)+l[2]*Math.cos(d);f[0]=g[0]+c[0];f[1]=g[1]+c[1];f[2]=g[2]+c[2];return f};a.rotateY=function(a,c,d,f){var l=[],g=[];l[0]=a[0]-c[0];l[1]=a[1]-c[1];l[2]=a[2]-c[2];g[0]=l[2]*Math.sin(d)+l[0]*Math.cos(d);g[1]=l[1];g[2]=l[2]*Math.cos(d)-l[0]*Math.sin(d);f[0]=g[0]+c[0];f[1]=g[1]+c[1];f[2]=g[2]+c[2];return f};a.rotateZ=function(a,c,d,f){var l=[],g=[];l[0]=a[0]-c[0];l[1]=a[1]-c[1];l[2]=a[2]-c[2];g[0]=l[0]*Math.cos(d)-l[1]*Math.sin(d);g[1]=l[0]*Math.sin(d)+l[1]*Math.cos(d);g[2]=l[2];f[0]=g[0]+
c[0];f[1]=g[1]+c[1];f[2]=g[2]+c[2];return f};a.forEach=function(){var b=a.create();return function(a,c,f,l,g,m){c||(c=3);f||(f=0);for(l=l?Math.min(l*c+f,a.length):a.length;f<l;f+=c)b[0]=a[f],b[1]=a[f+1],b[2]=a[f+2],g(b,m,b),a[f]=b[0],a[f+1]=b[1],a[f+2]=b[2];return a}}();a.IB=function(b,c){var d=a.fromValues(b[0],b[1],b[2]),f=a.fromValues(c[0],c[1],c[2]);a.normalize(d,d);a.normalize(f,f);d=a.dot(d,f);return 1<d?0:Math.acos(d)};a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};"undefined"!==
typeof a&&(a.vec3=a)};
b4w.module.vec4=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array,c=Math.random;a.create=function(){var a=new p(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var c=new p(4);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};a.fromValues=function(a,c,d,f){var l=new p(4);l[0]=a;l[1]=c;l[2]=d;l[3]=f;return l};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};a.set=function(a,c,d,f,l){l[0]=a;l[1]=c;l[2]=d;l[3]=f;return l};a.add=function(a,c,d){d[0]=
a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];d[3]=a[3]+c[3];return d};a.subtract=function(a,c,d){d[0]=a[0]-c[0];d[1]=a[1]-c[1];d[2]=a[2]-c[2];d[3]=a[3]-c[3];return d};a.sub=a.subtract;a.multiply=function(a,c,d){d[0]=a[0]*c[0];d[1]=a[1]*c[1];d[2]=a[2]*c[2];d[3]=a[3]*c[3];return d};a.mul=a.multiply;a.divide=function(a,c,d){d[0]=a[0]/c[0];d[1]=a[1]/c[1];d[2]=a[2]/c[2];d[3]=a[3]/c[3];return d};a.div=a.divide;a.min=function(a,c,d){d[0]=Math.min(a[0],c[0]);d[1]=Math.min(a[1],c[1]);d[2]=Math.min(a[2],c[2]);d[3]=
Math.min(a[3],c[3]);return d};a.max=function(a,c,d){d[0]=Math.max(a[0],c[0]);d[1]=Math.max(a[1],c[1]);d[2]=Math.max(a[2],c[2]);d[3]=Math.max(a[3],c[3]);return d};a.scale=function(a,c,d){d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;d[3]=a[3]*c;return d};a.scaleAndAdd=function(a,c,d,f){f[0]=a[0]+c[0]*d;f[1]=a[1]+c[1]*d;f[2]=a[2]+c[2]*d;f[3]=a[3]+c[3]*d;return f};a.distance=function(a,c){var d=c[0]-a[0],f=c[1]-a[1],l=c[2]-a[2],g=c[3]-a[3];return Math.sqrt(d*d+f*f+l*l+g*g)};a.dist=a.distance;a.squaredDistance=
function(a,c){var d=c[0]-a[0],f=c[1]-a[1],l=c[2]-a[2],g=c[3]-a[3];return d*d+f*f+l*l+g*g};a.sqrDist=a.squaredDistance;a.length=function(a){var c=a[0],d=a[1],f=a[2];a=a[3];return Math.sqrt(c*c+d*d+f*f+a*a)};a.len=a.length;a.squaredLength=function(a){var c=a[0],d=a[1],f=a[2];a=a[3];return c*c+d*d+f*f+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];c[3]=-a[3];return c};a.inverse=function(a,c){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];c[3]=1/a[3];return c};a.normalize=
function(a,c){var d=a[0],f=a[1],l=a[2],g=a[3],d=d*d+f*f+l*l+g*g;0<d&&(d=1/Math.sqrt(d),c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d,c[3]=a[3]*d);return c};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]};a.lerp=function(a,c,d,f){var l=a[0],g=a[1],m=a[2];a=a[3];f[0]=l+d*(c[0]-l);f[1]=g+d*(c[1]-g);f[2]=m+d*(c[2]-m);f[3]=a+d*(c[3]-a);return f};a.random=function(b,h){b=b||1;h[0]=c();h[1]=c();h[2]=c();h[3]=c();a.normalize(h,h);a.scale(h,b,h);return h};a.transformMat4=function(a,c,d){var f=a[0],
l=a[1],g=a[2];a=a[3];d[0]=c[0]*f+c[4]*l+c[8]*g+c[12]*a;d[1]=c[1]*f+c[5]*l+c[9]*g+c[13]*a;d[2]=c[2]*f+c[6]*l+c[10]*g+c[14]*a;d[3]=c[3]*f+c[7]*l+c[11]*g+c[15]*a;return d};a.transformQuat=function(a,c,d){var f=a[0],l=a[1],g=a[2],m=c[0],k=c[1],x=c[2];c=c[3];var r=c*f+k*g-x*l,q=c*l+x*f-m*g,p=c*g+m*l-k*f,f=-m*f-k*l-x*g;d[0]=r*c+f*-m+q*-x-p*-k;d[1]=q*c+f*-k+p*-m-r*-x;d[2]=p*c+f*-x+r*-k-q*-m;d[3]=a[3];return d};a.forEach=function(){var b=a.create();return function(a,c,f,l,g,m){c||(c=4);f||(f=0);for(l=l?Math.min(l*
c+f,a.length):a.length;f<l;f+=c)b[0]=a[f],b[1]=a[f+1],b[2]=a[f+2],b[3]=a[f+3],g(b,m,b),a[f]=b[0],a[f+1]=b[1],a[f+2]=b[2],a[f+3]=b[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.vec4=a)};
b4w.module.quat=function(a,p){var c=p("vec3"),b=p("vec4"),h=p("mat3"),d="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new d(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var b=c.create(),d=c.fromValues(1,0,0),g=c.fromValues(0,1,0);return function(h,k,x){var r=c.dot(h,k);if(-.9999999>r)return c.cross(d,h,b),1E-6>c.length(b)&&c.cross(g,h,b),c.normalize(b,b),a.setAxisAngle(b,Math.PI,x),x;if(.9999999<r)return x[0]=0,x[1]=0,x[2]=0,x[3]=1,x;c.cross(h,
k,b);x[0]=b[0];x[1]=b[1];x[2]=b[2];x[3]=1+r;return a.normalize(x,x)}}();a.setAxes=function(){var b=h.create();return function(c,d,h,k){b[0]=d[0];b[3]=d[1];b[6]=d[2];b[1]=h[0];b[4]=h[1];b[7]=h[2];b[2]=-c[0];b[5]=-c[1];b[8]=-c[2];return a.normalize(a.fromMat3(b,k),k)}}();a.clone=b.clone;a.fromValues=b.fromValues;a.copy=b.copy;a.set=b.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,c){b*=.5;var d=Math.sin(b);c[0]=d*a[0];c[1]=d*a[1];c[2]=d*a[2];c[3]=Math.cos(b);
return c};a.add=b.add;a.multiply=function(a,b,c){var d=a[0],k=a[1],h=a[2];a=a[3];var r=b[0],q=b[1],p=b[2];b=b[3];c[0]=d*b+a*r+k*p-h*q;c[1]=k*b+a*q+h*r-d*p;c[2]=h*b+a*p+d*q-k*r;c[3]=a*b-d*r-k*q-h*p;return c};a.mul=a.multiply;a.scale=b.scale;a.rotateX=function(a,b,c){b*=.5;var d=a[0],k=a[1],h=a[2];a=a[3];var r=Math.sin(b);b=Math.cos(b);c[0]=d*b+a*r;c[1]=k*b+h*r;c[2]=h*b-k*r;c[3]=a*b-d*r;return c};a.rotateY=function(a,b,c){b*=.5;var d=a[0],k=a[1],h=a[2];a=a[3];var r=Math.sin(b);b=Math.cos(b);c[0]=d*
b-h*r;c[1]=k*b+a*r;c[2]=h*b+d*r;c[3]=a*b-k*r;return c};a.rotateZ=function(a,b,c){b*=.5;var d=a[0],k=a[1],h=a[2];a=a[3];var r=Math.sin(b);b=Math.cos(b);c[0]=d*b+k*r;c[1]=k*b-d*r;c[2]=h*b+a*r;c[3]=a*b-h*r;return c};a.calculateW=function(a,b){var c=a[0],d=a[1],k=a[2];b[0]=c;b[1]=d;b[2]=k;b[3]=Math.sqrt(Math.abs(1-c*c-d*d-k*k));return b};a.dot=b.dot;a.lerp=b.lerp;a.slerp=function(a,b,c,d){var k=a[0],h=a[1],r=a[2];a=a[3];var q=b[0],p=b[1],E=b[2];b=b[3];var A,n,u;n=k*q+h*p+r*E+a*b;0>n&&(n=-n,q=-q,p=-p,
E=-E,b=-b);1E-6<1-n?(A=Math.acos(n),u=Math.sin(A),n=Math.sin((1-c)*A)/u,c=Math.sin(c*A)/u):n=1-c;d[0]=n*k+c*q;d[1]=n*h+c*p;d[2]=n*r+c*E;d[3]=n*a+c*b;return d};a.invert=function(a,b){var c=a[0],d=a[1],k=a[2],h=a[3],r=c*c+d*d+k*k+h*h,r=r?1/r:0;b[0]=-c*r;b[1]=-d*r;b[2]=-k*r;b[3]=h*r;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=b.length;a.len=a.length;a.squaredLength=b.squaredLength;a.sqrLen=a.squaredLength;a.normalize=b.normalize;a.fromMat3=function(a,
b){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=.5*c,c=.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{var d=0;a[4]>a[0]&&(d=1);a[8]>a[3*d+d]&&(d=2);var k=(d+1)%3,h=(d+2)%3,c=Math.sqrt(a[3*d+d]-a[3*k+k]-a[3*h+h]+1);b[d]=.5*c;c=.5/c;b[3]=(a[3*k+h]-a[3*h+k])*c;b[k]=(a[3*k+d]+a[3*d+k])*c;b[h]=(a[3*h+d]+a[3*d+h])*c}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=a)};
b4w.module.mat3=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new p(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b};a.clone=function(a){var b=new p(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=
a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,b){if(b===a){var h=a[1],d=a[2],f=a[5];b[1]=a[3];b[2]=a[6];b[3]=h;b[5]=a[7];b[6]=d;b[7]=f}else b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8];return b};a.invert=function(a,b){var h=a[0],d=a[1],f=a[2],l=a[3],g=a[4],m=a[5],k=a[6],p=a[7],r=a[8],q=r*g-m*p,z=-r*l+m*k,E=
p*l-g*k,A=h*q+d*z+f*E;if(!A)return null;A=1/A;b[0]=q*A;b[1]=(-r*d+f*p)*A;b[2]=(m*d-f*g)*A;b[3]=z*A;b[4]=(r*h-f*k)*A;b[5]=(-m*h+f*l)*A;b[6]=E*A;b[7]=(-p*h+d*k)*A;b[8]=(g*h-d*l)*A;return b};a.adjoint=function(a,b){var h=a[0],d=a[1],f=a[2],l=a[3],g=a[4],m=a[5],k=a[6],p=a[7],r=a[8];b[0]=g*r-m*p;b[1]=f*p-d*r;b[2]=d*m-f*g;b[3]=m*k-l*r;b[4]=h*r-f*k;b[5]=f*l-h*m;b[6]=l*p-g*k;b[7]=d*k-h*p;b[8]=h*g-d*l;return b};a.determinant=function(a){var b=a[3],h=a[4],d=a[5],f=a[6],l=a[7],g=a[8];return a[0]*(g*h-d*l)+a[1]*
(-g*b+d*f)+a[2]*(l*b-h*f)};a.multiply=function(a,b,h){var d=a[0],f=a[1],l=a[2],g=a[3],m=a[4],k=a[5],p=a[6],r=a[7];a=a[8];var q=b[0],z=b[1],E=b[2],A=b[3],n=b[4],u=b[5],e=b[6],O=b[7];b=b[8];h[0]=q*d+z*g+E*p;h[1]=q*f+z*m+E*r;h[2]=q*l+z*k+E*a;h[3]=A*d+n*g+u*p;h[4]=A*f+n*m+u*r;h[5]=A*l+n*k+u*a;h[6]=e*d+O*g+b*p;h[7]=e*f+O*m+b*r;h[8]=e*l+O*k+b*a;return h};a.mul=a.multiply;a.translate=function(a,b,h){var d=a[0],f=a[1],l=a[2],g=a[3],m=a[4],k=a[5],p=a[6],r=a[7];a=a[8];var q=b[0];b=b[1];h[0]=d;h[1]=f;h[2]=l;
h[3]=g;h[4]=m;h[5]=k;h[6]=q*d+b*g+p;h[7]=q*f+b*m+r;h[8]=q*l+b*k+a;return h};a.rotate=function(a,b,h){var d=a[0],f=a[1],l=a[2],g=a[3],m=a[4],k=a[5],p=a[6],r=a[7];a=a[8];var q=Math.sin(b);b=Math.cos(b);h[0]=b*d+q*g;h[1]=b*f+q*m;h[2]=b*l+q*k;h[3]=b*g-q*d;h[4]=b*m-q*f;h[5]=b*k-q*l;h[6]=p;h[7]=r;h[8]=a;return h};a.scale=function(a,b,h){var d=b[0];b=b[1];h[0]=d*a[0];h[1]=d*a[1];h[2]=d*a[2];h[3]=b*a[3];h[4]=b*a[4];h[5]=b*a[5];h[6]=a[6];h[7]=a[7];h[8]=a[8];return h};a.Sw=function(a,b){b[0]=1;b[1]=0;b[2]=
0;b[3]=0;b[4]=1;b[5]=0;b[6]=a[0];b[7]=a[1];b[8]=1;return b};a.Qw=function(a,b){var h=Math.sin(a),d=Math.cos(a);b[0]=d;b[1]=h;b[2]=0;b[3]=-h;b[4]=d;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.Rw=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=a[1];b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.fromMat2d=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=0;b[3]=a[2];b[4]=a[3];b[5]=0;b[6]=a[4];b[7]=a[5];b[8]=1;return b};a.fromQuat=function(a,b){var h=a[0],d=a[1],f=a[2],l=a[3],g=h+h,m=d+d,k=f+f,h=h*g,p=d*g,d=d*m,r=f*g,q=
f*m,f=f*k,g=l*g,m=l*m,l=l*k;b[0]=1-d-f;b[3]=p-l;b[6]=r+m;b[1]=p+l;b[4]=1-h-f;b[7]=q-g;b[2]=r-m;b[5]=q+g;b[8]=1-h-d;return b};a.normalFromMat4=function(a,b){var h=a[0],d=a[1],f=a[2],l=a[3],g=a[4],m=a[5],k=a[6],p=a[7],r=a[8],q=a[9],z=a[10],E=a[11],A=a[12],n=a[13],u=a[14],e=a[15],O=h*m-d*g,I=h*k-f*g,F=h*p-l*g,t=d*k-f*m,y=d*p-l*m,L=f*p-l*k,C=r*n-q*A,H=r*u-z*A,r=r*e-E*A,K=q*u-z*n,q=q*e-E*n,z=z*e-E*u,E=O*z-I*q+F*K+t*r-y*H+L*C;if(!E)return null;E=1/E;b[0]=(m*z-k*q+p*K)*E;b[1]=(k*r-g*z-p*H)*E;b[2]=(g*q-m*
r+p*C)*E;b[3]=(f*q-d*z-l*K)*E;b[4]=(h*z-f*r+l*H)*E;b[5]=(d*r-h*q-l*C)*E;b[6]=(n*L-u*y+e*t)*E;b[7]=(u*F-A*L-e*I)*E;b[8]=(A*y-n*F+e*O)*E;return b};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.Pw=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.mat3=a)};
b4w.module.mat4=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new p(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var b=new p(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.copy=function(a,b){b[0]=a[0];b[1]=
a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,b){if(b===a){var h=a[1],d=a[2],f=a[3],l=a[6],g=a[7],m=a[11];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=h;b[6]=a[9];b[7]=a[13];b[8]=d;b[9]=l;b[11]=a[14];b[12]=f;b[13]=g;
b[14]=m}else b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15];return b};a.invert=function(a,b){var h=a[0],d=a[1],f=a[2],l=a[3],g=a[4],m=a[5],k=a[6],p=a[7],r=a[8],q=a[9],z=a[10],E=a[11],A=a[12],n=a[13],u=a[14],e=a[15],O=h*m-d*g,I=h*k-f*g,F=h*p-l*g,t=d*k-f*m,y=d*p-l*m,L=f*p-l*k,C=r*n-q*A,H=r*u-z*A,K=r*e-E*A,M=q*u-z*n,G=q*e-E*n,v=z*e-E*u,N=O*v-I*G+F*M+t*K-y*H+L*C;if(!N)return null;
N=1/N;b[0]=(m*v-k*G+p*M)*N;b[1]=(f*G-d*v-l*M)*N;b[2]=(n*L-u*y+e*t)*N;b[3]=(z*y-q*L-E*t)*N;b[4]=(k*K-g*v-p*H)*N;b[5]=(h*v-f*K+l*H)*N;b[6]=(u*F-A*L-e*I)*N;b[7]=(r*L-z*F+E*I)*N;b[8]=(g*G-m*K+p*C)*N;b[9]=(d*K-h*G-l*C)*N;b[10]=(A*y-n*F+e*O)*N;b[11]=(q*F-r*y-E*O)*N;b[12]=(m*H-g*M-k*C)*N;b[13]=(h*M-d*H+f*C)*N;b[14]=(n*I-A*t-u*O)*N;b[15]=(r*t-q*I+z*O)*N;return b};a.adjoint=function(a,b){var h=a[0],d=a[1],f=a[2],l=a[3],g=a[4],m=a[5],k=a[6],p=a[7],r=a[8],q=a[9],z=a[10],E=a[11],A=a[12],n=a[13],u=a[14],e=a[15];
b[0]=m*(z*e-E*u)-q*(k*e-p*u)+n*(k*E-p*z);b[1]=-(d*(z*e-E*u)-q*(f*e-l*u)+n*(f*E-l*z));b[2]=d*(k*e-p*u)-m*(f*e-l*u)+n*(f*p-l*k);b[3]=-(d*(k*E-p*z)-m*(f*E-l*z)+q*(f*p-l*k));b[4]=-(g*(z*e-E*u)-r*(k*e-p*u)+A*(k*E-p*z));b[5]=h*(z*e-E*u)-r*(f*e-l*u)+A*(f*E-l*z);b[6]=-(h*(k*e-p*u)-g*(f*e-l*u)+A*(f*p-l*k));b[7]=h*(k*E-p*z)-g*(f*E-l*z)+r*(f*p-l*k);b[8]=g*(q*e-E*n)-r*(m*e-p*n)+A*(m*E-p*q);b[9]=-(h*(q*e-E*n)-r*(d*e-l*n)+A*(d*E-l*q));b[10]=h*(m*e-p*n)-g*(d*e-l*n)+A*(d*p-l*m);b[11]=-(h*(m*E-p*q)-g*(d*E-l*q)+r*
(d*p-l*m));b[12]=-(g*(q*u-z*n)-r*(m*u-k*n)+A*(m*z-k*q));b[13]=h*(q*u-z*n)-r*(d*u-f*n)+A*(d*z-f*q);b[14]=-(h*(m*u-k*n)-g*(d*u-f*n)+A*(d*k-f*m));b[15]=h*(m*z-k*q)-g*(d*z-f*q)+r*(d*k-f*m);return b};a.determinant=function(a){var b=a[0],h=a[1],d=a[2],f=a[3],l=a[4],g=a[5],m=a[6],k=a[7],p=a[8],r=a[9],q=a[10],z=a[11],E=a[12],A=a[13],n=a[14];a=a[15];return(b*g-h*l)*(q*a-z*n)-(b*m-d*l)*(r*a-z*A)+(b*k-f*l)*(r*n-q*A)+(h*m-d*g)*(p*a-z*E)-(h*k-f*g)*(p*n-q*E)+(d*k-f*m)*(p*A-r*E)};a.multiply=function(a,b,h){var d=
a[0],f=a[1],l=a[2],g=a[3],m=a[4],k=a[5],p=a[6],r=a[7],q=a[8],z=a[9],E=a[10],A=a[11],n=a[12],u=a[13],e=a[14];a=a[15];var O=b[0],I=b[1],F=b[2],t=b[3];h[0]=O*d+I*m+F*q+t*n;h[1]=O*f+I*k+F*z+t*u;h[2]=O*l+I*p+F*E+t*e;h[3]=O*g+I*r+F*A+t*a;O=b[4];I=b[5];F=b[6];t=b[7];h[4]=O*d+I*m+F*q+t*n;h[5]=O*f+I*k+F*z+t*u;h[6]=O*l+I*p+F*E+t*e;h[7]=O*g+I*r+F*A+t*a;O=b[8];I=b[9];F=b[10];t=b[11];h[8]=O*d+I*m+F*q+t*n;h[9]=O*f+I*k+F*z+t*u;h[10]=O*l+I*p+F*E+t*e;h[11]=O*g+I*r+F*A+t*a;O=b[12];I=b[13];F=b[14];t=b[15];h[12]=O*d+
I*m+F*q+t*n;h[13]=O*f+I*k+F*z+t*u;h[14]=O*l+I*p+F*E+t*e;h[15]=O*g+I*r+F*A+t*a;return h};a.mul=a.multiply;a.translate=function(a,b,h){var d=b[0],f=b[1];b=b[2];var l,g,m,k,p,r,q,z,E,A,n,u;a===h?(h[12]=a[0]*d+a[4]*f+a[8]*b+a[12],h[13]=a[1]*d+a[5]*f+a[9]*b+a[13],h[14]=a[2]*d+a[6]*f+a[10]*b+a[14],h[15]=a[3]*d+a[7]*f+a[11]*b+a[15]):(l=a[0],g=a[1],m=a[2],k=a[3],p=a[4],r=a[5],q=a[6],z=a[7],E=a[8],A=a[9],n=a[10],u=a[11],h[0]=l,h[1]=g,h[2]=m,h[3]=k,h[4]=p,h[5]=r,h[6]=q,h[7]=z,h[8]=E,h[9]=A,h[10]=n,h[11]=u,
h[12]=l*d+p*f+E*b+a[12],h[13]=g*d+r*f+A*b+a[13],h[14]=m*d+q*f+n*b+a[14],h[15]=k*d+z*f+u*b+a[15]);return h};a.scale=function(a,b,h){var d=b[0],f=b[1];b=b[2];h[0]=a[0]*d;h[1]=a[1]*d;h[2]=a[2]*d;h[3]=a[3]*d;h[4]=a[4]*f;h[5]=a[5]*f;h[6]=a[6]*f;h[7]=a[7]*f;h[8]=a[8]*b;h[9]=a[9]*b;h[10]=a[10]*b;h[11]=a[11]*b;h[12]=a[12];h[13]=a[13];h[14]=a[14];h[15]=a[15];return h};a.rotate=function(a,b,h,d){var f=h[0],l=h[1];h=h[2];var g=Math.sqrt(f*f+l*l+h*h),m,k,p,r,q,z,E,A,n,u,e,O,I,F,t,y,L,C,H,K;if(1E-7>Math.abs(g))return null;
g=1/g;f*=g;l*=g;h*=g;m=Math.sin(b);k=Math.cos(b);p=1-k;b=a[0];g=a[1];r=a[2];q=a[3];z=a[4];E=a[5];A=a[6];n=a[7];u=a[8];e=a[9];O=a[10];I=a[11];F=f*f*p+k;t=l*f*p+h*m;y=h*f*p-l*m;L=f*l*p-h*m;C=l*l*p+k;H=h*l*p+f*m;K=f*h*p+l*m;f=l*h*p-f*m;l=h*h*p+k;d[0]=b*F+z*t+u*y;d[1]=g*F+E*t+e*y;d[2]=r*F+A*t+O*y;d[3]=q*F+n*t+I*y;d[4]=b*L+z*C+u*H;d[5]=g*L+E*C+e*H;d[6]=r*L+A*C+O*H;d[7]=q*L+n*C+I*H;d[8]=b*K+z*f+u*l;d[9]=g*K+E*f+e*l;d[10]=r*K+A*f+O*l;d[11]=q*K+n*f+I*l;a!==d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]);
return d};a.rotateX=function(a,b,h){var d=Math.sin(b);b=Math.cos(b);var f=a[4],l=a[5],g=a[6],m=a[7],k=a[8],p=a[9],r=a[10],q=a[11];a!==h&&(h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]);h[4]=f*b+k*d;h[5]=l*b+p*d;h[6]=g*b+r*d;h[7]=m*b+q*d;h[8]=k*b-f*d;h[9]=p*b-l*d;h[10]=r*b-g*d;h[11]=q*b-m*d;return h};a.rotateY=function(a,b,h){var d=Math.sin(b);b=Math.cos(b);var f=a[0],l=a[1],g=a[2],m=a[3],k=a[8],p=a[9],r=a[10],q=a[11];a!==h&&(h[4]=a[4],h[5]=a[5],h[6]=a[6],
h[7]=a[7],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]);h[0]=f*b-k*d;h[1]=l*b-p*d;h[2]=g*b-r*d;h[3]=m*b-q*d;h[8]=f*d+k*b;h[9]=l*d+p*b;h[10]=g*d+r*b;h[11]=m*d+q*b;return h};a.rotateZ=function(a,b,h){var d=Math.sin(b);b=Math.cos(b);var f=a[0],l=a[1],g=a[2],m=a[3],k=a[4],p=a[5],r=a[6],q=a[7];a!==h&&(h[8]=a[8],h[9]=a[9],h[10]=a[10],h[11]=a[11],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]);h[0]=f*b+k*d;h[1]=l*b+p*d;h[2]=g*b+r*d;h[3]=m*b+q*d;h[4]=k*b-f*d;h[5]=p*b-l*d;h[6]=r*b-g*d;h[7]=q*b-m*d;return h};
a.Sw=function(a,b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=a[0];b[13]=a[1];b[14]=a[2];b[15]=1;return b};a.Rw=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=a[1];b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=a[2];b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.Qw=function(a,b,h){var d=b[0],f=b[1];b=b[2];var l=Math.sqrt(d*d+f*f+b*b),g;if(1E-7>Math.abs(l))return null;l=1/l;d*=l;f*=l;b*=l;l=Math.sin(a);a=Math.cos(a);g=1-a;h[0]=d*d*g+a;h[1]=f*d*g+b*
l;h[2]=b*d*g-f*l;h[3]=0;h[4]=d*f*g-b*l;h[5]=f*f*g+a;h[6]=b*f*g+d*l;h[7]=0;h[8]=d*b*g+f*l;h[9]=f*b*g-d*l;h[10]=b*b*g+a;h[11]=0;h[12]=0;h[13]=0;h[14]=0;h[15]=1;return h};a.CC=function(a,b){var h=Math.sin(a),d=Math.cos(a);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=d;b[6]=h;b[7]=0;b[8]=0;b[9]=-h;b[10]=d;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.DC=function(a,b){var h=Math.sin(a),d=Math.cos(a);b[0]=d;b[1]=0;b[2]=-h;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=h;b[9]=0;b[10]=d;b[11]=0;b[12]=0;b[13]=0;
b[14]=0;b[15]=1;return b};a.EC=function(a,b){var h=Math.sin(a),d=Math.cos(a);b[0]=d;b[1]=h;b[2]=0;b[3]=0;b[4]=-h;b[5]=d;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromRotationTranslation=function(a,b,h){var d=a[0],f=a[1],l=a[2],g=a[3],m=d+d,k=f+f,p=l+l;a=d*m;var r=d*k,d=d*p,q=f*k,f=f*p,l=l*p,m=g*m,k=g*k,g=g*p;h[0]=1-(q+l);h[1]=r+g;h[2]=d-k;h[3]=0;h[4]=r-g;h[5]=1-(a+l);h[6]=f+m;h[7]=0;h[8]=d+k;h[9]=f-m;h[10]=1-(a+q);h[11]=0;h[12]=b[0];h[13]=b[1];h[14]=b[2];
h[15]=1;return h};a.fromQuat=function(a,b){var h=a[0],d=a[1],f=a[2],l=a[3],g=h+h,m=d+d,k=f+f,h=h*g,p=d*g,d=d*m,r=f*g,q=f*m,f=f*k,g=l*g,m=l*m,l=l*k;b[0]=1-d-f;b[1]=p+l;b[2]=r-m;b[3]=0;b[4]=p-l;b[5]=1-h-f;b[6]=q+g;b[7]=0;b[8]=r+m;b[9]=q-g;b[10]=1-h-d;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.frustum=function(a,b,h,d,f,l,g){var m=1/(b-a),k=1/(d-h),p=1/(f-l);g[0]=2*f*m;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=2*f*k;g[6]=0;g[7]=0;g[8]=(b+a)*m;g[9]=(d+h)*k;g[10]=(l+f)*p;g[11]=-1;g[12]=0;g[13]=0;g[14]=
l*f*2*p;g[15]=0;return g};a.perspective=function(a,b,h,d,f){a=1/Math.tan(a/2);var l=1/(h-d);f[0]=a/b;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=a;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=(d+h)*l;f[11]=-1;f[12]=0;f[13]=0;f[14]=2*d*h*l;f[15]=0;return f};a.zD=function(a,b,h,d){var f=Math.tan(a.RD*Math.PI/180),l=Math.tan(a.pC*Math.PI/180),g=Math.tan(a.kD*Math.PI/180);a=Math.tan(a.BD*Math.PI/180);var m=2/(g+a),k=2/(f+l);d[0]=m;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=k;d[6]=0;d[7]=0;d[8]=-((g-a)*m*.5);d[9]=(f-l)*k*.5;d[10]=h/
(b-h);d[11]=-1;d[12]=0;d[13]=0;d[14]=h*b/(b-h);d[15]=0;return d};a.ortho=function(a,b,h,d,f,l,g){var m=1/(a-b),k=1/(h-d),p=1/(f-l);g[0]=-2*m;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=-2*k;g[6]=0;g[7]=0;g[8]=0;g[9]=0;g[10]=2*p;g[11]=0;g[12]=(a+b)*m;g[13]=(d+h)*k;g[14]=(l+f)*p;g[15]=1;return g};a.lookAt=function(c,b,h,d){var f,l,g,m,k,p,r,q,z=c[0],E=c[1];c=c[2];g=h[0];m=h[1];l=h[2];r=b[0];h=b[1];f=b[2];if(1E-7>Math.abs(z-r)&&1E-7>Math.abs(E-h)&&1E-7>Math.abs(c-f))return a.identity(d);b=z-r;h=E-h;r=c-f;q=1/Math.sqrt(b*
b+h*h+r*r);b*=q;h*=q;r*=q;f=m*r-l*h;l=l*b-g*r;g=g*h-m*b;(q=Math.sqrt(f*f+l*l+g*g))?(q=1/q,f*=q,l*=q,g*=q):g=l=f=0;m=h*g-r*l;k=r*f-b*g;p=b*l-h*f;(q=Math.sqrt(m*m+k*k+p*p))?(q=1/q,m*=q,k*=q,p*=q):p=k=m=0;d[0]=f;d[1]=m;d[2]=b;d[3]=0;d[4]=l;d[5]=k;d[6]=h;d[7]=0;d[8]=g;d[9]=p;d[10]=r;d[11]=0;d[12]=-(f*z+l*E+g*c);d[13]=-(m*z+k*E+p*c);d[14]=-(b*z+h*E+r*c);d[15]=1;return d};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+
a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};a.Pw=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.mat4=a)};b4w.module.__gpp_eval=function(a){a.yr=function(){function a(c,b,h,d,f,l){this.message=c;this.offset=d;this.oi=f;this.Cg=l;this.name="SyntaxError"}(function(a,b){function h(){this.constructor=a}h.prototype=b.prototype;a.prototype=new h})(a,Error);return{SyntaxError:a,parse:function(c){function b(a,b){switch(a){case "++":return++b;case "--":return--b;case "+":return+b;case "-":return-b;case "~":return~b;case "!":return!b}}function h(a){if(Mb!==a){Mb>a&&(Mb=0,qb={oi:1,Cg:1,Ji:!1});var b=qb,d,e;for(d=
Mb;d<a;d++)e=c.charAt(d),"\n"===e?(b.Ji||b.oi++,b.Cg=1,b.Ji=!1):"\r"===e||"\u2028"===e||"\u2029"===e?(b.oi++,b.Cg=1,b.Ji=!0):(b.Cg++,b.Ji=!1);Mb=a}return qb}function d(a){D<Sa||(D>Sa&&(Sa=D,jb=[]),jb.push(a))}function f(){var a,b,e;a=D;b=U();b!==w?(b=l(),b!==w?(e=U(),e!==w?(X++,10===c.charCodeAt(D)?(e=kc,D++):(e=w,0===X&&d(lc)),e===w&&(c.substr(D,2)===bb?(e=bb,D+=2):(e=w,0===X&&d(mc)),e===w&&(13===c.charCodeAt(D)?(e=nc,D++):(e=w,0===X&&d(hb)))),X--,e===w&&0===X&&d(Rb),e===w&&(e=null),e!==w?a=b:(D=
a,a=w)):(D=a,a=w)):(D=a,a=w)):(D=a,a=w);return a}function l(){var a,b,e,f,k,h,l,m;a=D;b=g();if(b!==w){e=[];f=D;k=U();k!==w?(44===c.charCodeAt(D)?(h=fa,D++):(h=w,0===X&&d(ia)),h!==w?(l=U(),l!==w?(m=g(),m!==w?f=k=[k,h,l,m]:(D=f,f=w)):(D=f,f=w)):(D=f,f=w)):(D=f,f=w);for(;f!==w;)e.push(f),f=D,k=U(),k!==w?(44===c.charCodeAt(D)?(h=fa,D++):(h=w,0===X&&d(ia)),h!==w?(l=U(),l!==w?(m=g(),m!==w?f=k=[k,h,l,m]:(D=f,f=w)):(D=f,f=w)):(D=f,f=w)):(D=f,f=w);e!==w?a=b=0==e.length?b:e[e.length-1]:(D=a,a=w)}else D=a,a=
w;return a}function g(){var a,b,e,f;a=D;b=m();b!==w?(e=U(),e!==w?(63===c.charCodeAt(D)?(e=S,D++):(e=w,0===X&&d(P)),e!==w?(e=U(),e!==w?(e=l(),e!==w?(f=U(),f!==w?(58===c.charCodeAt(D)?(f=ga,D++):(f=w,0===X&&d(qa)),f!==w?(f=U(),f!==w?(f=l(),f!==w?a=b?e:f:(D=a,a=w)):(D=a,a=w)):(D=a,a=w)):(D=a,a=w)):(D=a,a=w)):(D=a,a=w)):(D=a,a=w)):(D=a,a=w)):(D=a,a=w);a===w&&(a=m());return a}function m(){var a,b,c,d,e,f,g,h;a=D;b=k();if(b!==w){c=[];d=D;e=U();e!==w?(f=ca(),f!==w?(g=U(),g!==w?(h=k(),h!==w?d=e=[e,f,g,h]:
(D=d,d=w)):(D=d,d=w)):(D=d,d=w)):(D=d,d=w);for(;d!==w;)c.push(d),d=D,e=U(),e!==w?(f=ca(),f!==w?(g=U(),g!==w?(h=k(),h!==w?d=e=[e,f,g,h]:(D=d,d=w)):(D=d,d=w)):(D=d,d=w)):(D=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)a=a||c[b][3];else D=a,a=w}else D=a,a=w;return a}function k(){var a,b,c,d,e,f,g,k;a=D;b=x();if(b!==w){c=[];d=D;e=U();e!==w?(f=V(),f!==w?(g=U(),g!==w?(k=x(),k!==w?d=e=[e,f,g,k]:(D=d,d=w)):(D=d,d=w)):(D=d,d=w)):(D=d,d=w);for(;d!==w;)c.push(d),d=D,e=U(),e!==w?(f=V(),f!==w?(g=U(),g!==w?(k=x(),
k!==w?d=e=[e,f,g,k]:(D=d,d=w)):(D=d,d=w)):(D=d,d=w)):(D=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)a=a&&c[b][3];else D=a,a=w}else D=a,a=w;return a}function x(){var a,b,c,d,e,f,g,k;a=D;b=r();if(b!==w){c=[];d=D;e=U();e!==w?(f=R(),f!==w?(g=U(),g!==w?(k=r(),k!==w?d=e=[e,f,g,k]:(D=d,d=w)):(D=d,d=w)):(D=d,d=w)):(D=d,d=w);for(;d!==w;)c.push(d),d=D,e=U(),e!==w?(f=R(),f!==w?(g=U(),g!==w?(k=r(),k!==w?d=e=[e,f,g,k]:(D=d,d=w)):(D=d,d=w)):(D=d,d=w)):(D=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)a|=c[b][3];else D=
a,a=w}else D=a,a=w;return a}function r(){var a,b,c,d,e,f,g,k;a=D;b=q();if(b!==w){c=[];d=D;e=U();e!==w?(f=J(),f!==w?(g=U(),g!==w?(k=q(),k!==w?d=e=[e,f,g,k]:(D=d,d=w)):(D=d,d=w)):(D=d,d=w)):(D=d,d=w);for(;d!==w;)c.push(d),d=D,e=U(),e!==w?(f=J(),f!==w?(g=U(),g!==w?(k=q(),k!==w?d=e=[e,f,g,k]:(D=d,d=w)):(D=d,d=w)):(D=d,d=w)):(D=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)a^=c[b][3];else D=a,a=w}else D=a,a=w;return a}function q(){var a,b,c,d,e,f,g,k;a=D;b=z();if(b!==w){c=[];d=D;e=U();e!==w?(f=N(),f!==w?
(g=U(),g!==w?(k=z(),k!==w?d=e=[e,f,g,k]:(D=d,d=w)):(D=d,d=w)):(D=d,d=w)):(D=d,d=w);for(;d!==w;)c.push(d),d=D,e=U(),e!==w?(f=N(),f!==w?(g=U(),g!==w?(k=z(),k!==w?d=e=[e,f,g,k]:(D=d,d=w)):(D=d,d=w)):(D=d,d=w)):(D=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)a&=c[b][3];else D=a,a=w}else D=a,a=w;return a}function z(){var a,b,c,d,e,f,g,k;a=D;b=E();if(b!==w){c=[];d=D;e=U();e!==w?(f=v(),f!==w?(g=U(),g!==w?(k=E(),k!==w?d=e=[e,f,g,k]:(D=d,d=w)):(D=d,d=w)):(D=d,d=w)):(D=d,d=w);for(;d!==w;)c.push(d),d=D,e=U(),
e!==w?(f=v(),f!==w?(g=U(),g!==w?(k=E(),k!==w?d=e=[e,f,g,k]:(D=d,d=w)):(D=d,d=w)):(D=d,d=w)):(D=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "==":a=a==c[b][3];break;case "!=":a=a!=c[b][3]}else D=a,a=w}else D=a,a=w;return a}function E(){var a,b,c,d,e,f,g,k;a=D;b=A();if(b!==w){c=[];d=D;e=U();e!==w?(f=G(),f!==w?(g=U(),g!==w?(k=A(),k!==w?d=e=[e,f,g,k]:(D=d,d=w)):(D=d,d=w)):(D=d,d=w)):(D=d,d=w);for(;d!==w;)c.push(d),d=D,e=U(),e!==w?(f=G(),f!==w?(g=U(),g!==w?(k=A(),k!==w?d=e=[e,f,g,k]:
(D=d,d=w)):(D=d,d=w)):(D=d,d=w)):(D=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<=":a=a<=c[b][3];break;case ">=":a=a>=c[b][3];break;case "<":a=a<c[b][3];break;case ">":a=a>c[b][3]}else D=a,a=w}else D=a,a=w;return a}function A(){var a,b,c,d,e,f,g,k;a=D;b=n();if(b!==w){c=[];d=D;e=U();e!==w?(f=M(),f!==w?(g=U(),g!==w?(k=n(),k!==w?d=e=[e,f,g,k]:(D=d,d=w)):(D=d,d=w)):(D=d,d=w)):(D=d,d=w);for(;d!==w;)c.push(d),d=D,e=U(),e!==w?(f=M(),f!==w?(g=U(),g!==w?(k=n(),k!==w?d=e=[e,f,g,k]:(D=d,
d=w)):(D=d,d=w)):(D=d,d=w)):(D=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<<":a<<=c[b][3];break;case ">>":a>>=c[b][3]}else D=a,a=w}else D=a,a=w;return a}function n(){var a,b,c,d,e,f,g,k;a=D;b=u();if(b!==w){c=[];d=D;e=U();e!==w?(f=K(),f!==w?(g=U(),g!==w?(k=u(),k!==w?d=e=[e,f,g,k]:(D=d,d=w)):(D=d,d=w)):(D=d,d=w)):(D=d,d=w);for(;d!==w;)c.push(d),d=D,e=U(),e!==w?(f=K(),f!==w?(g=U(),g!==w?(k=u(),k!==w?d=e=[e,f,g,k]:(D=d,d=w)):(D=d,d=w)):(D=d,d=w)):(D=d,d=w);if(c!==w)for(a=b,b=0;b<
c.length;b++)switch(c[b][1]){case "+":a+=c[b][3];break;case "-":a-=c[b][3]}else D=a,a=w}else D=a,a=w;return a}function u(){var a,b,c,d,f,g,k,h;a=D;b=e();if(b!==w){c=[];d=D;f=U();f!==w?(g=H(),g!==w?(k=U(),k!==w?(h=e(),h!==w?d=f=[f,g,k,h]:(D=d,d=w)):(D=d,d=w)):(D=d,d=w)):(D=d,d=w);for(;d!==w;)c.push(d),d=D,f=U(),f!==w?(g=H(),g!==w?(k=U(),k!==w?(h=e(),h!==w?d=f=[f,g,k,h]:(D=d,d=w)):(D=d,d=w)):(D=d,d=w)):(D=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "*":a*=c[b][3];break;case "/":a=
Math.floor(a/c[b][3]);break;case "%":a%=c[b][3]}else D=a,a=w}else D=a,a=w;return a}function e(){var a,f,g;a=D;c.substr(D,7)===ya?(f=ya,D+=7):(f=w,0===X&&d(ba));f!==w?(g=U(),g!==w?(g=I(),g!==w?a=g:(D=a,a=w)):(D=a,a=w)):(D=a,a=w);if(a===w){a=D;f=O();if(f!==w)if(g=U(),g!==w)if(c.substr(D,2)===ob?(g=ob,D+=2):(g=w,0===X&&d(va)),g===w&&(c.substr(D,2)===Pb?(g=Pb,D+=2):(g=w,0===X&&d(ja))),g!==w){a:{a=f;switch(g){case "++":f=++a;break a;case "--":f=--a;break a}f=void 0}a=f}else D=a,a=w;else D=a,a=w;else D=
a,a=w;a===w&&(a=O());a===w&&(a=D,c.substr(D,2)===ob?(f=ob,D+=2):(f=w,0===X&&d(va)),f===w&&(c.substr(D,2)===Pb?(f=Pb,D+=2):(f=w,0===X&&d(ja)),f===w&&(43===c.charCodeAt(D)?(f=Va,D++):(f=w,0===X&&d(za)),f===w&&(45===c.charCodeAt(D)?(f=Wa,D++):(f=w,0===X&&d(ab)),f===w&&(126===c.charCodeAt(D)?(f=sa,D++):(f=w,0===X&&d(Ma)),f===w&&(33===c.charCodeAt(D)?(f=Vb,D++):(f=w,0===X&&d(Wb))))))),f!==w?(g=U(),g!==w?(g=e(),g!==w?a=f=b(f,g):(D=a,a=w)):(D=a,a=w)):(D=a,a=w))}return a}function O(){var a,b,e;X++;var f;
a=D;48===c.charCodeAt(D)?(b=pa,D++):(b=w,0===X&&d(Ga));if(b!==w)if(ra.test(c.charAt(D))?(b=c.charAt(D),D++):(b=w,0===X&&d(Ia)),b!==w){b=D;e=[];f=t();if(f!==w)for(;f!==w;)e.push(f),f=t();else e=w;b=e!==w?c.substring(b,D):e;b!==w?a=b=parseInt("0x"+b):(D=a,a=w)}else D=a,a=w;else D=a,a=w;if(a===w){a=D;48===c.charCodeAt(D)?(b=pa,D++):(b=w,0===X&&d(Ga));if(b===w)if(b=D,La.test(c.charAt(D))?(e=c.charAt(D),D++):(e=w,0===X&&d(la)),e!==w){var g;f=[];g=F();if(g!==w)for(;g!==w;)f.push(g),g=F();else f=w;f===w&&
(f=null);f!==w?b=e=[e,f]:(D=b,b=w)}else D=b,b=w;a=b!==w?c.substring(a,D):b;a!==w&&(a=parseInt(a))}X--;a===w&&0===X&&d(oa);a===w&&(b=y(),b!==w&&(b=0),a=b,a===w&&(a=D,40===c.charCodeAt(D)?(b=Y,D++):(b=w,0===X&&d(B)),b!==w?(b=U(),b!==w?(b=l(),b!==w?(e=U(),e!==w?(41===c.charCodeAt(D)?(e=W,D++):(e=w,0===X&&d(na)),e!==w?a=b:(D=a,a=w)):(D=a,a=w)):(D=a,a=w)):(D=a,a=w)):(D=a,a=w)));return a}function I(){var a,b,e,f,g;b=y();b!==w&&(b=0);a=b;if(a===w){b=[];f=e=D;X++;40===c.charCodeAt(D)?(g=Y,D++):(g=w,0===X&&
d(B));g===w&&(41===c.charCodeAt(D)?(g=W,D++):(g=w,0===X&&d(na)));X--;g===w?f=void 0:(D=f,f=w);f!==w?(g=T(),g!==w?e=f=[f,g]:(D=e,e=w)):(D=e,e=w);if(e!==w)for(;e!==w;)b.push(e),f=e=D,X++,40===c.charCodeAt(D)?(g=Y,D++):(g=w,0===X&&d(B)),g===w&&(41===c.charCodeAt(D)?(g=W,D++):(g=w,0===X&&d(na))),X--,g===w?f=void 0:(D=f,f=w),f!==w?(g=T(),g!==w?e=f=[f,g]:(D=e,e=w)):(D=e,e=w);else b=w;b!==w&&(b=1);a=b;a===w&&(a=D,40===c.charCodeAt(D)?(b=Y,D++):(b=w,0===X&&d(B)),b!==w?(e=U(),e!==w?(f=I(),f!==w?(g=U(),g!==
w?(41===c.charCodeAt(D)?(b=W,D++):(b=w,0===X&&d(na)),b!==w?a=f:(D=a,a=w)):(D=a,a=w)):(D=a,a=w)):(D=a,a=w)):(D=a,a=w))}return a}function F(){var a;da.test(c.charAt(D))?(a=c.charAt(D),D++):(a=w,0===X&&d(Q));return a}function t(){var a;ta.test(c.charAt(D))?(a=c.charAt(D),D++):(a=w,0===X&&d(lb));return a}function y(){var a,b;X++;b=a=D;X++;var e,f,g,k;e=D;c.substr(D,7)===ya?(f=ya,D+=7):(f=w,0===X&&d(ba));f!==w?(g=D,X++,k=C(),X--,k===w?g=void 0:(D=g,g=w),g!==w?e=f=[f,g]:(D=e,e=w)):(D=e,e=w);X--;e===w?b=
void 0:(D=b,b=w);if(b!==w){X++;b=D;e=L();if(e!==w){f=[];for(g=C();g!==w;)f.push(g),g=C();f!==w?b=e+=f.join(""):(D=b,b=w)}else D=b,b=w;X--;b===w&&0===X&&d(ua);b!==w?a=b:(D=a,a=w)}else D=a,a=w;X--;a===w&&0===X&&d(ua);return a}function L(){var a;Ja.test(c.charAt(D))?(a=c.charAt(D),D++):(a=w,0===X&&d(Ea));a===w&&(36===c.charCodeAt(D)?(a=mb,D++):(a=w,0===X&&d(Fa)),a===w&&(95===c.charCodeAt(D)?(a=nb,D++):(a=w,0===X&&d($a))));return a}function C(){var a;a=L();a===w&&(a=F());return a}function H(){var a,b,
e,f;a=D;42===c.charCodeAt(D)?(b=Kb,D++):(b=w,0===X&&d(Eb));b===w&&(47===c.charCodeAt(D)?(b=Pa,D++):(b=w,0===X&&d(ib)),b===w&&(37===c.charCodeAt(D)?(b=cc,D++):(b=w,0===X&&d(sc))));b!==w?(e=D,X++,61===c.charCodeAt(D)?(f=dc,D++):(f=w,0===X&&d(Lb)),X--,f===w?e=void 0:(D=e,e=w),e!==w?a=b:(D=a,a=w)):(D=a,a=w);return a}function K(){var a,b,e;a=D;43===c.charCodeAt(D)?(b=Va,D++):(b=w,0===X&&d(za));b!==w?(b=D,X++,43===c.charCodeAt(D)?(e=Va,D++):(e=w,0===X&&d(za)),e===w&&(61===c.charCodeAt(D)?(e=dc,D++):(e=
w,0===X&&d(Lb))),X--,e===w?b=void 0:(D=b,b=w),b!==w?a="+":(D=a,a=w)):(D=a,a=w);a===w&&(a=D,45===c.charCodeAt(D)?(b=Wa,D++):(b=w,0===X&&d(ab)),b!==w?(b=D,X++,45===c.charCodeAt(D)?(e=Wa,D++):(e=w,0===X&&d(ab)),e===w&&(61===c.charCodeAt(D)?(e=dc,D++):(e=w,0===X&&d(Lb))),X--,e===w?b=void 0:(D=b,b=w),b!==w?a="-":(D=a,a=w)):(D=a,a=w));return a}function M(){var a;c.substr(D,2)===db?(a=db,D+=2):(a=w,0===X&&d(xa));a===w&&(c.substr(D,2)===eb?(a=eb,D+=2):(a=w,0===X&&d(Xa)));return a}function G(){var a;c.substr(D,
2)===Qa?(a=Qa,D+=2):(a=w,0===X&&d(xb));a===w&&(c.substr(D,2)===pb?(a=pb,D+=2):(a=w,0===X&&d(yb)),a===w&&(60===c.charCodeAt(D)?(a=zb,D++):(a=w,0===X&&d(sb)),a===w&&(62===c.charCodeAt(D)?(a=Na,D++):(a=w,0===X&&d(Aa)))));return a}function v(){var a;c.substr(D,2)===Fb?(a=Fb,D+=2):(a=w,0===X&&d(Gb));a===w&&(c.substr(D,2)===Ba?(a=Ba,D+=2):(a=w,0===X&&d(ec)));return a}function N(){var a,b,e;a=D;38===c.charCodeAt(D)?(b=ea,D++):(b=w,0===X&&d(Ca));b!==w?(b=D,X++,38===c.charCodeAt(D)?(e=ea,D++):(e=w,0===X&&
d(Ca)),X--,e===w?b=void 0:(D=b,b=w),b!==w?a="&":(D=a,a=w)):(D=a,a=w);return a}function J(){var a,b,e;a=D;94===c.charCodeAt(D)?(b=Ra,D++):(b=w,0===X&&d(wa));b!==w?(b=D,X++,94===c.charCodeAt(D)?(e=Ra,D++):(e=w,0===X&&d(wa)),X--,e===w?b=void 0:(D=b,b=w),b!==w?a="^":(D=a,a=w)):(D=a,a=w);return a}function R(){var a,b,e;a=D;124===c.charCodeAt(D)?(b=Ka,D++):(b=w,0===X&&d(vb));b!==w?(b=D,X++,124===c.charCodeAt(D)?(e=Ka,D++):(e=w,0===X&&d(vb)),X--,e===w?b=void 0:(D=b,b=w),b!==w?a="|":(D=a,a=w)):(D=a,a=w);
return a}function V(){var a;c.substr(D,2)===wb?(a=wb,D+=2):(a=w,0===X&&d(Xb));a!==w&&(a="&&");return a}function ca(){var a;c.substr(D,2)===Yb?(a=Yb,D+=2):(a=w,0===X&&d(Oa));a!==w&&(a="||");return a}function U(){var a,b;a=[];for(b=Z();b!==w;)a.push(b),b=Z();return a}function Z(){var a;X++;Hb.test(c.charAt(D))?(a=c.charAt(D),D++):(a=w,0===X&&d(Zb));X--;a===w&&0===X&&d(Qb);return a}function T(){var a;c.length>D?(a=c.charAt(D),D++):(a=w,0===X&&d(fc));return a}var aa=1<arguments.length?arguments[1]:{},
w={},ha={start:f},ma=f,fa=",",ia={type:"literal",value:",",description:'","'},S="?",P={type:"literal",value:"?",description:'"?"'},ga=":",qa={type:"literal",value:":",description:'":"'},ya="defined",ba={type:"literal",value:"defined",description:'"defined"'},Y="(",B={type:"literal",value:"(",description:'"("'},W=")",na={type:"literal",value:")",description:'")"'},oa={type:"other",description:"number"},pa="0",Ga={type:"literal",value:"0",description:'"0"'},da=/^[0-9]/,Q={type:"class",value:"[0-9]",
description:"[0-9]"},La=/^[1-9]/,la={type:"class",value:"[1-9]",description:"[1-9]"},ra=/^[xX]/,Ia={type:"class",value:"[xX]",description:"[xX]"},ta=/^[0-9a-fA-F]/,lb={type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},ua={type:"other",description:"identifier"},mb="$",Fa={type:"literal",value:"$",description:'"$"'},nb="_",$a={type:"literal",value:"_",description:'"_"'},Ja=/^[a-zA-Z]/,Ea={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},ob="++",va={type:"literal",value:"++",description:'"++"'},
Pb="--",ja={type:"literal",value:"--",description:'"--"'},Va="+",za={type:"literal",value:"+",description:'"+"'},Wa="-",ab={type:"literal",value:"-",description:'"-"'},sa="~",Ma={type:"literal",value:"~",description:'"~"'},Vb="!",Wb={type:"literal",value:"!",description:'"!"'},Kb="*",Eb={type:"literal",value:"*",description:'"*"'},Pa="/",ib={type:"literal",value:"/",description:'"/"'},cc="%",sc={type:"literal",value:"%",description:'"%"'},dc="=",Lb={type:"literal",value:"=",description:'"="'},db=
"<<",xa={type:"literal",value:"<<",description:'"<<"'},eb=">>",Xa={type:"literal",value:">>",description:'">>"'},Qa="<=",xb={type:"literal",value:"<=",description:'"<="'},pb=">=",yb={type:"literal",value:">=",description:'">="'},zb="<",sb={type:"literal",value:"<",description:'"<"'},Na=">",Aa={type:"literal",value:">",description:'">"'},Fb="==",Gb={type:"literal",value:"==",description:'"=="'},Ba="!=",ec={type:"literal",value:"!=",description:'"!="'},ea="&",Ca={type:"literal",value:"&",description:'"&"'},
Ra="^",wa={type:"literal",value:"^",description:'"^"'},Ka="|",vb={type:"literal",value:"|",description:'"|"'},wb="&&",Xb={type:"literal",value:"&&",description:'"&&"'},Yb="||",Oa={type:"literal",value:"||",description:'"||"'},Qb={type:"other",description:"whitespace"},Hb=/^[\t\x0B\f ]/,Zb={type:"class",value:"[\\t\\v\\f ]",description:"[\\t\\v\\f ]"},Rb={type:"other",description:"end of line"},kc="\n",lc={type:"literal",value:"\n",description:'"\\n"'},bb="\r\n",mc={type:"literal",value:"\r\n",description:'"\\r\\n"'},
nc="\r",hb={type:"literal",value:"\r",description:'"\\r"'},fc={type:"any",description:"any character"},D=0,Mb=0,qb={oi:1,Cg:1,Ji:!1},Sa=0,jb=[],X=0,Ha;if("startRule"in aa){if(!(aa.ms in ha))throw Error("Can't start parsing from rule \""+aa.ms+'".');ma=ha[aa.ms]}Ha=ma();if(Ha!==w&&D===c.length)return Ha;Ha!==w&&D<c.length&&d({type:"end",description:"end of input"});throw function(b,d,e){function f(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?
1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function g(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0100-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1000-\uFFFF]/g,
function(a){return"\\u"+b(a)})}var d=Array(a.length),e;for(e=0;e<a.length;e++)d[e]=a[e].description;d=1<a.length?d.slice(0,-1).join(", ")+" or "+d[a.length-1]:d[0];e=b?'"'+c(b)+'"':"end of input";return"Expected "+d+" but "+e+" found."}var k=h(e),l=e<c.length?c.charAt(e):null;null!==d&&f(d);return new a(null!==b?b:g(d,l),0,0,e,k.oi,k.Cg)}(null,jb,Sa);}}}()};b4w.module.__md5=function(a){function p(a,f){var m=a[0],k=a[1],p=a[2],r=a[3],m=b(m,k,p,r,f[0],7,-680876936),r=b(r,m,k,p,f[1],12,-389564586),p=b(p,r,m,k,f[2],17,606105819),k=b(k,p,r,m,f[3],22,-1044525330),m=b(m,k,p,r,f[4],7,-176418897),r=b(r,m,k,p,f[5],12,1200080426),p=b(p,r,m,k,f[6],17,-1473231341),k=b(k,p,r,m,f[7],22,-45705983),m=b(m,k,p,r,f[8],7,1770035416),r=b(r,m,k,p,f[9],12,-1958414417),p=b(p,r,m,k,f[10],17,-42063),k=b(k,p,r,m,f[11],22,-1990404162),m=b(m,k,p,r,f[12],7,1804603682),r=b(r,m,k,p,
f[13],12,-40341101),p=b(p,r,m,k,f[14],17,-1502002290),k=b(k,p,r,m,f[15],22,1236535329),m=h(m,k,p,r,f[1],5,-165796510),r=h(r,m,k,p,f[6],9,-1069501632),p=h(p,r,m,k,f[11],14,643717713),k=h(k,p,r,m,f[0],20,-373897302),m=h(m,k,p,r,f[5],5,-701558691),r=h(r,m,k,p,f[10],9,38016083),p=h(p,r,m,k,f[15],14,-660478335),k=h(k,p,r,m,f[4],20,-405537848),m=h(m,k,p,r,f[9],5,568446438),r=h(r,m,k,p,f[14],9,-1019803690),p=h(p,r,m,k,f[3],14,-187363961),k=h(k,p,r,m,f[8],20,1163531501),m=h(m,k,p,r,f[13],5,-1444681467),r=
h(r,m,k,p,f[2],9,-51403784),p=h(p,r,m,k,f[7],14,1735328473),k=h(k,p,r,m,f[12],20,-1926607734),m=c(k^p^r,m,k,f[5],4,-378558),r=c(m^k^p,r,m,f[8],11,-2022574463),p=c(r^m^k,p,r,f[11],16,1839030562),k=c(p^r^m,k,p,f[14],23,-35309556),m=c(k^p^r,m,k,f[1],4,-1530992060),r=c(m^k^p,r,m,f[4],11,1272893353),p=c(r^m^k,p,r,f[7],16,-155497632),k=c(p^r^m,k,p,f[10],23,-1094730640),m=c(k^p^r,m,k,f[13],4,681279174),r=c(m^k^p,r,m,f[0],11,-358537222),p=c(r^m^k,p,r,f[3],16,-722521979),k=c(p^r^m,k,p,f[6],23,76029189),m=
c(k^p^r,m,k,f[9],4,-640364487),r=c(m^k^p,r,m,f[12],11,-421815835),p=c(r^m^k,p,r,f[15],16,530742520),k=c(p^r^m,k,p,f[2],23,-995338651),m=d(m,k,p,r,f[0],6,-198630844),r=d(r,m,k,p,f[7],10,1126891415),p=d(p,r,m,k,f[14],15,-1416354905),k=d(k,p,r,m,f[5],21,-57434055),m=d(m,k,p,r,f[12],6,1700485571),r=d(r,m,k,p,f[3],10,-1894986606),p=d(p,r,m,k,f[10],15,-1051523),k=d(k,p,r,m,f[1],21,-2054922799),m=d(m,k,p,r,f[8],6,1873313359),r=d(r,m,k,p,f[15],10,-30611744),p=d(p,r,m,k,f[6],15,-1560198380),k=d(k,p,r,m,f[13],
21,1309151649),m=d(m,k,p,r,f[4],6,-145523070),r=d(r,m,k,p,f[11],10,-1120210379),p=d(p,r,m,k,f[2],15,718787259),k=d(k,p,r,m,f[9],21,-343485551);a[0]=m+a[0]&4294967295;a[1]=k+a[1]&4294967295;a[2]=p+a[2]&4294967295;a[3]=r+a[3]&4294967295}function c(a,b,c,d,f,h){b=(b+a&4294967295)+(d+h&4294967295)&4294967295;return(b<<f|b>>>32-f)+c&4294967295}function b(a,b,d,f,h,p,q){return c(b&d|~b&f,a,b,h,p,q)}function h(a,b,d,f,h,p,q){return c(b&f|d&~f,a,b,h,p,q)}function d(a,b,d,f,h,p,q){return c(d^(b|~f),a,b,h,
p,q)}var f="0123456789abcdef".split("");a.uq=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var d;for(d=64;d<=b.length;d+=64){for(var h=b.substring(d-64,d),r=[],q=void 0,q=0;64>q;q+=4)r[q>>2]=h.charCodeAt(q)+(h.charCodeAt(q+1)<<8)+(h.charCodeAt(q+2)<<16)+(h.charCodeAt(q+3)<<24);p(a,r)}b=b.substring(d-64);h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<b.length;d++)h[d>>2]|=b.charCodeAt(d)<<(d%4<<3);h[d>>2]|=128<<(d%4<<3);if(55<d)for(p(a,h),d=0;16>d;d++)h[d]=0;h[14]=8*
c;p(a,h);for(b=0;b<a.length;b++){c=a[b];d="";for(h=0;4>h;h++)d+=f[c>>8*h+4&15]+f[c>>8*h&15];a[b]=d}return a.join("")}};b4w.module.shader_texts=function(a){a["anchors.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"void main ( ) { gl_FragColor = vec4 ( 1.0 ) ; }".split(" ")}]};a["anchors.glslv"]={type:"group",a:[{type:"var",name:"ANCHOR_NUM",b:["0"]},{type:"textline",b:"attribute float a_index ; uniform vec3 u_position [ ANCHOR_NUM ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec4 a ; a = u_view_matrix * vec4 ( u_position [ int ( a_index ) ] , 1.0 ) ; gl_Position = u_proj_matrix * a ; gl_PointSize = 4.0 ; }".split(" ")}]};
a["color_id.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec3 u_color_id ; uniform vec4 u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_OUTLINE"],group:{type:"group",
a:[{type:"textline",b:["uniform","float","u_outline_intensity",";"]}]}}]},{type:"textline",b:"void main ( ) { float b ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"b = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"b = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",b:"if ( b < 0.5 ) discard ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_OUTLINE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_outline_intensity ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["color_id.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},
{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",
a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; attribute vec3 a_normal ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",
a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",
b:"void main ( ) { mat4 ck ; vec3 cl , cm , cn , co ; cl = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"cl = mix ( cl , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"cm = vec3 ( 0.0 ) ; cn = vec3 ( 0.0 ) ; co = vec3 ( 0.0 ) ; bv ( cl , cm , cn , co ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],
group:{type:"group",a:[{type:"textline",b:["cm","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"cm = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"cn = ( u_model_matrix * vec4 ( cm , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"ck = ao ( u_camera_eye , cn , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"ck = ai ( u_camera_eye , cn , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"co = ( u_model_matrix * vec4 ( cm , 1.0 ) ) . xyz ; ck = ck * aa ( u_wind , u_time , u_jitter_amp , u_jitter_freq , co ) ;".split(" ")}]}}]},{type:"textline",b:"d cp = av ( cl - cm , cm , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ck ) ; cp . b = cn ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"d cp = av ( cl , cm , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["co","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"co = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"cj ( cp . a , cp . b , co ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = ay ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"textline",b:"gl_Position = u_proj_matrix * u_view_matrix * vec4 ( cp . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ;".split(" ")}]}}]},{type:"textline",b:["uniform","sampler2D","u_shadow_map0",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform",
"sampler2D","u_shadow_mask",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",
a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"include",file:"shadow.glslf"}]}}]},{type:"textline",b:"void main ( ) { float e_ ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],
group:{type:"group",a:[{type:"textline",b:"e_ = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"e_ = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",b:"if ( e_ < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = cq ( cD ) ;".split(" ")}]}},
{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( eU ( cJ . z ) , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",
b:["}"]}]};a["depth.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:"WIND_BEND && MAIN_BEND_COL && DETAIL_BEND || SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],
group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",
b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:"BILLBOARD && SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_shadow_cast_billboard_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",
a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { float fT ; vec2 fU ; vec4 fV , fW ; mat4 fX , fY ; vec3 fZ , f_ , ga , gb ; fZ = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"fZ = mix ( fZ , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"f_ = vec3 ( 0.0 ) ; ga = vec3 ( 0.0 ) ; gb = vec3 ( 0.0 ) ; bv ( fZ , f_ , ga , gb ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["f_","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"f_ = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],
group:{type:"group",a:[{type:"textline",b:"d gc = fE ( fZ , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , f_ , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"ga = ( u_model_matrix * vec4 ( f_ , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:"! HAIR_BILLBOARD && SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),
group:{type:"group",a:[{type:"textline",b:["fX","=","u_shadow_cast_billboard_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["fX","=","u_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"fY = ao ( u_camera_eye , ga , fX , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"fY = ai ( u_camera_eye , ga , fX ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"gb = ( u_model_matrix * vec4 ( f_ , 1.0 ) ) . xyz ; fY = fY * aa ( u_wind , u_time , u_jitter_amp , u_jitter_freq , gb ) ;".split(" ")}]}}]},{type:"textline",b:"d gc = av ( fZ - f_ , f_ , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , fY ) ; gc . b = ga ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d gc = av ( fZ , f_ , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["gb","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gb = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"cj ( gc . a , gc . b , gb ) ;".split(" ")}]}}]},{type:"textline",b:"fV = u_view_matrix * vec4 ( gc . a , 1.0 ) ; fW = u_proj_matrix * fV ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"fW . xy += u_subpixel_jitter * fW . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = ay ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"fO ( gc . a ) ; cJ = fV ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],
group:{type:"group",a:[{type:"textline",b:"cD = - fV . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:"fU = ( u_proj_matrix * u_view_matrix [ 3 ] ) . xy ; fT = SHADOW_TEX_RES / 2.0 ; fU = floor ( fU * fT + 0.5 ) / fT - fU ; fW . xy += fU ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","fW",";","}"]}]};a["grass_map.glslf"]={type:"group",a:[{type:"include",
file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","fT",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","fT",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","fT",";"]}]}}]}]}}]},
{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["gl_FragColor","=","fT",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( fT , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",
b:"gl_FragColor = vec4 ( 1.0 , fT ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["}"]}]};a["grass_map.glslv"]={type:"group",a:[{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_grass_size",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",
a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","fT",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","fT",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","fT",";"]}]}}]}]}}]},{type:"textline",b:"void main ( ) { vec4 fU ; mat4 fV ; vec3 fW ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"fW = ( u_model_matrix * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; fV = ai ( u_camera_eye , fW , u_view_matrix ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"fV = fV * aa ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"d fX = av ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , fV ) ; fX . b = fW ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d fX = av ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},
{type:"textline",b:"fU = u_proj_matrix * u_view_matrix * vec4 ( fX . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"fT = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["fT","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],
group:{type:"group",a:[{type:"textline",b:["fT","=","a_grass_color",";"]}]}}]}]}}]},{type:"textline",b:["gl_Position","=","fU",";","}"]}]};a["halo.glslf"]={type:"group",a:[{type:"var",name:"NUM_LINES",b:["0"]},{type:"var",name:"NUM_RINGS",b:["0"]},{type:"var",name:"NUM_STARS",b:["0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 ga ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying float gb ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS",
">","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"const int gc = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const int gc = NUM_LINES ;".split(" ")}]}}]},{type:"textline",b:"float ge ( float gd ) { return gd - floor ( gd * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"void gn ( inout float gf , in float gg [ gc ] , in float gh ) { float gi , gj , gk , gl ; for ( int gm = 0 ; gm < NUM_RINGS ; gm ++ ) { gi = 40.0 * gg [ gm ] ; gj = 300.0 * ( ge ( gi ) - 0.005 ) ; gk = gi ; gl = abs ( gk * ( u_halo_size * gj - gh ) ) ; gf += 1.0 - min ( gl , 1.0 ) ; } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"void gw ( inout float go , in float gp [ gc ] , in float gq ) { float gr , gs , gt , gu ; for ( int gv = 0 ; gv < NUM_LINES ; gv ++ ) { gr = gp [ gv ] ; gs = gr ; gt = 1000.0 * ( ge ( gr ) - 0.005 ) ; gu = 20.0 * abs ( gs * a . x + gt * a . y ) ; go += 1.0 - min ( gu , 1.0 ) ; } go *= gq ; }".split(" ")}]}}]},{type:"textline",b:"void gD ( inout float gx , in vec2 gy ) { float gz , gA , gB , gC ; gA = atan ( gy . y , gy . x ) ; gA *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; gB = cos ( gA ) ; gC = sin ( gA ) ; gA = ( gB * gy . x + gC * gy . y ) * ( gB * gy . y - gC * gy . x ) ; gz = abs ( gA ) ; if ( gz < 1.0 ) { gz = ( 0.01 * u_halo_size ) / ( gz ) ; gx *= sqrt ( min ( gz , 1.0 ) ) ; } } void main ( ) { vec3 gE ; float gF , gG , gH , gI ; gF = ( a . x * a . x + a . y * a . y ) ; gG = sqrt ( gF ) ; gF = max ( 1.0 - gF , 0.0 ) ; gF = pow ( gF , u_halo_hardness ) ; gH = u_diffuse_color . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_RINGS","||","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float gJ [ gc ] ; for ( int gK = 0 ; gK < gc ; gK ++ ) { gJ [ gK ] = fract ( gb / ( float ( gK ) + 0.01 ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"gI = 0.0 ; gn ( gI , gJ , gG ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"gG = 0.0 ; gw ( gG , gJ , gF ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_STARS"],group:{type:"group",a:[{type:"textline",b:"gD ( gF , a ) ;".split(" ")}]}}]},{type:"textline",b:"gF *= gH ; gE = u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"gI *= gF ; gE += u_halo_rings_color * gI ; gF += gI ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"gG *= gH ; gE += u_halo_lines_color * gG ; gF += gG ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"gF *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gI = u_halo_stars_blend * ( ga . y - u_halo_stars_height ) ; gF *= clamp ( gI , 0.0 , 1.0 ) ; gF *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"fX ( gE ) ; f_ ( gE , gF ) ; gl_FragColor = vec4 ( gE , gF ) ; }".split(" ")}]};
a["halo.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform PRECISION float u_halo_size ; varying vec2 a ; varying float gb ;".split(" ")},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ga",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 gc , gd ; mat4 ge , gf ; vec3 gg ; gg = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; a = a_halo_bb_vertex * 2.0 ; gb = fract ( gg . x + gg . y + gg . z ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"ge = N ( gg , u_view_matrix ) ; gf = u_view_matrix ; gf [ 3 ] [ 0 ] = 0.0 ; gf [ 3 ] [ 1 ] = 0.0 ; gf [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ge = N ( gg , u_view_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"gc = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; gc = ge * gc ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",
b:"gd = u_proj_matrix * gf * gc ; gd . z = 0.99999 * gd . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["ga","=","gc",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gd = u_proj_matrix * u_view_matrix * gc ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","gd",";","}"]}]};a["line.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; void main ( ) { gl_FragColor = u_diffuse_color ; }".split(" ")}]};
a["line.glslv"]={type:"group",a:[{type:"var",name:"NUM_POINTS",b:["0"]},{type:"textline",b:"attribute float a_point ; uniform vec3 u_line_points [ NUM_POINTS ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec3 gc ; gc = u_line_points [ int ( a_point ) ] ; gl_Position = u_proj_matrix * u_view_matrix * vec4 ( gc , 1.0 ) ; }".split(" ")}]};a["main.glslf"]={type:"group",a:[{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",
name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},
{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_COLOR"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:["uniform",
"float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",
a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD","||","REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC","&&","!","ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_specmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",
a:[{type:"textline",b:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D",
"u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_refractmap ; uniform sampler2D u_scene_depth ;".split(" ")}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_normal_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform float u_specular_alpha ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_reflect_factor ; uniform vec4 u_refl_plane ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],
group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"textline",b:"varying vec3 jB ; varying vec3 jC ; varying vec3 jD ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","jE",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jF",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","jG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"include",file:"environment.glslf"},{type:"textline",b:"void main ( ) { vec4 kq , kr , ks , kt ; mat3 ku ; vec3 kv , kw , kx , ky , kz , kA , kB , kC ; vec2 kD , kE , kF , kG ; float kH , kI , kJ , kK , kL ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"kH = jC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["kD","=","a",";"]}]}}]},{type:"textline",b:["kv","=","jD",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) kv = kv ; else kv = - kv ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],
group:{type:"group",a:[{type:"textline",b:"kw = cross ( kv , jE . xyz ) * jE . w ; ku = mat3 ( jE . xyz , kw , kv ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:"kI = length ( cJ ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"kE = normalize ( u_view_matrix_frag * vec4 ( jD , 0.0 ) ) . st ; kE = kE * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:"if ( kI < PARALLAX_LOD_DIST ) { kJ = clamp ( 0.5 * ( PARALLAX_LOD_DIST - kI ) , 0.0 , 1.0 ) ; kJ = u_parallax_scale * kJ ; kw = normalize ( jB * ku ) ; kK = 1.0 / PARALLAX_STEPS ; kF = kw . xy * kJ / ( PARALLAX_STEPS * kw . z ) ; kJ = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:["kG","=",
"kE",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["kG","=","kD",";"]}]}}]},{type:"textline",b:"kL = texture2D ( u_normalmap0 , kG ) . a ; for ( float kM = 1.0 ; kM <= PARALLAX_STEPS ; kM ++ ) { if ( kL < kJ ) { kJ -= kK ; kG -= kF ; kL = texture2D ( u_normalmap0 , kG ) . a ; } } kF = kG + kF ; kK = texture2D ( u_normalmap0 , kF ) . a - ( kJ + kK ) ; kL = kL - kJ ; kJ = kL / ( kL - kK ) ; kG = kJ * kF + ( 1.0 - kJ ) * kG ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO",
"==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"kD += kG - kE ;".split(" ")}]}}]},{type:"textline",b:["kE","=","kG",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"kE += kG - kD ;".split(" ")}]}}]},{type:"textline",b:["kD","=","kG",";"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],
group:{type:"group",a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"kq = texture2D ( u_normalmap0 , kE ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kq = texture2D ( u_normalmap0 , kD ) ;".split(" ")}]}}]},{type:"textline",b:"kw = kq . rgb - 0.5 ; kw = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , kw , u_normal_factor ) ; kw = ku * kw ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:["kw","=","kv",";"]}]}}]},{type:"textline",b:"kw = normalize ( kw ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"kE = normalize ( u_view_matrix_frag * vec4 ( kw , 0.0 ) ) . st ; kE = kE * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"kv = normalize ( jB ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"kx = jF ; fV ( kx ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"kq = vec4 ( kx , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["kq","=","u_diffuse_color",";"]}]}}]},{type:"textline",b:["kL","=","1.0",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"kr = texture2D ( u_colormap0 , kE ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COLOR0_CO",
"==","TEXTURE_COORDS_UV_ORCO"],group:{type:"group",a:[{type:"textline",b:"kr = texture2D ( u_colormap0 , kD ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"fV ( kr . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR1_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"ks = texture2D ( u_colormap1 , kE ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"ks = texture2D ( u_colormap1 , kD ) ;".split(" ")}]}}]},{type:"textline",b:"fV ( ks . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"kt = texture2D ( u_stencil0 , kE ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kt = texture2D ( u_stencil0 , kD ) ;".split(" ")}]}}]},{type:"textline",b:"kr = mix ( kr , ks , kt . r ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"kq . rgb = mix ( kq . rgb , kr . rgb , u_diffuse_color_factor ) ; kK = u_alpha_factor * kr . a ; kK += ( 1.0 - step ( 0.0 , kK ) ) ; kq . a = mix ( kK , 1.0 , u_diffuse_color . a ) ; kL = kr . a ;".split(" ")}]}},{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"kq . rgb *= mix ( vec3 ( 1.0 ) , kr . rgb , u_diffuse_color_factor ) ; kq . a = kr . a ; kL = kr . a ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"kx = u_diffuse_intensity * kq . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS"],group:{type:"group",a:[{type:"textline",b:["ky","=","kx",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kJ = 0.5 * kw . y + 0.5 ; kz = u_environment_energy * kp ( kJ , kw ) ; kz = u_ambient * kz ; kK = eZ ( kx ) ; kA = u_emit * kq . rgb ; kB = u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:"kC = vec3 ( kL ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_SPEC_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"kC = texture2D ( u_specmap0 , kE ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kC = texture2D ( u_specmap0 , kD ) . rgb ;".split(" ")}]}}]},{type:"textline",b:"fV ( kC . rgb ) ; kB = mix ( kB , kC , u_specular_color_factor ) ;".split(" ")}]}}]},{type:"textline",
b:"kJ = u_specular_params [ 0 ] ; kF = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; kC = kJ * kB ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS","==","0"],group:{type:"group",a:[{type:"textline",b:"gO kN = jh ( kA , kz , kx ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gO kN = jc ( kA , kz , kx , kC , jC , kw , kv , kF , u_diffuse_params , kK , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}}]},
{type:"textline",b:"ky = kN . a . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["kL","=","u_reflect_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["kL","=","0.0",";"]}]}}]},{type:"textline",b:"jZ ( ky , kv , kw , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , kL ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"ky += kN . b ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"ky = max ( ky - sqrt ( 0.01 * - min ( kH , 0.0 ) ) , 0.5 * ky ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"jA ( ky , kH , u_time , kK , kw , u_sun_direction , u_sun_intensity , u_sun_quaternion , jC , kI ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"kJ = kq . a ; if ( kJ <= 0.5 ) discard ; kJ = 1.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kJ = kq . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"kJ += kN . a . a * kC . r * u_specular_alpha ;".split(" ")}]}}]}]}}]}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:["kJ","=","1.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"ky = mix ( km ( cI , kw . xz * u_refr_bump ) , ky , kJ ) ; kJ = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG && ( ! PROCEDURAL_FOG || WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:"kL = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"kB = gm ( u_cube_fog , kv ) ; ks = vec4 ( kB , u_fog_color_density . a ) ; fV ( ks . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ks = u_fog_color_density ; ks . rgb *= kL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"gC ( ky , kI , kv , u_cam_water_depth , u_underwater_fog_color_density , ks , kH , kL ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gg ( ky , kI , ks ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"SSAO_ONLY && SHADOW_SRC == SHADOW_SRC_MASK && ! SHADELESS".split(" "),group:{type:"group",a:[{type:"textline",b:"ky = vec3 ( dC . a ) ;".split(" ")}]}}]},{type:"textline",b:["fX","(","ky",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"f_ ( ky , kJ ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( ky , kJ ) ; }".split(" ")}]};
a["main.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ;".split(" ")},{type:"condition",a:[{type:"if",
c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_position_next ; attribute vec3 a_normal_next ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",
b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_texture_scale",";"]},{type:"condition",
a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",
b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:"varying vec3 jB ; varying vec3 jC ; varying vec3 jD ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","jE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jF",";"]}]}}]},{type:"condition",a:[{type:"if",
c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying",
"vec4","cH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","jG",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",
b:"void main ( ) { vec4 kq , kr ; float ks , kt , ku ; mat4 kv ; vec3 kw , kx , ky , kz , kA , kB , kC ; kw = a_position ; kx = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_UV_ORCO"],group:{type:"group",a:[{type:"textline",b:"ky = vec3 ( a_tangent ) ; kz = a_tangent [ 3 ] * cross ( kx , ky ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"kA = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; kB = normalize ( ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ) ; kA = kA - u_camera_eye ; kz = cross ( kA , kB ) ; ky = cross ( kB , kz ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"ky = vec3 ( 0.0 ) ; kz = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"kw = mix ( kw , a_position_next , u_va_frame_factor ) ; kx = mix ( kx , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"kA = vec3 ( a_tangent ) ; kB = a_tangent_next [ 3 ] * cross ( a_normal_next , kA ) ; ky = mix ( ky , kA , u_va_frame_factor ) ; kz = mix ( kz , kB , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"bv ( kw , ky , kz , kx ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["kA","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kA = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d kD = fE ( kw , ky , kz , kx , kA , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"kB = ( u_model_matrix * vec4 ( kA , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"kv = ao ( u_camera_eye , kB , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kv = ai ( u_camera_eye , kB , u_view_matrix ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"kC = ( u_model_matrix * vec4 ( kA , 1.0 ) ) . xyz ; kv = kv * aa ( u_wind , u_time , u_jitter_amp , u_jitter_freq , kC ) ;".split(" ")}]}}]},{type:"textline",b:"d kD = av ( kw - kA , kA , ky , kz , kx , kv ) ; kD . b = kB ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d kD = av ( kw , kA , ky , kz , kx , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"ks = ( dot ( cross ( kD . e , kD . c ) , kD . d ) < 0.0 ) ? - 1.0 : 1.0 ; jE = vec4 ( kD . c , ks ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"cj ( kD . a , kD . b , kx ) ;".split(" ")}]}}]},{type:"textline",b:"jC = kD . a ; jD = kD . e ; jB = u_camera_eye - kD . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",
b:"a = ay ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"jF = kD . f ;".split(" ")}]}},{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["jF","=","a_color",";"]}]}}]},{type:"textline",b:"kq = u_view_matrix * vec4 ( kD . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",
a:[{type:"textline",b:["cJ","=","kq",";"]}]}}]},{type:"textline",b:"kr = u_proj_matrix * kq ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"kr . xy += u_subpixel_jitter * kr . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["fO","(","kr",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"fO ( kD . a ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:"ks = kr . x ; kt = kr . y ; ku = kr . w ; cI . x = ( ks + ku ) / 2.0 ; cI . y = ( kt + ku ) / 2.0 ; cI . z = ku ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"jG = - kq . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","kr",";","}"]}]};a["nodes.glslf"]={type:"group",
a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",b:["vec3",
"(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",b:["0"]},{type:"var",name:"LAMP_INDEX",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",
file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW","||","REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_COLOR"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_reflectmap ; uniform vec4 u_refl_plane ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],
group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",
a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_scene_depth",";"]}]}}]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 jC ; varying vec4 cJ ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","jD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","jE",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || USE_NODE_B4W_REFRACTION".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION",
"&&","USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["varying","float","jG",";"]}]}}]},{type:"textline",b:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; vec3 kq = vec3 ( ZERO_VALUE_NODES ) ; vec3 kr = vec3 ( UNITY_VALUE_NODES ) ;".split(" ")},{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["USE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:"vec3 kv ( in vec3 ks , in float kt ) { vec3 ku ; ku = kq ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"ku = km ( cI , ks . xz * kt ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ku = texture2D ( u_refractmap , cI . xy / cI . z ) . rgb ; fV ( ku ) ;".split(" ")}]}}]},{type:"textline",b:["return","ku",
";","}"]}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_SEPHSV".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 kA ( vec3 kw ) { float kx , ky ; vec4 kz ; kz = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; kz = mix ( vec4 ( kw . bg , kz . wz ) , vec4 ( kw . gb , kz . xy ) , step ( kw . b , kw . g ) ) ; kz = mix ( vec4 ( kz . xyw , kw . r ) , vec4 ( kw . r , kz . yzx ) , step ( kz . x , kw . r ) ) ; kx = kz . x - min ( kz . w , kz . y ) ; ky = 1.0e-10 ; return vec3 ( abs ( kz . z + ( kz . w - kz . y ) / ( 6.0 * kx + ky ) ) , kx / ( kz . x + ky ) , kz . x ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_COMBHSV".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 kE ( vec3 kB ) { vec3 kC ; vec4 kD ; kD = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; kC = abs ( fract ( vec3 ( kB . r , kB . r , kB . r ) + kD . xyz ) * 6.0 - kD . www ) ; return kB . b * mix ( kD . xxx , clamp ( kC - kD . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , kB . g ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_UV","||","USE_NODE_B4W_PARALLAX"],group:{type:"group",a:[{type:"textline",b:"vec3 kG ( vec2 kF ) { return vec3 ( kF * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_TEXTURE_COLOR","||","USE_NODE_TEXTURE_NORMAL","||","USE_NODE_B4W_PARALLAX"],group:{type:"group",a:[{type:"textline",b:"vec2 kI ( vec3 kH ) { return vec2 ( kH . xy * 0.5 + vec2 ( 0.5 , 0.5 ) ) ; }".split(" ")}]}}]},
{type:"node",name:"CAMERA",k:[{type:"node_out",name:"lI",qualifier:["vec3"],e:!0},{type:"node_out",name:"lJ",qualifier:["float"],e:!0},{type:"node_out",name:"lK",qualifier:["float"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_lI"],f:[{type:"textline",b:"lI = normalize ( kV . xyz ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_lJ"],f:[{type:"textline",b:"lJ = abs ( kV . z ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_lK"],
f:[{type:"textline",b:"lK = length ( kV . xyz ) ;".split(" ")}]}]}]},{type:"node",name:"COMBRGB",k:[{type:"node_in",name:"lL",qualifier:["float"],e:!1},{type:"node_in",name:"lM",qualifier:["float"],e:!1},{type:"node_in",name:"lN",qualifier:["float"],e:!1},{type:"node_out",name:"lO",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lO = vec3 ( lL , lM , lN ) ;".split(" ")}]},{type:"node",name:"COMBHSV",k:[{type:"node_in",name:"lP",qualifier:["float"],e:!1},{type:"node_in",name:"lQ",qualifier:["float"],
e:!1},{type:"node_in",name:"lR",qualifier:["float"],e:!1},{type:"node_out",name:"lS",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lS = kE ( vec3 ( lP , lQ , lR ) ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_UV",k:[{type:"node_out",name:"lT",qualifier:["vec3"],e:!1},{type:"node_param",name:"kJ",qualifier:["varying","vec2"]}],f:[{type:"textline",b:"lT = kG ( kJ ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC",k:[{type:"node_out",name:"lU",qualifier:["vec3"],e:!1},{type:"node_param",name:"kK",
qualifier:["varying","vec3"]}],f:[{type:"textline",b:["lU","=","kK",";"]}]},{type:"node",name:"GEOMETRY_VC1",k:[{type:"node_out",name:"lV",qualifier:["float"],e:!1},{type:"node_param",name:"kL",qualifier:["varying","float"]}],f:[{type:"textline",b:["lV","=","kL",";"]}]},{type:"node",name:"GEOMETRY_VC2",k:[{type:"node_out",name:"lW",qualifier:["float"],e:!1},{type:"node_out",name:"lX",qualifier:["float"],e:!1},{type:"node_param",name:"kM",qualifier:["varying","vec2"]}],f:[{type:"textline",b:"lW = kM [ 0 ] ; lX = kM [ 1 ] ;".split(" ")}]},
{type:"node",name:"GEOMETRY_VC3",k:[{type:"node_out",name:"lY",qualifier:["float"],e:!1},{type:"node_out",name:"lZ",qualifier:["float"],e:!1},{type:"node_out",name:"l_",qualifier:["float"],e:!1},{type:"node_param",name:"kN",qualifier:["varying","vec3"]}],f:[{type:"textline",b:"lY = kN [ 0 ] ; lZ = kN [ 1 ] ; l_ = kN [ 2 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_NO",k:[{type:"node_out",name:"ma",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["ma","=","lo",";"]}]},{type:"node",name:"GEOMETRY_FB",
k:[{type:"node_out",name:"mb",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mb = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"GEOMETRY_VW",k:[{type:"node_out",name:"mc",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["mc","=","ln",";"]}]},{type:"node",name:"GEOMETRY_GL",k:[{type:"node_out",name:"md",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"md = vec3 ( lp . r , - lp . b , lp . g ) ;".split(" ")}]},{type:"node",name:"HUE_SAT",k:[{type:"node_in",
name:"me",qualifier:["float"],e:!1},{type:"node_in",name:"mf",qualifier:["float"],e:!1},{type:"node_in",name:"mg",qualifier:["float"],e:!1},{type:"node_in",name:"mh",qualifier:["float"],e:!1},{type:"node_in",name:"mi",qualifier:["vec3"],e:!1},{type:"node_out",name:"mj",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lt = kA ( mi ) ; lt [ 0 ] += ( me - 0.5 ) ; if ( lt [ 0 ] > UNITY_VALUE_NODES ) lt [ 0 ] -= UNITY_VALUE_NODES ; else if ( lt [ 0 ] < ZERO_VALUE_NODES ) lt [ 0 ] += UNITY_VALUE_NODES ; lt *= vec3 ( UNITY_VALUE_NODES , mf , mg ) ; lt = mix ( kr , mix ( kq , lt , step ( kq , lt ) ) , step ( lt , kr ) ) ; mj = mix ( mi , kE ( lt ) , mh ) ;".split(" ")}]},
{type:"node",name:"INVERT",k:[{type:"node_in",name:"mk",qualifier:["float"],e:!1},{type:"node_in",name:"ml",qualifier:["vec3"],e:!1},{type:"node_out",name:"mm",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"mm = mix ( ml , kr - ml , mk ) ;".split(" ")}]},{type:"node",name:"LAMP",k:[{type:"node_out",name:"mn",qualifier:["vec3"],e:!0},{type:"node_out",name:"mo",qualifier:["vec3"],e:!1},{type:"node_out",name:"mp",qualifier:["float"],e:!1},{type:"node_out",name:"mq",qualifier:["float"],e:!0}],f:[{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_mn"],f:[{type:"textline",b:"mn = u_lamp_light_color_intensities [ LAMP_INDEX ] ;".split(" ")}]}]},{type:"textline",b:"kW = u_lamp_light_factors [ LAMP_INDEX ] ; lu = u_lamp_light_directions [ LAMP_INDEX ] ; lv = u_lamp_light_positions [ LAMP_INDEX ] ; ld = kW . z ; if ( ld != - UNITY_VALUE_NODES ) { mo = lv - jC ; mp = length ( mo ) ; mo = normalize ( mo ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mq"],f:[{type:"textline",b:"mq = ld / ( ld + mp * mp ) ; ld = kW . x ; le = kW . y ; if ( ld > - UNITY_VALUE_NODES ) { lf = dot ( mo , lu ) ; lf *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( lf - ld ) / le ) ; mq *= lf ; }".split(" ")}]}]},
{type:"textline",b:["}","else","{"]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mo"],f:[{type:"textline",b:["mo","=","lu",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mp"],f:[{type:"textline",b:"mp = length ( lv - jC ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mq"],f:[{type:"textline",b:["mq","=","UNITY_VALUE_NODES",";"]}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"NORMAL",k:[{type:"node_in",name:"mr",qualifier:["vec3"],e:!1},{type:"node_out",
name:"ms",qualifier:["vec3"],e:!0},{type:"node_out",name:"mt",qualifier:["float"],e:!0},{type:"node_param",name:"kO",qualifier:["vec3"]}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ms"],f:[{type:"textline",b:["ms","=","kO",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mt"],f:[{type:"textline",b:"mt = - dot ( mr , kO ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_VECTOR_VIEW",k:[{type:"node_in",name:"mu",qualifier:["vec3"],e:!1},{type:"node_out",name:"mv",qualifier:["vec3"],
e:!1}],f:[{type:"textline",b:"mv = - ( u_view_matrix_frag * vec4 ( mu , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]},{type:"node",name:"MAPPING",k:[{type:"node_in",name:"mw",qualifier:["vec3"],e:!1},{type:"node_out",name:"mx",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["mx","=","mw",";"]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRS_MATRIX",f:[{type:"textline",b:"mx = ( MAPPING_TRS_MATRIX * vec4 ( mx , UNITY_VALUE_NODES ) ) . xyz ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",
name:"MAPPING_SCALE",f:[{type:"textline",b:"mx = mx * MAPPING_SCALE ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRANSLATION",f:[{type:"textline",b:"mx = mx + MAPPING_TRANSLATION ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MIN_CLIP",f:[{type:"textline",b:"mx = max ( mx , MAPPING_MIN_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MAX_CLIP",f:[{type:"textline",b:"mx = min ( mx , MAPPING_MAX_CLIP ) ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["MAPPING_IS_NORMAL"],f:[{type:"textline",b:"mx = normalize ( mx ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ADD",k:[{type:"node_in",name:"my",qualifier:["float"],e:!1},{type:"node_in",name:"mz",qualifier:["float"],e:!1},{type:"node_out",name:"mA",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mA = my + mz ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mA = clamp ( mA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_SUBTRACT",k:[{type:"node_in",name:"mB",qualifier:["float"],e:!1},{type:"node_in",name:"mC",qualifier:["float"],e:!1},{type:"node_out",name:"mD",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mD = mB - mC ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mD = clamp ( mD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MULTIPLY",k:[{type:"node_in",name:"mE",qualifier:["float"],e:!1},{type:"node_in",
name:"mF",qualifier:["float"],e:!1},{type:"node_out",name:"mG",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mG = mE * mF ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mG = clamp ( mG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_DIVIDE",k:[{type:"node_in",name:"mH",qualifier:["float"],e:!1},{type:"node_in",name:"mI",qualifier:["float"],e:!1},{type:"node_out",name:"mJ",qualifier:["float"],e:!1}],f:[{type:"textline",
b:"mJ = ( mI != ZERO_VALUE_NODES ) ? mH / mI : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mJ = clamp ( mJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SINE",k:[{type:"node_in",name:"mK",qualifier:["float"],e:!1},{type:"node_in",name:"mL",qualifier:["float"],e:!1},{type:"node_out",name:"mM",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mM = sin ( mK ) ;".split(" ")},{type:"node_condition",
a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mM = clamp ( mM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["mL",";"]}]},{type:"node",name:"MATH_COSINE",k:[{type:"node_in",name:"mN",qualifier:["float"],e:!1},{type:"node_in",name:"mO",qualifier:["float"],e:!1},{type:"node_out",name:"mP",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mP = cos ( mN ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",
b:"mP = clamp ( mP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["mO",";"]}]},{type:"node",name:"MATH_TANGENT",k:[{type:"node_in",name:"mQ",qualifier:["float"],e:!1},{type:"node_in",name:"mR",qualifier:["float"],e:!1},{type:"node_out",name:"mS",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mS = tan ( mQ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mS = clamp ( mS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["mR",";"]}]},{type:"node",name:"MATH_ARCSINE",k:[{type:"node_in",name:"mT",qualifier:["float"],e:!1},{type:"node_in",name:"mU",qualifier:["float"],e:!1},{type:"node_out",name:"mV",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mV = ( mT <= UNITY_VALUE_NODES && mT >= - UNITY_VALUE_NODES ) ? asin ( mT ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mV = clamp ( mV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["mU",";"]}]},{type:"node",name:"MATH_ARCCOSINE",k:[{type:"node_in",name:"mW",qualifier:["float"],e:!1},{type:"node_in",name:"mX",qualifier:["float"],e:!1},{type:"node_out",name:"mY",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mY = ( mW <= UNITY_VALUE_NODES && mW >= - UNITY_VALUE_NODES ) ? acos ( mW ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mY = clamp ( mY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["mX",";"]}]},{type:"node",name:"MATH_ARCTANGENT",k:[{type:"node_in",name:"mZ",qualifier:["float"],e:!1},{type:"node_in",name:"m_",qualifier:["float"],e:!1},{type:"node_out",name:"na",qualifier:["float"],e:!1}],f:[{type:"textline",b:"na = atan ( mZ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"na = clamp ( na , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["m_",";"]}]},{type:"node",name:"MATH_POWER",
k:[{type:"node_in",name:"nb",qualifier:["float"],e:!1},{type:"node_in",name:"nc",qualifier:["float"],e:!1},{type:"node_out",name:"nd",qualifier:["float"],e:!1}],f:[{type:"textline",b:"if ( nb < ZERO_VALUE_NODES || nb == ZERO_VALUE_NODES && nc == ZERO_VALUE_NODES ) nd = ZERO_VALUE_NODES ; else nd = pow ( nb , nc ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nd = clamp ( nd , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",
name:"MATH_LOGARITHM",k:[{type:"node_in",name:"ne",qualifier:["float"],e:!1},{type:"node_in",name:"nf",qualifier:["float"],e:!1},{type:"node_out",name:"ng",qualifier:["float"],e:!1}],f:[{type:"textline",b:"ng = ( ne > ZERO_VALUE_NODES && nf > ZERO_VALUE_NODES ) ? log2 ( ne ) / log2 ( nf ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"ng = clamp ( ng , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",
name:"MATH_MINIMUM",k:[{type:"node_in",name:"nh",qualifier:["float"],e:!1},{type:"node_in",name:"ni",qualifier:["float"],e:!1},{type:"node_out",name:"nj",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nj = min ( nh , ni ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nj = clamp ( nj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MAXIMUM",k:[{type:"node_in",name:"nk",qualifier:["float"],e:!1},{type:"node_in",
name:"nl",qualifier:["float"],e:!1},{type:"node_out",name:"nm",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nm = max ( nk , nl ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nm = clamp ( nm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ROUND",k:[{type:"node_in",name:"nn",qualifier:["float"],e:!1},{type:"node_in",name:"no",qualifier:["float"],e:!1},{type:"node_out",name:"np",qualifier:["float"],e:!1}],
f:[{type:"textline",b:"np = floor ( nn + 0.5 ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"np = clamp ( np , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["no",";"]}]},{type:"node",name:"MATH_LESS_THAN",k:[{type:"node_in",name:"nq",qualifier:["float"],e:!1},{type:"node_in",name:"nr",qualifier:["float"],e:!1},{type:"node_out",name:"ns",qualifier:["float"],e:!1}],f:[{type:"textline",b:"ns = ( nq < nr ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"ns = clamp ( ns , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_GREATER_THAN",k:[{type:"node_in",name:"nt",qualifier:["float"],e:!1},{type:"node_in",name:"nu",qualifier:["float"],e:!1},{type:"node_out",name:"nv",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nv = ( nt > nu ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],
f:[{type:"textline",b:"nv = clamp ( nv , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MODULO",k:[{type:"node_in",name:"nw",qualifier:["float"],e:!1},{type:"node_in",name:"nx",qualifier:["float"],e:!1},{type:"node_out",name:"ny",qualifier:["float"],e:!1}],f:[{type:"textline",b:"ny = abs ( nx ) > 0.000001 ? mod ( nw , nx ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"ny = clamp ( ny , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_ABSOLUTE",k:[{type:"node_in",name:"nz",qualifier:["float"],e:!1},{type:"node_in",name:"nA",qualifier:["float"],e:!1},{type:"node_out",name:"nB",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nB = abs ( nz ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nB = clamp ( nB , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nA",";"]}]},{type:"node",name:"MIX_RGB_MIX",k:[{type:"node_in",name:"nC",
qualifier:["float"],e:!1},{type:"node_in",name:"nD",qualifier:["vec3"],e:!1},{type:"node_in",name:"nE",qualifier:["vec3"],e:!1},{type:"node_out",name:"nF",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"ld = clamp ( nC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; nF = mix ( nD , nE , ld ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"nF = clamp ( nF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_ADD",
k:[{type:"node_in",name:"nG",qualifier:["float"],e:!1},{type:"node_in",name:"nH",qualifier:["vec3"],e:!1},{type:"node_in",name:"nI",qualifier:["vec3"],e:!1},{type:"node_out",name:"nJ",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"le = clamp ( nG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; nJ = mix ( nH , nH + nI , le ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"nJ = clamp ( nJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_MULTIPLY",k:[{type:"node_in",name:"nK",qualifier:["float"],e:!1},{type:"node_in",name:"nL",qualifier:["vec3"],e:!1},{type:"node_in",name:"nM",qualifier:["vec3"],e:!1},{type:"node_out",name:"nN",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lf = clamp ( nK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; nN = mix ( nL , nL * nM , lf ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"nN = clamp ( nN , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SUBTRACT",k:[{type:"node_in",name:"nO",qualifier:["float"],e:!1},{type:"node_in",name:"nP",qualifier:["vec3"],e:!1},{type:"node_in",name:"nQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"nR",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"ld = clamp ( nO , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; nR = mix ( nP , nP - nQ , ld ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"nR = clamp ( nR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SCREEN",k:[{type:"node_in",name:"nS",qualifier:["float"],e:!1},{type:"node_in",name:"nT",qualifier:["vec3"],e:!1},{type:"node_in",name:"nU",qualifier:["vec3"],e:!1},{type:"node_out",name:"nV",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"le = clamp ( nS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lf = UNITY_VALUE_NODES - le ; nV = kr - ( vec3 ( lf ) + le * ( kr - nU ) ) * ( kr - nT ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",
b:"nV = clamp ( nV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIVIDE",k:[{type:"node_in",name:"nW",qualifier:["float"],e:!1},{type:"node_in",name:"nX",qualifier:["vec3"],e:!1},{type:"node_in",name:"nY",qualifier:["vec3"],e:!1},{type:"node_out",name:"nZ",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"ld = clamp ( nW , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lf = UNITY_VALUE_NODES - ld ; nY += step ( nY , kq ) ; nZ = lf * nX + ld * nX / nY ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"nZ = clamp ( nZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIFFERENCE",k:[{type:"node_in",name:"n_",qualifier:["float"],e:!1},{type:"node_in",name:"oa",qualifier:["vec3"],e:!1},{type:"node_in",name:"ob",qualifier:["vec3"],e:!1},{type:"node_out",name:"oc",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"le = clamp ( n_ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oc = mix ( oa , abs ( oa - ob ) , le ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oc = clamp ( oc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DARKEN",k:[{type:"node_in",name:"od",qualifier:["float"],e:!1},{type:"node_in",name:"oe",qualifier:["vec3"],e:!1},{type:"node_in",name:"of",qualifier:["vec3"],e:!1},{type:"node_out",name:"og",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lf = clamp ( od , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; og = min ( oe . rgb , of . rgb * lf ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"og = clamp ( og , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LIGHTEN",k:[{type:"node_in",name:"oh",qualifier:["float"],e:!1},{type:"node_in",name:"oi",qualifier:["vec3"],e:!1},{type:"node_in",name:"oj",qualifier:["vec3"],e:!1},{type:"node_out",name:"ok",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"ld = clamp ( oh , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; ok = max ( oi . rgb , oj . rgb * ld ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"ok = clamp ( ok , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_OVERLAY",k:[{type:"node_in",name:"ol",qualifier:["float"],e:!1},{type:"node_in",name:"om",qualifier:["vec3"],e:!1},{type:"node_in",name:"on",qualifier:["vec3"],e:!1},{type:"node_out",name:"oo",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"le = clamp ( ol , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lu = vec3 ( UNITY_VALUE_NODES - le ) ; oo = mix ( om * ( lu + 2.0 * le * on ) , kr - ( lu + 2.0 * le * ( kr - on ) ) * ( kr - om ) , step ( 0.5 , om ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oo = clamp ( oo , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DODGE",k:[{type:"node_in",name:"op",qualifier:["float"],e:!1},{type:"node_in",name:"oq",qualifier:["vec3"],e:!1},{type:"node_in",name:"or",qualifier:["vec3"],e:!1},{type:"node_out",name:"os",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lf = clamp ( op , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lv = kr - lf * or ; lu = clamp ( oq / lv , 0.0 , 1.0 ) ; os = mix ( mix ( lu , kr , step ( lv , kq ) ) , oq , step ( oq , kq ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"os = clamp ( os , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_BURN",k:[{type:"node_in",name:"ot",qualifier:["float"],e:!1},{type:"node_in",name:"ou",qualifier:["vec3"],e:!1},{type:"node_in",name:"ov",qualifier:["vec3"],e:!1},{type:"node_out",name:"ow",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"ld = clamp ( ot , 0.0 , 1.0 ) ; lu = vec3 ( 1.0 - ld ) ; lv = lu + ld * ov ; lu = clamp ( kr - ( kr - ou ) / lv , 0.0 , 1.0 ) ; ow = mix ( lu , kq , step ( lv , kq ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"ow = clamp ( ow , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_HUE",k:[{type:"node_in",name:"ox",qualifier:["float"],e:!1},{type:"node_in",name:"oy",qualifier:["vec3"],e:!1},{type:"node_in",name:"oz",qualifier:["vec3"],e:!1},{type:"node_out",name:"oA",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"le = clamp ( ox , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oA = oy ; lv = kA ( oz ) ; if ( lv . y != ZERO_VALUE_NODES ) { lu = kA ( oA ) ; lu . x = lv . x ; lw = kE ( lu ) ; oA = mix ( oA , lw , le ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oA = clamp ( oA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SATURATION",k:[{type:"node_in",name:"oB",qualifier:["float"],e:!1},{type:"node_in",name:"oC",qualifier:["vec3"],e:!1},{type:"node_in",name:"oD",qualifier:["vec3"],e:!1},{type:"node_out",name:"oE",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lf = clamp ( oB , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; ld = UNITY_VALUE_NODES - lf ; oE = oC ; lv = kA ( oE ) ; if ( lv . y != ZERO_VALUE_NODES ) { lw = kA ( oD ) ; lv . y = ld * lv . y + lf * lw . y ; oE = kE ( lv ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oE = clamp ( oE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_VALUE",k:[{type:"node_in",name:"oF",qualifier:["float"],e:!1},{type:"node_in",name:"oG",qualifier:["vec3"],e:!1},{type:"node_in",name:"oH",qualifier:["vec3"],e:!1},{type:"node_out",name:"oI",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"le = clamp ( oF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; ld = UNITY_VALUE_NODES - le ; lw = kA ( oG ) ; lx = kA ( oH ) ; lw . z = ld * lw . z + le * lx . z ; oI = kE ( lw ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oI = clamp ( oI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_COLOR",k:[{type:"node_in",name:"oJ",qualifier:["float"],e:!1},{type:"node_in",name:"oK",qualifier:["vec3"],e:!1},{type:"node_in",name:"oL",qualifier:["vec3"],e:!1},{type:"node_out",name:"oM",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lf = clamp ( oJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oM = oK ; ly = kA ( oL ) ; if ( ly . y != ZERO_VALUE_NODES ) { lx = kA ( oM ) ; lx . x = ly . x ; lx . y = ly . y ; lz = kE ( lx ) ; oM = mix ( oM , lz , lf ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oM = clamp ( oM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SOFT_LIGHT",k:[{type:"node_in",name:"oN",qualifier:["float"],e:!1},{type:"node_in",name:"oO",qualifier:["vec3"],e:!1},{type:"node_in",name:"oP",qualifier:["vec3"],e:!1},{type:"node_out",name:"oQ",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"ld = clamp ( oN , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; le = UNITY_VALUE_NODES - ld ; ly = oP + oO - oP * oO ; oQ = oO * ( vec3 ( le ) + vec3 ( ld ) * ( ( kr - oO ) * oP + ly ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oQ = clamp ( oQ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",k:[{type:"node_in",name:"oR",qualifier:["float"],e:!1},{type:"node_in",name:"oS",qualifier:["vec3"],e:!1},{type:"node_in",name:"oT",qualifier:["vec3"],e:!1},{type:"node_out",name:"oU",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lf = clamp ( oR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oU = oS + lf * ( 2.0 * oT - kr ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oU = clamp ( oU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"OUTPUT",k:[{type:"node_in",name:"oV",qualifier:["vec3"],e:!1},{type:"node_in",name:"oW",qualifier:["float"],e:!1}],f:[{type:"textline",b:"lq = oV ; lc = oW ;".split(" ")}]},{type:"node",name:"MATERIAL",k:[{type:"node_in",name:"oX",qualifier:["vec3"],e:!1},{type:"node_in",name:"oY",qualifier:["float"],e:!1},{type:"node_in",
name:"oZ",qualifier:["vec3"],e:!1},{type:"node_in",name:"o_",qualifier:["vec3"],e:!0},{type:"node_out",name:"pa",qualifier:["vec3"],e:!0},{type:"node_out",name:"pb",qualifier:["float"],e:!0},{type:"node_out",name:"pc",qualifier:["vec3"],e:!0},{type:"node_param",name:"kP",qualifier:["const","vec2"]},{type:"node_param",name:"kQ",qualifier:["const","vec3"]}],f:[{type:"textline",b:"lz = clamp ( oX , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; ly = kQ [ 0 ] * clamp ( oZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],f:[{type:"textline",b:"lA = normalize ( o_ ) ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["lA","=","lo",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["!","SHADELESS_MAT"],f:[{type:"textline",b:"lB = kZ * lz ; le = 0.5 * lA . y + 0.5 ; lC = la * u_environment_energy * kp ( le , lA ) ; ld = eZ ( lz ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["NUM_LIGHTS",">","0"],f:[{type:"textline",b:"kT = vec2 ( kP [ 0 ] , kP [ 1 ] ) ; kU = vec2 ( kQ [ 1 ] , kQ [ 2 ] ) ; lH = jc ( lB , lC , lz , ly , lp , lA , ln , kU , kT , ld , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , ZERO_VALUE_NODES , vec4 ( ZERO_VALUE_NODES ) ) ;".split(" ")}]},
{type:"node_else",f:[{type:"textline",b:"lH = jh ( lB , lC , lz ) ;".split(" ")}]}]},{type:"textline",b:["lb","=","ld",";"]}]},{type:"node_else",f:[{type:"textline",b:"lH . a = vec4 ( lz , ZERO_VALUE_NODES ) ; lH . b = kq ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pa"],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],f:[{type:"textline",b:"pa = lH . a . rgb ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["pa","=","kq",";"]}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"pa += lH . b ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pb"],f:[{type:"textline",b:"pb = clamp ( oY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"pb += lH . a . a * ly . r * k_ ; pb = clamp ( pb , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_pc"],f:[{type:"textline",b:["pc","=","lA",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"lr = lH . b ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["lr","=","kq",";"]}]}]},{type:"textline",b:["ls","=","lA",";"]}]},{type:"node",name:"MATERIAL_EXT",k:[{type:"node_in",name:"pd",qualifier:["vec3"],e:!1},{type:"node_in",name:"pe",qualifier:["float"],e:!1},{type:"node_in",name:"pf",qualifier:["vec3"],e:!1},{type:"node_in",name:"pg",
qualifier:["vec3"],e:!0},{type:"node_in",name:"ph",qualifier:["float"],e:!1},{type:"node_in",name:"pi",qualifier:["float"],e:!1},{type:"node_in",name:"pj",qualifier:["vec4"],e:!1},{type:"node_in",name:"pk",qualifier:["float"],e:!1},{type:"node_in",name:"pl",qualifier:["float"],e:!1},{type:"node_out",name:"pm",qualifier:["vec3"],e:!0},{type:"node_out",name:"pn",qualifier:["float"],e:!0},{type:"node_out",name:"po",qualifier:["vec3"],e:!0},{type:"node_out",name:"pp",qualifier:["vec3"],e:!0},{type:"node_out",
name:"pq",qualifier:["vec3"],e:!0},{type:"node_param",name:"kR",qualifier:["const","vec2"]},{type:"node_param",name:"kS",qualifier:["const","vec3"]}],f:[{type:"textline",b:"ly = clamp ( pd , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lD = kS [ 0 ] * clamp ( pf , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],f:[{type:"textline",b:"lE = normalize ( pg ) ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["lE","=","lo",";"]}]}]},
{type:"node_condition",a:[{type:"node_if",c:["!","SHADELESS_MAT"],f:[{type:"textline",b:"lf = eZ ( ly ) ; lF = ph * ly ; lg = 0.5 * lE . y + 0.5 ; lG = la * u_environment_energy * kp ( lg , lE ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["NUM_LIGHTS",">","0"],f:[{type:"textline",b:"kU = vec2 ( kR [ 0 ] , kR [ 1 ] ) ; kT = vec2 ( kS [ 1 ] , kS [ 2 ] ) ; lH = jc ( lF , lG , ly , lD , lp , lE , ln , kT , kU , lf , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , pi , pj ) ;".split(" ")}]},
{type:"node_else",f:[{type:"textline",b:"lH = jh ( lF , lG , ly ) ;".split(" ")}]}]},{type:"textline",b:["lb","=","lf",";"]}]},{type:"node_else",f:[{type:"textline",b:"lH . a = vec4 ( ly , ZERO_VALUE_NODES ) ; lH . b = kq ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pm"],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],f:[{type:"textline",b:"pm = lH . a . rgb ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["pm","=","kq",";"]}]}]},{type:"node_condition",
a:[{type:"node_if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],f:[{type:"textline",b:"jZ ( pm , ln , lE , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , pk ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"pm += lH . b ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pn"],f:[{type:"textline",b:"pn = clamp ( pe , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],
f:[{type:"textline",b:"pn += lH . a . a * lD . r * pl ; pn = clamp ( pn , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_po"],f:[{type:"textline",b:["po","=","lE",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pp"],f:[{type:"textline",b:"pp = lH . a . rgb ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pq"],f:[{type:"textline",b:"pq = lH . b ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"lr = lH . b ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["lr","=","kq",";"]}]}]},{type:"textline",b:["ls","=","lE",";"]}]},{type:"node",name:"RGB",k:[{type:"node_out",name:"pr",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"pr = u_node_rgbs [ RGB_IND ] ;".split(" ")}]},{type:"node",name:"RGBTOBW",k:[{type:"node_in",name:"ps",qualifier:["vec3"],e:!1},{type:"node_out",name:"pt",qualifier:["float"],e:!1}],f:[{type:"textline",b:"pt = ps . r * 0.35 + ps . g * 0.45 + ps . b * 0.2 ;".split(" ")}]},
{type:"node",name:"SEPRGB",k:[{type:"node_in",name:"pu",qualifier:["vec3"],e:!1},{type:"node_out",name:"pv",qualifier:["float"],e:!0},{type:"node_out",name:"pw",qualifier:["float"],e:!0},{type:"node_out",name:"px",qualifier:["float"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pv"],f:[{type:"textline",b:"pv = pu . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pw"],f:[{type:"textline",b:"pw = pu . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_px"],f:[{type:"textline",b:"px = pu . b ;".split(" ")}]}]}]},{type:"node",name:"SEPHSV",k:[{type:"node_in",name:"py",qualifier:["vec3"],e:!1},{type:"node_out",name:"pz",qualifier:["float"],e:!0},{type:"node_out",name:"pA",qualifier:["float"],e:!0},{type:"node_out",name:"pB",qualifier:["float"],e:!0}],f:[{type:"textline",b:"lD = kA ( py ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pz"],f:[{type:"textline",b:"pz = lD . r ;".split(" ")}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_pA"],f:[{type:"textline",b:"pA = lD . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pB"],f:[{type:"textline",b:"pB = lD . b ;".split(" ")}]}]}]},{type:"node",name:"SQUEEZE",k:[{type:"node_in",name:"pC",qualifier:["float"],e:!1},{type:"node_in",name:"pD",qualifier:["float"],e:!1},{type:"node_in",name:"pE",qualifier:["float"],e:!1},{type:"node_out",name:"pF",qualifier:["float"],e:!1}],f:[{type:"textline",b:"pF = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( ( pC - pE ) * pD ) ) ) ;".split(" ")}]},
{type:"node",name:"GAMMA",k:[{type:"node_in",name:"pG",qualifier:["vec3"],e:!1},{type:"node_in",name:"pH",qualifier:["float"],e:!1},{type:"node_out",name:"pI",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"pI = max ( kq , pG ) ; pI = pow ( pI , vec3 ( pH ) ) ;".split(" ")}]},{type:"node",name:"B4W_SRGB_TO_LINEAR",k:[{type:"node_in",name:"pJ",qualifier:["vec3"],e:!1},{type:"node_out",name:"pK",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"pK = max ( kq , pJ ) ; pK = pow ( pK , vec3 ( 2.2 ) ) ;".split(" ")}]},
{type:"node",name:"B4W_LINEAR_TO_SRGB",k:[{type:"node_in",name:"pL",qualifier:["vec3"],e:!1},{type:"node_out",name:"pM",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"pM = max ( kq , pL ) ; pM = pow ( pM , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]},{type:"node",name:"TEXTURE_EMPTY",k:[{type:"node_out",name:"pN",qualifier:["vec3"],e:!1},{type:"node_out",name:"pO",qualifier:["vec3"],e:!1},{type:"node_out",name:"pP",qualifier:["float"],e:!1}],f:[{type:"textline",b:"pP = pN [ 0 ] = pN [ 1 ] = pN [ 2 ] = pO [ 0 ] = pO [ 1 ] = pO [ 2 ] = 0.0 ;".split(" ")}]},
{type:"node",name:"TEXTURE_ENVIRONMENT",k:[{type:"node_in",name:"pQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"pR",qualifier:["vec3"],e:!0},{type:"node_out",name:"pS",qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",qualifier:["uniform","samplerCube"]}],f:[{type:"textline",b:"kW = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , pQ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pR"],f:[{type:"textline",b:"pR = kW . xyz ; fV ( pR ) ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pS"],f:[{type:"textline",b:"pS = kW . w ;".split(" ")}]}]}]},{type:"node",name:"TEXTURE_COLOR",k:[{type:"node_in",name:"pT",qualifier:["vec3"],e:!0},{type:"node_in",name:"pU",qualifier:["vec3"],e:!0},{type:"node_in",name:"pV",qualifier:["vec3"],e:!0},{type:"node_in",name:"pW",qualifier:["vec3"],e:!0},{type:"node_out",name:"pX",qualifier:["vec3"],e:!0},{type:"node_out",name:"pY",qualifier:["float"],e:!0},{type:"node_out",name:"pZ",qualifier:["vec3"],
e:!0},{type:"node_out",name:"p_",qualifier:["float"],e:!0},{type:"node_out",name:"qa",qualifier:["vec3"],e:!0},{type:"node_out",name:"qb",qualifier:["float"],e:!0},{type:"node_out",name:"qc",qualifier:["vec3"],e:!0},{type:"node_out",name:"qd",qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"kW = texture2D ( node_TEXTURE_COLOR_var_texture , kI ( pT ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_pX"],f:[{type:"textline",b:"pX = kW . xyz ; fV ( pX ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pY"],f:[{type:"textline",b:"pY = kW . w ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv2"],f:[{type:"textline",b:"kW = texture2D ( node_TEXTURE_COLOR_var_texture , kI ( pU ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pZ"],f:[{type:"textline",b:"pZ = kW . xyz ; fV ( pZ ) ;".split(" ")}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_p_"],f:[{type:"textline",b:"p_ = kW . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv3"],f:[{type:"textline",b:"kW = texture2D ( node_TEXTURE_COLOR_var_texture , kI ( pV ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qa"],f:[{type:"textline",b:"qa = kW . xyz ; fV ( qa ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qb"],f:[{type:"textline",b:"qb = kW . w ;".split(" ")}]}]}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_uv4"],f:[{type:"textline",b:"kW = texture2D ( node_TEXTURE_COLOR_var_texture , kI ( pW ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qc"],f:[{type:"textline",b:"qc = kW . xyz ; fV ( qc ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qd"],f:[{type:"textline",b:"qd = kW . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"TEXTURE_NORMAL",k:[{type:"node_in",name:"qe",qualifier:["vec3"],e:!0},{type:"node_in",name:"qf",qualifier:["vec3"],
e:!0},{type:"node_in",name:"qg",qualifier:["vec3"],e:!0},{type:"node_in",name:"qh",qualifier:["vec3"],e:!0},{type:"node_out",name:"qi",qualifier:["vec3"],e:!0},{type:"node_out",name:"qj",qualifier:["float"],e:!0},{type:"node_out",name:"qk",qualifier:["vec3"],e:!0},{type:"node_out",name:"ql",qualifier:["float"],e:!0},{type:"node_out",name:"qm",qualifier:["vec3"],e:!0},{type:"node_out",name:"qn",qualifier:["float"],e:!0},{type:"node_out",name:"qo",qualifier:["vec3"],e:!0},{type:"node_out",name:"qp",
qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"kW = texture2D ( node_TEXTURE_NORMAL_var_texture , kI ( qe ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qi"],f:[{type:"textline",b:"qi = normalize ( kX * ( kW . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qj"],f:[{type:"textline",b:"qj = kW . w ;".split(" ")}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_uv2"],f:[{type:"textline",b:"kW = texture2D ( node_TEXTURE_NORMAL_var_texture , kI ( qf ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qk"],f:[{type:"textline",b:"qk = normalize ( kX * ( kW . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ql"],f:[{type:"textline",b:"ql = kW . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv3"],f:[{type:"textline",b:"kW = texture2D ( node_TEXTURE_NORMAL_var_texture , kI ( qg ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qm"],f:[{type:"textline",b:"qm = normalize ( kX * ( kW . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qn"],f:[{type:"textline",b:"qn = kW . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv4"],f:[{type:"textline",b:"kW = texture2D ( node_TEXTURE_NORMAL_var_texture , kI ( qh ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qo"],f:[{type:"textline",b:"qo = normalize ( kX * ( kW . xyz - 0.5 ) ) ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qp"],f:[{type:"textline",b:"qp = kW . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"VALUE",k:[{type:"node_out",name:"qq",qualifier:["float"],e:!1}],f:[{type:"textline",b:"qq = u_node_values [ VALUE_IND ] ;".split(" ")}]},{type:"node",name:"VECT_MATH_ADD",k:[{type:"node_in",name:"qr",qualifier:["vec3"],e:!1},{type:"node_in",name:"qs",qualifier:["vec3"],e:!1},{type:"node_out",name:"qt",qualifier:["vec3"],e:!1},{type:"node_out",name:"qu",qualifier:["float"],
e:!0}],f:[{type:"textline",b:"qt = qr + qs ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qu"],f:[{type:"textline",b:"qu = ( abs ( qt [ 0 ] ) + abs ( qt [ 1 ] ) + abs ( qt [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_SUBTRACT",k:[{type:"node_in",name:"qv",qualifier:["vec3"],e:!1},{type:"node_in",name:"qw",qualifier:["vec3"],e:!1},{type:"node_out",name:"qx",qualifier:["vec3"],e:!1},{type:"node_out",name:"qy",qualifier:["float"],e:!0}],f:[{type:"textline",
b:"qx = qv - qw ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qy"],f:[{type:"textline",b:"qy = ( abs ( qx [ 0 ] ) + abs ( qx [ 1 ] ) + abs ( qx [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_AVERAGE",k:[{type:"node_in",name:"qz",qualifier:["vec3"],e:!1},{type:"node_in",name:"qA",qualifier:["vec3"],e:!1},{type:"node_out",name:"qB",qualifier:["vec3"],e:!1},{type:"node_out",name:"qC",qualifier:["float"],e:!0}],f:[{type:"textline",b:"qB = qz + qA ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qC"],f:[{type:"textline",b:"qC = length ( qB ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qB"],f:[{type:"textline",b:"qB = normalize ( qB ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_DOT_PRODUCT",k:[{type:"node_in",name:"qD",qualifier:["vec3"],e:!1},{type:"node_in",name:"qE",qualifier:["vec3"],e:!1},{type:"node_out",name:"qF",qualifier:["vec3"],e:!1},{type:"node_out",name:"qG",qualifier:["float"],e:!0}],f:[{type:"textline",
b:["qF","=","kq",";"]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qG"],f:[{type:"textline",b:"qG = dot ( qD , qE ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",k:[{type:"node_in",name:"qH",qualifier:["vec3"],e:!1},{type:"node_in",name:"qI",qualifier:["vec3"],e:!1},{type:"node_out",name:"qJ",qualifier:["vec3"],e:!1},{type:"node_out",name:"qK",qualifier:["float"],e:!0}],f:[{type:"textline",b:"qJ = cross ( qH , qI ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_qK"],f:[{type:"textline",b:"qK = length ( qJ ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_NORMALIZE",k:[{type:"node_in",name:"qL",qualifier:["vec3"],e:!1},{type:"node_in",name:"qM",qualifier:["vec3"],e:!1},{type:"node_out",name:"qN",qualifier:["vec3"],e:!1},{type:"node_out",name:"qO",qualifier:["float"],e:!0}],f:[{type:"textline",b:"qN = normalize ( qL ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qO"],f:[{type:"textline",b:"qO = length ( qL ) ;".split(" ")}]}]},
{type:"textline",b:["qM",";"]}]},{type:"node",name:"B4W_REFLECT",k:[{type:"node_in",name:"qP",qualifier:["vec3"],e:!1},{type:"node_in",name:"qQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"qR",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"qR = reflect ( - qP , qQ ) ;".split(" ")}]},{type:"node",name:"B4W_PARALLAX",k:[{type:"node_in",name:"qS",qualifier:["vec3"],e:!1},{type:"node_in",name:"qT",qualifier:["float"],e:!1},{type:"node_in",name:"qU",qualifier:["const","float"],e:!1},{type:"node_in",
name:"qV",qualifier:["const","float"],e:!1},{type:"node_out",name:"qW",qualifier:["vec3"],e:!1},{type:"node_param",name:"node_B4W_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"lh = length ( kV ) ; if ( lh < qV ) { kT = kI ( qS ) ; li = clamp ( 0.5 * ( qV - lh ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; li = qT * li ; lD = normalize ( ln * kX ) ; lj = UNITY_VALUE_NODES / qU ; kU = lD . xy * li / ( qU * lD . z ) ; lk = UNITY_VALUE_NODES ; ll = texture2D ( node_B4W_PARALLAX_var_texture , kT ) . a ; for ( float qX = 1.0 ; qX <= qU ; qX ++ ) { if ( ll < lk ) { lk -= lj ; kT -= kU ; ll = texture2D ( node_B4W_PARALLAX_var_texture , kT ) . a ; } } kU = kT + kU ; lj = texture2D ( node_B4W_PARALLAX_var_texture , kU ) . a - ( lk + lj ) ; lk = ll - lk ; lk = lk / ( lk - lj ) ; kT = lk * kU + ( UNITY_VALUE_NODES - lk ) * kT ; qW = kG ( kT ) ; } else qW = qS ;".split(" ")}]},
{type:"node",name:"B4W_CLAMP",k:[{type:"node_in",name:"qY",qualifier:["vec3"],e:!1},{type:"node_out",name:"qZ",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"qZ = clamp ( qY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"B4W_REFRACTION",k:[{type:"node_in",name:"q_",qualifier:["vec3"],e:!1},{type:"node_in",name:"ra",qualifier:["float"],e:!1},{type:"node_out",name:"rb",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"rb = kv ( q_ , ra ) ;".split(" ")}]},{type:"node",
name:"B4W_TRANSLUCENCY",k:[{type:"node_in",name:"rc",qualifier:["float"],e:!1},{type:"node_in",name:"rd",qualifier:["float"],e:!1},{type:"node_in",name:"re",qualifier:["float"],e:!1},{type:"node_in",name:"rf",qualifier:["float"],e:!1},{type:"node_in",name:"rg",qualifier:["float"],e:!1},{type:"node_out",name:"rh",qualifier:["float"],e:!0},{type:"node_out",name:"ri",qualifier:["vec4"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rh"],f:[{type:"textline",b:["rh","=","rc",";"]}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ri"],f:[{type:"textline",b:"ri = vec4 ( rd , re , rf , rg ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_TIME",k:[{type:"node_out",name:"rj",qualifier:["float"],e:!1}],f:[{type:"textline",b:["rj","=","u_time",";"]}]},{type:"node",name:"B4W_SMOOTHSTEP",k:[{type:"node_in",name:"rk",qualifier:["float"],e:!1},{type:"node_in",name:"rl",qualifier:["float"],e:!1},{type:"node_in",name:"rm",qualifier:["float"],e:!1},{type:"node_out",name:"rn",qualifier:["float"],
e:!1}],f:[{type:"textline",b:"rn = smoothstep ( rl , rm , rk ) ;".split(" ")}]},{type:"nodes_global"},{type:"textline",b:"void main ( ) { vec2 kT , kU ; vec4 kV , kW ; mat3 kX ; float kY , kZ , k_ , la , lb , lc , ld , le , lf , lg , lh , li , lj , lk , ll ; vec3 lm , ln , lo , lp , lq , lr , ls , lt , lu , lv , lw , lx , ly , lz , lA , lB , lC , lD , lE , lF , lG ;".split(" ")},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),group:{type:"group",
a:[{type:"textline",b:["lm","=","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"kY = jC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["ln","=","jD",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",
b:"if ( gl_FrontFacing ) ln = ln ; else ln = - ln ;".split(" ")}]}}]},{type:"textline",b:"lo = normalize ( ln ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"lp = cross ( ln , jE . xyz ) * jE . w ; kX = mat3 ( jE . xyz , lp , ln ) ; kX = kX ;".split(" ")}]}}]},{type:"textline",b:"lp = u_camera_eye_frag - jC ; ln = normalize ( lp ) ; lp = jC ; kV = cJ ; kZ = u_emit ; k_ = u_specular_alpha ; la = u_ambient ; gO lH ;".split(" ")},
{type:"nodes_main"},{type:"textline",b:"lD = lq ; lj = lc ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"lD = max ( lD - sqrt ( 0.01 * - min ( kY , ZERO_VALUE_NODES ) ) , 0.5 * lD ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"jA ( lD , kY , u_time , lb , ls , u_sun_direction , lm , u_sun_quaternion , jC , length ( cJ ) ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"! DISABLE_FOG && ( ! PROCEDURAL_FOG || WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:"lk = clamp ( length ( u_sun_intensity ) + u_environment_energy , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"lq = gm ( u_cube_fog , ln ) ; kW = vec4 ( lq , u_fog_color_density . a ) ; fV ( kW . rgb ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"kW = u_fog_color_density ; kW . rgb *= lk ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"gC ( lD , length ( cJ ) , ln , u_cam_water_depth , u_underwater_fog_color_density , kW , kY , lk ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gg ( lD , length ( cJ ) , kW ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","ALPHA_CLIP"],
group:{type:"group",a:[{type:"textline",b:"if ( lj < 0.5 ) discard ; lj = UNITY_VALUE_NODES ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SSAO_ONLY","&&","SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"kU = texture2DProj ( u_shadow_mask , cI ) . rg ; lc = kU . g ; lD = vec3 ( lc ) ;".split(" ")}]}}]},{type:"textline",b:["fX","(","lD",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"f_ ( lD , lj ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( lD , lj ) ; }".split(" ")}]};a["nodes.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",
c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",
b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",
a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",
";"]}]}}]},{type:"textline",b:"varying vec3 jC ; varying vec4 cJ ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","jD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","jE",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || USE_NODE_B4W_REFRACTION".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","jG",";"]}]}}]},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"node",name:"GEOMETRY_UV",k:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"kJ",qualifier:["varying",
"vec2"]}],f:[{type:"textline",b:["kJ","=","node_GEOMETRY_UV_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_VC",k:[{type:"node_param",name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"kO",qualifier:["varying","vec3"]}],f:[{type:"textline",b:["kO","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC1",k:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",qualifier:["attribute","float"]},{type:"node_param",name:"kP",
qualifier:["varying","float"]}],f:[{type:"textline",b:["kP","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC2",k:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"kQ",qualifier:["varying","vec2"]}],f:[{type:"textline",b:["kQ","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC3",k:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute",
"vec3"]},{type:"node_param",name:"kR",qualifier:["varying","vec3"]}],f:[{type:"textline",b:["kR","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]},{type:"nodes_global"},{type:"textline",b:"void main ( ) { vec4 kS ; float kT , kU , kV ; mat4 kW ; vec3 kX , kY , kZ , k_ , la , lb , lc ; kX = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"kY = a_normal ; kZ = vec3 ( a_tangent ) ; k_ = a_tangent [ 3 ] * cross ( kY , kZ ) ;".split(" ")}]}},
{type:"elif",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",a:[{type:"textline",b:"kY = a_normal ; kZ = vec3 ( 0.0 ) ; k_ = vec3 ( 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kY = vec3 ( 0.0 ) ; kZ = vec3 ( 0.0 ) ; k_ = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"kX = mix ( kX , a_position_next , u_va_frame_factor ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:"kY = mix ( kY , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"la = vec3 ( a_tangent ) ; lb = a_tangent_next [ 3 ] * cross ( a_normal_next , la ) ; kZ = mix ( kZ , la , u_va_frame_factor ) ; k_ = mix ( k_ , lb , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"bv ( kX , kZ , k_ , kY ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["la","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"la = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"lb = ( u_model_matrix * vec4 ( la , 1.0 ) ) . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"kW = ao ( u_camera_eye , lb , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kW = ai ( u_camera_eye , lb , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"lc = ( u_model_matrix * vec4 ( la , 1.0 ) ) . xyz ; kW = kW * aa ( u_wind , u_time , u_jitter_amp , u_jitter_freq , lc ) ;".split(" ")}]}}]},
{type:"textline",b:"d ld = av ( kX - la , la , kZ , k_ , kY , kW ) ; ld . b = lb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d ld = av ( kX , la , kZ , k_ , kY , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"cj ( ld . a , ld . b , kY ) ;".split(" ")}]}}]},{type:"textline",b:"jC = ld . a ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:"jD = ld . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"kT = ( dot ( cross ( ld . e , ld . c ) , ld . d ) < 0.0 ) ? - 1.0 : 1.0 ; jE = vec4 ( ld . c , kT ) ;".split(" ")}]}}]},{type:"textline",b:"cJ = u_view_matrix * vec4 ( ld . a , 1.0 ) ; kS = u_proj_matrix * cJ ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"kS . xy += u_subpixel_jitter * kS . w ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["fO","(","kS",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"fO ( ld . a ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || ( USE_NODE_B4W_REFRACTION && REFRACTIVE )".split(" "),group:{type:"group",a:[{type:"textline",b:"kT = kS . x ; kU = kS . y ; kV = kS . w ; cI . x = ( kT + kV ) / 2.0 ; cI . y = ( kU + kV ) / 2.0 ; cI . z = kV ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"jG = - cJ . z / u_view_max_depth ;".split(" ")}]}}]},{type:"nodes_main"},{type:"textline",b:["gl_Position","=","kS",";","}"]}]};a["particles_color.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec4 u_fog_color_density ; varying float kS ; varying vec3 jF ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cJ",";"]}]}}]},{type:"textline",b:"void main ( ) { vec3 kT ; float kU ; kU = 2.0 * sqrt ( ( gl_PointCoord . x - 0.5 ) * ( gl_PointCoord . x - 0.5 ) + ( gl_PointCoord . y - 0.5 ) * ( gl_PointCoord . y - 0.5 ) ) ; kU = smoothstep ( u_p_alpha_start , u_p_alpha_end , kU ) ; kU = u_diffuse_color . a * kS * ( 1.0 - clamp ( kU , 0.0 , 1.0 ) ) ; kT = jF * u_diffuse_color . rgb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gg ( kT , length ( cJ ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:["fX","(","kT",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"f_ ( kT , kU ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( kT , kU ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",a:[{type:"var",name:"COLOR_RAMP_LENGTH",
b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",
b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform float u_height ; uniform float u_p_size ;".split(" ")},{type:"condition",
a:[{type:"if",c:["!","WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float kS ; varying vec3 jF ; varying vec3 cJ ;".split(" ")},{type:"include",file:"particles.glslv"},{type:"textline",b:"void main ( ) { float lF ; vec4 lG ; kT lH ; lH = lE ( ) ; lG = u_view_matrix * vec4 ( lH . b , 1.0 ) ; gl_Position = u_proj_matrix * lG ; kS = lH . c ; jF = lH . d ; cJ = lG . xyz ; lF = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; gl_PointSize = lH . a * lF ; }".split(" ")}]};
a["particles_texture.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"fog.glslf"},{type:"var",name:"PARTICLES_SHADELESS",b:["0"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",
a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",
a:[{type:"textline",b:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_COLOR"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; varying float kS ; varying vec3 jF ; varying vec2 a ; varying vec3 jB ; varying vec3 jC ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]},{type:"include",file:"environment.glslf"},{type:"textline",b:"void main ( ) { vec2 kq ; float kr ; vec3 ks , kt , ku , kv , kw , kx ; vec4 ky , kz ; ky = u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"kz = texture2D ( u_sampler , a ) ; fV ( kz . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"ky . rgb = mix ( ky . rgb , kz . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"ky . rgb *= mix ( vec3 ( 1.0 ) , kz . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"ky . a = kz . a ;".split(" ")}]}}]},{type:"textline",b:"ky . rgb *= jF ; ks = u_diffuse_intensity * ky . rgb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","PARTICLES_SHADELESS"],group:{type:"group",a:[{type:"textline",b:"kt = u_emit * ky . rgb ; ku = vec3 ( 0.0 , 1.0 , 0.0 ) ; kr = 0.5 ; kv = u_environment_energy * kp ( kr , ku ) ; kv = u_ambient * kv ; kr = u_specular_params [ 0 ] ; kq = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; kw = kr * u_specular_color ; kx = normalize ( jB ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"gO kA = jc ( kt , kv , ks , kw , jC , ku , kx , kq , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gO kA = jh ( kt , kv , ks ) ;".split(" ")}]}}]},{type:"textline",b:"kw = kA . a . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["kw","=","ks",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gg ( kw , length ( cJ ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:"kr = ky . a * kS ; fX ( kw ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"f_ ( kw , kr ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( kw , kr ) ; }".split(" ")}]};a["particles_texture.glslv"]={type:"group",a:[{type:"var",name:"BILLBOARD_ALIGN",b:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"define",name:"BILLBOARD_ALIGN_VIEW",b:["1"]},{type:"define",
name:"BILLBOARD_ALIGN_XY",b:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",b:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",b:["4"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform vec3 u_camera_eye ; uniform float u_p_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float kS ; varying vec3 jF ; varying vec2 a ; varying vec3 jB ; varying vec3 jC ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]},{type:"include",file:"particles.glslv"},{type:"textline",b:"float ks ( vec2 kq , vec2 kr ) { return ( atan ( kr . y , kr . x ) - atan ( kq . y , kq . x ) ) ; } void main ( ) { vec4 kt , ku , kv ; mat4 kw ; float kx ; kT ky ; ky = lE ( ) ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { kx = ky . e ; kw = N ( ky . b , u_view_matrix ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { kx = ky . e ; kw = x ( ) ; kw [ 3 ] = vec4 ( ky . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { kx = ky . e ; kw = B ( radians ( 90.0 ) ) ; kw [ 3 ] = vec4 ( ky . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { kx = ks ( vec2 ( EPSILON , 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + ky . e ; kw = z ( radians ( - 90.0 ) ) ; kw [ 3 ] = vec4 ( ky . b , 1.0 ) ; } kt = vec4 ( a_p_bb_vertex * 2.0 * ky . a * u_p_size , 0.0 , 1.0 ) ; kt = kw * D ( kx ) * kt ; ku = u_view_matrix * kt ; kv = u_proj_matrix * ku ; gl_Position = kv ; kS = ky . c ; jF = ky . d ; a = a_p_bb_vertex + 0.5 ; jC = kt . xyz ; jB = u_camera_eye - kt . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["cJ","=","ku",";"]}]}}]},{type:"textline",b:["}"]}]};a["procedural_skydome.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 lF ; const float lG = 0.99 ; const float lH = 1.8 ; const int lI = 8 ; float lO ( vec3 lJ , vec3 lK ) { float lL , lM , lN ; lL = dot ( lK , lK ) ; lM = 2.0 * dot ( lK , lJ ) ; lN = dot ( lJ , lJ ) - 1.0 ; lL = lM * lM - 4.0 * lL * lN ; lL = sqrt ( lL ) ; lM = ( - lM - lL ) / 2.0 ; lL = lN / lM ; return lL ; } float lV ( float lP , float lQ ) { float lR , lS , lT , lU ; lR = 3.0 * ( 1.0 - lQ * lQ ) ; lS = 2.0 * ( 2.0 + lQ * lQ ) ; lT = 1.0 + lP * lP ; lU = pow ( 1.0 + lQ * lQ - 2.0 * lQ * lP , 1.5 ) ; lU = max ( lU , 0.00001 ) ; return ( lR / lS ) * ( lT / lU ) ; } float ma ( vec3 lW , vec3 lX , float lY ) { vec3 lZ ; float l_ ; l_ = dot ( lX , - lW ) ; if ( l_ < 0.0 ) { return 1.0 ; } lZ = lW + l_ * lX ; if ( length ( lZ ) < lY ) { return 0.0 ; } else if ( length ( lZ ) >= lY ) { lZ = normalize ( lZ ) * lY - lW ; l_ = acos ( dot ( normalize ( lZ ) , lX ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( l_ * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 me ( float mb , vec3 mc , float md ) { return mc - mc * pow ( u_sky_color , vec3 ( md / mb ) ) ; } void main ( ) { float mf , mg , mh , mi , mj , mk , ml , mm , mn ; vec3 mo , mp , mq , mr , ms , mt , mu ; mo = normalize ( lF ) ; mp = u_sun_direction ; mf = dot ( mo , mp ) ; mg = lV ( mf , - 0.01 ) * u_rayleigh_brightness * mp . y ; mh = lV ( mf - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - mp . y ) ; mf = smoothstep ( 0.0 , 100.0 , lV ( mf , 0.9995 ) ) * u_spot_brightness ; mq = vec3 ( 0.0 , lG , 0.0 ) ; mi = lO ( mq , mo ) ; mj = mi / float ( lI ) ; mk = ma ( mq , mo , lG - 0.3 ) ; mr = vec3 ( 0.0 , 0.0 , 0.0 ) ; ms = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int mv = 0 ; mv < lI ; mv ++ ) { ml = mj * float ( mv ) ; mt = mq + mo * ml ; mm = ma ( mt , mp , lG - 0.2 ) ; mn = lO ( mt , mp ) ; mu = me ( mn , vec3 ( lH ) , u_scatter_strength ) * mm ; mr += me ( sqrt ( ml ) , u_sky_color * mu , u_rayleigh_strength ) ; ms += me ( ml , mu , u_mie_strength ) ; } mr = mr * mk * pow ( mi , u_rayleigh_collection_power ) / float ( lI ) ; ms = ( ms * mk * pow ( mi , u_mie_collection_power ) ) / float ( lI ) ; ms = vec3 ( mf * ms + mh * ms + mg * mr ) ; fX ( ms ) ; gl_FragColor = vec4 ( ms , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 lF ; void main ( ) { vec4 kq , kr ; kq = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; kr = u_cube_view_matrix * kq ; lF = kr . xyz ; gl_Position = kq ; }".split(" ")}]};a["special_lens_flares.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; varying vec2 a ; void main ( ) { vec4 kq ; kq = texture2D ( u_sampler , a ) ; fX ( kq . rgb ) ; f_ ( kq . rgb , kq . a ) ; gl_FragColor = kq ; }".split(" ")}]};
a["special_lens_flares.glslv"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 a ; void main ( ) { vec2 kq ; float kr ; vec4 ks ; vec3 kt ; a = a_texcoord ; kt = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; ks = u_proj_matrix * u_view_matrix * vec4 ( kt , 0.0 ) ; ks . x /= ks . w ; ks . y /= ks . w ; ks += 99999.0 * step ( ks . z , 0.0 ) ; ks += 100.0 * ( step ( 1.0 , abs ( ks . x ) ) + step ( 1.0 , abs ( ks . y ) ) ) ; ks . x = - a_lf_dist * ks . x ; ks . y = - a_lf_dist * ks . y ; kr = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; kq = vec2 ( a_lf_bb_vertex . x / kr , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float ku = 1.9 ; kq *= ( 1.0 + ku * length ( ks . xy ) ) ; } gl_Position = vec4 ( ks . xy + kq , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"define",name:"INV_PI",b:["0.318309886"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["USE_SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky",";"]}]}},{type:"elif",c:["USE_SKY_BLEND"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_zenith_color",";"]}]}}]},{type:"textline",b:["uniform",
"vec3","u_horizon_color",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},{type:"textline",b:["varying","vec3","lF",";"]},{type:"condition",a:[{type:"if",c:["USE_SKY_BLEND","&&","USE_SKY_PAPER"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},
{type:"textline",b:"void main ( ) { vec4 kq ; float kr , ks ; vec3 kt , ku , kv , kw ;".split(" ")},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS && ! DISABLE_FOG && ! REFLECTION_PASS || ! USE_SKY_PAPER && USE_SKY_BLEND".split(" "),group:{type:"group",a:[{type:"textline",b:"ku = normalize ( lF ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"kt = textureCube ( u_sky , lF ) . rgb ;".split(" ")}]}},{type:"elif",c:["USE_SKY_BLEND"],
group:{type:"group",a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["USE_SKY_PAPER"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_SKY_REAL"],group:{type:"group",a:[{type:"textline",b:"kr = abs ( a . y ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kr = ( a . y + 1.0 ) * 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ks = acos ( ku . y ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_SKY_REAL"],
group:{type:"group",a:[{type:"textline",b:"kr = abs ( ks * INV_PI - 0.5 ) * 2.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kr = 1.0 - ks * INV_PI ;".split(" ")}]}}]}]}}]},{type:"textline",b:"kv = u_horizon_color ; kw = u_zenith_color ; fX ( kv ) ; fX ( kw ) ; kt = mix ( kv , kw , kr ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kt = u_horizon_color ; fX ( kt ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS && ! DISABLE_FOG && ! REFLECTION_PASS".split(" "),
group:{type:"group",a:[{type:"textline",b:"fV ( kt . rgb ) ; ks = u_camera_eye_frag . y - WATER_LEVEL ; ks = min ( - ks * 0.03 , 0.8 ) ; kr = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ; kv = vec3 ( 0.0 ) ; kq = u_underwater_fog_color_density ; kq . rgb = mix ( kq . rgb , kv , min ( - ku . y + ks , 1.0 ) ) * kr ; kr = clamp ( sign ( ku . y - 0.05 * ks ) , 0.0 , 1.0 ) ; kt = mix ( kq . rgb , kt , kr ) ; fX ( kt . rgb ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( kt , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 lF ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_SKY_BLEND","&&","USE_SKY_PAPER"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 kq , kr ; kq = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; kr = u_sky_vp_inverse * kq ; lF = kr . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_SKY_BLEND",
"&&","USE_SKY_PAPER"],group:{type:"group",a:[{type:"textline",b:"a = a_position . xy ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","kq",";","}"]}]};a["special_water.glslf"]={type:"group",a:[{type:"var",name:"ABSORB",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"SSS_STRENGTH",b:["6.0"]},{type:"var",name:"SSS_WIDTH",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",
file:"procedural.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",b:["0.001"]},{type:"define",name:"REFR_BUMP",b:["0.0005"]},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform samplerCube u_sky_texture ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_zenith_color",";"]}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"textline",
b:"uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE","||","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform",
"vec4","u_underwater_fog_color_density",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_scene_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["uniform",
"sampler2D","u_foam",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_norm_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap1_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap2_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap3_scale",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_MIRROR"],
group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"const float kq = 1.0 ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 jB ; varying vec3 jC ;".split(" ")},{type:"condition",a:[{type:"if",c:"( NUM_NORMALMAPS > 0 || FOAM ) && ! GENERATED_MESH".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jD",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 jE ; varying vec3 lG ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","lH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","lI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","float","jG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","lJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_TEXTURE"],group:{type:"group",a:[{type:"include",file:"environment.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","&&","SHORE_SMOOTHING","&&","USE_REFRACTION_CORRECTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},
{type:"textline",b:"vec3 lV ( in vec2 lK , in vec3 lL , in vec3 lM , in vec3 lN , out float lO ) { float lP , lQ , lR ; vec2 lS ; vec3 lT , lU ; lT = reflect ( - lM , lL ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"lS = lK . xy + lL . xz * REFL_BUMP / jG ; lO = u_reflect_factor ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"lU = u_underwater_fog_color_density . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lU = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",b:"lP = dot ( lM , lL ) ; lO *= max ( 1.0 - 1.0 / lP , 1.0 ) ; } else { lU = texture2D ( u_reflectmap , lS ) . rgb ; fV ( lU ) ; }".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"lO = u_mirror_factor ; lU = lN * textureCube ( u_mirrormap , lT ) . rgb ; fV ( lU ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"lO = u_reflect_factor ; lU = lN * vec3 ( 0.3 , 0.5 , 1.0 ) ; fV ( lU ) ;".split(" ")}]}}]},{type:"textline",b:"lT = normalize ( lT + lM ) ; lP = 1.0 - dot ( lM , lT ) ; lQ = u_fresnel_params [ 3 ] ; lR = u_fresnel_params [ 2 ] ; lQ = lQ + ( 1.0 - lQ ) * pow ( lP , lR ) ; lO = min ( lO * lQ , 1.0 ) ; return lU ; } void main ( ) { vec4 lW ; vec2 lX , lY , lZ ; float l_ , ma , mb , mc , md , me ; vec3 mf , mg , mh , mi , mj , mk , ml ; mat3 mm ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mm = mat3 ( jE , lG , jD ) ;".split(" ")}]}}]},{type:"textline",b:"mf = normalize ( jD ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mm = mat3 ( 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , - 1.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"mf = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","&&","FOAM"],group:{type:"group",a:[{type:"textline",b:"l_ = jC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0","||","FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"lX = vec2 ( lH . x , - lH . z ) + 0.5 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"lX = vec2 ( jC . x , - jC . z ) + 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["lX","=","a",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mg = vec3 ( 0.0 ) ; mh = texture2D ( u_normalmap0 , lX * u_normalmap0_scale + vec2 ( 0.3 , 0.5 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; mg += mh ;".split(" ")},{type:"condition",a:[{type:"if",
c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"mi = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORM_FOAM0"],group:{type:"group",a:[{type:"textline",b:["mi","+=","mh",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:"mh = texture2D ( u_normalmap0 , lX * u_normalmap1_scale + vec2 ( - 0.3 , 0.7 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; mg += mh ;".split(" ")},{type:"condition",a:[{type:"if",
c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM1"],group:{type:"group",a:[{type:"textline",b:["mi","+=","mh",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:"mh = texture2D ( u_normalmap0 , lX * u_normalmap2_scale + vec2 ( 0.0 , 1.1 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; mg += mh ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["NORM_FOAM2"],group:{type:"group",a:[{type:"textline",b:["mi","+=","mh",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:"mh = texture2D ( u_normalmap0 , lX * u_normalmap3_scale + vec2 ( - 0.66 , - 0.3 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; mg += mh ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM3"],group:{type:"group",
a:[{type:"textline",b:["mi","+=","mh",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"mh = mm * mi ; if ( ! g ( mh , vec3 ( 0.0 ) ) ) mh = normalize ( mh ) ; mi = mix ( mf , mh , 0.2 ) ; mi = normalize ( mi ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"mf = mix ( mf , normalize ( mm * mg ) , 0.3 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mf = mix ( mf , normalize ( mm * mg ) , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"mf = normalize ( mf ) ;".split(" ")}]}}]},{type:"textline",b:"mh = normalize ( jB ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"lY = cI . xy / cI . z ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",
b:"ma = jG * u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"mb = u_diffuse_color . a ; lW = texture2DProj ( u_scene_depth , cI ) ; mc = cu ( lW ) ; md = max ( mc - jG , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"lZ = lY + mf . xz * u_refr_bump / jG ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_REFRACTION_CORRECTION"],group:{type:"group",
a:[{type:"textline",b:"me = ke ( mc , lZ , lY ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lZ = lY ; me = mc ;".split(" ")}]}}]},{type:"textline",b:"mc = max ( me - jG , 0.0 ) ; me = u_view_max_depth / ABSORB * mc ; if ( u_cam_water_depth < 0.0 ) mc = 0.0 ; else mc = min ( mb * me , 1.0 ) ; me = u_view_max_depth / ABSORB * md ; mb = min ( 15.0 * mb * u_view_max_depth * md , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"me = u_view_max_depth / ABSORB * md ; if ( u_cam_water_depth > 0.0 ) mb = min ( mb * me , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"mb *= min ( 5.0 * ma , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mb = u_diffuse_color . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"mc = 1.0 - mb ; lZ = lY + mf . xz * REFR_BUMP / jG ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"mg = texture2D ( u_refractmap , lZ ) . rgb ; fV ( mg ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"me = pow ( min ( lI . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; mj = mix ( u_shallow_water_col , u_diffuse_color . rgb , me ) ; me = pow ( min ( lI . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; mj = mix ( u_shore_water_col , mj , me ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mj = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"me = max ( 1.0 - u_view_max_depth * md , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"me = 1.0 - mb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"md = max ( l_ / WAVES_HEIGHT + 0.1 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"mk = normalize ( vec3 ( lI . r , 0.0 , lI . g ) ) ; mk = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , mk , 0.8 ) ) ; l_ = 1.25 * max ( dot ( mi , mk ) - 0.2 , 0.0 ) ; l_ += max ( dot ( mi , vec3 ( 0.0 , - 1.0 , 0.0 ) ) , 0.0 ) ; me += l_ * ( 1.0 - lI . b ) ; md *= ( 1.0 - 0.95 * pow ( lI . b , 0.1 ) ) ;".split(" ")}]}}]},
{type:"textline",b:"me += md ; me = min ( u_foam_factor * me , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"lW = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + lX * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",b:"l_ = u_specular_params [ 0 ] ; lZ = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; mk = l_ * u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"mi = u_environment_energy * kp ( 0.0 , mf ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mi = u_environment_energy * u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:"mi = u_ambient * mi ; mi = mi + u_sun_intensity ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"ml = lV ( lY , mf , mh , mi , md ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ml = lV ( vec2 ( 0.0 ) , mf , mh , mi , md ) ;".split(" ")}]}}]},{type:"textline",b:"mj = u_diffuse_intensity * mj ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"gO mn = jc ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , mj , mk , jC , mf , mh , lZ , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gO mn = jh ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , mj ) ;".split(" ")}]}}]},{type:"textline",b:"mj = mn . a . rgb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"l_ = max ( dot ( u_sun_direction , - jD ) + SSS_WIDTH , 0.0 ) * max ( dot ( - mh , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; l_ = clamp ( SSS_STRENGTH * l_ , 0.0 , 1.0 ) ; mj = mix ( mj , u_shallow_water_col , l_ ) ; mj = mix ( mj , u_shore_water_col , l_ ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"mj = mix ( mg , mj , mc ) ;".split(" ")}]}}]},
{type:"textline",b:"mj = mix ( mj , ml , md ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"l_ = mix ( lW . g , lW . r , max ( 4.0 * ( me - 0.75 ) , 0.0 ) ) ; l_ = mix ( lW . b , l_ , max ( 2.0 * me - 1.0 , 0.0 ) ) ; l_ = mix ( 0.0 , l_ , me ) ; mj = mix ( mj , mi , l_ ) ;".split(" ")}]}}]},{type:"textline",b:"mj += mn . b ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"mk = gm ( u_cube_fog , mh ) ; lW = vec4 ( mk , u_fog_color_density . a ) ; fV ( lW . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["lW","=","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { gK ( mj , ma , u_cam_water_depth , u_underwater_fog_color_density , clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ) ; } else { gg ( mj , ma , lW ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gg ( mj , ma , lW ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["fX","(","mj",")",";"]},{type:"condition",a:[{type:"if",c:["!","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"mb = max ( mb , mn . b . r ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["mb","+=","l_",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"f_ ( mj , mb ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"mf = fwidth ( lJ ) ; mg = smoothstep ( vec3 ( 0.0 ) , mf * kq , lJ ) ; mc = min ( min ( mg . x , mg . y ) , mg . z ) ; mc = clamp ( mc , 0.0 , 1.0 ) ; mj = mix ( u_wireframe_edge_color , mj , mc ) ; mb = mix ( 1.0 , mb , mc ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( mj , mb ) ; }".split(" ")}]};a["special_water.glslv"]=
{type:"group",a:[{type:"var",name:"DIR_MIN_SHR_FAC",b:["0.0"]},{type:"var",name:"DIR_FREQ",b:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",b:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",b:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",b:["0.0"]},{type:"var",name:"DST_MIN_FAC",b:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",
b:["0.0"]},{type:"var",name:"PRECISION",b:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Y",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Y",b:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"WAVES_LENGTH",b:["0.0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",
file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_polyindex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",
b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),
group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",b:"varying vec3 jB ; varying vec3 jC ;".split(" ")},{type:"condition",a:[{type:"if",c:"! GENERATED_MESH && ( NUM_NORMALMAPS > 0 || FOAM )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jD",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 jE ; varying vec3 lG ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","lH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3",
"lI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","jG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","lJ",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 kv ( in vec2 kq ) { float kr ; vec4 ks ; vec2 kt ; kt = 0.5 + vec2 ( ( kq . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( kq . y + SHORE_MAP_CENTER_Y ) / SHORE_MAP_SIZE_Y ) ; ks = texture2D ( u_shore_dist_map , kt ) ; const vec2 ku = vec2 ( 1.0 / 255.0 , 1.0 ) ; kr = dot ( ks . ba , ku ) ; kt = normalize ( ks . rg * 2.0 - 1.0 ) ; return vec3 ( kt , kr ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],
group:{type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"SMALL_WAVES_FAC",b:["0.3"]},{type:"textline",b:"void kH ( inout vec3 kw , in float kx , in vec3 ky ) { vec2 kz , kA , kB ; float kC , kD , kE , kF , kG ; kC = dx ( DST_NOISE_SCALE_0 * ( kw . xz + DST_NOISE_FREQ_0 * kx ) ) * dx ( DST_NOISE_SCALE_1 * ( kw . zx - DST_NOISE_FREQ_1 * kx ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"kD = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; kE = ky . b ; kF = sqrt ( kE ) ; kD = max ( kE , DIR_MIN_SHR_FAC ) * sin ( kF / kD + DIR_FREQ * kx ) ; kG = max ( dx ( DIR_NOISE_SCALE * ( kw . xz + DIR_NOISE_FREQ * kx ) ) , DIR_MIN_NOISE_FAC ) ; kD *= kG ; kG = WAVES_HEIGHT * mix ( kD , kC , max ( kF , DST_MIN_FAC ) ) ; kz = ky . rg ; kF = WAVES_HOR_FAC * kD * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - kE ) , 0.0 ) ; kz = kF * kz ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"kG = WAVES_HEIGHT * kC ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"kA = 2.0 * ( kw . xz - 0.1 * kx ) ; kB = 1.3 * ( kw . zx + 0.03 * kx ) ; kD = da ( 0.5 * kA ) . x + da ( 0.5 * kB ) . x - 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"kw . xz += kz ; kD *= kE ;".split(" ")}]}}]},{type:"textline",b:"kG += SMALL_WAVES_FAC * kD ;".split(" ")}]}}]},
{type:"textline",b:"kw . y += kG ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { vec4 kI , lK ; vec2 lL ; float lM , lN , lO ; vec3 lP , lQ , lR , lS ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"if ( a_polyindex == 0.0 ) lJ = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) lJ = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) lJ = vec3 ( 0.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["lP","=",
"a_position",";"]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"lM = abs ( lP . y ) ; lL = u_camera_eye . xz - mod ( u_camera_eye . xz , lM ) ; lP . y = WATER_LEVEL ; lP . xz += lL ;".split(" ")}]}},{type:"elif",c:["NUM_NORMALMAPS",">","0","||","FOAM"],group:{type:"group",a:[{type:"textline",b:["a","=","a_texcoord",";"]}]}}]},{type:"textline",b:"d lT = av ( lP , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC","&&","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"lH = lT . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"lI = kv ( lT . a . xz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"lN = length ( u_wind ) ; lO = u_time ; lO *= lN ;".split(" ")},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",
a:[{type:"textline",b:["lN","=","lM",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["lN","=","0.1",";"]}]}}]},{type:"textline",b:"lP = lT . a + vec3 ( lN , 0.0 , 0.0 ) ; lQ = lT . a + vec3 ( 0.0 , 0.0 , lN ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"lR = kv ( lP . xz ) ; lS = kv ( lQ . xz ) ; kH ( lP , lO , lR ) ; kH ( lQ , lO , lS ) ; kH ( lT . a , lO , lI ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"kH ( lP , lO , vec3 ( 0.0 ) ) ; kH ( lQ , lO , vec3 ( 0.0 ) ) ; kH ( lT . a , lO , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"if ( a_position . y < 0.0 ) { lT . a . y = WATER_LEVEL - 1.0 ; lP . y = lT . a . y ; lQ . y = lT . a . y ; }".split(" ")}]}}]},{type:"textline",b:"lR = normalize ( lP - lT . a ) ; lS = normalize ( lQ - lT . a ) ; jD = normalize ( cross ( lS , lR ) ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"jE = lS ; lG = cross ( jD , jE ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"lM = dot ( jD , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; lN = clamp ( 0.8 - lM , 0.0 , 1.0 ) ; jD = mix ( jD , vec3 ( 0.0 , 1.0 , 0.0 ) , lN ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"jC = lT . a ; jB = u_camera_eye - lT . a ; kI = u_view_matrix * vec4 ( lT . a , 1.0 ) ; lK = u_proj_matrix * kI ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"lO = lK . x ; lM = lK . y ; lN = lK . w ; cI . x = ( lO + lN ) / 2.0 ; cI . y = ( lM + lN ) / 2.0 ; cI . z = lN ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:"jG = - kI . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["gl_Position",
"=","lK",";","}"]}]};a["wireframe.glslf"]={type:"group",a:[{type:"define",name:"WM_OPAQUE_WIREFRAME",b:["0"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",b:["1"]},{type:"define",name:"WM_FRONT_BACK_VIEW",b:["2"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",
b:"varying vec3 lJ ; const float kq = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"const vec3 kr = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 kr = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 ks = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 kt = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 ku = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { float kv , kw ; vec3 kx , ky ; kx = vec3 ( 0.0 ) ; kv = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"ky = sign ( lJ - vec3 ( 0.02 * kq ) ) ; if ( ky . x < 0.0 || ky . y < 0.0 || ky . z < 0.0 ) { kx = kr ; kv = 1.0 ; } else discard ;".split(" ")}]}},{type:"elif",c:["WIREFRAME_QUALITY","==","0"],group:{type:"group",a:[{type:"textline",b:"ky = sign ( lJ - vec3 ( 0.02 * kq ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( ky . x < 0.0 || ky . y < 0.0 || ky . z < 0.0 ) kx = u_wireframe_edge_color ; else kx = ku ; kv = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( ky . x < 0.0 || ky . y < 0.0 || ky . z < 0.0 ) kv = 1.0 ; else kv = 0.0 ; kx = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( ky . x < 0.0 || ky . y < 0.0 || ky . z < 0.0 ) kx = u_wireframe_edge_color ; else if ( gl_FrontFacing ) kx = ks ; else kx = kt ; kv = 1.0 ; }".split(" ")}]}},
{type:"elif",c:["WIREFRAME_QUALITY","==","1"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"ky = fwidth ( lJ ) ; ky = smoothstep ( vec3 ( 0.0 ) , ky * kq , lJ ) ; kw = min ( min ( ky . x , ky . y ) , ky . z ) ; kw = clamp ( kw , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { kx = vec3 ( mix ( u_wireframe_edge_color , ku , kw ) ) ; kv = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { kx = u_wireframe_edge_color ; kv = mix ( 1.0 , 0.0 , kw ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) kx = mix ( u_wireframe_edge_color , ks , kw ) ; else kx = mix ( u_wireframe_edge_color , kt , kw ) ; kv = 1.0 ; }".split(" ")}]}}]},
{type:"textline",b:["fX","(","kx",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"f_ ( kx , kv ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( kx , kv ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","BILLBOARD"],
group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],
group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},{type:"textline",
b:["varying","vec3","lJ",";"]},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec4 kq ; mat4 kr ; vec3 ks , kt , ku , kv , kw ; if ( a_polyindex == 0.0 ) lJ = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) lJ = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) lJ = vec3 ( 0.0 , 0.0 , 1.0 ) ; ks = a_position ; kt = a_normal ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"d kx = av ( ks , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"ks = mix ( ks , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"ku = vec3 ( 0.0 ) ; kv = vec3 ( 0.0 ) ; bv ( ks , ku , kv , kt ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["ku","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ku = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d kx = fE ( ks , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ku , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"kv = ( u_model_matrix * vec4 ( ku , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"kr = ao ( u_camera_eye , kv , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kr = ai ( u_camera_eye , kv , u_view_matrix ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"kw = ( u_model_matrix * vec4 ( ku , 1.0 ) ) . xyz ; kr = kr * aa ( u_wind , u_time , u_jitter_amp , u_jitter_freq , kw ) ;".split(" ")}]}}]},{type:"textline",b:"d kx = av ( ks - ku , ku , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , kr ) ; kx . b = kv ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d kx = av ( ks , ku , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"cj ( kx . a , kx . b , kt ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"kq = u_view_matrix * vec4 ( kx . a , 1.0 ) ; gl_Position = u_proj_matrix * kq ; }".split(" ")}]};a["postprocessing/anaglyph.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 a ; void main ( ) { vec4 kq , kr ; kq = texture2D ( u_sampler_left , a ) ; kr = texture2D ( u_sampler_right , a ) ; gl_FragColor = vec4 ( kq [ 0 ] , kr [ 1 ] , kr [ 2 ] , kq [ 3 ] + kr [ 3 ] ) ; }".split(" ")}]};
a["postprocessing/antialiasing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"AA_METHOD_PASS",b:["1"]},{type:"define",name:"AA_METHOD_FXAA_LIGHT",b:["2"]},{type:"define",name:"AA_METHOD_FXAA_QUALITY",b:["3"]},{type:"define",name:"FXAA_REDUCE_MIN",b:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",b:["(","1.0","/","8.0",")"]},{type:"define",name:"FXAA_SPAN_MAX",b:["8.0"]},{type:"textline",b:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 a ; vec4 kt ( float kq , float kr ) { vec2 ks ; ks = a + vec2 ( kq , kr ) * u_texel_size ; return texture2D ( u_color , ks ) ; } float kx ( vec4 ku ) { float kv ; vec3 kw ; kw = vec3 ( 0.299 , 0.587 , 0.114 ) ; kv = dot ( ku . rgb , kw ) ; return kv ; } vec4 lL ( ) { vec2 ky ; float kz , kA , kB , kC , kD , kE ; vec4 kF , kG , kH , kI , lK ; kF = kt ( - 1.0 , - 1.0 ) ; kG = kt ( 1.0 , - 1.0 ) ; kH = kt ( - 1.0 , 1.0 ) ; kI = kt ( 1.0 , 1.0 ) ; lK = kt ( 0.0 , 0.0 ) ; kz = kx ( kF ) ; kA = kx ( kG ) ; kB = kx ( kH ) ; kC = kx ( kI ) ; kD = kx ( lK ) ; kE = min ( kD , min ( min ( kz , kA ) , min ( kB , kC ) ) ) ; kD = max ( kD , max ( max ( kz , kA ) , max ( kB , kC ) ) ) ; ky . x = - ( ( kz + kA ) - ( kB + kC ) ) ; ky . y = ( ( kz + kB ) - ( kA + kC ) ) ; kz = max ( ( kz + kA + kB + kC ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; kA = 1.0 / ( min ( abs ( ky . x ) , abs ( ky . y ) ) + kz ) ; ky = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , ky * kA ) ) * u_texel_size ; kF = 0.5 * ( texture2D ( u_color , a + ky * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , a + ky * ( 2.0 / 3.0 - 0.5 ) ) ) ; kG = kF * 0.5 + 0.25 * ( texture2D ( u_color , a + ky * - 0.5 ) + texture2D ( u_color , a + ky * 0.5 ) ) ; kB = kx ( kG ) ; if ( ( kB < kE ) || ( kB > kD ) ) return kF ; else return kG ; }".split(" ")},
{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",b:["(","1.0","/","6.0",")"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["(","1.0","/","12.0",")"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["(","3.0","/","4.0",")"]},{type:"textline",b:"vec4 mp ( ) { bool lM , lN , lO , lP , lQ ; float lR , lS , lT , lU , lV , lW , lX , lY , lZ , l_ , ma , mb , mc , md , me ; vec4 mf , mg , mh , mi , mj ; vec2 mk , ml , mm , mn , mo ; mk . x = a . x ; mk . y = a . y ; mf = texture2D ( u_color , mk ) ; mg = kt ( 0.0 , 1.0 ) ; mh = kt ( 1.0 , 0.0 ) ; mi = kt ( 0.0 , - 1.0 ) ; mj = kt ( - 1.0 , 0.0 ) ; lR = kx ( mg ) ; lS = kx ( mh ) ; lT = kx ( mi ) ; lU = kx ( mj ) ; lV = kx ( mf ) ; lW = max ( lR , lV ) ; lX = min ( lR , lV ) ; lW = max ( lS , lW ) ; lX = min ( lS , lX ) ; lY = max ( lT , lU ) ; lZ = min ( lT , lU ) ; lY = max ( lY , lW ) ; lW = min ( lZ , lX ) ; lZ = lY * FXAA_QUALITY_EDGE_THRESHOLD ; lX = lY - lW ; lY = max ( FXAA_QUALITY_EDGE_THRESHOLD_MIN , lZ ) ; lM = lX < lY ; if ( lM ) return mf ; mg = kt ( - 1.0 , - 1.0 ) ; mh = kt ( 1.0 , 1.0 ) ; mi = kt ( 1.0 , - 1.0 ) ; mj = kt ( - 1.0 , 1.0 ) ; lW = kx ( mg ) ; lZ = kx ( mh ) ; lY = kx ( mi ) ; l_ = kx ( mj ) ; ma = lT + lR ; mb = lU + lS ; lX = 1.0 / lX ; mc = ma + mb ; ma = ( - 2.0 * lV ) + ma ; mb = ( - 2.0 * lV ) + mb ; md = lY + lZ ; lY = lW + lY ; me = ( - 2.0 * lS ) + md ; lY = ( - 2.0 * lT ) + lY ; lW = lW + l_ ; l_ = l_ + lZ ; lZ = ( abs ( ma ) * 2.0 ) + abs ( me ) ; ma = ( abs ( mb ) * 2.0 ) + abs ( lY ) ; me = ( - 2.0 * lU ) + lW ; mb = ( - 2.0 * lR ) + l_ ; lY = abs ( me ) + lZ ; l_ = abs ( mb ) + ma ; me = lW + md ; lZ = u_texel_size . x ; lM = lY >= l_ ; mb = mc * 2.0 + me ; if ( ! lM ) lT = lU ; if ( ! lM ) lR = lS ; if ( lM ) lZ = u_texel_size . y ; ma = ( mb * ( 1.0 / 12.0 ) ) - lV ; lW = lT - lV ; md = lR - lV ; lY = lT + lV ; l_ = lR + lV ; lN = abs ( lW ) >= abs ( md ) ; mc = max ( abs ( lW ) , abs ( md ) ) ; if ( lN ) lZ = - lZ ; me = clamp ( abs ( ma ) * lX , 0.0 , 1.0 ) ; ml . x = mk . x ; ml . y = mk . y ; mm . x = ( ! lM ) ? 0.0 : u_texel_size . x ; mm . y = ( lM ) ? 0.0 : u_texel_size . y ; if ( ! lM ) ml . x += lZ * 0.5 ; if ( lM ) ml . y += lZ * 0.5 ; mn . x = ml . x - mm . x ; mn . y = ml . y - mm . y ; mo . x = ml . x + mm . x ; mo . y = ml . y + mm . y ; lU = ( ( - 2.0 ) * me ) + 3.0 ; lS = kx ( texture2D ( u_color , mn ) ) ; mb = me * me ; lT = kx ( texture2D ( u_color , mo ) ) ; if ( ! lN ) lY = l_ ; lR = mc * 1.0 / 4.0 ; lW = lV - lY * 0.5 ; md = lU * mb ; lN = lW < 0.0 ; lS -= lY * 0.5 ; lT -= lY * 0.5 ; lO = abs ( lS ) >= lR ; lP = abs ( lT ) >= lR ; if ( ! lO ) mn . x -= mm . x * 1.5 ; if ( ! lO ) mn . y -= mm . y * 1.5 ; lQ = ( ! lO ) || ( ! lP ) ; if ( ! lP ) mo . x += mm . x * 1.5 ; if ( ! lP ) mo . y += mm . y * 1.5 ; if ( lQ ) { if ( ! lO ) lS = kx ( texture2D ( u_color , mn . xy ) ) ; if ( ! lP ) lT = kx ( texture2D ( u_color , mo . xy ) ) ; if ( ! lO ) lS = lS - lY * 0.5 ; if ( ! lP ) lT = lT - lY * 0.5 ; lO = abs ( lS ) >= lR ; lP = abs ( lT ) >= lR ; if ( ! lO ) mn . x -= mm . x * 2.0 ; if ( ! lO ) mn . y -= mm . y * 2.0 ; lQ = ( ! lO ) || ( ! lP ) ; if ( ! lP ) mo . x += mm . x * 2.0 ; if ( ! lP ) mo . y += mm . y * 2.0 ; if ( lQ ) { if ( ! lO ) lS = kx ( texture2D ( u_color , mn . xy ) ) ; if ( ! lP ) lT = kx ( texture2D ( u_color , mo . xy ) ) ; if ( ! lO ) lS = lS - lY * 0.5 ; if ( ! lP ) lT = lT - lY * 0.5 ; lO = abs ( lS ) >= lR ; lP = abs ( lT ) >= lR ; if ( ! lO ) mn . x -= mm . x * 2.0 ; if ( ! lO ) mn . y -= mm . y * 2.0 ; lQ = ( ! lO ) || ( ! lP ) ; if ( ! lP ) mo . x += mm . x * 2.0 ; if ( ! lP ) mo . y += mm . y * 2.0 ; if ( lQ ) { if ( ! lO ) lS = kx ( texture2D ( u_color , mn . xy ) ) ; if ( ! lP ) lT = kx ( texture2D ( u_color , mo . xy ) ) ; if ( ! lO ) lS = lS - lY * 0.5 ; if ( ! lP ) lT = lT - lY * 0.5 ; lO = abs ( lS ) >= lR ; lP = abs ( lT ) >= lR ; if ( ! lO ) mn . x -= mm . x * 4.0 ; if ( ! lO ) mn . y -= mm . y * 4.0 ; lQ = ( ! lO ) || ( ! lP ) ; if ( ! lP ) mo . x += mm . x * 4.0 ; if ( ! lP ) mo . y += mm . y * 4.0 ; if ( lQ ) { if ( ! lO ) lS = kx ( texture2D ( u_color , mn . xy ) ) ; if ( ! lP ) lT = kx ( texture2D ( u_color , mo . xy ) ) ; if ( ! lO ) lS = lS - lY * 0.5 ; if ( ! lP ) lT = lT - lY * 0.5 ; lO = abs ( lS ) >= lR ; lP = abs ( lT ) >= lR ; if ( ! lO ) mn . x -= mm . x * 2.0 ; if ( ! lO ) mn . y -= mm . y * 2.0 ; if ( ! lP ) mo . x += mm . x * 2.0 ; if ( ! lP ) mo . y += mm . y * 2.0 ; } } } } ma = mk . x - mn . x ; lX = mo . x - mk . x ; if ( ! lM ) ma = mk . y - mn . y ; if ( ! lM ) lX = mo . y - mk . y ; lQ = ( lS < 0.0 ) != lN ; me = ( lX + ma ) ; lO = ( lT < 0.0 ) != lN ; l_ = 1.0 / me ; lP = ma < lX ; mc = min ( ma , lX ) ; lN = lP ? lQ : lO ; lV = md * md ; lU = ( mc * ( - l_ ) ) + 0.5 ; mb = lV * FXAA_QUALITY_SUBPIX ; lW = lN ? lU : 0.0 ; lY = max ( lW , mb ) ; if ( ! lM ) mk . x += lY * lZ ; if ( lM ) mk . y += lY * lZ ; return texture2D ( u_color , mk ) ; }".split(" ")},
{type:"define",name:"FXAA_CONSOLE_EDGE_SHARPNESS",b:["8.0"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD",b:["0.125"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD_MIN",b:["0.05"]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_PASS"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_LIGHT"],group:{type:"group",a:[{type:"textline",
b:"gl_FragColor = lL ( ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_QUALITY"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = mp ( ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 0.0 , 1.0 ) * texture2D ( u_color , a ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/bloom_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec4 kq ; vec2 kr , ks ; kr = vec2 ( 0.0 , 0.0 ) ; ks = u_texel_size ; kq = texture2D ( u_color , a ) ; gl_FragColor = kq * 0.0875447373698 ; kr += ks ; gl_FragColor += texture2D ( u_color , a + kr ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , a - kr ) * 0.0858112354248 ; kr += ks ; gl_FragColor += texture2D ( u_color , a + kr ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , a - kr ) * 0.0808139781061 ; kr += ks ; gl_FragColor += texture2D ( u_color , a + kr ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , a - kr ) * 0.0731235112908 ; kr += ks ; gl_FragColor += texture2D ( u_color , a + kr ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , a - kr ) * 0.0635705267419 ; kr += ks ; gl_FragColor += texture2D ( u_color , a + kr ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , a - kr ) * 0.0530985673112 ; kr += ks ; gl_FragColor += texture2D ( u_color , a + kr ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , a - kr ) * 0.0426125984122 ; kr += ks ; gl_FragColor += texture2D ( u_color , a + kr ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , a - kr ) * 0.0328565115809 ; kr += ks ; gl_FragColor += texture2D ( u_color , a + kr ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , a - kr ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * kq , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 a ; void main ( ) { vec4 kq , kr ; kq = texture2D ( u_main , a ) ; kr = texture2D ( u_bloom , a ) ; kq = kq ; kq += kr ; gl_FragColor = vec4 ( kq . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"PI_4",
b:["0.785398163"]},{type:"textline",b:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 a ; void main ( ) { float kq ; vec3 kr , ks ; vec4 kt ; kt = texture2D ( u_color , a ) ; kr = kt . rgb ; if ( u_brightness < 0.0 ) kr = kr * ( 1.0 + u_brightness ) ; else kr = kr + ( ( 1.0 - kr ) * u_brightness ) ; kr = ( kr - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; kr *= u_exposure ; ks = vec3 ( 0.299 , 0.587 , 0.114 ) ; kq = dot ( kr , ks ) ; kr = mix ( vec3 ( kq ) , kr , u_saturation ) ; gl_FragColor = vec4 ( kr , kt . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { gl_FragColor = cq ( clamp ( lQ ( u_depth , a , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};a["postprocessing/dof.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { float lR , lS ; vec4 lT , lU ; lT = texture2D ( u_sharp , a ) ; if ( u_dof_dist > 0.0 ) { lR = lQ ( u_depth , a , u_camera_range ) ; lR *= u_view_max_depth ; if ( lR < u_dof_dist ) lS = ( u_dof_dist - lR ) / u_dof_front ; else lS = ( lR - u_dof_dist ) / u_dof_rear ; lS = clamp ( lS , 0.0 , 1.0 ) ; lU = texture2D ( u_blurred , a ) ; gl_FragColor = mix ( lT , lU , lS ) ; } else gl_FragColor = lT ; }".split(" ")}]};
a["postprocessing/edge.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; uniform vec2 u_texel_size ; varying vec2 a ; float kv ( float kq , float kr , float ks ) { vec4 kt ; vec2 ku ; ku = a + vec2 ( kq , kr ) * u_texel_size ; kt = texture2D ( u_sampler , ku ) * ks ; return cu ( kt ) ; } void main ( ) { float kw ; kw = ( kv ( - 1.0 , - 1.0 , - 1.0 ) + kv ( 0.0 , - 1.0 , - 1.0 ) + kv ( 1.0 , - 1.0 , - 1.0 ) + kv ( - 1.0 , 0.0 , - 1.0 ) + kv ( 0.0 , 0.0 , 8.0 ) + kv ( 1.0 , 0.0 , - 1.0 ) + kv ( - 1.0 , 1.0 , - 1.0 ) + kv ( 0.0 , 1.0 , - 1.0 ) + kv ( 1.0 , 1.0 , - 1.0 ) ) ; kw *= 1000.0 ; gl_FragColor = vec4 ( kw , kw , kw , 1.0 ) ; }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"var",name:"STEPS_PER_PASS",b:["0.0"]},{type:"textline",b:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_camera_range",
";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"varying float lR ; varying vec2 lS ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying vec4 lT ; void main ( ) { vec4 lU ; float lV , lW , lX , lY , lZ ; vec2 l_ , ma , mb ; l_ = ( lT . xy - a ) ; lV = length ( l_ ) ; l_ = u_radial_blur_step * l_ / lV ; lW = lV / u_radial_blur_step ; l_ *= min ( lW , STEPS_PER_PASS ) / STEPS_PER_PASS ; lW = max ( lW , STEPS_PER_PASS ) ; ma = a ; lX = 0.0 ; for ( float mc = 0.0 ; mc < STEPS_PER_PASS ; mc += 1.0 ) { if ( mc <= lW ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:"lY = lQ ( u_input , ma , u_camera_range ) ; lX += max ( ( 1.0 - pow ( lV , 0.3 ) ) * step ( 0.9 , lY ) , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lU = texture2D ( u_input , ma ) ; lX += cu ( lU ) ;".split(" ")}]}}]},{type:"textline",b:"} ma += l_ ; }".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"mb = a + lS ; lZ = da ( vec2 ( 2.5 * ( mb . x ) , 2.5 * ( mb . y ) + 1.0 * u_time ) ) . x + 0.75 * da ( vec2 ( 5.0 * ( mb . x ) - 0.66 * u_time , 5.0 * ( mb . y ) + 0.66 * u_time ) ) . x + 0.5 * dx ( vec2 ( 7.5 * ( mb . x ) + 0.33 * u_time , 7.5 * ( mb . y ) - 0.33 * u_time ) ) ; lZ *= clamp ( 1.2 - sqrt ( 0.2 * lV ) , 0.0 , 1.0 ) * lR ; lX = max ( lZ , lX ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = cq ( lX / STEPS_PER_PASS ) ; }".split(" ")}]};a["postprocessing/god_rays.glslv"]={type:"group",
a:[{type:"include",file:"math.glslv"},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_camera_quat ; uniform float u_cam_water_depth ; varying float lR ; varying vec2 lS ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying vec4 lT ; void main ( ) { float kq , kr ; vec3 ks ; a = a_bb_vertex + 0.5 ; ks = normalize ( u_sun_direction ) ; lT = u_proj_matrix * u_view_matrix * vec4 ( ks , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { lR = 1.0 ; ks = vec3 ( 0.0 , 1.0 , 0.0 ) ; ks = j ( u_camera_quat , ks ) ; ks = normalize ( ks ) ; kq = dot ( ks , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; kr = atan ( ks . x , ks . z ) ; lS = vec2 ( - kr , acos ( kq ) ) ; } else { lR = 0.0 ; }".split(" ")}]}}]},{type:"textline",b:"lT . xy = 0.5 * ( lT . xy / lT . w + 1.0 ) ; lT += 99999.0 * step ( lT . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/god_rays_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; varying vec2 a ; void main ( ) { float kq ; vec3 kr ; vec4 ks ; ks = texture2D ( u_main , a ) ; kr = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; fV ( ks . rgb ) ; kq = cu ( texture2D ( u_god_rays , a ) ) ; kr = ks . rgb + u_god_rays_intensity * vec3 ( kq ) * kr ; fX ( kr ) ; gl_FragColor . rgb = kr ; gl_FragColor . a = ks . a ; }".split(" ")}]};
a["postprocessing/lanczos.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec4 kq ; kq = texture2D ( u_color , a ) * 0.38026 ; kq += texture2D ( u_color , a - u_texel_size ) * 0.27667 ; kq += texture2D ( u_color , a + u_texel_size ) * 0.27667 ; kq += texture2D ( u_color , a - 2.0 * u_texel_size ) * 0.08074 ; kq += texture2D ( u_color , a + 2.0 * u_texel_size ) * 0.08074 ; kq += texture2D ( u_color , a - 3.0 * u_texel_size ) * - 0.02612 ; kq += texture2D ( u_color , a + 3.0 * u_texel_size ) * - 0.02612 ; kq += texture2D ( u_color , a - 4.0 * u_texel_size ) * - 0.02143 ; kq += texture2D ( u_color , a + 4.0 * u_texel_size ) * - 0.02143 ; gl_FragColor = kq ; }".split(" ")}]};
a["postprocessing/luminance.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; varying vec2 a ; void main ( ) { float kq ; vec4 kr ; kr = texture2D ( u_input , a ) ; kq = dot ( kr . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( kq ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_av.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; void main ( ) { float kq , kr ; kr = 0.0 ; for ( float ks = 0.025 ; ks < 1.0 ; ks += 0.05 ) for ( float kt = 0.025 ; kt < 1.0 ; kt += 0.05 ) { kq = max ( texture2D ( u_input , vec2 ( ks , kt ) ) . r , 0.01 ) ; kr += log ( kq ) ; } kr = exp ( kr / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( kr ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 a ; varying float lU ; void main ( ) { vec4 lV ; float lW , lX ; lW = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; lX = texture2D ( u_luminance , a ) . r ; lV = texture2D ( u_main , a ) ; lX = lX / lW ; lW = u_bloom_edge_lum ; gl_FragColor = lV * max ( lX - lW , 0.0 ) * lU ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_position ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 a ; varying float lU ; const vec3 kq = vec3 ( 0.0 , 1.0 , 0.0 ) ; void ky ( in vec4 kr , in vec3 ks , out vec3 kt ) { float ku , kv , kw , kx ; ku = kr . w * ks . x + kr . y * ks . z - kr . z * ks . y ; kv = kr . w * ks . y + kr . z * ks . x - kr . x * ks . z ; kw = kr . w * ks . z + kr . x * ks . y - kr . y * ks . x ; kx = - kr . x * ks . x - kr . y * ks . y - kr . z * ks . z ; kt . x = ku * kr . w - kx * kr . x - kv * kr . z + kw * kr . y ; kt . y = kv * kr . w - kx * kr . y - kw * kr . x + ku * kr . z ; kt . z = kw * kr . w - kx * kr . z - ku * kr . y + kv * kr . x ; } void main ( ) { vec3 kz ; a = 2.0 * a_position ; ky ( u_camera_quat , kq , kz ) ; lU = dot ( - kz , u_sun_direction ) * u_bloom_key ; lU *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",a:[{type:"var",name:"BLUR_DECAY_THRESHOLD",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; varying vec2 a ; void main ( ) { vec4 kq , kr ; kq = texture2D ( u_mb_tex_curr , a ) ; kr = texture2D ( u_mb_tex_accum , a ) ; if ( length ( kq - kr ) > BLUR_DECAY_THRESHOLD ) { gl_FragColor = ( 1.0 - u_motion_blur_exp ) * kq + u_motion_blur_exp * kr ; } else { gl_FragColor = kq ; } }".split(" ")}]};
a["postprocessing/outline.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_outline_src ; uniform sampler2D u_outline_mask ; uniform sampler2D u_outline_mask_blurred ; uniform vec3 u_outline_color ; uniform float u_draw_outline ; varying vec2 a ; void main ( ) { vec3 kq ; float kr ; vec4 ks , kt , ku ; ks = texture2D ( u_outline_src , a ) ; gl_FragColor = ks ; if ( u_draw_outline != 0.0 ) { kt = texture2D ( u_outline_mask , a ) ; ku = texture2D ( u_outline_mask_blurred , a ) ; kr = ku . a - kt . a ; if ( kr != 0.0 ) { kr = smoothstep ( 0.0 , 1.0 , ku . a ) ; if ( kt . a == 0.0 ) { kq = u_outline_color ; fX ( kq ) ; ku = vec4 ( clamp ( kq , 0.0 , 1.0 ) , kr ) ; gl_FragColor = mix ( ks , ku , kr ) ; } } } }".split(" ")}]};
a["postprocessing/postprocessing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",b:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",b:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",b:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",b:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",b:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",b:["6"]},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec2 kq , kr ; vec4 ks ;".split(" ")},
{type:"condition",a:[{type:"if",c:["POST_EFFECT","==","POST_EFFECT_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","==","POST_EFFECT_GRAYSCALE"],group:{type:"group",a:[{type:"textline",b:"ks = texture2D ( u_color , a ) ; gl_FragColor . rgb = vec3 ( ( ks . r + ks . g + ks . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_BLUR || POST_EFFECT == POST_EFFECT_Y_BLUR".split(" "),
group:{type:"group",a:[{type:"textline",b:"kq = vec2 ( 0.0 , 0.0 ) ; kr = u_texel_size ; ks = texture2D ( u_color , a ) ; gl_FragColor = ks * 0.2270270270 ; kq += kr ; ks = texture2D ( u_color , a + kq ) ; gl_FragColor += ks * 0.1945945946 ; ks = texture2D ( u_color , a - kq ) ; gl_FragColor += ks * 0.1945945946 ; kq += kr ; ks = texture2D ( u_color , a + kq ) ; gl_FragColor += ks * 0.1216216216 ; ks = texture2D ( u_color , a - kq ) ; gl_FragColor += ks * 0.1216216216 ; kq += kr ; ks = texture2D ( u_color , a + kq ) ; gl_FragColor += ks * 0.0540540541 ; ks = texture2D ( u_color , a - kq ) ; gl_FragColor += ks * 0.0540540541 ; kq += kr ; ks = texture2D ( u_color , a + kq ) ; gl_FragColor += ks * 0.0162162162 ; ks = texture2D ( u_color , a - kq ) ; gl_FragColor += ks * 0.0162162162 ;".split(" ")}]}},
{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_EXTEND || POST_EFFECT == POST_EFFECT_Y_EXTEND".split(" "),group:{type:"group",a:[{type:"textline",b:"kr = u_texel_size ; ks = texture2D ( u_color , a ) ; gl_FragColor = ks ; if ( ks . a == 0.0 ) { ks = texture2D ( u_color , a + kr ) ; if ( ks . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , ks . a ) ; else { ks = texture2D ( u_color , a - kr ) ; if ( ks . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , ks . a ) ; } }".split(" ")}]}}]},{type:"textline",
b:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_position ; varying vec2 a ; void main ( ) { a = 2.0 * a_position ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",b:["1"]},{type:"define",name:"SMAA_EDGE_DETECTION",
b:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:["uniform","sampler2D","u_color",";"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION","&&","SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},{type:"textline",b:"uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","lV",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 lW ; varying vec4 lX ; varying vec4 lY ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","lZ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",
a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",b:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",a:[{type:"define",name:"SMAA_CORNER_ROUNDING",
b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",a:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",b:["0.01"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_SCALE",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",b:["0.4"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",
a:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",b:["30.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",b:["16"]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",b:["20"]},{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",b:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",b:["(","1.0","/","7.0",
")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",b:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",b:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",b:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec3 me ( vec2 l_ , sampler2D ma ) { float mb , mc , md ; mb = texture2D ( ma , l_ ) . r ; mc = texture2D ( ma , lW . xy ) . r ; md = texture2D ( ma , lW . zw ) . r ; return vec3 ( mb , mc , md ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 mj ( vec2 mf , sampler2D mg ) { vec2 mh ; vec3 mi ; mi = me ( mf , mg ) ; mh = abs ( mi . xx - mi . yz ) ; mh = step ( SMAA_PREDICATION_THRESHOLD , mh ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * mh ) ; }".split(" ")}]}}]},{type:"textline",b:"void mn ( bvec2 mk , inout vec2 ml , vec2 mm ) { if ( mk . x ) ml . x = mm . x ; if ( mk . y ) ml . y = mm . y ; } void mn ( bvec4 mo , inout vec4 mp , vec4 mq ) { mn ( mo . xy , mp . xy , mq . xy ) ; mn ( mo . zw , mp . zw , mq . zw ) ; } vec2 ms ( vec2 mr ) { return sign ( mr ) * floor ( abs ( mr ) + .5 ) ; } vec4 ms ( vec4 mt ) { return sign ( mt ) * floor ( abs ( mt ) + .5 ) ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 mG ( vec2 mu , sampler2D mv".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","mw"]}]}}]},{type:"textline",b:") { vec4 mx ; float my , mz , mA , mB , mC ; vec3 mD ; vec2 mE , mF ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:"mE = mj ( mu , mw ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mE = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",b:"mD = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; my = dot ( texture2D ( mv , mu ) . rgb , mD ) ; mz = dot ( texture2D ( mv , lW . xy ) . rgb , mD ) ; mA = dot ( texture2D ( mv , lW . zw ) . rgb , mD ) ; mx . xy = abs ( my - vec2 ( mz , mA ) ) ; mE = step ( mE , mx . xy ) ; if ( dot ( mE , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; mB = dot ( texture2D ( mv , lX . xy ) . rgb , mD ) ; mC = dot ( texture2D ( mv , lX . zw ) . rgb , mD ) ; mx . zw = abs ( my - vec2 ( mB , mC ) ) ; mF = max ( mx . xy , mx . zw ) ; my = dot ( texture2D ( mv , lY . xy ) . rgb , mD ) ; mB = dot ( texture2D ( mv , lY . zw ) . rgb , mD ) ; mx . zw = abs ( vec2 ( mz , mA ) - vec2 ( my , mB ) ) ; mF = max ( mF . xy , mx . zw ) ; mC = max ( mF . x , mF . y ) ; mE . xy *= step ( mC , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * mx . xy ) ; return mE ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 mI ( vec2 mH ) { mH . r = mH . r * abs ( 5.0 * mH . r - 5.0 * 0.75 ) ; return ms ( mH ) ; } vec4 mI ( vec4 mJ ) { mJ . rb = mJ . rb * abs ( 5.0 * mJ . rb - 5.0 * 0.75 ) ; return ms ( mJ ) ; } vec2 mR ( sampler2D mK , vec2 mL , vec2 mM , out vec2 mN ) { vec3 mO ; vec4 mP ; mP = vec4 ( mL , - 1.0 , 1.0 ) ; mO = vec3 ( u_texel_size , 1.0 ) ; for ( int mQ = 0 ; mQ < SMAA_MAX_SEARCH_STEPS_DIAG ; mQ ++ ) { if ( mP . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && mP . w > 0.9 ) { mP . xyz += mO * vec3 ( mM , 1.0 ) ; mN = texture2D ( mK , mP . xy , 0.0 ) . rg ; mP . w = dot ( mN , vec2 ( 0.5 , 0.5 ) ) ; } } return mP . zw ; } vec2 mZ ( sampler2D mS , vec2 mT , vec2 mU , out vec2 mV ) { vec3 mW ; vec4 mX ; mX = vec4 ( mT , - 1.0 , 1.0 ) ; mX . x += 0.25 * u_texel_size . x ; mW = vec3 ( u_texel_size , 1.0 ) ; for ( int mY = 0 ; mY < SMAA_MAX_SEARCH_STEPS_DIAG ; mY ++ ) { if ( mX . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && mX . w > 0.9 ) { mX . xyz = mW * vec3 ( mU , 1.0 ) + mX . xyz ; mV = texture2D ( mS , mX . xy , 0.0 ) . rg ; mV = mI ( mV ) ; mX . w = dot ( mV , vec2 ( 0.5 , 0.5 ) ) ; } } return mX . zw ; } vec2 ne ( sampler2D m_ , vec2 na , vec2 nb , float nc ) { vec2 nd ; nd = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * nb + na ; nd = SMAA_AREATEX_PIXEL_SIZE * nd + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; nd . x += 0.5 ; nd . y += SMAA_AREATEX_SUBTEX_SIZE * nc ; return texture2D ( m_ , nd , 0.0 ) . rg ; } vec2 nq ( sampler2D nf , sampler2D ng , vec2 nh , vec2 ni , vec4 nj ) { vec4 nk , nl , nm ; vec2 nn , no , np ; nn = vec2 ( 0.0 , 0.0 ) ; if ( ni . r > 0.0 ) { nk . xz = mR ( nf , nh , vec2 ( - 1.0 , 1.0 ) , no ) ; nk . x += float ( no . y > 0.9 ) ; } else nk . xz = vec2 ( 0.0 , 0.0 ) ; nk . yw = mR ( nf , nh , vec2 ( 1.0 , - 1.0 ) , no ) ; if ( nk . x + nk . y > 2.0 ) { nl = vec4 ( - nk . x + 0.25 , nk . x , nk . y , - nk . y - 0.25 ) * u_texel_size . xyxy + nh . xyxy ; nm . xy = texture2D ( nf , nl . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; nm . zw = texture2D ( nf , nl . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; nm . yxwz = mI ( nm . xyzw ) ; np = vec2 ( 2.0 , 2.0 ) * nm . xz + nm . yw ; mn ( bvec2 ( step ( 0.9 , nk . zw ) ) , np , vec2 ( 0.0 , 0.0 ) ) ; nn += ne ( ng , nk . xy , np , nj . z ) ; } nk . xz = mZ ( nf , nh , vec2 ( - 1 , - 1 ) , no ) ; if ( texture2D ( nf , nh + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { nk . yw = mZ ( nf , nh , vec2 ( 1 , 1 ) , no ) ; nk . y += float ( no . y > 0.9 ) ; } else nk . yw = vec2 ( 0.0 , 0.0 ) ; if ( nk . x + nk . y > 2.0 ) { nl = vec4 ( - nk . x , - nk . x , nk . y , nk . y ) * u_texel_size . xyxy + nh . xyxy ; nm . x = texture2D ( nf , nl . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; nm . y = texture2D ( nf , nl . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; nm . zw = texture2D ( nf , nl . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; np = vec2 ( 2.0 , 2.0 ) * nm . xz + nm . yw ; mn ( bvec2 ( step ( 0.9 , nk . zw ) ) , np , vec2 ( 0 , 0 ) ) ; nn += ne ( ng , nk . xy , np , nj . w ) . gr ; } return nn ; }".split(" ")}]}}]},
{type:"textline",b:"float nw ( sampler2D nr , vec2 ns , float nt ) { vec2 nu , nv ; nu = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; nv = SMAA_SEARCHTEX_SIZE * vec2 ( nt , 1.0 ) ; nu += vec2 ( - 1.0 , 1.0 ) ; nv += vec2 ( 0.5 , - 0.5 ) ; nu *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; nv *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( nr , nu * ns + nv , 0.0 ) . r ; } float nE ( sampler2D nx , sampler2D ny , vec2 nz , float nA ) { float nB ; vec2 nC ; nC = vec2 ( 0.0 , 1.0 ) ; for ( int nD = 0 ; nD < SMAA_MAX_SEARCH_STEPS ; nD ++ ) { if ( nz . x > nA && nC . g > 0.8281 && nC . r == 0.0 ) { nC = texture2D ( nx , nz , 0.0 ) . rg ; nz = - vec2 ( 2.0 , 0.0 ) * u_texel_size + nz ; } } nB = - ( 255.0 / 127.0 ) * nw ( ny , nC , 0.0 ) + 3.25 ; return u_texel_size . x * nB + nz . x ; } float nM ( sampler2D nF , sampler2D nG , vec2 nH , float nI ) { float nJ ; vec2 nK ; nK = vec2 ( 0.0 , 1.0 ) ; for ( int nL = 0 ; nL < SMAA_MAX_SEARCH_STEPS ; nL ++ ) { if ( nH . x < nI && nK . g > 0.8281 && nK . r == 0.0 ) { nK = texture2D ( nF , nH , 0.0 ) . rg ; nH = vec2 ( 2.0 , 0.0 ) * u_texel_size + nH ; } } nJ = - ( 255.0 / 127.0 ) * nw ( nG , nK , 0.5 ) + 3.25 ; return - u_texel_size . x * nJ + nH . x ; } float nU ( sampler2D nN , sampler2D nO , vec2 nP , float nQ ) { float nR ; vec2 nS ; nS = vec2 ( 1.0 , 0.0 ) ; for ( int nT = 0 ; nT < SMAA_MAX_SEARCH_STEPS ; nT ++ ) { if ( nP . y > nQ && nS . r > 0.8281 && nS . g == 0.0 ) { nS = texture2D ( nN , nP , 0.0 ) . rg ; nP = - vec2 ( 0.0 , 2.0 ) * u_texel_size + nP ; } } nR = - ( 255.0 / 127.0 ) * nw ( nO , nS . gr , 0.0 ) + 3.25 ; return u_texel_size . y * nR + nP . y ; } float ob ( sampler2D nV , sampler2D nW , vec2 nX , float nY ) { float nZ ; vec2 n_ ; n_ = vec2 ( 1.0 , 0.0 ) ; for ( int oa = 0 ; oa < SMAA_MAX_SEARCH_STEPS ; oa ++ ) { if ( nX . y < nY && n_ . r > 0.8281 && n_ . g == 0.0 ) { n_ = texture2D ( nV , nX , 0.0 ) . rg ; nX = vec2 ( 0.0 , 2.0 ) * u_texel_size + nX ; } } nZ = - ( 255.0 / 127.0 ) * nw ( nW , n_ . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * nZ + nX . y ; } vec2 oi ( sampler2D oc , vec2 od , float oe , float of , float og ) { vec2 oh ; oh = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * ms ( 4.0 * vec2 ( oe , of ) ) + od ; oh = SMAA_AREATEX_PIXEL_SIZE * oh + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; oh . y = SMAA_AREATEX_SUBTEX_SIZE * og + oh . y ; return texture2D ( oc , oh , 0.0 ) . rg ; } void op ( sampler2D oj , inout vec2 ok , vec4 ol , vec2 om ) { vec2 on , oo ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"on = step ( om . xy , om . yx ) ; oo = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * on ; oo /= on . x + on . y ; on = vec2 ( 1.0 , 1.0 ) ; on . x -= oo . x * texture2D ( oj , ol . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; on . x -= oo . y * texture2D ( oj , ol . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; on . y -= oo . x * texture2D ( oj , ol . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; on . y -= oo . y * texture2D ( oj , ol . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; ok *= clamp ( on , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"} void ow ( sampler2D oq , inout vec2 or , vec4 os , vec2 ot ) { vec2 ou , ov ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"ou = step ( ot . xy , ot . yx ) ; ov = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * ou ; ov /= ou . x + ou . y ; ou = vec2 ( 1.0 , 1.0 ) ; ou . x -= ov . x * texture2D ( oq , os . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; ou . x -= ov . y * texture2D ( oq , os . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; ou . y -= ov . x * texture2D ( oq , os . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; ou . y -= ov . y * texture2D ( oq , os . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; or *= clamp ( ou , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 oK ( vec2 ox , vec2 oy , sampler2D oz , sampler2D oA , sampler2D oB , vec4 oC ) { float oD , oE ; vec3 oF ; vec2 oG , oH , oI ; vec4 oJ ; oJ = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; oG = texture2D ( oz , ox ) . rg ; if ( oG . g > 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",
b:"oJ . rg = nq ( oz , oA , ox , oG , oC ) ; if ( oJ . r == - oJ . g ) {".split(" ")}]}}]},{type:"textline",b:"; oF . x = nE ( oz , oB , lW . xy , lY . x ) ; oF . y = lX . y ; oH . x = oF . x ; oD = texture2D ( oz , oF . xy , 0.0 ) . r ; oF . z = nM ( oz , oB , lW . zw , lY . y ) ; oH . y = oF . z ; oH = abs ( ms ( oH / u_texel_size . xx - oy . xx ) ) ; oI = sqrt ( oH ) ; oE = texture2D ( oz , oF . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; oJ . rg = oi ( oA , oI , oD , oE , oC . y ) ; oF . y = ox . y ; op ( oz , oJ . rg , oF . xyzy , oH ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"} else oG . r = 0.0 ;".split(" ")}]}}]},{type:"textline",b:"} if ( oG . r > 0.0 ) { ; oF . y = nU ( oz , oB , lX . xy , lY . z ) ; oF . x = lW . x ; oI . x = oF . y ; oD = texture2D ( oz , oF . xy , 0.0 ) . g ; oF . z = ob ( oz , oB , lX . zw , lY . w ) ; oI . y = oF . z ; oI = abs ( ms ( oI / u_texel_size . yy - oy . yy ) ) ; oH = sqrt ( oI ) ; oE = texture2D ( oz , oF . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; oJ . ba = oi ( oA , oH , oD , oE , oC . x ) ; oF . x = ox . x ; ow ( oz , oJ . ba , oF . xyxz , oI ) ; } return oJ ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 oW ( vec2 oL , sampler2D oM , sampler2D oN".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","oO"]}]}}]},{type:"textline",b:") { bool oP ; vec2 oQ , oR , oS ; vec4 oT , oU , oV ; oT . x = texture2D ( oN , lV . xy ) . a ; oT . y = texture2D ( oN , lV . zw ) . g ; oT . wz = texture2D ( oN , oL ) . xz ; if ( dot ( oT , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { oU = texture2D ( oM , oL , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"oV = texture2D ( oO , a ) ; oQ = 2.0 * cC ( oV ) - 1.0 ; oU . a = sqrt ( 2.0 * length ( oQ ) ) ;".split(" ")}]}}]},{type:"textline",b:"return oU ; } else { oP = max ( oT . x , oT . z ) > max ( oT . y , oT . w ) ; oV = vec4 ( 0.0 , oT . y , 0.0 , oT . w ) ; oQ = oT . yw ; mn ( bvec4 ( oP , oP , oP , oP ) , oV , vec4 ( oT . x , 0.0 , oT . z , 0.0 ) ) ; mn ( bvec2 ( oP , oP ) , oQ , oT . xz ) ; oQ /= dot ( oQ , vec2 ( 1.0 , 1.0 ) ) ; oU = oV * vec4 ( u_texel_size , - u_texel_size ) + oL . xyxy ; oT = oQ . x * texture2D ( oM , oU . xy , 0.0 ) ; oT += oQ . y * texture2D ( oM , oU . zw , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"oV = texture2D ( oO , oU . xy ) ; oR = 2.0 * cC ( oV ) - 1.0 ; oS = oQ . x * oR ; oV = texture2D ( oO , oU . zw ) ; oR = 2.0 * cC ( oV ) - 1.0 ; oS += oQ . y * oR ; oT . a = sqrt ( 2.0 * length ( oS ) ) ;".split(" ")}]}}]},{type:"textline",b:["return","oT",";","}","}"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 pf ( vec2 oX , sampler2D oY , sampler2D oZ".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","o_"]}]}}]},{type:"textline",b:") { float pa ; vec2 pb ; vec4 pc , pd , pe ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"pc = texture2D ( o_ , a ) ; pb = 2.0 * cC ( pc ) - 1.0 ; pc = texture2D ( oY , oX ) ; pd = texture2D ( oZ , oX - pb ) ; pa = abs ( pc . a * pc . a - pd . a * pd . a ) / 2.0 ; pa = 0.5 * clamp ( 1.0 - sqrt ( pa ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; pe = mix ( pc , pd , pa ) ; pe . a = 1.0 ; return pe ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"pc = texture2D ( oY , oX ) ; pd = texture2D ( oZ , oX ) ; return mix ( pc , pd , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:"void main ( ) { vec4 pg ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"pg = vec4 ( mG ( a , u_color".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:[",","u_predication_tex"]}]}}]},{type:"textline",b:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"pg = oK ( a , lZ , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"pg = oW ( a , u_color , u_blend".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],
group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"pg = vec4 ( pf ( a , u_color , u_color_prev".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"pg = texture2D ( u_color , a ) ;".split(" ")}]}}]},
{type:"textline",b:["gl_FragColor","=","pg",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",a:[{type:"define",name:"SMAA_EDGE_DETECTION",b:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:"attribute vec2 a_position ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","lV",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 lW ; varying vec4 lX ; varying vec4 lY ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","lZ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],
group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["4"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["8"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["32"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"void kr ( vec2 kq ) { lW = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + kq . xyxy ; lX = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + kq . xyxy ; lY = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + kq . xyxy ; }".split(" ")}]}},
{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"void ku ( vec2 ks , out vec2 kt ) { kt = ks / u_texel_size ; lW = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + ks . xyxy ; lX = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + ks . xyxy ; lY = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( lW . xz , lX . yw ) ; }".split(" ")}]}},{type:"elif",c:["SMAA_PASS",
"==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"void kw ( vec2 kv ) { lV = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + kv . xyxy ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { a = 2.0 * a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:["kr","(","a",")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",
b:"ku ( a , lZ ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["kw","(","a",")",";"]}]}}]},{type:"textline",b:"gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"define",name:"SSAO_QUALITY_8",b:["1"]},
{type:"define",name:"SSAO_QUALITY_16",b:["2"]},{type:"define",name:"SSAO_QUALITY_24",b:["3"]},{type:"define",name:"SSAO_QUALITY_32",b:["4"]},{type:"textline",b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform sampler2D u_ssao_special_tex ; uniform vec2 u_camera_range ; uniform vec2 u_texel_size ; varying vec2 a ; uniform float u_ssao_radius_increase ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; float ma ( in vec2 l_ ) { return lQ ( u_depth , l_ , u_camera_range ) ; } void main ( ) { vec3 mb , mc , md ; float me , mf , mg , mh , mi , mj , mk ; me = texture2D ( u_color , a ) . r ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_WHITE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( me , 1.0 , 0.0 , 1.0 ) ; return ;".split(" ")}]}}]},{type:"textline",b:"mb = normalize ( 2.0 * texture2D ( u_ssao_special_tex , a * 0.25 / u_texel_size ) . rgb - 1.0 ) ; mf = ma ( a ) ; mg = mf * ( u_camera_range . y - u_camera_range . x ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_8"],group:{type:"group",a:[{type:"textline",b:"const float ml = 8.0 ; const int mm = 1 ;".split(" ")}]}},
{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:"const float ml = 16.0 ; const int mm = 2 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_24"],group:{type:"group",a:[{type:"textline",b:"const float ml = 24.0 ; const int mm = 3 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_32"],group:{type:"group",a:[{type:"textline",b:"const float ml = 32.0 ; const int mm = 4 ;".split(" ")}]}}]},{type:"textline",b:"mh = u_ssao_radius_increase * 0.001 ; const float mn = 1.0 + 2.4 / ml ; mi = 0.0 ; for ( int mo = 0 ; mo < mm ; mo ++ ) for ( int mp = - 1 ; mp <= 1 ; mp += 2 ) for ( int mq = - 1 ; mq <= 1 ; mq += 2 ) for ( int mr = - 1 ; mr <= 1 ; mr += 2 ) { mc = reflect ( normalize ( vec3 ( mp , mq , mr ) ) , mb ) * ( mh *= mn ) ; md = vec3 ( a , mg ) ; md += vec3 ( mc . xy , mc . z * mg * 2.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"md . z -= 1.4 * ( md . z - mg ) * step ( mg , md . z ) ;".split(" ")}]}}]},{type:"textline",b:"mj = ma ( md . xy ) * ( u_camera_range . y - u_camera_range . x ) ; mk = clamp ( ( mg - mj ) / mj , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"mi += mix ( 1.0 , mk , step ( mj , md . z ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"mi += mix ( step ( md . z , mj ) , 0.5 , mk ) ;".split(" ")}]}}]},{type:"textline",b:"} mi = mi / ml ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"mi = clamp ( mi * mi + 0.6 * mi , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mi = clamp ( mi * mi + mi , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"mf = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * mf ) ; mi = mix ( 1.0 , mi , mf ) ; gl_FragColor = vec4 ( me , mi , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/ssao_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"include",file:"depth_fetch.glslf"}]}}]},{type:"textline",b:"uniform sampler2D u_ssao_mask ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; uniform float u_ssao_blur_discard_value ; float ma ( in vec2 l_ ) { return lQ ( u_depth , l_ , u_camera_range ) ; }".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { vec2 mb , mc ; float md , me , mf , mg , mh , mi , mj ; md = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"me = ma ( a ) ; mf = 0.0 ; mg = u_ssao_blur_discard_value * 100.0 ;".split(" ")}]}}]},{type:"textline",b:"mb = vec2 ( - 2.0 ) ; for ( int mk = 0 ; mk < 4 ; ++ mk ) { for ( int ml = 0 ; ml < 4 ; ++ ml ) { mc = ( mb + vec2 ( float ( mk ) , float ( ml ) ) ) * u_texel_size ; mh = texture2D ( u_ssao_mask , a + mc ) . g ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"mi = ma ( a + mc ) ; mj = 1.0 - clamp ( abs ( mi - me ) * mg , 0.0 , 1.0 ) ; md += mh * mj ; mf += mj ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["md","+=","mh",";"]}]}}]},{type:"textline",b:["}","}"]},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , a ) . r , md / mf , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , a ) . r , md / 16.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/velocity.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 a ; void main ( ) { vec2 kq ; vec4 kr , ks ; float kt ; kt = texture2D ( u_depth , a ) . x ; kr = vec4 ( a * 2.0 - 1.0 , 2.0 * kt - 1.0 , 1.0 ) ; ks = u_view_proj_inverse * kr ; ks = ks / ks . w ; ks = u_view_proj_prev * ks ; ks /= ks . w ; kq = ( kr . xy - ks . xy ) / 4.0 + 0.5 ; kq = clamp ( kq , 0.0 , 1.0 ) ; gl_FragColor = cq ( kq ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","float",";"]}]};a["include/math.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"float b = 0.0 ; float c = 1.0 ; struct d { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool g ( vec3 e , vec3 f ) { return any ( lessThan ( abs ( e - f ) , vec3 ( EPSILON ) ) ) ; } vec3 j ( in vec4 h , in vec3 i ) { return i + 2.0 * cross ( h . xyz , cross ( h . xyz , i ) + h . w * i ) ; } vec4 l ( in vec4 k ) { return vec4 ( - k . xyz , k . w ) / dot ( k , k ) ; } vec3 q ( vec4 m , vec4 n , vec4 o ) { vec3 p ; p = o . xyz * m . w ; p = j ( n , p ) ; p += m . xyz * o . w ; return p ; } vec3 w ( vec4 r , vec4 s , vec4 t ) { vec4 u ; vec3 v ; v = t . xyz - r . xyz * t . w ; u = l ( s ) ; v = j ( u , v ) ; v /= r . w ; return v ; } mat4 x ( ) { return mat4 ( c , b , b , b , b , c , b , b , b , b , c , b , b , b , b , c ) ; } mat4 z ( float y ) { return mat4 ( c , b , b , b , b , cos ( y ) , sin ( y ) , b , b , - sin ( y ) , cos ( y ) , b , b , b , b , c ) ; } mat4 B ( float A ) { return mat4 ( cos ( A ) , b , - sin ( A ) , b , b , c , b , b , sin ( A ) , b , cos ( A ) , b , b , b , b , c ) ; } mat4 D ( float C ) { return mat4 ( cos ( C ) , sin ( C ) , b , b , - sin ( C ) , cos ( C ) , b , b , b , b , c , b , b , b , b , c ) ; } d F ( in d E ) { return d ( E . a , E . b , normalize ( E . c ) , normalize ( E . d ) , normalize ( E . e ) , E . f ) ; }".split(" ")}]};
a["include/to_world.glslv"]={type:"group",a:[{type:"define",name:"SKIN_SLERP",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",b:["(","M_PI","/","4.0",")"]},{type:"textline",b:"const vec3 G = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"BILLBOARD_SPHERICAL || ! BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"mat4 N ( vec3 H , mat4 I ) { vec3 J , L , M ; J = vec3 ( I [ 0 ] [ 0 ] , I [ 1 ] [ 0 ] , I [ 2 ] [ 0 ] ) ; L = vec3 ( I [ 0 ] [ 1 ] , I [ 1 ] [ 1 ] , I [ 2 ] [ 1 ] ) ; M = vec3 ( I [ 0 ] [ 2 ] , I [ 1 ] [ 2 ] , I [ 2 ] [ 2 ] ) ; L = cross ( M , J ) ; return mat4 ( vec4 ( J , 0.0 ) , vec4 ( L , 0.0 ) , vec4 ( M , 0.0 ) , vec4 ( H , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 T ( vec3 O , vec3 P ) { vec3 Q , R , S ; Q = O - P ; Q . y = 0.0 ; Q = normalize ( Q ) ; R = normalize ( cross ( G , Q ) ) ; S = normalize ( cross ( Q , R ) ) ; return mat4 ( vec4 ( R , 0.0 ) , vec4 ( S , 0.0 ) , vec4 ( Q , 0.0 ) , vec4 ( P , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"mat4 aa ( in vec3 U , float V , float W , float X , vec3 Y ) { float Z , _ ; Z = fract ( length ( Y ) / 0.17 ) ; _ = X + Z / 10.0 ; Z = Z ; if ( X != 0.0 ) Z /= X ; U *= 1.0 + 0.5 * sin ( V ) ; _ = length ( U ) * W * sin ( 2.0 * 3.14 * V * _ + Z ) ; return D ( _ ) ; }".split(" ")}]}}]},
{type:"textline",b:"mat4 ai ( in vec3 ab , in vec3 ac , in mat4 ad ) { vec3 ae ; float af , ag ; mat4 ah ;".split(" ")},{type:"condition",a:[{type:"if",c:"BILLBOARD_SPHERICAL || ! BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"ah = N ( ac , ad ) ;".split(" ")}]}},{type:"elif",c:["BILLBOARD_RANDOM"],group:{type:"group",a:[{type:"textline",b:"af = fract ( ( ac . x * 1.43 + ac . y * 0.123 + ac . z * 6.1 ) ) ; af = 2.0 * M_PI * af ; ae = normalize ( vec3 ( ad [ 0 ] [ 2 ] , 0.0 , ad [ 2 ] [ 2 ] ) ) ; ag = acos ( ae [ 2 ] ) ; if ( ae [ 0 ] < 0.0 ) ag = 2.0 * M_PI - ag ; ag = ag - af ; if ( ag < 0.0 ) ag = 2.0 * M_PI + ag ; af = af ; if ( ag <= MAX_BILLBOARD_ANGLE ) af += ag ; else if ( ag <= M_PI - MAX_BILLBOARD_ANGLE ) af += MAX_BILLBOARD_ANGLE * ( 2.0 * ag - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( ag <= M_PI + MAX_BILLBOARD_ANGLE ) af += ag - M_PI ; else if ( ag <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) af += MAX_BILLBOARD_ANGLE * ( 2.0 * ag - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else af += ag - 2.0 * M_PI ; ah = B ( af ) ; ah [ 3 ] = vec4 ( ac , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"ah = T ( ab , ac ) ;".split(" ")}]}}]},{type:"textline",b:["return","ah",";","}"]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"mat4 ao ( in vec3 aj , in vec3 ak , in mat4 al , mat4 am ) { mat4 an ; an = ai ( aj , ak , al ) ; am [ 3 ] = vec4 ( 0.0 , 0.0 , 0.0 , 1.0 ) ; an = an * am ; return an ; }".split(" ")}]}}]},{type:"textline",b:"d av ( in vec3 ap , in vec3 aq , in vec3 ar , in vec3 as , in vec3 at , in mat4 au ) { ap = ( au * vec4 ( ap , 1.0 ) ) . xyz ; aq = ( au * vec4 ( aq , 1.0 ) ) . xyz ; ar = ( au * vec4 ( ar , 0.0 ) ) . xyz ; as = ( au * vec4 ( as , 0.0 ) ) . xyz ; at = ( au * vec4 ( at , 0.0 ) ) . xyz ; return F ( d ( ap , aq , ar , as , at , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};
a["include/scale_texcoord.glslv"]={type:"group",a:[{type:"textline",b:"vec2 ay ( vec2 aw , vec3 ax ) { return ( aw + 0.5 ) * ax . xy - 0.5 ; }".split(" ")}]};a["include/skin.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 aF ( in vec4 az , in vec4 aA , in float aB ) { float aC , aD , aE ; aC = az [ 0 ] * aA [ 0 ] + az [ 1 ] * aA [ 1 ] + az [ 2 ] * aA [ 2 ] + az [ 3 ] * aA [ 3 ] ; if ( aC < 0.0 ) { aA *= - 1.0 ; aC = - aC ; } if ( abs ( aC ) >= 1.0 ) return az ; aD = acos ( aC ) ; aC = sqrt ( 1.0 - aC * aC ) ; if ( abs ( aC ) < 0.001 ) return vec4 ( az * 0.5 + aA * 0.5 ) ; aE = sin ( ( 1.0 - aB ) * aD ) / aC ; aD = sin ( aB * aD ) / aC ; return az * aE + aA * aD ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec3 aR ( in vec3 aG , in vec4 aH , in vec4 aI , in vec4 aJ , in vec4 aK , in float aL ) { vec3 aM , aN , aO ; vec4 aP , aQ ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"aP = aF ( aH , aI , aL ) ; aQ = mix ( aJ , aK , aL ) ; aM = j ( aP , aG ) ; aM = aM * aQ . w + aQ . xyz ; return aM ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"aN = q ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( aG , 1.0 ) ) ; aO = j ( aH , aN ) ; aN = j ( aI , aN ) ; aO = aO * aJ . w + aJ . xyz ; aN = aN * aK . w + aK . xyz ; aM = mix ( aO , aN , aL ) ; return w ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( aM , 1.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} vec3 a_ ( in vec3 aS , in vec4 aT , in vec4 aU , in float aV ) { vec4 aW ; vec3 aX , aY , aZ ; aX = q ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( aS , 0.0 ) ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"aW = aF ( aT , aU , aV ) ; aY = j ( aW , aX ) ; return w ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( aY , 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"aZ = j ( aT , aX ) ; aX = j ( aU , aX ) ; aY = mix ( aZ , aX , aV ) ; return q ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( aY , 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aR ( in vec3 ba , in vec4 bb , in vec4 bc ) { vec3 bd ; bd = q ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( ba , 1.0 ) ) ; bd = j ( bb , bd ) ; bd = bd * bc . w + bc . xyz ; return w ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( bd , 1.0 ) ) ; } vec3 a_ ( in vec3 be , in vec4 bf ) { vec3 bg ; bg = q ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( be , 0.0 ) ) ; bg = j ( bf , bg ) ; return w ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( bg , 0.0 ) ) ; }".split(" ")}]}}]},
{type:"textline",b:"void bv ( inout vec3 bh , inout vec3 bi , inout vec3 bj , inout vec3 bk ) { int bl , bm ; vec4 bn ; vec3 bo , bp , bq , br ; float bs , bt ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:["bs","=","u_frame_factor",";"]}]}}]},{type:"textline",b:"if ( a_influence . y > 0.0 ) { bo = vec3 ( 0.0 , 0.0 , 0.0 ) ; bp = vec3 ( 0.0 , 0.0 , 0.0 ) ; bq = vec3 ( 0.0 , 0.0 , 0.0 ) ; br = vec3 ( 0.0 , 0.0 , 0.0 ) ; bn = a_influence ; for ( int bu = 0 ; bu < 4 ; bu ++ ) { bl = int ( bn [ bu ] ) ; bt = fract ( bn [ bu ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"bo += bt * aR ( bh , u_quatsb [ bl ] , u_quatsa [ bl ] , u_transb [ bl ] , u_transa [ bl ] , bs ) ; bp += bt * a_ ( bi , u_quatsb [ bl ] , u_quatsa [ bl ] , bs ) ; bq += bt * a_ ( bj , u_quatsb [ bl ] , u_quatsa [ bl ] , bs ) ; br += bt * a_ ( bk , u_quatsb [ bl ] , u_quatsa [ bl ] , bs ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bo += bt * aR ( bh , u_quatsb [ bl ] , u_transb [ bl ] ) ; bp += bt * a_ ( bi , u_quatsb [ bl ] ) ; bq += bt * a_ ( bj , u_quatsb [ bl ] ) ; br += bt * a_ ( bk , u_quatsb [ bl ] ) ;".split(" ")}]}}]},
{type:"textline",b:"} bh = bo ; bi = bp ; bj = bq ; bk = br ; } if ( ! ( a_influence . y > 0.0 ) ) { bm = int ( a_influence [ 0 ] - 1.0 ) ; if ( bm > - 1 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"bh = aR ( bh , u_quatsb [ bm ] , u_quatsa [ bm ] , u_transb [ bm ] , u_transa [ bm ] , bs ) ; bi = a_ ( bi , u_quatsb [ bm ] , u_quatsa [ bm ] , bs ) ; bj = a_ ( bj , u_quatsb [ bm ] , u_quatsa [ bm ] , bs ) ; bk = a_ ( bk , u_quatsb [ bm ] , u_quatsa [ bm ] , bs ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"bh = aR ( bh , u_quatsb [ bm ] , u_transb [ bm ] ) ; bi = a_ ( bi , u_quatsb [ bm ] ) ; bj = a_ ( bj , u_quatsb [ bm ] ) ; bk = a_ ( bk , u_quatsb [ bm ] ) ;".split(" ")}]}}]},{type:"textline",b:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"void bG ( inout vec3 bw , in vec3 bx , in float by , in float bz , in float bA , in vec3 bB , in float bC ) { vec3 bD ; float bE , bF ; bE = length ( bx ) ; bF = bz * ( 1.0 + 0.1 * fract ( bE ) ) ; bF = by * bC * ( 1.0 + sin ( 2.0 * 3.14 * bA * bF + bE ) ) ; bE = ( bw . y - bx . y ) * abs ( bF ) ; bE += 1.0 ; bE *= bE ; bE = bE * bE - bE ; bD = bw ; bD . xz += bB . xz * bE * sign ( bF ) ; bE = length ( bw - bx ) ; bw = bx + normalize ( bD - bx ) * bE ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"vec4 bI ( vec4 bH ) { return bH * bH * ( 3.0 - 2.0 * bH ) ; } vec4 bK ( vec4 bJ ) { return abs ( fract ( bJ + 0.5 ) * 2.0 - 1.0 ) ; } vec4 bM ( vec4 bL ) { return bI ( bK ( bL ) ) ; } void cc ( inout vec3 bN , in float bO , in vec3 bP , in vec3 bQ , in vec3 bR , in float bS , in float bT , in float bU , in vec3 bV ) { vec3 bW ; vec4 bX ; vec2 bY , bZ ; float b_ , ca , cb ; b_ = dot ( bR , vec3 ( 1.0 ) ) ; ca = b_ + bV . g ; cb = dot ( bN , vec3 ( bV . g ) ) ; bY = ( bO + vec2 ( cb , ca ) ) ; bX = ( ( fract ( ( bY . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( bQ ) * bS ; bX = bM ( bX ) ; bZ = bX . xz + bX . yw ; bZ . y = 0.5 - bZ . y ; bW = bZ . xyx * bV . rbr * vec3 ( bT * bP . x , bU , bT * bP . z ) ; bN += bW ; }".split(" ")}]}}]},
{type:"textline",b:"void cj ( inout vec3 cd , inout vec3 ce , in vec3 cf ) { vec3 cg , ch , ci ; cg = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"ch = ce ; ci = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ch = cd ; ci = ce ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"cc ( ch , u_time , cf , cg , ci , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",b:"bG ( ch , ci , au_wind_bending_amp , au_wind_bending_freq , u_time , cg , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bG ( ch , ci , au_wind_bending_amp , au_wind_bending_freq , u_time , cg , 1.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"cd += ch - ce ; ce = ch ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"cd = ch ; ce = ci ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/std_enums.glsl"]={type:"group",a:[{type:"define",name:"TEXTURE_COORDS_UV_ORCO",b:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",b:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",b:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",
b:["2"]},{type:"define",name:"SHADOW_SRC_NONE",b:["1"]},{type:"define",name:"SHADOW_SRC_DEPTH",b:["2"]},{type:"define",name:"SHADOW_SRC_MASK",b:["3"]},{type:"define",name:"SHADOW_DST_NONE",b:["1"]},{type:"define",name:"SHADOW_DST_DEPTH",b:["2"]},{type:"define",name:"SHADOW_DST_MASK",b:["3"]},{type:"define",name:"SPECULAR_PHONG",b:["1"]},{type:"define",name:"SPECULAR_COOKTORR",b:["2"]},{type:"define",name:"SPECULAR_WARDISO",b:["3"]},{type:"define",name:"DIFFUSE_LAMBERT",b:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",
b:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",b:["3"]},{type:"define",name:"MAPPING_TYPE_TEXTURE",b:["0.0"]},{type:"define",name:"MAPPING_TYPE_POINT",b:["1.0"]},{type:"define",name:"MAPPING_TYPE_VECTOR",b:["2.0"]},{type:"define",name:"MAPPING_TYPE_NORMAL",b:["3.0"]}]};a["include/pack.glslf"]={type:"group",a:[{type:"textline",b:"float ck = 255.0 ; float cl = 0.0 ; float cm = 1.0 ; vec4 cq ( const in float cn ) { vec4 co , cp ; co = vec4 ( ck * ck * ck , ck * ck , ck , cm ) ; cp = vec4 ( cl , cm / ck , cm / ck , cm / ck ) ; co = fract ( cn * co ) ; co -= co . xxyz * cp ; return co ; } float cu ( const in vec4 cr ) { vec4 cs ; float ct ; cs = vec4 ( cm / ( ck * ck * ck ) , cm / ( ck * ck ) , cm / ck , cm ) ; ct = dot ( cr , cs ) ; return ct ; } vec4 cq ( const in vec2 cv ) { vec4 cw ; vec2 cx , cy ; cx = vec2 ( ck , cm ) ; cy = vec2 ( cl , cm / ck ) ; cw = fract ( cv . xxyy * cx . xyxy ) ; cw -= cw . xxzz * cy . xyxy ; if ( cv . r == cm ) cw . rg = vec2 ( cl , cm ) ; if ( cv . g == cm ) cw . ba = vec2 ( cl , cm ) ; return cw ; } vec2 cC ( const in vec4 cz ) { vec2 cA , cB ; cB = vec2 ( cm / ck , cm ) ; cA . r = dot ( cz . rg , cB ) ; cA . g = dot ( cz . ba , cB ) ; return cA ; }".split(" ")}]};
a["include/procedural.glslf"]={type:"group",a:[{type:"textline",b:"float cK = 0.0 ; float cL = 1.0 ; vec4 cN ( vec4 cM ) { return cM - floor ( cM * ( cL / 289.0 ) ) * 289.0 ; } vec3 cN ( vec3 cO ) { return cO - floor ( cO * ( cL / 289.0 ) ) * 289.0 ; } vec2 cN ( vec2 cP ) { return cP - floor ( cP * ( cL / 289.0 ) ) * 289.0 ; } vec4 cR ( vec4 cQ ) { return cQ - floor ( cQ * ( cL / 7.0 ) ) * 7.0 ; } vec4 cT ( vec4 cS ) { return cN ( ( 34.0 * cS + 5.0 ) * cS ) ; }".split(" ")},{type:"define",name:"K",
b:["0.142857142857"]},{type:"define",name:"K2",b:["0.0714285714285"]},{type:"define",name:"JITTER",b:["0.7"]},{type:"textline",b:"vec2 da ( vec2 cU ) { vec4 cV , cW , cX , cY ; vec2 cZ , c_ ; cZ = cN ( floor ( cU ) ) ; c_ = fract ( cU ) ; cV = c_ . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; cW = c_ . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; cX = cT ( cZ . x + vec4 ( cK , cL , cK , cL ) ) ; cX = cT ( cX + cZ . y + vec4 ( cK , cK , cL , cL ) ) ; cY = cR ( cX ) * K + K2 ; cX = cR ( floor ( cX * K ) ) * K + K2 ; cV = cV + JITTER * cY ; cY = cW + JITTER * cX ; cW = cV * cV + cY * cY ;".split(" ")},
{type:"condition",a:[{type:"if",c:["1"],group:{type:"group",a:[{type:"textline",b:"cW . xy = min ( cW . xy , cW . zw ) ; cW . x = min ( cW . x , cW . y ) ; return cW . xx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"cW . xy = ( cW . x < cW . y ) ? cW . xy : cW . yx ; cW . xz = ( cW . x < cW . z ) ? cW . xz : cW . zx ; cW . xw = ( cW . x < cW . w ) ? cW . xw : cW . wx ; cW . y = min ( cW . y , cW . z ) ; cW . y = min ( cW . y , cW . w ) ; return sqrt ( cW . xy ) ;".split(" ")}]}}]},
{type:"textline",b:"} mat3 dj ( vec2 db , float dc ) { vec4 dd , de , df , dg ; vec2 dh , di ; dh = cN ( floor ( db ) ) ; di = fract ( db ) ; dd = di . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; de = di . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; df = cT ( dh . x + vec4 ( cK , cL , cK , cL ) ) ; df = cT ( df + dh . y + vec4 ( cK , cK , cL , cL ) ) ; dg = cR ( df ) * K + K2 ; df = cR ( floor ( df * K ) ) * K + K2 ; dd = dd + JITTER * dg ; dg = de + JITTER * df ; de = dd * dd + dg * dg ; dd += dc ; dg += dc ; df = dd * dd + dg * dg ; dd += dc ; dg += dc ; dd = dd * dd + dg * dg ; de . xy = min ( de . xy , de . zw ) ; de . x = min ( de . x , de . y ) ; df . xy = min ( df . xy , df . zw ) ; df . x = min ( df . x , df . y ) ; dd . xy = min ( dd . xy , dd . zw ) ; dd . x = min ( dd . x , dd . y ) ; return mat3 ( de . xx , cK , df . xx , cK , dd . xx , cK ) ; } vec3 dl ( vec3 dk ) { return cN ( ( ( dk * 34.0 ) + cL ) * dk ) ; } float dx ( vec2 dm ) { vec3 dn , dp , dq , dr ; vec4 ds ; vec2 dt , du , dv ; const vec4 dw = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; dt = floor ( dm + dot ( dm , dw . yy ) ) ; du = dm - dt + dot ( dt , dw . xx ) ; dv = ( du . x > du . y ) ? vec2 ( cL , cK ) : vec2 ( cK , cL ) ; ds = du . xyxy + dw . xxzz ; ds . xy -= dv ; dt = cN ( dt ) ; dn = dl ( dl ( dt . y + vec3 ( cK , dv . y , cL ) ) + dt . x + vec3 ( cK , dv . x , cL ) ) ; dp = max ( 0.5 - vec3 ( dot ( du , du ) , dot ( ds . xy , ds . xy ) , dot ( ds . zw , ds . zw ) ) , cK ) ; dp = dp * dp ; dp = dp * dp ; dn = 2.0 * fract ( dn * dw . www ) - cL ; dq = abs ( dn ) - 0.5 ; dr = floor ( dn + 0.5 ) ; dn = dn - dr ; dp *= 1.79284291400159 - 0.85373472095314 * ( dn * dn + dq * dq ) ; dr . x = dn . x * du . x + dq . x * du . y ; dr . yz = dn . yz * ds . xz + dq . yz * ds . yw ; return 130.0 * dot ( dp , dr ) ; } vec2 dB ( vec2 dy ) { float dz , dA ; dz = dot ( dy , vec2 ( 12.9898 , 78.233 ) ) ; dA = dot ( dy , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; dz = fract ( sin ( dz ) * 43758.5453 ) * 2.0 - cL ; dA = fract ( sin ( dA ) * 43758.5453 ) * 2.0 - cL ; return vec2 ( dz , dA ) ; }".split(" ")}]};
a["include/shadow.glslf"]={type:"group",a:[{type:"var",name:"CSM_BLEND_BETWEEN_CASCADES",b:["1.0"]},{type:"var",name:"CSM_FADE_LAST_CASCADE",b:["1.0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["vec4","dC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"const float dD = 0.1 ; const float dE = 0.1 ; const float dF = - 0.01 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"const float dG = 0.05 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"mat4 dH = mat4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 , 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 , - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 , - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; mat4 dI = mat4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 , - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 , - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 , - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"bool dL ( vec2 dJ , float dK ) { return all ( lessThanEqual ( dJ , vec2 ( 1.0 + dK ) ) ) && all ( greaterThanEqual ( dJ , vec2 ( 0.0 - dK ) ) ) ; }".split(" ")}]}}]},{type:"textline",b:"float dX ( vec3 dM , sampler2D dN , float dO ) { vec2 dP , dQ ; mat2 dR ; float dS , dT , dU ; dM . z = clamp ( dM . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==",
"SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"dS = 0.0 ; dT = dB ( dM . xy ) . x * M_PI ; dU = cos ( dT ) ; dT = sin ( dT ) ; dR = mat2 ( dU , dT , - dT , dU ) ; for ( int dV = 0 ; dV < 4 ; dV ++ ) for ( int dW = 0 ; dW < 4 ; dW ++ ) { dQ . x = dH [ dV ] [ dW ] ; dQ . y = dI [ dV ] [ dW ] ; dQ = dR * dQ ; dP = dM . xy + dQ * dO / SHADOW_TEX_RES ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( ! dL ( dP , dF ) ) dS += 1.0 ; else".split(" ")}]}}]},
{type:"textline",b:"dS += step ( dM . z , texture2D ( dN , dP ) . r ) ; } dS /= 16.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["dS","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( dS , 0.0 , 1.0 ) ; } float en ( vec3 dY , sampler2D dZ , vec3 d_ , sampler2D ea , float eb , float ec , float ed ) { vec2 ee , ef ; mat2 eg ; float eh , ei , ej , ek ; dY . z = clamp ( dY . z , 0.0 , 1.0 ) ; d_ . z = clamp ( d_ . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"eh = 0.0 ; ei = 0.0 ; ej = dB ( dY . xy ) . x * M_PI ; ek = cos ( ej ) ; ej = sin ( ej ) ; eg = mat2 ( ek , ej , - ej , ek ) ; for ( int el = 0 ; el < 4 ; el ++ ) for ( int em = 0 ; em < 4 ; em ++ ) { ef . x = dH [ el ] [ em ] ; ef . y = dI [ el ] [ em ] ; ef = eg * ef ; ee = dY . xy + ef * eb / SHADOW_TEX_RES ; eh += step ( dY . z , texture2D ( dZ , ee ) . r ) ; ee = d_ . xy + ef * ec / SHADOW_TEX_RES ; ei += step ( d_ . z , texture2D ( ea , ee ) . r ) ; } eh = mix ( eh , ei , ed ) ; eh /= 16.0 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["eh","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( eh , 0.0 , 1.0 ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"float er ( vec2 eo ) { float ep , eq ; ep = min ( eo . x , eo . y ) ; eq = min ( 1.0 - eo . x , 1.0 - eo . y ) ; return min ( ep , eq ) ; } float eu ( float es , float et ) { if ( et >= 0.0 && et <= dE ) es = ( es - 1.0 ) / dE * et + 1.0 ; return es ; } float eF ( vec3 ev , vec3 ew , sampler2D ex , sampler2D ey , float ez , float eA , float eB , float eC ) { float eD , eE ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_BLEND_BETWEEN_CASCADES"],group:{type:"group",a:[{type:"textline",b:"eE = er ( ev . xy ) ; if ( - eC > eB && eE >= 0.0 && eE <= dD && dL ( ew . xy , 0.0 ) ) { eE = 1.0 - eE / dD ; eD = en ( ev , ex , ew , ey , ez , eA , eE ) ; } else".split(" ")}]}}]},{type:"textline",b:"eD = dX ( ev , ex , ez ) ; return eD ; } float eN ( vec3 eG , sampler2D eH , float eI , float eJ , float eK ) { float eL , eM ; eL = dX ( eG , eH , eI ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["CSM_FADE_LAST_CASCADE"],group:{type:"group",a:[{type:"textline",b:"if ( - eK > eJ ) { eM = er ( eG . xy ) ; eL = eu ( eL , eM ) ; }".split(" ")}]}}]},{type:"textline",b:"return eL ; } float eU ( float eO ) { vec3 eP , eQ , eR , eS ; float eT ; eT = 1.0 ; eP = cE . xyz / cE . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"eQ = cF . xyz / cF . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",
a:[{type:"textline",b:"eR = cG . xyz / cG . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"eS = cH . xyz / cH . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( dL ( eP . xy , 0.0 ) ) { eT = eF ( eP , eQ , u_shadow_map0 , u_shadow_map1 , u_pcf_blur_radii [ 0 ] , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 0 ] , eO ) ; }".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"if ( dL ( eP . xy , dG ) ) { eT = eN ( eP , u_shadow_map0 , u_pcf_blur_radii [ 0 ] , u_csm_center_dists [ 0 ] , eO ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"else { if ( dL ( eQ . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"eT = eF ( eQ , eR , u_shadow_map1 , u_shadow_map2 , u_pcf_blur_radii [ 1 ] , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 1 ] , eO ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"eT = eN ( eQ , u_shadow_map1 , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 1 ] , eO ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"else { if ( dL ( eR . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"eT = eF ( eR , eS , u_shadow_map2 , u_shadow_map3 , u_pcf_blur_radii [ 2 ] , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 2 ] , eO ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"eT = eN ( eR , u_shadow_map2 , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 2 ] , eO ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"else { if ( dL ( eS . xy , 0.0 ) ) eT = eN ( eS , u_shadow_map3 , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 3 ] , eO ) ; }".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",
b:["return","eT",";","}"]}]}}]}]}}]},{type:"textline",b:"float eZ ( inout vec3 eV ) { float eW ; vec3 eX ; vec2 eY ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"eY = texture2DProj ( u_shadow_mask , cI ) . rg ; eX = vec3 ( eY . r ) ; eW = eY . g ; dC = vec4 ( eX , eW ) ; eV *= dC . a ; return dC . r ;".split(" ")}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"return eU ( cJ . z ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["return","1.0",";"]}]}}]},{type:"textline",b:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec2 fd ( vec3 e_ , float fa , vec2 fb ) { vec2 fc ; fc = vec2 ( ( e_ . x - fb . x ) / fa , - ( e_ . z - fb . y ) / fa ) ; return fract ( fc ) ; } vec2 fh ( vec2 fe , float ff , vec2 fg ) { return vec2 ( fe . x * ff , - fe . y * ff ) + fg ; } d fi ( ) { return d ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } d fE ( vec3 fj , vec3 fk , vec3 fl , vec3 fm , vec3 fn , sampler2D fo , sampler2D fp , vec3 fq , float fr , vec3 fs , vec4 ft , mat4 fu ) { mat4 fv ; vec4 fw ; vec2 fx , fy , fz ; float fA , fB ; vec3 fC ; fC = j ( ft , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; fA = - fC . x ; fB = - fC . z ; fx = vec2 ( fs . x + fr * ( - 1.0 - fA ) / 2.0 , fs . z + fr * ( 1.0 - fB ) / 2.0 ) ; fy = fd ( fn , fr , fx ) ; fA = fr / 2.0 ; fz = abs ( fh ( fy - vec2 ( 0.5 ) , fr , vec2 ( 0.0 ) ) ) ; fB = fA * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( fz ) > fB ) return fi ( ) ; fA = fr / fq . z ; fz = ( fy - vec2 ( 0.5 ) ) * fA + vec2 ( 0.5 ) ; fC = fC * ( fr / fq . z - 1.0 ) / 2.0 ; fz . x += fC . x ; fz . y -= fC . z ; fw = texture2D ( fp , fz ) ; fB = fw . r ; if ( fB < u_scale_threshold ) return fi ( ) ; fA = fq . y - fq . x ; fA = fq . y - texture2D ( fo , fz ) . r * fA ; fz = fj . xz - fn . xz ; fn . xz = fh ( fy , fr , fx ) ; fn . y = fA ; fj . xz = fn . xz + fz ; fj . y *= fB ; fj . y += fA ; fC = fw . gba ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"fj -= fn ; fv = ai ( fs , fn , fu ) ; d fD = av ( fj , fn , fk , fl , fm , fv ) ; fD . b = fn ; fD . f = fC ; return F ( fD ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return F ( d ( fj , fn , fk , fl , fm , fC ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",a:[{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"condition",a:[{type:"if",
c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"vec4 fK ( mat4 fF , vec4 fG ) { vec4 fH ; float fI ; vec2 fJ ; fJ = ( fF * u_v_light_matrix [ 3 ] ) . xy ; fI = SHADOW_TEX_RES / 2.0 ; fJ = floor ( fJ * fI + 0.5 ) / fI - fJ ; fH = fF * fG ; fH . xy += fJ ; fH = u_b_light_matrix * fH ; return fH ; } void fO ( vec3 fL ) { vec4 fM ; vec3 fN ; fN = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ; fM = u_v_light_matrix * vec4 ( fL + u_normal_offset * fN , 1.0 ) ; cE = fK ( u_p_light_matrix0 , fM ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"cF = fK ( u_p_light_matrix1 , fM ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"cG = fK ( u_p_light_matrix2 , fM ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"cH = fK ( u_p_light_matrix3 , fM ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"elif",c:["SHADOW_SRC",
"==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"void fO ( vec4 fP ) { float fQ , fR , fS ; fQ = fP . x ; fR = fP . y ; fS = fP . w ; cI . x = ( fQ + fS ) / 2.0 ; cI . y = ( fR + fS ) / 2.0 ; cI . z = fS ; }".split(" ")}]}}]}]};a["include/gamma.glslf"]={type:"group",a:[{type:"define",name:"GAMMA",b:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",b:["1"]},{type:"textline",b:"void fV ( inout vec3 fU ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",
b:"fU = max ( vec3 ( 0.0 ) , fU ) ; fU = pow ( fU , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void fX ( inout vec3 fW ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"fW = max ( vec3 ( 0.0 ) , fW ) ; fW = pow ( fW , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void f_ ( inout vec3 fY , in float fZ ) {".split(" ")},{type:"condition",a:[{type:"if",c:["PREMULTIPLY_ALPHA"],group:{type:"group",a:[{type:"textline",b:"fY = fY * fZ ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["include/fog.glslf"]={type:"group",a:[{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"textline",b:"void gg ( inout vec3 gc , in float gd , in vec4 ge ) { float gf ; gf = ge . w * gd ; gf = exp ( - gf * gf ) ; gf = clamp ( gf , 0.0 , 1.0 ) ; gc = mix ( ge . rgb , gc , gf ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 gm ( in mat4 gh , in vec3 gi ) { vec3 gj , gk , gl ; gj = mix ( gh [ 0 ] . rgb , gh [ 1 ] . rgb , max ( sign ( gi . x ) , 0.0 ) ) ; gk = mix ( gh [ 2 ] . rgb , gh [ 3 ] . rgb , max ( sign ( gi . z ) , 0.0 ) ) ; gl = vec3 ( gh [ 0 ] . a , gh [ 1 ] . a , gh [ 2 ] . a ) ; gj = mix ( gj , gk , abs ( gi . z ) ) ; gj = mix ( gj , gl , abs ( gi . y ) ) ; return gj ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"void go ( inout float gn ) { gn -= 0.5 ; gn = 4.0 * ( gn * gn * gn ) + 0.5 ; } void gC ( inout vec3 gp , in float gq , in vec3 gr , in float gs , in vec4 gt , in vec4 gu , in float gv , in float gw ) { vec3 gx , gy ; float gz , gA , gB ; gz = gu . w * gq ; gz = exp ( - gz * gz ) ; gz = clamp ( gz , 0.0 , 1.0 ) ; gA = max ( gr . y , 0.0 ) ; gq = max ( gq - max ( gs / gA , 0.0 ) , 0.0 ) ; gB = gt . w * gq ; gB = 1.0 - gB ; gB = max ( gB , 0.0 ) ; go ( gB ) ; gB += max ( gv - 0.5 , 0.0 ) ; if ( gB < gz ) { gx = vec3 ( 0.0 , 0.02 , 0.05 ) ; gy = gt . rgb ; gs = clamp ( - gs * 0.03 , 0.0 , 0.8 ) ; gy = mix ( gy , gx , min ( gA , 1.0 ) ) ; gy = mix ( gy , vec3 ( 0.0 ) , gs ) * gw ; gp = mix ( gy , gp , gB ) ; } if ( gB >= gz ) { gp = mix ( gu . rgb , gp , gz ) ; } } void gK ( inout vec3 gD , in float gE , in float gF , in vec4 gG , in float gH ) { vec3 gI ; float gJ ; gJ = gG . w * gE ; gJ = 1.0 - gJ ; gJ = clamp ( gJ , 0.0 , 1.0 ) ; go ( gJ ) ; gF = clamp ( - gF * 0.03 , 0.0 , 0.8 ) ; gI = mix ( gG . rgb , vec3 ( 0.0 ) , gF ) * gH ; gD = mix ( gI , gD , gJ ) ; }".split(" ")}]}}]}]};
a["include/lighting.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",
b:"float gL = 0.0 ; float gM = 1.0 ; float gN = 0.5 ; struct gO { vec4 a ; vec3 b ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"float gW ( vec3 gP , vec3 gQ , vec3 gR , float gS , float gT ) { float gU ; vec3 gV ; gV = normalize ( gP + gQ ) ; gU = ( gM - gS ) * max ( dot ( gR , gV ) , gL ) + gS ; return pow ( gU , gT ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"float hf ( vec3 gX , vec3 gY , vec3 gZ , float g_ ) { float ha , hb , hc , hd ; vec3 he ; he = normalize ( gX + gY ) ; ha = max ( dot ( gZ , he ) , 0.001 ) ; hb = max ( dot ( gZ , gY ) , 0.01 ) ; hc = max ( dot ( gZ , gX ) , 0.01 ) ; ha = tan ( acos ( ha ) ) ; hd = max ( g_ , 0.001 ) ; return hc * ( gM / ( 4.0 * M_PI * hd * hd ) ) * ( exp ( - ( ha * ha ) / ( hd * hd ) ) / ( sqrt ( hb * hc ) ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],group:{type:"group",a:[{type:"textline",b:"float hn ( vec3 hg , vec3 hh , vec3 hi , float hj , float hk ) { float hl ; vec3 hm ; hm = normalize ( hg + hh ) ; hl = acos ( dot ( hm , hi ) ) ; if ( hl < hj ) return gM ; else if ( hl >= hj + hk || hk == gL ) return gL ; else return gM - ( hl - hj ) / hk ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",
b:"void hC ( float ho , vec3 hp , vec3 hq , vec3 hr , float hs , inout float ht ) { vec3 hu , hv ; float hw , hx , hy , hz , hA , hB ; if ( hs > gL ) { hw = max ( dot ( hp , hr ) , gL ) ; hx = hs * hs ; hy = gM - gN * ( hx / ( hx + 0.33 ) ) ; hu = hq - ho * hp ; hv = hr - hw * hp ; if ( length ( hu ) == gL || length ( hv ) == gL || abs ( ho ) > gM || abs ( hw ) > gM ) ht = ht * hy ; else { hz = acos ( ho ) ; hw = acos ( hw ) ; hu = normalize ( hu ) ; hv = normalize ( hv ) ; hA = max ( hz , hw ) ; hB = min ( hz , hw ) ; hB *= 0.95 ; hz = max ( dot ( hu , hv ) , gL ) ; hw = 0.45 * ( hx / ( hx + 0.09 ) ) ; ht = ht * ( hy + ( hw * hz * sin ( hA ) * tan ( hB ) ) ) ; } } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"void hJ ( vec3 hD , vec3 hE , float hF , float hG , out float hH ) { float hI ; if ( hF == gL ) { hH = gM ; } else { hI = gM + abs ( dot ( hE , hD ) ) ; hI = hG + ( gM - hG ) * pow ( hI , hF ) ; hH = clamp ( hI , gL , gM ) ; } }".split(" ")}]}}]},{type:"textline",b:"void hR ( vec3 hK , vec3 hL , vec3 hM , vec2 hN , const float hO , out float hP ) { float hQ ;".split(" ")},{type:"condition",
a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"hJ ( hK , hL , hN [ 0 ] , hN [ 1 ] , hP ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hQ = max ( dot ( hK , hL ) , gL ) ; hP = ( gM - hO ) * hQ + hO ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"hC ( hQ , hK , hL , hM , hN [ 0 ] , hP ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"} void hY ( vec3 hS , vec3 hT , vec3 hU , float hV , vec2 hW , out float hX ) {".split(" ")},
{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"hX = gW ( hS , hT , hU , hV , hW [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"hX = hf ( hS , hT , hU , hW [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],group:{type:"group",a:[{type:"textline",b:"hX = hn ( hS , hT , hU , hW [ 0 ] , hW [ 1 ] ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["hX","=","gL",";"]}]}}]},{type:"textline",b:"} void iv ( vec3 hZ , vec3 h_ , vec3 ia , vec2 ib , vec4 ic , vec3 id , vec3 ie , vec3 ig , inout gO ih , float ii , vec2 ij , vec2 ik , float il ) { float im , io , ip , iq , ir , is , it , iu ; im = gL ; if ( ib . r != gL ) hR ( ia , h_ , hZ , ij , il , im ) ; io = gL ; if ( ib . g != gL ) hY ( h_ , hZ , ia , il , ik , io ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_TRANSLUCENCY"],
group:{type:"group",a:[{type:"textline",b:"if ( dot ( h_ , ia ) * dot ( hZ , ia ) < gL ) { ip = ic . x ; iq = ic . y ; ir = ic . z ; is = ic . w ; it = clamp ( abs ( dot ( h_ , ia ) ) , gL , gM ) ; iu = clamp ( dot ( hZ , - h_ ) , gL , gM ) ; iu = pow ( iu , iq ) ; ih . a += ii * vec4 ( ig * it * pow ( id , vec3 ( ip ) ) , gM ) ; ih . a += ir * mix ( vec4 ( id , gM ) , vec4 ( gM ) , is ) * ii * vec4 ( ig * it * vec3 ( iu ) , gM ) ; } else { ih . b += ig * ie * io ; ih . a += vec4 ( ig * id * im , io ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"ih . b += ig * ie * io ; ih . a += vec4 ( ig * id * im , io ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"lamp",name:"POINT",f:[{type:"textline",b:"iY = iJ [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; iQ = iG [ LAMP_IND ] ; iR = iI [ LAMP_IND ] ; iM = gL ;".split(" ")},{type:"textline",b:"iR = iR ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) iR *= iF ; iQ = iQ - iA ;".split(" ")},{type:"textline",b:"iN = length ( iQ ) ; iR *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + iN * iN ) ; iQ = normalize ( iQ ) ; iv ( iC , iQ , iB , iY , iL , iy , iz , iR , jb , iK , iE , iD , iM ) ;".split(" ")}]},
{type:"lamp",name:"SPOT",f:[{type:"textline",b:"iZ = iJ [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; iS = iG [ LAMP_IND ] ; iT = iI [ LAMP_IND ] ; iU = iH [ LAMP_IND ] ; iN = gL ;".split(" ")},{type:"textline",b:"iT = iT ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) iT *= iF ; iS = iS - iA ;".split(" ")},{type:"textline",b:"iO = length ( iS ) ; iT *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + iO * iO ) ; iS = normalize ( iS ) ;".split(" ")},{type:"textline",b:"iO = dot ( iS , iU ) ; iO *= smoothstep ( gL , gM , ( iO - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; iT *= iO ; iv ( iC , iS , iB , iZ , iL , iy , iz , iT , jb , iK , iE , iD , iN ) ;".split(" ")}]},
{type:"lamp",name:"SUN",f:[{type:"textline",b:"i_ = iJ [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; iU = iI [ LAMP_IND ] ; iV = iH [ LAMP_IND ] ; iO = gL ;".split(" ")},{type:"textline",b:"iU = iU ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) iU *= iF ; iv ( iC , iV , iB , i_ , iL , iy , iz , iU , jb , iK , iE , iD , iO ) ;".split(" ")}]},{type:"lamp",name:"HEMI",f:[{type:"textline",b:"ja = iJ [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; iW = iI [ LAMP_IND ] ; iX = iH [ LAMP_IND ] ; iP = gN ;".split(" ")},
{type:"textline",b:"iW = iW ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) iW *= iF ; iv ( iC , iX , iB , ja , iL , iy , iz , iW , jb , iK , iE , iD , iP ) ;".split(" ")}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"gO jc ( vec3 iw , vec3 ix , vec3 iy , vec3 iz , vec3 iA , vec3 iB , vec3 iC , vec2 iD , vec2 iE , float iF , vec3 iG [ NUM_LIGHTS ] , vec3 iH [ NUM_LIGHTS ] , vec3 iI [ NUM_LIGHTS ] , vec4 iJ [ NUM_LFACTORS ] , float iK , vec4 iL ) { float iM , iN , iO , iP ; vec3 iQ , iR , iS , iT , iU , iV , iW , iX ; vec2 iY , iZ , i_ , ja ; gO jb ; jb . a = vec4 ( iw + iy * ix , gL ) ; jb . b = vec3 ( gL ) ;".split(" ")},
{type:"lamps_main"},{type:"textline",b:["return","jb",";","}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gO jh ( vec3 jd , vec3 je , vec3 jf ) { gO jg ; jg . a = vec4 ( jd + jf * je , gL ) ; jg . b = vec3 ( gL ) ; return jg ; }".split(" ")}]}}]}]};a["include/caustics.glslf"]={type:"group",a:[{type:"var",name:"CAUST_SPEED",b:["vec2","(","0.0",")"]},{type:"var",name:"CAUST_SCALE",b:["0.0"]},{type:"var",name:"CAUST_BRIGHT",b:["0.0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",b:["100.0"]},
{type:"textline",b:"void jA ( inout vec3 ji , float jj , float jk , float jl , vec3 jm , vec3 jn , vec3 jo , vec4 jp , vec3 jq , float jr ) { mat3 js ; float jt , ju , jv , jw ; vec2 jx ; vec3 jy ; vec4 jz ; if ( jr > CAUSTICS_VIEW_DISTANCE ) return ; jz = jp ; jy = jq + jm ; jy . xz = 10.0 * sin ( 0.1 * jy . xz ) ; jy = jy + 2.0 * cross ( - jz . xyz , cross ( - jz . xyz , jy ) + jz . w * jy ) ; jx = jy . xz ; jy = jn ; jt = max ( dot ( jm , jy ) , 0.0 ) ; ju = 0.025 ; jx . s += 0.5 * sin ( dot ( jq + jk , vec3 ( 1.0 ) ) ) ; jx . t += 0.7 * ( - sin ( dot ( jq - jk , vec3 ( - 0.7 ) ) ) ) ; jx . st += 0.23 * cos ( 4.0 * jj - CAUST_SPEED . x * jk ) ; jx . st += 3.0 * sin ( jj - 0.3 * CAUST_SPEED . y * jk ) ; jv = CAUST_SCALE * ( 1.0 + max ( 0.1 * jj , 0.0 ) ) ; js = dj ( ( jx / jv ) , ju ) ; jv = ( js * vec3 ( 1.0 , 0.0 , 0.0 ) ) . x ; ju = ( js * vec3 ( 0.0 , 1.0 , 0.0 ) ) . x ; jw = ( js * vec3 ( 0.0 , 0.0 , 1.0 ) ) . x ; jy = CAUST_BRIGHT * vec3 ( jv , ju , jw ) ; jv = jl * jt ; ju = max ( sign ( jj ) , 0.0 ) ; jv = min ( jv + 0.5 * sign ( - jm . y ) * ju , 1.0 ) ; jv *= 1.0 - ju * ( 0.1 * jj ) ; jy *= jv ; jy *= jy ; jw = min ( - jj + 10.0 , 1.0 ) ; ji += max ( ( 2.0 * jo * jy ) * jw , 0.0 ) ; }".split(" ")}]};
a["include/mirror.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"define",name:"REFL_BUMP",b:["0.1"]},{type:"textline",b:"float jN ( in vec3 jH , in vec3 jI , in float jJ , in float jK ) { float jL ; vec3 jM ; jM = normalize ( jI + jH ) ; jL = 1.0 - dot ( jH , jM ) ; jL = jK + ( 1.0 - jK ) * pow ( jL , jJ ) ; return jL ; } void jZ ( inout vec3 jO , in vec3 jP , in vec3 jQ , in float jR , in float jS , in float jT ) { vec2 jU , jV ; float jW ; vec3 jX , jY ; jX = reflect ( - jP , jQ ) ; jW = 1.0 ; if ( jR != 0.0 ) jW = jN ( jP , jX , jR , jS ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"jY = u_refl_plane . xyz * dot ( jQ , u_refl_plane . xyz ) ; jY = jQ - jY ; jU = ( u_view_matrix_frag * vec4 ( jY , 0.0 ) ) . xy ; jV = cI . xy / cI . z ; jV += jU * REFL_BUMP ; jY = texture2D ( u_reflectmap , jV ) . rgb ; fV ( jY . rgb ) ; jO = mix ( jO , jY , jT * jW ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"jY = textureCube ( u_mirrormap , jX ) . xyz ; fV ( jY . rgb ) ; jO = mix ( jO , jY , u_mirror_factor * jW ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]}}]}]};a["include/refraction.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_REFRACTION_CORRECTION"],group:{type:"group",a:[{type:"textline",b:"float ke ( in float j_ , inout vec2 ka , in vec2 kb ) { float kc ; vec4 kd ; kd = texture2D ( u_scene_depth , ka ) ; kc = cu ( kd ) ; if ( kc < jG ) { ka = kb ; return j_ ; } else { return kc ; } return j_ ; }".split(" ")}]}}]},{type:"textline",
b:"vec3 km ( in vec3 kf , in vec2 kg ) { vec3 kh ; float ki ; vec4 kj ; vec2 kk , kl ; kk = kf . xy / kf . z ; kl = kk + kg ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_REFRACTION_CORRECTION"],group:{type:"group",a:[{type:"textline",b:"kj = texture2DProj ( u_scene_depth , kf ) ; ki = cu ( kj ) ; ke ( ki , kl , kk ) ;".split(" ")}]}}]},{type:"textline",b:"kh = texture2D ( u_refractmap , kl ) . rgb ; fV ( kh ) ; return kh ; }".split(" ")}]}}]}]};a["include/environment.glslf"]={type:"group",
a:[{type:"textline",b:"vec3 kp ( float kn , vec3 ko ) {".split(" ")},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"return textureCube ( u_sky_texture , ko ) . rgb ;".split(" ")}]}},{type:"elif",c:["SKY_COLOR"],group:{type:"group",a:[{type:"textline",b:"return mix ( u_horizon_color , u_zenith_color , kn ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"return vec3 ( 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["include/particles.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"struct kT { float a ; vec3 b ; float c ; vec3 d ; float e ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void kZ ( inout float kU , float kV , vec2 kW , vec2 kX ) { float kY ; kY = kX . x - kW . x ; kY = ( kV - kW . x ) / kY ; kU = mix ( kU , kX . y , clamp ( kY , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void le ( inout vec3 k_ , float la , vec4 lb , vec4 lc ) { float ld ; ld = lc . x - lb . x ; ld = ( la - lb . x ) / ld ; k_ = mix ( k_ , lc . yzw , clamp ( ld , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"float lk ( float lf , float lg , vec2 lh [ SIZE_RAMP_LENGTH ] ) { float li , lj ; li = lf / lg ; lj = lh [ 0 ] . y ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"kZ ( lj , li , lh [ 0 ] , lh [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","2"],group:{type:"group",a:[{type:"textline",b:"kZ ( lj , li , lh [ 1 ] , lh [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",b:"kZ ( lj , li , lh [ 2 ] , lh [ 3 ] ) ;".split(" ")}]}}]},{type:"textline",
b:["return","lj",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"vec3 lq ( float ll , float lm , vec4 ln [ COLOR_RAMP_LENGTH ] ) { vec3 lo ; float lp ; lp = ll / lm ; lo = ln [ 0 ] . yzw ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"le ( lo , lp , ln [ 0 ] , ln [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","2"],
group:{type:"group",a:[{type:"textline",b:"le ( lo , lp , ln [ 1 ] , ln [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",b:"le ( lo , lp , ln [ 2 ] , ln [ 3 ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","lo",";","}"]}]}}]},{type:"textline",b:"float ly ( float lr , float ls , float lt , float lu ) { float lv , lw , lx ; lv = max ( 0.01 , min ( ls , lt ) ) ; lw = max ( 0.01 , min ( ls , lu ) ) ; lx = ls - lw ; lv = clamp ( lr / lv , 0.0 , 1.0 ) - step ( lx , lr ) * ( lr - lx ) / lw ; return lv ; } kT lE ( ) { vec3 lz , lA ; float lB , lC ; kT lD ; if ( u_p_cyclic == 1 ) { lB = mod ( u_p_time , u_p_length ) - a_p_delay ; if ( lB < 0.0 ) lB += u_p_length ; } if ( u_p_cyclic != 1 ) { lB = u_p_time - a_p_delay ; } if ( lB < 0.0 || lB >= a_p_lifetime ) { lD . a = 0.0001 ; lD . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( lB < 0.0 || lB >= a_p_lifetime ) ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:"lz = a_position ; lA = a_normal ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lz = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; lA = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ;".split(" ")}]}}]},{type:"textline",b:"lz += u_p_nfactor * lB * lA ; lz += a_p_vels . xyz * lB ; lz . y -= u_p_gravity * lB * lB / 2.0 ; lC = max ( u_p_mass , EPSILON ) ; lz += ( u_p_wind / lC ) * lB * lB / 2.0 ; lD . b = lz ; lD . e = a_p_vels . w * lB ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"lD . a = lk ( lB , u_p_max_lifetime , u_p_size_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lD . a = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"lD . d = lq ( lB , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lD . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"lD . c = ly ( lB , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; } return lD ; }".split(" ")}]};a["include/depth_fetch.glslf"]={type:"group",a:[{type:"textline",b:"float lQ ( in sampler2D lK , in vec2 lL , in vec2 lM ) { float lN , lO , lP ; lN = texture2D ( lK , lL ) . r ; lO = lM . x ; lP = lM . y ; lN = 2.0 * lO / ( lO + lP - ( 2.0 * lN - 1.0 ) * ( lP - lO ) ) ; return lN ; }".split(" ")}]}};b4w.module.animation=function(a,p){var c=p("__animation"),b=p("__constraints");p("__physics");var h=p("__print"),d=p("__util");a.SLOT_0=c.SLOT_0;a.SLOT_1=c.SLOT_1;a.SLOT_2=c.SLOT_2;a.SLOT_3=c.SLOT_3;a.SLOT_4=c.SLOT_4;a.SLOT_5=c.SLOT_5;a.SLOT_6=c.SLOT_6;a.SLOT_7=c.SLOT_7;a.SLOT_ALL=c.SLOT_ALL;a.OBJ_ANIM_TYPE_ARMATURE=c.OBJ_ANIM_TYPE_ARMATURE;a.OBJ_ANIM_TYPE_OBJECT=c.OBJ_ANIM_TYPE_OBJECT;a.OBJ_ANIM_TYPE_VERTEX=c.OBJ_ANIM_TYPE_VERTEX;a.OBJ_ANIM_TYPE_SOUND=c.OBJ_ANIM_TYPE_SOUND;a.OBJ_ANIM_TYPE_PARTICLES=
c.OBJ_ANIM_TYPE_PARTICLES;a.OBJ_ANIM_TYPE_MATERIAL=c.OBJ_ANIM_TYPE_MATERIAL;a.AB_CYCLIC=c.AB_CYCLIC;a.AB_FINISH_RESET=c.AB_FINISH_RESET;a.AB_FINISH_STOP=c.AB_FINISH_STOP;var f=new Float32Array(4);a.is_animated=function(a){return c.is_animated(a)};a.get_actions=function(){h.error("get_actions() deprecated, use get_anim_names() instead");for(var a=[],b=c.gx(),d=0;d<b.length;d++)a.push(c.gA(b[d].name));return a};a.get_current_action=function(b,c){h.error("get_current_action() deprecated, use get_current_anim_name() instead");
return a.get_current_anim_name(b,c)};a.get_anim_names=function(a){return c.Tj(a)?c.get_anim_names(a):[]};a.get_current_anim_name=function(a,b){if(!c.is_animated(a))return null;b=b||c.SLOT_0;return c.ix(a,b)};a.apply=function(a,b,d){if(d>c.SLOT_7)h.error("Can't apply animation to slot "+d+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{d=d||c.SLOT_0;if(c.is_animated(a)){var f=c.get_slot_num_by_anim(a,b);if(-1!=f&&f!=d){h.error('Animation "'+b+'" is already applied to object "'+
a.name+'" (slot "'+f+'").');return}}c.cB(a,b)?c.apply(a,b,d):h.error('No fcurves in action "'+b+'"')}};a.remove=function(a){c.remove(a)};a.remove_slot_animation=function(a,b){c.is_animated(a)&&(b=b||c.SLOT_0,c.remove_slot_animation(a,b))};a.apply_def=function(a){c.apply_def(a)};a.play=function(a,b,d){c.is_animated(a)?(d=d||c.SLOT_0,c.play(a,b,d),c.update_object_animation(a,0,d,!0)):h.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,b){c.is_animated(a)&&(b=b||c.SLOT_0,c.stop(a,
b))};a.is_play=function(a,b){if(!c.is_animated(a))return!1;b=b||c.SLOT_0;return c.is_play(a,b)};a.set_current_frame_float=function(b,c,d){h.error("set_current_frame_float() deprecated, use set_frame() instead");a.set_frame(b,c,d)};a.get_current_frame_float=function(b,c){h.error("get_current_frame_float() deprecated, use get_frame() instead");return a.get_frame(b,c)};a.set_frame=function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.set_current_frame_float(a,b,d),c.update_object_animation(a,0,d,!0))};
a.get_frame=function(a,b){if(!c.is_animated(a))return 0;b=b||c.SLOT_0;return c.get_current_frame_float(a,b)};a.set_speed=function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.set_speed(a,b||1,d))};a.get_speed=function(a,b){if(!c.is_animated(a))return 0;b=b||c.SLOT_0;return a.B[b]?c.get_speed(a,b):0};a.get_frame_range=function(a,b){h.error("get_frame_range() deprecated, use get_anim_start_frame() and get_anim_length() instead");if(c.is_animated(a)){b=b||c.SLOT_0;var d=a.B[b];if(d)return[d.start,d.start+
d.length]}return null};a.get_anim_start_frame=function(a,b){return c.is_animated(a)&&(b=b||c.SLOT_0,a.B[b])?c.get_anim_start_frame(a,b):-1};a.get_anim_length=function(a,b){return c.is_animated(a)&&(b=b||c.SLOT_0,a.B[b])?c.get_anim_length(a,b):-1};a.cyclic=function(b,d,f){h.error("cyclic() deprecated, use set_behavior() instead");a.set_behavior(b,d?c.AB_CYCLIC:c.AB_FINISH_RESET,f)};a.is_cyclic=function(a,b){h.error("is_cyclic() deprecated, use get_behavior() instead");if(!c.is_animated(a))return!1;
b=b||c.SLOT_0;return c.is_cyclic(a,b)};a.set_behavior=function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.set_behavior(a,b,d))};a.get_behavior=function(a,b){if(!c.is_animated(a))return null;b=b||c.SLOT_0;return c.get_behavior(a,b)};a.apply_smoothing=function(a,b,d,f){f=f||c.SLOT_0;c.is_animated(a)&&c.apply_smoothing(a,b,d,f)};a.update_object_animation=function(a,b,d,f){c.is_animated(a)&&(d=d||c.SLOT_0,c.update_object_animation(a,b||0,d,f||!1))};a.frame_to_sec=function(a){return c.frame_to_sec(a)};
a.get_bone_translation=function(a,c,h){if(!d.is_armature(a))return null;h||(h=new Float32Array(3));b.mx(a,c,!1,f,null);h[0]=f[0];h[1]=f[1];h[2]=f[2];return h};a.get_first_armature_object=function(a){return d.is_mesh(a)?c.get_first_armature_object(a):null};a.get_slot_num_by_anim=function(a,b){return c.is_animated(a)&&b?c.get_slot_num_by_anim(a,b):null};a.get_anim_type=function(a,b){return c.is_animated(a)?c.get_anim_type(a,b):null};a.apply_to_first_empty_slot=function(a,b){return c.apply_to_first_empty_slot(a,
b)};a.get_skel_mix_factor=function(a){return a.d.oe};a.set_skel_mix_factor=function(a,b,f){d.is_armature(a)?(b=Math.min(Math.max(b,0),1),a.d.oe!=b&&c.set_skel_mix_factor(a,b,f||0)):h.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.anchors=function(a,p){var c=p("__anchors");p("__print");p("__util");a.attach_move_cb=c.attach_move_cb;a.detach_move_cb=c.detach_move_cb};b4w.module.assets=function(a,p){var c=p("__assets");a.AT_ARRAYBUFFER=c.AT_ARRAYBUFFER;a.AT_JSON=c.AT_JSON;a.AT_TEXT=c.AT_TEXT;a.AT_AUDIOBUFFER=c.AT_AUDIOBUFFER;a.AT_IMAGE_ELEMENT=c.AT_IMAGE_ELEMENT;a.AT_AUDIO_ELEMENT=c.AT_AUDIO_ELEMENT;a.enqueue=function(a,h,d){c.enqueue(a,h,d)}};b4w.module.camera=function(a,p){function c(a,c){b.is_target_camera(a)?(m.copy(c,a.d.Nb),l.A(a),h.sync_transform(a)):d.error("set_pivot(): Wrong object or camera move style")}var b=p("__camera");p("__config");var h=p("__physics"),d=p("__print"),f=p("__constraints"),l=p("__transform"),g=p("__util"),m=p("vec3"),k=p("vec4");p("quat");var x=p("mat3"),r=p("mat4"),q=new Float32Array(2),z=new Float32Array(3),E=new Float32Array(3),A=new Float32Array(4),n=new Float32Array(9);a.MS_STATIC=b.MS_STATIC;a.MS_ANIMATION=
b.MS_ANIMATION;a.MS_TARGET_CONTROLS=b.MS_TARGET_CONTROLS;a.MS_EYE_CONTROLS=b.MS_EYE_CONTROLS;a.MS_HOVER_CONTROLS=b.MS_HOVER_CONTROLS;a.is_camera=b.is_camera;a.is_target_camera=b.is_target_camera;a.is_eye_camera=b.is_eye_camera;a.is_hover_camera=b.is_hover_camera;a.set_move_style=function(a,b){a.d.da=b};a.get_move_style=function(a){return b.is_camera(a)?b.get_move_style(a):(d.error("get_move_style(): Wrong object"),null)};a.set_velocity_params=function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&
!b.is_hover_camera(a))return d.error("set_velocity_params(): Wrong object or camera move style"),null;var f=a.d;f.Tn=c[0];f.Sn=c[1];f.Un=c[2]};a.get_velocity_params=function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return d.error("get_velocity_params(): Wrong object or camera move style"),null;c||(c=new Float32Array(3));var f=a.d;c[0]=f.Tn;c[1]=f.Sn;c[2]=f.Un;return c};a.set_look_at=function(a,c,d,f){var g=a.d;b.Jw(c,d,f,g.g,g.quat);l.A(a);h.sync_transform(a)};a.get_eye=
function(a,c){if(b.is_camera(a))return c||(c=new Float32Array(3)),m.copy(a.d.g,c),c;d.error("get_eye(): Wrong object")};a.set_pivot=c;a.set_trans_pivot=function(a,c,f){b.is_target_camera(a)?(m.copy(c,a.d.g),m.copy(f,a.d.Nb),l.A(a),h.sync_transform(a)):d.error("set_trans_pivot(): Wrong object or camera move style")};a.get_pivot=function(a,c){if(b.is_target_camera(a))return c||(c=new Float32Array(3)),m.copy(a.d.Nb,c),c;d.error("get_pivot(): Wrong object or camera move style")};a.rotate_pivot=function(b,
c,f){d.error("rotate_pivot() deprecated, use rotate_camera() or rotate_target_camera() instead");a.rotate_target_camera(b,c,f)};a.move_pivot=function(a,c,f){if(b.is_target_camera(a)){var g=a.d;if(g.Hs){var k=x.fromMat4(g.T,n),q=m.subtract(g.g,g.Nb,E);z[0]=c;z[1]=0;z[2]=f;m.scale(z,m.len(q),z);m.transformMat3(z,k,z);m.add(g.Nb,z,g.Nb);m.add(g.g,z,g.g);l.A(a);h.sync_transform(a)}}else d.error("move_pivot(): wrong object")};a.rotate_hover_cam=function(b,c){d.error("rotate_hover_cam() deprecated, use rotate_camera() or rotate_hover_camera() instead");
a.rotate_hover_camera(b,c,0)};a.get_hover_cam_angle=function(a){d.error("get_hover_cam_angle() deprecated, use get_camera_angles() instead");return b.is_hover_camera(a)?-b.get_camera_angles(a,q)[1]:(d.error("get_hover_cam_angle(): wrong object or camera move style"),null)};a.set_hover_cam_angle=function(a,c){d.error("set_hover_cam_angle() deprecated, use rotate_camera() or rotate_hover_camera() instead");if(b.is_hover_camera(a))if(a.d.cb){var f=b.get_camera_angles(a,q);(f=-c-f[1])&&b.rotate_hover_camera(a,
0,f);l.A(a);h.sync_transform(a)}else d.error("set_hover_cam_angle(): distance/hover_angle limits are not defined or disabled");else d.error("set_hover_cam_angle(): wrong object or camera move style")};a.get_hover_angle_limits=function(a,c){if(b.is_hover_camera(a))return a.d.Kb?(c||(c=new Float32Array(2)),c[0]=a.d.Kb.La,c[1]=a.d.Kb.Sa):d.error("get_hover_angle_limits(): camera hasn't angle limits"),c;d.error("get_hover_angle_limits(): wrong object")};a.get_cam_dist_limits=function(a,c){if(b.is_hover_camera(a)||
b.is_target_camera(a))return a.d.cb?(c||(c=new Float32Array(2)),c[0]=a.d.Af,c[1]=a.d.Pd):d.error("get_cam_dist_limits(): camera hasn't distance limits"),c;d.error("get_cam_dist_limits(): wrong object")};a.translate_hover_cam_v=function(b,c){d.error("translate_hover_cam_v() deprecated, use hover_cam_set_translation() instead");a.hover_cam_set_translation(b,c)};a.hover_cam_set_translation=function(a,c){if(b.is_hover_camera(a)){var f=a.d;if(f.cb){var g=m.subtract(c,f.g,z);m.add(g,f.lc,f.lc)}l.set_translation(a,
c);l.A(a);h.sync_transform(a)}else d.error("hover_cam_set_translation(): wrong object")};a.get_hover_cam_pivot=function(a,c){if(!b.is_hover_camera(a))return d.error("get_hover_cam_pivot(): wrong object"),null;c||(c=new Float32Array(3));m.copy(a.d.lc,c);return c};a.has_distance_limits=function(a){return b.is_target_camera(a)||b.is_hover_camera(a)?a.d.cb:(d.error("has_distance_limits(): wrong object"),null)};a.apply_vertical_limits=function(a,c,f,g){switch(b.get_move_style(a)){case b.MS_TARGET_CONTROLS:case b.MS_EYE_CONTROLS:g|=
l.SPACE_WORLD;break;case b.MS_HOVER_CONTROLS:if(c>f){d.error("apply_vertical_limits(): wrong vertical limits");return}break;default:d.error("apply_vertical_limits(): wrong object");return}a.d.wd={La:c,Sa:f};b.Ry(a,g==l.SPACE_LOCAL);l.A(a);h.sync_transform(a)};a.clear_vertical_limits=function(a){a.d.wd=null};a.apply_horizontal_limits=function(a,c,f,g){switch(b.get_move_style(a)){case b.MS_TARGET_CONTROLS:case b.MS_EYE_CONTROLS:break;case b.MS_HOVER_CONTROLS:if(c>f){d.error("apply_horizontal_limits(): wrong horizontal limits");
return}break;default:d.error("apply_horizontal_limits(): wrong object");return}a.d.Wb={left:c,right:f};b.Ny(a,g==l.SPACE_LOCAL);l.A(a);h.sync_transform(a)};a.clear_horizontal_limits=function(a){a.d.Wb=null};a.get_horizontal_limits=function(a,c){if(b.is_target_camera(a)||b.is_eye_camera(a)||b.is_hover_camera(a)){var f=a.d;c=c||new Float32Array(2);if(f.Wb)return c[0]=f.Wb.left,c[1]=f.Wb.right,c}else d.error("get_horizontal_limits(): wrong object")};a.has_horizontal_limits=function(a){if(b.is_target_camera(a)||
b.is_eye_camera(a)||b.is_hover_camera(a))return Boolean(a.d.Wb);d.error("has_horizontal_limits(): wrong object")};a.apply_hover_angle_limits=function(a,c,f){b.is_hover_camera(a)?c<f?d.error("apply_hover_angle_limits(): wrong hover angle limits"):(c=g.angle_wrap_periodic(c,-Math.PI,Math.PI),f=g.angle_wrap_periodic(f,-Math.PI,Math.PI),c=g.clamp(c,-Math.PI/2,0),f=g.clamp(f,-Math.PI/2,0),a.d.Kb={La:c,Sa:f},b.Sx(a),l.A(a),h.sync_transform(a)):d.error("apply_hover_angle_limits(): wrong object")};a.clear_hover_angle_limits=
function(a){b.is_hover_camera(a)?a.d.Kb=null:d.error("clear_hover_angle_limits(): wrong object")};a.apply_distance_limits=function(a,c,f){if(b.is_target_camera(a)||b.is_hover_camera(a))if(c>f)d.error("apply_distance_limits(): wrong distance limits");else{var g=a.d;g.cb=!0;g.Pd=c;g.Af=f;l.A(a);h.sync_transform(a)}else d.error("apply_distance_limits(): wrong object")};a.clear_distance_limits=function(a){b.is_target_camera(a)||b.is_hover_camera(a)?a.d.cb=!1:d.error("clear_distance_limits(): wrong object")};
a.set_eye_params=function(b,c,f){d.error("set_eye_params() deprecated, use rotate_camera() or rotate_eye_camera() instead");a.rotate_eye_camera(b,c,Math.PI/2-f)};a.is_look_up=function(a){g.quat_to_dir(a.d.quat,g.AXIS_MY,z);return 0<=z[1]?!0:!1};a.rotate_camera=function(c,e,f,g,k){switch(a.get_move_style(c)){case b.MS_STATIC:case b.MS_ANIMATION:break;case b.MS_TARGET_CONTROLS:b.rotate_target_camera(c,e,f,g,k);break;case b.MS_EYE_CONTROLS:b.rotate_eye_camera(c,e,f,g,k);break;case b.MS_HOVER_CONTROLS:b.rotate_hover_camera(c,
e,f,g,k);break;default:d.error("rotate_camera(): Wrong object")}l.A(c);h.sync_transform(c)};a.rotate_target_camera=function(a,c,f,g,k){b.is_target_camera(a)?(b.rotate_target_camera(a,c,f,g,k),l.A(a),h.sync_transform(a)):d.error("rotate_target_camera(): wrong object")};a.rotate_eye_camera=function(a,c,f,g,k){b.is_eye_camera(a)?(b.rotate_eye_camera(a,c,f,g,k),l.A(a),h.sync_transform(a)):d.error("rotate_eye_camera(): wrong object")};a.rotate_hover_camera=function(a,c,f,g,k){b.is_hover_camera(a)?(b.rotate_hover_camera(a,
c,f,g,k),l.A(a),h.sync_transform(a)):d.error("rotate_hover_camera(): wrong object")};a.rotate=function(b,c,f){d.error("rotate() deprecated, use rotate_camera() or rotate_eye_camera() instead");a.rotate_eye_camera(b,c,-f)};a.get_camera_angles=function(a,c){c||(c=new Float32Array(2));b.get_camera_angles(a,c);return c};a.get_camera_angles_char=function(a,c){c||(c=new Float32Array(2));b.get_camera_angles_char(a,c);return c};a.get_angles=function(a,c){d.error("get_angles() deprecated, use get_camera_angles() instead");
c||(c=new Float32Array(2));b.get_angles(a,c);return c};a.set_stereo_distance=function(a,c){for(var d=a.d.H,f=0;f<d.length;f++){var g=d[f];g.type!=b.mb&&g.type!=b.wb||b.Fz(g,c,g.sd)}};a.get_stereo_distance=function(a){a=a.d.H;for(var c=0;c<a.length;c++){var d=a[c];if(d.type==b.mb||d.type==b.wb)return d.Mi}return 0};a.is_underwater=function(a){d.error("is_underwater() deprecated, always returns false");return a.d.Bs};a.translate_view=function(a,c,d,f){a=a.d.H;for(var g=0;g<a.length;g++){var k=a[g];
k.$b||b.ig(k,k.va);var h=z;h[0]=-c;h[1]=-d;h[2]=0;r.translate(k.pa,h,k.pa);r.rotateZ(k.pa,f,k.pa);r.multiply(k.pa,k.ja,k.ef);b.Wo(k);b.Vo(k)}};a.get_fov=function(a){return g.vk(a.d.H[0].kc)};a.set_fov=function(a,c){for(var d=a.d.H,f=0;f<d.length;f++){var k=d[f];k.kc=g.nw(c);k.$b||b.ig(k,k.va);r.multiply(k.pa,k.ja,k.ef);b.Wo(k);b.Vo(k)}};a.correct_up=function(a,b){b||(b=g.AXIS_Y);f.correct_up(a,b)};a.zoom_object=function(a,e){if(b.is_target_camera(a)){l.get_object_center(e,!1,z);c(a,z);l.A(a);var f=
l.get_object_size(e),g=b.hx(a)/2,f=f/Math.sin(g),g=l.Fy(a,z);l.move_local(a,0,f-g,0);l.A(a);h.sync_transform(a)}else d.error("zoom_object(): wrong object")};a.set_ortho_scale=function(c,e){if(b.is_camera(c)&&a.is_ortho_camera(c)){var f=c.d;if(b.is_target_camera(c)){var g=m.dist(f.g,f.Nb);f.Tg=e/2*f.Sg/g}else b.is_hover_camera(c)&&a.has_distance_limits(c)?(g=m.distance(f.g,f.lc),f.Tg=e/2*f.Sg/g):c.d.H[0].top=e/2;b.NA(c)}else d.error("set_ortho_scale(): wrong object")};a.get_ortho_scale=function(c){if(b.is_camera(c)&&
a.is_ortho_camera(c))return 2*c.d.H[0].top;d.error("get_ortho_scale(): wrong object")};a.is_ortho_camera=function(a){if(b.is_camera(a))return a.d.H[0].type==b.xc;d.error("is_ortho_camera(): wrong object")};a.calc_ray=function(a,c,f,g){g||(g=new Float32Array(3));var h=a.d.H[0];switch(h.type){case b.Sb:case b.Dd:case b.mb:case b.wb:var l=Math.tan(h.kc*Math.PI/360);A[0]=(2*c/h.width-1)*l*h.va;A[1]=-1;A[2]=(2*f/h.height-1)*l;A[3]=0;k.transformMat4(A,a.d.T,A);g[0]=A[0];g[1]=A[1];g[2]=A[2];m.normalize(g,
g);return g;default:return d.error("Non-compatible camera"),g}};a.project_point=function(a,c,d){d||(d=new Float32Array(2));return b.project_point(a,c,d)}};b4w.module.config=function(a,p){var c=p("__config");a.P_LOW=c.P_LOW;a.P_HIGH=c.P_HIGH;a.P_ULTRA=c.P_ULTRA;a.P_CUSTOM=c.P_CUSTOM;a.set=c.set;a.get=c.get;a.reset=c.reset;a.get_std_assets_path=c.get_std_assets_path};b4w.module.controls=function(a,p){var c=p("__controls"),b=p("__print");a.CT_CONTINUOUS=c.CT_CONTINUOUS;a.CT_TRIGGER=c.CT_TRIGGER;a.CT_SHOT=c.CT_SHOT;a.CT_LEVEL=c.CT_LEVEL;a.KEY_BACKSPACE=8;a.KEY_TAB=9;a.KEY_ENTER=13;a.KEY_SHIFT=16;a.KEY_CTRL=17;a.KEY_ALT=18;a.KEY_PAUSE=19;a.KEY_CAPSLOCK=20;a.KEY_ESC=27;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=
104;a.KEY_NUM9=105;a.KEY_A=65;a.KEY_B=66;a.KEY_C=67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=74;a.KEY_K=75;a.KEY_L=76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;a.KEY_8=56;a.KEY_9=57;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=187;a.KEY_COMMA=188;a.KEY_DASH=189;a.KEY_PERIOD=
190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=221;a.KEY_SINGLE_QUOTE=222;a.PL_SINGLE_TOUCH_MOVE=c.PL_SINGLE_TOUCH_MOVE;a.PL_MULTITOUCH_MOVE_ZOOM=c.PL_MULTITOUCH_MOVE_ZOOM;a.PL_MULTITOUCH_MOVE_PAN=c.PL_MULTITOUCH_MOVE_PAN;a.create_custom_sensor=c.create_custom_sensor;a.create_keyboard_sensor=c.create_keyboard_sensor;a.create_collision_sensor=c.create_collision_sensor;a.create_collision_impulse_sensor=c.create_collision_impulse_sensor;
a.create_ray_sensor=c.create_ray_sensor;a.create_mouse_click_sensor=c.create_mouse_click_sensor;a.create_mouse_wheel_sensor=c.create_mouse_wheel_sensor;a.create_mouse_move_sensor=c.create_mouse_move_sensor;a.create_touch_move_sensor=c.create_touch_move_sensor;a.create_touch_zoom_sensor=c.create_touch_zoom_sensor;a.create_motion_sensor=c.create_motion_sensor;a.create_vertical_velocity_sensor=c.create_vertical_velocity_sensor;a.create_gyro_angles_sensor=c.create_gyro_angles_sensor;a.create_gyro_delta_sensor=
c.create_gyro_delta_sensor;a.create_timer_sensor=function(a,b){return c.create_timer_sensor(a,b||!1)};a.reset_timer_sensor=c.reset_timer_sensor;a.create_elapsed_sensor=c.create_elapsed_sensor;a.create_timeline_sensor=c.create_timeline_sensor;a.create_selection_sensor=function(a,b){return c.create_selection_sensor(a,b||!1)};a.set_custom_sensor=function(a,b){c.sz(a,b)};a.get_custom_sensor=function(a){return a.value};a.get_sensor_value=c.get_sensor_value;a.get_sensor_payload=c.get_sensor_payload;a.create_sensor_lock=
function(a,d,f){b.error("create_sensor_lock() deprecated");a.Lm=d.slice(0);a.Km=Array(d.length);a.Zj=f||c.Ml};a.remove_sensor_lock=function(a){b.error("remove_sensor_lock() deprecated");a.Lm=null;a.Km=null;a.Zj=null};a.create_sensor_manifold=function(a,b,f,l,g,m,k){g=g||c.Ml;c.create_sensor_manifold(a,b,f,l,g,m,void 0===k?null:k)};a.create_kb_sensor_manifold=function(a,b,f,l,g,m){l=c.create_keyboard_sensor(l);c.create_sensor_manifold(a,b,f,[l],c.Ml,g,void 0===m?null:m)};a.check_sensor_manifolds=function(a){return c.check_sensor_manifold(a,
null)};a.check_sensor_manifold=c.check_sensor_manifold;a.remove_sensor_manifolds=function(a){b.error("remove_sensor_manifolds() deprecated, use remove_sensor_manifold() instead");c.remove_sensor_manifold(a,null)};a.remove_sensor_manifold=c.remove_sensor_manifold;a.reset=c.reset;a.register_keyboard_events=c.register_keyboard_events;a.register_mouse_events=function(a,b,f){c.register_mouse_events(a,b,!!f)};a.register_wheel_events=c.register_wheel_events;a.register_touch_events=c.register_touch_events;
a.register_device_orientation=c.register_device_orientation;a.unregister_keyboard_events=c.unregister_keyboard_events;a.unregister_mouse_events=c.unregister_mouse_events;a.unregister_wheel_events=c.unregister_wheel_events;a.unregister_device_orientation=c.register_device_orientation;a.unregister_touch_events=c.unregister_touch_events};b4w.module.constraints=function(a,p){var c=p("__camera"),b=p("__constraints"),h=p("__physics"),d=p("__transform");a.append_stiff=function(a,c,g,m,k){k=k||1;c instanceof Array&&2==c.length?b.Ao(a,c[0],c[1],g,m,k):b.Bo(a,c,g,m,k);d.A(a);h.sync_transform(a)};a.append_semi_stiff=function(a,c,g,m){b.vu(a,c,g,m);d.A(a);h.sync_transform(a)};a.append_semi_stiff_cam=function(a,l,g,m,k,p,r,q){if(!c.is_eye_camera(a))return m_print.error("append_semi_stiff_cam(): Wrong object"),null;b.uu(a,l,g,m,k,p,r,q);d.A(a);
h.sync_transform(a)};a.append_semi_soft_cam=function(a,c,g,m){if(!m||0>m)m=.25;b.tu(a,c,g,m);d.A(a);h.sync_transform(a)};a.append_stiff_trans=function(a,c,g){b.wu(a,c,g);d.A(a);h.sync_transform(a)};a.append_copy_trans=function(a,c,g){b.pu(a,c,g);d.A(a);h.sync_transform(a)};a.append_stiff_trans_rot=function(a,c,g,m){b.xu(a,c,g,m);d.A(a);h.sync_transform(a)};a.append_track=function(a,c){3==c.length?b.Au(a,c):b.zu(a,c);d.A(a);h.sync_transform(a)};a.append_follow=function(a,c,g,m){3==c.length?b.ru(a,
c,g,m):b.qu(a,c,g,m);d.A(a);h.sync_transform(a)};a.append_stiff_viewport=function(a,c,g){b.append_stiff_viewport(a,c,g);d.A(a);h.sync_transform(a)};a.remove=function(a){a.Oa&&b.remove(a)};a.get_parent=b.get_parent};b4w.module.data=function(a,p){var c=p("__data");p("__print");p("__util");a.load=c.load;a.unload=function(a){c.unload(a|0)};a.set_debug_resources_root=c.set_debug_resources_root;a.is_primary_loaded=c.is_primary_loaded;a.load_and_add_new=c.load;a.cleanup=a.unload};b4w.module.debug=function(a,p){p("__batch");p("__config");var c=p("__controls"),b=p("__debug"),h=p("__physics"),d=p("__print"),f=p("__scenegraph"),l=p("__scenes"),g=p("__shaders"),m=p("__sfx"),k=p("__textures"),x=p("__util"),r=p("vec3");a.physics_stats=function(){h.jw()};a.physics_id=function(a){d.log("O",h.Lw(a));for(var b=h.fx().l.p,c=0;c<b.length;c++){var f=b[c];f.sb.N==a&&d.log("B",f)}};a.visible_objects=function(){for(var a=l.get_active(),b=l.Da(a,"MESH",l.DATA_ID_ALL),a=l.ia(a,"MAIN_OPAQUE").p,
c=0;c<b.length;c++){var f=b[c],g=f.d;if("DYNAMIC"==g.type)for(var k=0;k<a.length;k++){var e=a[k];if(e.W&&e.ib==g){d.log(f.name,f);break}}}};a.object_info=function(a){for(var b=l.get_active(),c=l.Da(b,"MESH",l.DATA_ID_ALL),f=0;f<c.length;f++){var g=c[f];if(g.name==a){d.log("Object",g);for(var k=l.gm(b),e=0;e<k.length;e++){for(var h=k[e],m=h.p,p=[],r=0;r<m.length;r++)m[r].ib==g.d&&p.push(m[r]);d.log("Subscene "+h.type,p)}}}};a.objects_stat=function(){var a=l.get_active();console.log("Armatures: "+l.Da(a,
"ARMATURE",l.DATA_ID_ALL).length);console.log("Cameras: "+l.Da(a,"CAMERA",l.DATA_ID_ALL).length);console.log("Curves: "+l.Da(a,"CURVE",l.DATA_ID_ALL).length);console.log("Empties: "+l.Da(a,"EMPTY",l.DATA_ID_ALL).length);console.log("Lamps: "+l.Da(a,"LAMP",l.DATA_ID_ALL).length);console.log("Meshes: "+l.Da(a,"MESH",l.DATA_ID_ALL).length);console.log("Speakers: "+l.Da(a,"SPEAKER",l.DATA_ID_ALL).length)};a.num_vertices=function(){for(var a=0,b=l.get_active(),b=[l.ia(b,"MAIN_OPAQUE"),l.ia(b,"MAIN_BLEND")],
c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.p,f=0;f<d.length;f++){var g=d[f].o;g&&(a+=g.num_vertices)}}return a};a.num_triangles=function(){for(var a=0,b=l.get_active(),b=[l.ia(b,"MAIN_OPAQUE"),l.ia(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.p,f=0;f<d.length;f++){var g=d[f].o;g&&(a+=g.num_triangles)}}return a};a.num_draw_calls=function(){var a=l.get_active(),a=[l.ia(a,"MAIN_OPAQUE"),l.ia(a,"MAIN_BLEND")];return a[0].p.length+a[1].p.length};a.num_shaders=function(){return x.ed(g.Yp())};
a.geometry_stats=function(){for(var a=l.get_active(),b=l.gm(a),a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=d.type&&"WIREFRAME"!=d.type)for(var f=d.p,g=0;g<f.length;g++){var e=f[g].o,k=f[g].ib;e&&("COLOR_PICKING"!=d.type&&"OUTLINE_MASK"!=d.type||k.ik||k.hk)&&(a[e.id]=e)}}var f=d=c=b=0,h;for(h in a)e=a[h],e=e.R,e.Dj&&(d++,f+=e.Dj/1048576),b++,c+=e.tp/1048576;return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:f}};a.num_textures=function(){for(var a=[],b=0,c=l.get_active(),c=[l.ia(c,"MAIN_OPAQUE"),
l.ia(c,"MAIN_BLEND")],d=0;d<c.length;d++){var f=c[d];if(f)for(var f=f.p,g=0;g<f.length;g++){var e=f[g].o;if(e)for(var e=e.M,k=0;k<e.length;k++){var h=e[k];if("IMAGE"===h.source||"ENVIRONMENT_MAP"===h.source){var m=h.Ta;-1===a.indexOf(m)&&(a.push(m),h=h.width*h.height*4/1048576/h.Bl,h*=1.3333,b+=h)}}}}return{number:a.length,memory:b}};a.num_render_targets=function(){for(var a=[],b=0,c=l.get_active(),c=l.gm(c),d=0;d<c.length;d++){var f=c[d];if("SINK"!=f.type){var g=f.j,e=[g.yb,g.Cc];e.push.apply(e,
f.td);for(f=0;f<e.length;f++){var h=e[f];k.mi(h)&&-1==a.indexOf(h)&&(a.push(h),b+=g.width*g.height*k.Gx(h))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=l.get_active();(a=l.ia(a,"MAIN_OPAQUE"))&&l.Tq(a.j,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=l.get_active(),b=l.ia(a,"MAIN_OPAQUE"),a=l.lA(a,["SHADOW_CAST"]);if(b)for(var c=0;c<a.length;c++){var d=a[c],f;switch(c){case 0:f=[1,0,0];break;case 1:f=[0,1,0];break;case 2:f=[0,0,1];break;default:f=
[1,0,1]}l.Tq(d.j,b,f)}};a.scenegraph_to_dot=function(){for(var a=l.ei(),b=0;b<a.length;b++)d.log("\n"+f.gw(l.im(a[b])))};a.scenes_to_dot=function(){};a.controls_info=c.debug;a.object_distance=function(a,b){return r.dist(a.d.g,b.d.g)};a.msg=b.msg;a.fbmsg=b.fbmsg;a.print_telemetry=b.print_telemetry;a.plot_telemetry=b.plot_telemetry;a.fbres=function(a,c){function d(){b.fbmsg("FBRES",a());setTimeout(d,c)}c||(c=16);d()};a.assert_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,
1]),c=new Float32Array([1,0,0]),d=new Float32Array([0,1,0]),f=new Float32Array([0,0,1]),g=new Float32Array([-1,0,0]),e=new Float32Array([0,-1,0]),k=new Float32Array([0,0,-1]);if(!x.te(a,x.bu))throw"Wrong VEC3_IDENT";if(!x.te(b,x.Wt))throw"Wrong QUAT4_IDENT";if(!x.te(c,x.AXIS_X))throw"Wrong AXIS_X";if(!x.te(d,x.AXIS_Y))throw"Wrong AXIS_Y";if(!x.te(f,x.AXIS_Z))throw"Wrong AXIS_Z";if(!x.te(g,x.AXIS_MX))throw"Wrong AXIS_MX";if(!x.te(e,x.AXIS_MY))throw"Wrong AXIS_MY";if(!x.te(k,x.AXIS_MZ))throw"Wrong AXIS_MZ";
};a.mute_music=function(){for(var a=m.get_speaker_objects(),b=0;b<a.length;b++){var c=a[b];"BACKGROUND_MUSIC"==m.km(c)&&m.mute(c,!0)}};a.check_finite=function(a){b.check_finite(a)};a.set_debug_params=function(a){var b=l.get_active();if(b=l.ia(b,"WIREFRAME"))"string"==typeof a.wireframe_mode&&l.Kz(b,a.wireframe_mode),"object"==typeof a.wireframe_edge_color&&l.Jz(b,a.wireframe_edge_color);else throw"Wireframe subscene not found.";};a.get_error_quantity=function(){return d.tx()};a.get_warning_quantity=
function(){return d.Jx()};a.clear_errors_warnings=function(){return d.clear_errors_warnings()}};b4w.module.geometry=function(a,p){var c=p("__batch"),b=p("__geometry"),h=p("__print"),d=p("__renderer");a.extract_vertex_array=function(a,d,g){if(!b.gi(a))return h.error("Wrong object:",a.name),null;if(a=c.Y(a,d,"MAIN")||c.Y(a,d,"NODES")){if((d=a.R)&&d.Ob&&d.Ob[g])return b.Ew(d,g);h.error("Attribute not found:"+g);return null}h.error("Wrong material:",d);return null};a.extract_index_array=function(a,d){if(!b.gi(a))return h.error("Wrong object:",a.name),null;var g=c.Y(a,d,"MAIN")||c.Y(a,d,"NODES");
if(g){if((g=g.R)&&g.Ob)return g.Ee;h.error("Buffer data not found");return null}h.error("Wrong material:",d);return null};a.update_vertex_array=function(a,d,g,m){var k=["MAIN","NODES","DEPTH","COLOR_ID"];if(b.gi(a))for(var p=0;p<k.length;p++){var r=c.Y(a,d,k[p]);r&&(r=r.R)&&r.Ob&&r.Ob[g]&&b.Kk(r,g,0,m)}else h.error("Wrong object:",a.name)};a.override_geometry=function(a,l,g,m,k){var p=["MAIN","NODES","DEPTH","COLOR_ID"];if(b.gi(a))if(g instanceof Uint16Array||g instanceof Uint32Array)if(m instanceof
Float32Array)for(var r=0;r<p.length;r++){var q=c.Y(a,l,p[r]);if(q){var z=q.R;if(z){b.EA(z,q.Qd,g);var E=0,A;for(A in z.Ob)var n=z.Ob[A],E=E+m.length/3*n.jd;z.Vc=new Float32Array(E);var E=z.Vc,u=0;for(A in z.Ob)switch(n=z.Ob[A],A){case "a_position":E.set(m,u);n.offset=u;n.length=m.length;u+=n.length;break;case "a_normal":var e;k&&(e=b.Uo(g,m,m));var O=b.So(g,m,e);E.set(O,u);n.offset=u;n.length=m.length;u+=n.length;break;case "a_tangent":n.offset=u;n.length=m.length/3*n.jd;for(var O=new Float32Array(n.length),
I=0;I<O.length;I+=4)O[I]=1,O[I+3]=1;E.set(O,u);u+=n.length;break;default:n.offset=u,n.length=m.length/3*n.jd,O=new Float32Array(n.length),E.set(O,u),u+=n.length}b.Es(z);d.Do(q);(q=c.jc(a,q))&&q.R&&(q.R=z)}}}else h.error("Wrong positions_array type");else h.error("Wrong ibo_array type");else h.error("Wrong object:",a.name)};a.set_shape_key_value=function(a,c,d){if(!b.check_shape_keys(a))return h.error("Wrong object:",a.name),null;if(!b.tq(a,c))return h.error("Wrong key name:",c),null;b.Gu(a,c,parseFloat(d))};
a.check_shape_keys=function(a){return b.check_shape_keys(a)};a.get_shape_keys_names=function(a){return b.check_shape_keys(a)?b.get_shape_keys_names(a):(h.error("Wrong object:",a.name),null)};a.get_shape_key_value=function(a,c){return b.check_shape_keys(a)?b.tq(a,c)?b.get_shape_key_value(a,c):(h.error("Wrong key name:",c),null):(h.error("Wrong object:",a.name),null)}};b4w.module.hud=function(a,p){var c=p("__hud");p("__print");a.draw_mixer_strip=c.draw_mixer_strip;a.plot_array=c.plot_array};b4w.module.lights=function(a,p){function c(a){for(var b=f.get_active(),c=f.Da(b,"LAMP",f.DATA_ID_ALL),p=0;p<c.length;p++){var n=c[p];if("SUN"==n.fa.type){var r=n;break}}if(!r)return h.error("There is no sun on the scene"),null;"number"==typeof a.hor_position&&"number"==typeof a.vert_position&&(c=(90-a.vert_position)/180*Math.PI,p=r.d,l.set_rotation_euler(r,[c,(180-a.hor_position)/180*Math.PI,0]),a=new Float32Array(3),g.quat_to_dir(p.quat,g.AXIS_Y,a),p=m.length(p.g),m.copy(a,k),m.scale(k,p,k),l.set_translation(r,
k),l.A(r),a=r.fa,a.zp&&(n=r.data.energy,p=b.world.light_settings.environment_energy,c=Math.cos(Math.abs(c)),n*=Math.max(Math.min(3*c,1),0),c=Math.max(c,.1)*p,d.Ur(a,n),f.set_environment_colors(b,c,null,null)),f.mg(r,b))}function b(a){if(d.ym(a))return a.fa.type;h.error("get_light_type(): Wrong object");return!1}var h=p("__print"),d=p("__lights"),f=p("__scenes");p("__batch");var l=p("__transform"),g=p("__util"),m=p("vec3"),k=new Float32Array(3),x,r=60;a.get_lamps=function(a){var b=f.get_active(),b=
f.Da(b,"LAMP",f.DATA_ID_ALL);if(!a)return b;for(var c=[],d=0;d<b.length;d++){var g=b[d];g.fa.type===a&&c.push(g)}return c};a.get_sun_params=function(){for(var a=f.get_active(),a=f.Da(a,"LAMP",f.DATA_ID_ALL),b=null,c=0;c<a.length;c++){var d=a[c];if("SUN"==d.fa.type){b=d;break}}return b?(b=b.fa.direction,a=180*Math.atan2(b[2],b[0])/Math.PI+90,180<a&&(a-=360),b=180*Math.atan2(b[1],Math.sqrt(b[0]*b[0]+b[2]*b[2]))/Math.PI,c={},c.hor_position=a,c.vert_position=b,c):null};a.set_sun_params=c;a.set_day_time=
function(a){for(var b=f.get_active(),b=f.Da(b,"LAMP",f.DATA_ID_ALL),d=0;d<b.length;d++){var g=b[d];if("SUN"==g.fa.type){var k=g;break}}if(!k)return h.error("There is no sun on the scene"),null;k=-Math.cos(a/12*Math.PI)*r;b={};b.hor_position=12>a?15*a:15*(a-24);b.vert_position=k;c(b)};a.set_date=function(a){(x=a.getDate())?1582==x&&10==a.pD&&4<a.fw&&15>a.fw&&h.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!"):h.error("There is no year 0 in the Julian system!")};a.set_max_sun_angle=
function(a){r=Math.min(Math.max(a,0),90)};a.get_light_params=function(a){if(d.ym(a))var c=a.fa;else return h.error("get_light_params(): Wrong object"),!1;if(a=b(a))switch(a){case "SPOT":var f={light_type:a,light_color:c.color,light_energy:c.Ae,light_spot_blend:c.lg,light_spot_size:c.Uc,light_distance:c.distance};break;case "POINT":f={light_type:a,light_color:c.color,light_energy:c.Ae,light_distance:c.distance};break;default:f={light_type:a,light_color:c.color,light_energy:c.Ae}}return f?f:!1};a.get_light_type=
b;a.set_light_params=function(a,b){if(d.ym(a))var c=a.fa;else return h.error("set_light_params(): Wrong object"),!1;var g=f.get_active();"number"==typeof b.light_energy&&(d.Ur(c,b.light_energy),f.mg(a,g));"object"==typeof b.light_color&&(d.zz(c,b.light_color),f.mg(a,g));"number"==typeof b.light_spot_blend&&(d.Bz(c,b.light_spot_blend),f.mg(a,g));"number"==typeof b.light_spot_size&&(d.Cz(c,b.light_spot_size),f.mg(a,g));"number"==typeof b.light_distance&&(d.Az(c,b.light_distance),f.mg(a,g));f.zA()}};b4w.module.material=function(a,p){function c(a,b){for(var c=a.n,d=0;d<c.length;d++){var f=c[d];if(-1<f.Fc.indexOf(b))return"MAIN"==f.type}return!1}function b(a,b){var c=d.Y(a,b,"MAIN");return Boolean(c&&c.cc[0])}function h(a,b){var c=d.Y(a,b,"MAIN");return Boolean(c&&c.cc[1])}var d=p("__batch"),f=p("__config"),l=p("__print"),g=p("__objects"),m=p("__shaders");p("__util");p("vec4");var k=f.q,x="u_colormap0 u_colormap1 u_stencil0 u_specmap u_normalmap0 u_mirrormap".split(" ");a.inherit_material=function(a,
b,c,f){if(g.ii(c)&&g.ii(a)){for(var k=["MAIN","DEPTH","COLOR_ID"],h=!1,m=0;m<k.length;m++){var e=k[m],p=d.Y(a,b,e),I=d.Y(c,f,e);if(p&&I){var h=!0,F=d.jc(c,f,e);"MAIN"==e&&(d.Vr(I,p),F&&d.Vr(F,p));for(e=0;e<I.Gb.length;e++){var t=I.Gb[e];if(-1!==x.indexOf(t)){var y=p.Gb.indexOf(t);-1!==y&&(I.M[e]=p.M[y],F&&(t=F.Gb.indexOf(t),-1!==t&&(F.M[t]=p.M[y])))}}}}h||l.error("Wrong objects for inheriting material!")}else l.error("Wrong or batched object(s)")};a.get_materials_names=function(a){var b=[];a=a.n;
for(var c=0;c<a.length;c++)for(var d=0;d<a[c].Fc.length;d++)-1==b.indexOf(a[c].Fc[d])&&b.push(a[c].Fc[d]);return b};a.set_diffuse_color=function(a,b,c){var f=d.Y(a,b,"MAIN");f?(f.ob.set(c),(a=d.jc(a,b,"MAIN"))&&a.ob.set(c)):l.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_color=function(a,b){var c=d.Y(a,b,"MAIN");if(c){var f=Array(4);f[0]=c.ob[0];f[1]=c.ob[1];f[2]=c.ob[2];f[3]=c.ob[3];return f}l.error('Couldn\'t get property "diffuse_color"!')};a.set_diffuse_intensity=function(a,
b,c){var f=d.Y(a,b,"MAIN");if(f){if(f.xe=c,a=d.jc(a,b,"MAIN"))a.xe=c}else l.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_intensity=function(a,b){var c=d.Y(a,b,"MAIN");if(c)return c.xe;l.error('Couldn\'t get property "diffuse_intensity"!')};a.set_specular_color=function(a,b,c){var f=d.Y(a,b,"MAIN");f?(f.qd.set(c),(a=d.jc(a,b,"MAIN"))&&a.qd.set(c)):l.error('Couldn\'t set property "specular_color"!')};a.get_specular_color=function(a,b){var c=d.Y(a,b,"MAIN");if(c){var f=Array(3);f[0]=
c.qd[0];f[1]=c.qd[1];f[2]=c.qd[2];return f}l.error('Couldn\'t get property "specular_color"!')};a.set_specular_intensity=function(a,c,f){b(a,c)||l.error('Property "specular_intensity" is missing!');d.Y(a,c,"MAIN").cc[0]=f;(a=d.jc(a,c,"MAIN"))&&(a.cc[0]=f)};a.get_specular_intensity=function(a,c){b(a,c)||l.error('Property "specular_intensity" is missing!');return d.Y(a,c,"MAIN").cc[0]};a.check_specular_intensity=b;a.set_specular_hardness=function(a,b,c){h(a,b)||l.error('Property "specular_hardness" is missing!');
d.Y(a,b,"MAIN").cc[1]=c;(a=d.jc(a,b,"MAIN"))&&(a.cc[1]=c)};a.get_specular_hardness=function(a,b){h(a,b)||l.error('Property "specular_hardness" is missing!');return d.Y(a,b,"MAIN").cc[1]};a.check_specular_hardness=h;a.set_emit_factor=function(a,b,c){var f=d.Y(a,b,"MAIN");if(f){if(f.Rd=c,a=d.jc(a,b,"MAIN"))a.Rd=c}else l.error('Couldn\'t set property "emit_factor"!')};a.get_emit_factor=function(a,b){var c=d.Y(a,b,"MAIN");if(c)return c.Rd;l.error('Couldn\'t get property "emit_factor"!')};a.set_ambient_factor=
function(a,b,c){var f=d.Y(a,b,"MAIN");if(f){if(f.Gd=c,a=d.jc(a,b,"MAIN"))a.Gd=c}else l.error('Couldn\'t set property "ambient_factor"!')};a.get_ambient_factor=function(a,b){var c=d.Y(a,b,"MAIN");if(c)return c.Gd;l.error('Couldn\'t get property "ambient_factor"!')};a.set_diffuse_color_factor=function(a,b,c){var f=d.Y(a,b,"MAIN");if(f){if(f.we=c,a=d.jc(a,b,"MAIN"))a.we=c}else l.error('Couldn\'t set property "diffuse_color_factor"!')};a.get_diffuse_color_factor=function(a,b){var c=d.Y(a,b,"MAIN");if(c)return c.we;
l.error('Couldn\'t get property "diffuse_color_factor"!')};a.set_alpha_factor=function(a,b,c){var f=d.Y(a,b,"MAIN");if(f){if(f.ne=c,a=d.jc(a,b,"MAIN"))a.ne=c}else l.error('Couldn\'t set property "alpha_factor"!')};a.get_alpha_factor=function(a,b){var c=d.Y(a,b,"MAIN");if(c)return c.ne;l.error('Couldn\'t get property "alpha_factor"!')};a.get_material_extended_params=function(a,b){if(!a||!b)return l.error("missing arguments in get_material_params"),null;if(!c(a,b))return null;var f=d.Y(a,b,"MAIN");
if(!f)return null;var g={};"MAIN"==f.type&&(g.fg=f.fg,g.AC=f.Oc[2],g.BC=5*(1-f.Oc[3]),g.bg=f.bg,g.xD=d.qb(f,"PARALLAX_STEPS")[1]);return g};a.get_water_material_params=function(a,b){if(!a||!b)return l.error("missing arguments in get_water_material_params"),null;if(!c(a,b))return null;var f=d.Y(a,b,"MAIN");if(!f||!f.gf)return null;if(!f)return l.error("material not found"),null;var g={};if("MAIN"==f.type){if(k.kh){var h=g.shallow_water_col=Array(3);h[0]=f.shallow_water_col[0];h[1]=f.shallow_water_col[1];
h[2]=f.shallow_water_col[2];h=g.shore_water_col=Array(3);h[0]=f.shore_water_col[0];h[1]=f.shore_water_col[1];h[2]=f.shore_water_col[2];g.shallow_water_col_fac=f.shallow_water_col_fac;g.shore_water_col_fac=f.shore_water_col_fac}g.foam_factor=f.foam_factor;g.norm_uv_velocity=f.Gh;g.absorb_factor=d.qb(f,"ABSORB")[1];g.sss_strength=d.qb(f,"SSS_STRENGTH")[1];g.sss_width=d.qb(f,"SSS_WIDTH")[1];g.dst_noise_scale0=d.qb(f,"DST_NOISE_SCALE_0")[1];g.dst_noise_scale1=d.qb(f,"DST_NOISE_SCALE_1")[1];g.dst_noise_freq0=
d.qb(f,"DST_NOISE_FREQ_0")[1];g.dst_noise_freq1=d.qb(f,"DST_NOISE_FREQ_1")[1];g.dir_min_shore_fac=d.qb(f,"DIR_MIN_SHR_FAC")[1];g.dir_freq=d.qb(f,"DIR_FREQ")[1];g.dir_noise_scale=d.qb(f,"DIR_NOISE_SCALE")[1];g.dir_noise_freq=d.qb(f,"DIR_NOISE_FREQ")[1];g.dir_min_noise_fac=d.qb(f,"DIR_MIN_NOISE_FAC")[1];g.dst_min_fac=d.qb(f,"DST_MIN_FAC")[1];g.waves_hor_fac=d.qb(f,"WAVES_HOR_FAC")[1]}return g};a.set_material_extended_params=function(a,b,f){if(a&&b&&f){if(!c(a,b))return l.error("setting material params is not possible"),
null;var g=d.Y(a,b,"MAIN");if(g){var k=[g];(g=d.jc(a,b,"MAIN"))&&k.push(g);for(a=0;a<k.length;a++)g=k[a],"number"==typeof f.material_reflectivity&&(g.fg=f.material_reflectivity),"number"==typeof f.material_fresnel&&(g.Oc[2]=f.material_fresnel),"number"==typeof f.material_fresnel_factor&&(g.Oc[3]=1-f.material_fresnel_factor/5),"number"==typeof f.material_parallax_scale&&(g.bg=f.material_parallax_scale),"number"==typeof f.material_parallax_steps&&(b=m.t(parseFloat(f.material_parallax_steps)),d.ea(g,
"PARALLAX_STEPS",b),d.vb(g,!0))}else l.error("material not found")}else l.error("missing arguments in set_material_params")};a.set_water_material_params=function(a,b,f){if(!a||!b||!f)return l.error("missing arguments in set_water_material_params"),null;if(!c(a,b))return l.error("setting water material params is not possible"),null;var g=d.Y(a,b,"MAIN");if(!g)return l.error("material not found"),null;var h=[g];(g=d.jc(a,b,"MAIN"))&&h.push(g);for(a=0;a<h.length;a++)g=h[a],k.kh&&("object"==typeof f.shallow_water_col&&
g.shallow_water_col.set(f.shallow_water_col),"number"==typeof f.shallow_water_col_fac&&(g.shallow_water_col_fac=f.shallow_water_col_fac),"object"==typeof f.shore_water_col&&g.shore_water_col.set(f.shore_water_col),"number"==typeof f.shore_water_col_fac&&(g.shore_water_col_fac=f.shore_water_col_fac)),k.shore_smoothing&&g.Zn&&("boolean"==typeof f.shore_smoothing&&(f.shore_smoothing?d.ea(g,"SHORE_SMOOTHING",1):d.ea(g,"SHORE_SMOOTHING",0)),"number"==typeof f.absorb_factor&&(b=m.t(parseFloat(f.absorb_factor)),
d.ea(g,"ABSORB",b))),"number"==typeof f.foam_factor&&k.Jg&&(g.foam_factor=f.foam_factor),"number"==typeof f.norm_uv_velocity&&(g.Gh=f.norm_uv_velocity),k.water_dynamic&&g.water_dynamic&&("boolean"==typeof f.water_dynamic&&(f.water_dynamic?d.ea(g,"DYNAMIC",1):d.ea(g,"DYNAMIC",0)),"number"==typeof f.waves_height&&(b=m.t(parseFloat(f.waves_height)),d.ea(g,"WAVES_HEIGHT",b)),"number"==typeof f.waves_length&&(b=m.t(parseFloat(f.waves_length)),d.ea(g,"WAVES_LENGTH",b)),"number"==typeof f.sss_strength&&
(b=m.t(parseFloat(f.sss_strength)),d.ea(g,"SSS_STRENGTH",b)),"number"==typeof f.sss_width&&(b=m.t(parseFloat(f.sss_width)),d.ea(g,"SSS_WIDTH",b)),"number"==typeof f.dst_noise_scale0&&(b=m.t(parseFloat(f.dst_noise_scale0)),d.ea(g,"DST_NOISE_SCALE_0",b)),"number"==typeof f.dst_noise_scale1&&(b=m.t(parseFloat(f.dst_noise_scale1)),d.ea(g,"DST_NOISE_SCALE_1",b)),"number"==typeof f.dst_noise_freq0&&(b=m.t(parseFloat(f.dst_noise_freq0)),d.ea(g,"DST_NOISE_FREQ_0",b)),"number"==typeof f.dst_noise_freq1&&(b=
m.t(parseFloat(f.dst_noise_freq1)),d.ea(g,"DST_NOISE_FREQ_1",b)),"number"==typeof f.dir_min_shore_fac&&(b=m.t(parseFloat(f.dir_min_shore_fac)),d.ea(g,"DIR_MIN_SHR_FAC",b)),"number"==typeof f.dir_freq&&(b=m.t(parseFloat(f.dir_freq)),d.ea(g,"DIR_FREQ",b)),"number"==typeof f.dir_noise_scale&&(b=m.t(parseFloat(f.dir_noise_scale)),d.ea(g,"DIR_NOISE_SCALE",b)),"number"==typeof f.dir_noise_freq&&(b=m.t(parseFloat(f.dir_noise_freq)),d.ea(g,"DIR_NOISE_FREQ",b)),"number"==typeof f.dir_min_noise_fac&&(b=m.t(parseFloat(f.dir_min_noise_fac)),
d.ea(g,"DIR_MIN_NOISE_FAC",b)),"number"==typeof f.dst_min_fac&&(b=m.t(parseFloat(f.dst_min_fac)),d.ea(g,"DST_MIN_FAC",b)),"number"==typeof f.waves_hor_fac&&(b=m.t(parseFloat(f.waves_hor_fac)),d.ea(g,"WAVES_HOR_FAC",b))),d.vb(g,!0);return!0}};b4w.module.particles=function(a,p){var c=p("__particles"),b=p("__print");a.set_size=function(a,d,f){c.Qg(a)?c.set_size(a,d,f):b.error('"',a.name,'" has no particle systems')};a.set_normal_factor=function(a,d,f){c.Qg(a)?c.set_normal_factor(a,d,f):b.error('"',a.name,'" has no particle systems')};a.set_factor=function(a,d,f){c.Qg(a)?(f=Math.min(f,1),f=Math.max(f,0),c.set_factor(a,d,f)):b.error('"',a.name,'" has no particle systems')}};b4w.module.physics=function(a,p){var c=p("__print"),b=p("__physics"),h=p("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){b.has_physics(a)?b.enable_simulation(a):c.error("No physics for object "+a.name)};a.disable_simulation=function(a){b.has_physics(a)?b.disable_simulation(a):c.error("No physics for object "+a.name)};a.has_physics=function(a){return b.has_physics(a)};a.has_simulated_physics=function(a){return b.has_simulated_physics(a)};a.has_dynamic_physics=
function(a){return b.has_dynamic_physics(a)};a.set_gravity=function(a,f){b.has_physics(a)?b.set_gravity(a,f):c.error("No physics for object "+a.name)};a.set_damping=function(a,f,h){b.has_physics(a)?b.s("set_damping",a.l.N,f,h):c.error("No physics for object "+a.name)};a.reset_damping=function(a){if(b.has_physics(a)){var f=a.game;b.s("set_damping",a.l.N,f.damping,f.rotation_damping)}else c.error("No physics for object "+a.name)};a.set_transform=function(a,f,h){b.has_physics(a)?b.set_transform.apply(this,
arguments):c.error("No physics for object "+a.name)};a.sync_transform=function(a){b.has_physics(a)?b.sync_transform(a):c.error("No physics for object "+a.name)};a.apply_velocity=function(a){b.has_physics(a)?b.apply_velocity.apply(this,arguments):c.error("No physics for object "+a.name)};a.apply_velocity_world=function(a){b.has_physics(a)?b.apply_velocity_world.apply(this,arguments):c.error("No physics for object "+a.name)};a.apply_force=function(a,f,h,g){b.has_physics(a)?b.apply_force.apply(this,
arguments):c.error("No physics for object "+a.name)};a.apply_torque=function(a,f,h,g){b.has_physics(a)?b.apply_torque.apply(this,arguments):c.error("No physics for object "+a.name)};a.vehicle_throttle=function(a,f){b.has_physics(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object"),b.vehicle_throttle(a,h.clamp(f,-1,1))):c.error("No physics for object "+a.name)};a.vehicle_throttle_inc=function(a,f,l){if(b.has_physics(a)){b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object");
f=h.clamp(f,0,1);var g=a.i.Ig;-1==l||1==l?g=Math.max(-1,Math.min(g+l*f,1)):0==l&&0<=g?(g-=f,g=Math.max(0,g)):0==l&&0>g?(g+=f,g=Math.min(0,g)):c.error("Wrong steering direction");b.vehicle_throttle(a,h.clamp(g,-1,1))}else c.error("No physics for object "+a.name)};a.vehicle_steer=function(a,f){b.has_physics(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object"),b.vehicle_steer(a,h.clamp(f,-1,1))):c.error("No physics for object "+a.name)};a.vehicle_steer_inc=function(a,f,l){if(b.has_physics(a)){b.is_vehicle_chassis(a)||
b.is_vehicle_hull(a)||c.error("Wrong object");f=h.clamp(f,0,1);var g=a.i.rh;-1==l||1==l?g=Math.max(-1,Math.min(g+l*f,1)):0==l&&0<=g?(g-=f,g=Math.max(0,g)):0==l&&0>g?(g+=f,g=Math.min(0,g)):c.error("Wrong steering direction");b.vehicle_steer(a,h.clamp(g,-1,1))}else c.error("No physics for object "+a.name)};a.vehicle_brake=function(a,f){b.has_physics(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object"),b.vehicle_brake(a,h.clamp(f,0,1))):c.error("No physics for object "+a.name)};
a.vehicle_brake_inc=function(a,f){if(b.has_physics(a)){b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object");f=h.clamp(f,-1,1);var l=a.i.Oh;b.vehicle_brake(a,h.clamp(l+l*f,0,1))}else c.error("No physics for object "+a.name)};a.is_vehicle_chassis=function(a){return b.is_vehicle_chassis(a)};a.is_vehicle_hull=function(a){return b.is_vehicle_hull(a)};a.get_vehicle_name=function(a){if(!b.has_physics(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.b4w_vehicle_settings.name;
c.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(!b.has_physics(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.i.Ig;c.error("Wrong object")};a.get_vehicle_steering=function(a){if(!b.has_physics(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.i.rh;c.error("Wrong object")};a.get_vehicle_brake=function(a){if(!b.has_physics(a))return c.error("No physics for object "+
a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.i.Oh;c.error("Wrong object")};a.get_vehicle_speed=function(a){if(!b.has_physics(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return b.get_vehicle_speed(a);c.error("Wrong object")};a.is_character=function(a){return b.is_character(a)};a.set_character_move_dir=function(a,f,h){b.has_physics(a)?b.set_character_move_dir(a,f,h):c.error("No physics for object "+a.name)};a.set_character_move_type=
function(a,f){b.has_physics(a)?b.set_character_move_type(a,f):c.error("No physics for object "+a.name)};a.set_character_walk_velocity=function(a,f){b.has_physics(a)?b.set_character_walk_velocity(a,f):c.error("No physics for object "+a.name)};a.set_character_run_velocity=function(a,f){b.has_physics(a)?b.set_character_run_velocity(a,f):c.error("No physics for object "+a.name)};a.set_character_fly_velocity=function(a,f){b.has_physics(a)?b.set_character_fly_velocity(a,f):c.error("No physics for object "+
a.name)};a.character_jump=function(a){b.has_physics(a)?b.character_jump(a):c.error("No physics for object "+a.name)};a.character_rotation_inc=function(a,f,h){b.has_physics(a)?b.character_rotation_inc(a,f,h):c.error("No physics for object "+a.name)};a.set_character_rotation_quat=function(a,f){b.has_physics(a)?b.set_character_rotation_quat(a,f):c.error("No physics for object "+a.name)};a.set_character_rotation=function(a,f,h){b.has_physics(a)?b.set_character_rotation(a,f,h):c.error("No physics for object "+
a.name)};a.set_character_rotation_v=function(a,f){b.has_physics(a)?b.set_character_rotation_v(a,f):c.error("No physics for object "+a.name)};a.set_character_rotation_h=function(a,f){b.has_physics(a)?b.set_character_rotation_h(a,f):c.error("No physics for object "+a.name)};a.append_collision_test=function(a,f,h,g){b.has_physics(a)?b.append_collision_test(a,f,h,g||!1):c.error("No physics for object "+a.name)};a.remove_collision_test=function(a,f){b.has_physics(a)?b.remove_collision_test(a,f):c.error("No physics for object "+
a.name)};a.apply_collision_impulse_test=function(a,f){b.has_physics(a)?b.apply_collision_impulse_test(a,f):c.error("No physics for object "+a.name)};a.clear_collision_impulse_test=function(a){b.has_physics(a)?b.clear_collision_impulse_test(a):c.error("No physics for object "+a.name)};a.append_ray_test=function(a,f,h,g,m,k){b.has_physics(a)?b.append_ray_test(a,f,h,g,m,k):c.error("No physics for object "+a.name)};a.remove_ray_test=function(a,f,h,g,m){b.has_physics(a)?b.remove_ray_test(a,f,h,g,m):c.error("No physics for object "+
a.name)};a.apply_constraint=function(a,f,h,g,m,k,p,r,q,z){b.has_physics(f)&&b.has_physics(m)?b.apply_constraint(a,f,h,g,m,k,p,r,q,z):c.error("Wrong objects")};a.clear_constraint=function(a){b.has_physics(a)&&b.Ox(a)?b.clear_constraint(a):c.error("Wrong object")};a.pull_to_constraint_pivot=function(a,f,h,g,m,k){b.has_physics(a)&&b.has_physics(g)?b.pull_to_constraint_pivot(a,f,h,g,m,k):c.error("Wrong objects")}};b4w.module.scenes=function(a,p){var c=p("__batch"),b=p("__camera"),h=p("__graph"),d=p("__objects"),f=p("__print"),l=p("__physics"),g=p("__scenes"),m=p("__util");a.DATA_ID_ALL=g.DATA_ID_ALL;a.set_active=function(a){var b=g.ei();g.set_active(m.keysearch("name",a,b))};a.get_active=function(){return g.Z()?g.get_active().name:""};a.get_scenes=function(){for(var a=g.ei(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.get_active_camera=function(){if(g.Z())return g.Jj(g.get_active());f.error("No active scene");
return!1};a.get_object_by_name=function(a,b){var c=g.fd(g.mf,a,b|0);if(c)return c;f.error("get object "+a+": not found")};a.get_object_by_dupli_name=function(a,b,c){if(a=g.fd(g.Rk,a,b,c|0))return a;f.error("get object "+b+": not found")};a.get_object_by_dupli_name_list=function(a,b){var c=g.fd(g.Sk,a,b|0);if(c)return c;f.error("get object "+a+": not found")};a.get_object_data_id=function(a){return g.get_object_data_id(a)};a.pick_object=g.pick_object;a.outlining_is_enabled=function(a){return a&&a.d&&
a.d.Ab};a.set_outline_intensity=function(a,b){a&&a.d&&a.d.Ab?a.d.Qc=b:f.error("set_outline_intensity(): wrong object")};a.get_outline_intensity=function(a){if(a&&a.d&&a.d.Ab)return a.d.Qc;f.error("get_outline_intensity(): wrong object")};a.apply_outline_anim=function(a,b,c,d){a&&a.d&&a.d.Ab?g.apply_outline_anim(a,b,c,d):f.error("apply_outline_anim(): wrong object")};a.apply_outline_anim_def=function(a){if(a&&a.d&&a.d.Ab){var b=a.d.ti;g.apply_outline_anim(a,b.jk,b.lk,b.mk)}else f.error("apply_outline_anim_def(): wrong object")};
a.clear_outline_anim=function(a){a&&a.d&&a.d.Ab?g.clear_outline_anim(a):f.error("clear_outline_anim(): wrong object")};a.set_outline_color=g.set_outline_color;a.get_outline_color=function(a){var b=g.get_active();if(b=g.ia(b,"OUTLINE"))return a=a||new Float32Array(3),a.set(b.Le),a};a.set_glow_intensity=function(b,c){f.error("set_glow_intensity() deprecated, use set_outline_intensity() instead");a.set_outline_intensity(b,c)};a.get_glow_intensity=function(b){f.error("get_glow_intensity() deprecated, use get_outline_intensity() instead");
a.get_outline_intensity(b)};a.apply_glow_anim=function(b,c,d,g){f.error("apply_glow_anim() deprecated, use apply_outline_anim() instead");a.apply_outline_anim(b,c,d,g)};a.apply_glow_anim_def=function(b){f.error("apply_glow_anim_def() deprecated, use apply_outline_anim_def() instead");a.apply_outline_anim_def(b)};a.clear_glow_anim=function(b){f.error("clear_glow_anim() deprecated, use clear_outline_anim() instead");a.clear_outline_anim(b)};a.set_glow_color=function(b){f.error("set_glow_color() deprecated, use set_outline_color() instead");
a.set_outline_color(b)};a.get_glow_color=function(b){f.error("get_glow_color() deprecated, use get_outline_color() instead");a.get_outline_color(b)};a.get_shadow_params=function(){if(!g.Z())return f.error("No active scene"),!1;var a=g.get_active(),b=g.ia(a,"SHADOW_CAST");if(!b)return null;var c=a.d.nd,d=g.ia(a,"MAIN_OPAQUE"),h=g.ia(a,"DEPTH"),l={};l.csm_resolution=c.csm_resolution;l.self_shadow_polygon_offset=b.self_shadow_polygon_offset;h&&(l.self_shadow_normal_offset=h.self_shadow_normal_offset);
l.enable_csm=c.enable_csm;l.csm_num=c.csm_num;l.csm_first_cascade_border=c.csm_first_cascade_border;l.first_cascade_blur_radius=c.first_cascade_blur_radius;l.csm_last_cascade_border=c.csm_last_cascade_border;l.last_cascade_blur_radius=c.last_cascade_blur_radius;l.fade_last_cascade=c.fade_last_cascade;l.blend_between_cascades=c.blend_between_cascades;c.enable_csm?(l.csm_borders=g.qx(a,d.j),l.blur_radii=new Float32Array(c.csm_num),l.blur_radii.set(d.j.sk.subarray(0,c.csm_num))):(l.csm_borders=null,
l.blur_radii=null);return l};a.set_shadow_params=function(a){if(!g.Z())return f.error("No active scene"),!1;var d=g.get_active();"number"==typeof a.self_shadow_polygon_offset&&h.S(d.d.rb,function(b,c){"SHADOW_CAST"===c.type&&(c.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});var l=g.ia(d,"DEPTH");l&&("number"==typeof a.self_shadow_normal_offset&&(l.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(l.pcf_blur_radius=a.pcf_blur_radius));var m=g.ia(d,
"MAIN_BLEND");m&&("number"==typeof a.self_shadow_normal_offset&&(m.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(m.pcf_blur_radius=a.pcf_blur_radius),m.Ea=!0);m=d.d.nd;"number"==typeof a.csm_first_cascade_border&&(m.csm_first_cascade_border=a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&(m.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(m.csm_last_cascade_border=a.csm_last_cascade_border);
"number"==typeof a.last_cascade_blur_radius&&(m.last_cascade_blur_radius=a.last_cascade_blur_radius);if(l){for(var p=l.p,E=0;E<p.length;E++){var A=p[E];A.ib.Eb&&(A=A.o,c.gl(A,m),c.vb(A))}l.Ea=!0}l=d.camera.d.H;for(E=0;E<l.length;E++)b.Nn(l[E],m);g.nn(d)};a.get_environment_colors=function(){if(!g.Z())return f.error("No active scene"),!1;var a=g.get_active();return g.get_environment_colors(a)};a.set_environment_colors=function(a,b,c){if(!g.Z())return f.error("No active scene"),!1;var d=g.get_active();
g.set_environment_colors(d,parseFloat(a),b,c)};a.get_fog_color_density=function(a){if(!g.Z())return f.error("No active scene"),!1;var b=g.get_active();return g.get_fog_color_density(b,a)};a.set_fog_color_density=function(a){if(!g.Z())return f.error("No active scene"),!1;var b=g.get_active();g.set_fog_color_density(b,a)};a.get_ssao_params=function(){if(!g.Z())return f.error("No active scene"),!1;var a=g.get_active();return g.get_ssao_params(a)};a.set_ssao_params=function(a){if(!g.Z())return f.error("No active scene"),
!1;var b=g.get_active();g.set_ssao_params(b,a)};a.get_color_correction_params=function(){if(!g.Z())return f.error("No active scene"),null;var a=g.get_active(),a=g.ia(a,"COMPOSITING");if(!a)return null;var b={};b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b};a.set_color_correction_params=function(a){if(!g.Z())return f.error("No active scene"),null;var b=g.get_active(),b=g.ia(b,"COMPOSITING");if(!b)return null;"number"==typeof a.brightness&&
(b.brightness=a.brightness);"number"==typeof a.contrast&&(b.contrast=a.contrast);"number"==typeof a.exposure&&(b.exposure=a.exposure);"number"==typeof a.saturation&&(b.saturation=a.saturation);b.Ea=!0};a.get_sky_params=function(){if(!g.Z())return f.error("No active scene"),!1;var a=g.get_active();return g.get_sky_params(a)};a.set_sky_params=function(a){if(!g.Z())return f.error("No active scene"),!1;var b=g.get_active();g.set_sky_params(b,a)};a.get_dof_params=function(){if(!g.Z())return f.error("No active scene"),
!1;var a=g.get_active();return g.ia(a,"DOF")?g.get_dof_params(a):null};a.set_dof_params=function(a){if(!g.Z())return f.error("No active scene"),!1;var b=g.get_active();g.set_dof_params(b,a)};a.get_god_rays_params=function(){if(!g.Z())return f.error("No active scene"),!1;var a=g.get_active();return g.ia(a,"GOD_RAYS")?g.get_god_rays_params(a):null};a.set_god_rays_params=function(a){if(!g.Z())return f.error("No active scene"),!1;var b=g.get_active();g.set_god_rays_params(b,a)};a.get_bloom_params=function(){if(!g.Z())return f.error("No active scene"),
!1;var a=g.get_active();return g.ia(a,"BLOOM")?g.get_bloom_params(a):null};a.set_bloom_params=function(a){if(!g.Z())return f.error("No active scene"),!1;var b=g.get_active();g.set_bloom_params(b,a)};a.get_wind_params=function(){return g.get_wind_params()};a.set_wind_params=function(a){if(!g.Z())return f.error("No active scene"),!1;var b=g.get_active();g.set_wind_params(b,a)};a.get_water_surface_level=g.get_water_surface_level;a.set_water_params=function(a){if(!g.Z())return f.error("No active scene"),
!1;var b=g.get_active();g.set_water_params(b,a)};a.get_water_mat_params=function(a){if(!g.Z())return f.error("No active scene"),!1;var b=g.get_active();g.get_water_mat_params(b,a)};a.update_scene_materials_params=function(){if(!g.Z())return f.error("No active scene"),!1;var a=g.get_active();g.Fs(a)};a.hide_object=function(a){d.ii(a)||m.Uj(a)?g.hide_object(a):f.error("show/hide is only supported for dynamic meshes/empties")};a.show_object=function(a){d.ii(a)||m.Uj(a)?g.show_object(a):f.error("show/hide is only supported for dynamic meshes/empties")};
a.is_hidden=function(a){if(d.ii(a)||m.Uj(a))return g.is_hidden(a);f.error("show/hide is only supported for dynamic meshes/empties");return!1};a.is_visible=function(a){return a.d.is_visible};a.check_object=function(a){return g.Z()?g.check_object(a,g.get_active()):(f.error("No active scene"),!1)};a.check_object_by_name=function(a,b){return g.fd(g.mf,a,b|0)?!0:!1};a.check_object_by_dupli_name=function(a,b,c){return g.fd(g.Rk,a,b,c|0)?!0:!1};a.check_object_by_dupli_name_list=function(a,b){return g.fd(g.Sk,
a,b|0)?!0:!1};a.get_all_objects=function(a,b){var c=g.get_active();a||(a="ALL");b||0===b||(b=g.DATA_ID_ALL);return g.Da(c,a,b)};a.get_object_name=function(a){return a?a.name:(f.error("Wrong object name"),"")};a.get_object_type=function(a){return a&&a.type?a.type:(f.error("Wrong object ID"),"UNDEFINED")};a.get_object_dg_parent=function(a){return a.ua};a.get_object_children=function(a){return a.yc.slice(0)};a.get_first_character=function(){for(var a=g.Da(g.get_active(),"MESH",g.DATA_ID_ALL),b=0;b<a.length;b++){var c=
a[b];if(l.is_character(c))return c}return null};a.get_shore_dist=function(a,b){b||0===b||(b=1);return g.get_shore_dist(a,b)};a.get_cam_water_depth=function(){return g.get_cam_water_depth()};a.get_type_mesh_object=function(a){return"MESH"==a.type?a.d.type:null};a.get_meta_tags=function(){if(!g.Z())return f.error("No active scene"),!1;var a=g.get_active();return g.get_meta_tags(a)};a.append_object=function(a){if(!a.d.wm)return f.error('object "'+a.name+'" has been created not by coping.'),!1;var b=
a.name;if(g.fd(g.mf,a.name,0))for(var c=1;;){b=a.name+(3>String(c).length?"."+("000"+String(c)).slice(-3):"."+String(c));if(!g.fd(g.mf,b,0)){a.name=b;f.error('object "'+a.name+'" already exists. Name was replaced by "'+b+'".');break}c++}g.append_object(g.get_active(),a,!0)};a.remove_object=function(a){g.remove_object(a)||f.error('object "'+a.name+'" was not copied.')}};b4w.module.sfx=function(a,p){var c=p("__scenes"),b=p("__sfx"),h=p("__print");a.play=function(a,c,h){b.play(a,c,h)};a.play_def=function(a){b.play_def(a)};a.is_play=function(a){return b.is_play(a)};a.speaker_play=function(a,c,l,g){h.error("speaker_play() deprecated, use play() or play_def() instead");b.cyclic(a,c);g&&b.playrate(a,g);b.play(a,0,l)};a.speaker_stop=function(a){h.error("speaker_stop() deprecated, use stop() instead");b.stop(a)};a.stop=function(a){b.stop(a)};a.pause=function(a){b.Vz(a)};
a.resume=function(a){b.Xz(a)};a.speaker_playback_rate=function(a,c){h.error("speaker_playback_rate() deprecated, use playrate() instead");b.playrate(a,c)};a.playrate=function(a,c){b.playrate(a,c)};a.get_playrate=function(a){return b.get_playrate(a)};a.cyclic=function(a,c){b.cyclic(a,c)};a.is_cyclic=function(a){return b.is_cyclic(a)};a.listener_reset_speed=function(a,c){b.listener_reset_speed(a,c)};a.speaker_reset_speed=function(a,c,h){b.speaker_reset_speed(a,c,h)};a.get_volume=function(a){return a&&
"object"===typeof a?b.get_volume(a):b.yx()};a.set_volume=function(a,c){a&&"object"===typeof a?b.set_volume(a,c):b.Dz(c)};a.mute=function(a,c){a&&"object"===typeof a?b.mute(a,c):b.yy(c)};a.is_muted=function(a){return a&&"object"===typeof a?b.is_muted(a):b.by()};a.get_speaker_objects=function(){return b.get_speaker_objects().slice(0)};a.get_speakers=function(){h.error("get_speakers() deprecated, use get_speaker_objects() instead");return a.get_speaker_objects()};a.check_active_speakers=b.check_active_speakers;
a.set_compressor_params=function(a){b.set_compressor_params(c.get_active(),a)};a.get_compressor_params=function(){return b.get_compressor_params(c.get_active())};a.duck=function(a,c,h){a&&"object"===typeof a?b.duck(a,c,h):b.vw(c,h)};a.unduck=function(a){a&&"object"===typeof a?b.unduck(a):b.yA()};a.apply_playlist=b.apply_playlist;a.clear_playlist=b.clear_playlist;a.detect_audio_container=b.detect_audio_container;a.detect_video_container=b.detect_video_container;a.set_positional_params=b.set_positional_params;
a.get_positional_params=b.get_positional_params;a.set_filter_params=b.set_filter_params;a.get_filter_params=b.get_filter_params;a.get_filter_freq_response=b.get_filter_freq_response;a.get_duration=function(a){if(a&&b.Xd(a))return b.get_duration(a);h.error('Object "'+(a?a.name:void 0)+'" is not a valid speaker')}};b4w.module.shaders=function(a,p){function c(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(new RegExp(/^[A-Z.]+ /))){var f=d.split(" ")[0];f in b||(b[f]=0);b[f]++}}c=a=0;for(f in b)switch(f){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[f];break;default:a+=b[f]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function b(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);
c.send(b);if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function h(a){for(var b=g.ei(),c=0;c<b.length;c++)for(var d=g.Da(b[c],"MESH",g.DATA_ID_ALL),f=0;f<d.length;f++){var h=d[f];if(h.n)for(var l=0;l<h.n.length;l++){var m=h.n[l];if(m.Rb==a&&m.Fc.length)return m.Fc}}return null}function d(a){a.sort(function(a,b){return b.dm.ALU_OPS-a.dm.ALU_OPS});for(var b=0;b<a.length;b++){var c=a[b],d=c.dm,g=c.hB,l=h(c.dw),l=l?"\t\t("+l.join(", ")+")":"\t\t(NA)";f.groupCollapsed("FRAG --\x3e",
"ALU",d.ALU_OPS,"TEX",d.TEX_OPS,"\t\tVERT --\x3e","ALU",g.ALU_OPS,"TEX",g.TEX_OPS,l);f.groupCollapsed("directives");for(var l=c.Na.ye,m=0;m<l.length;m++){var n=l[m];f.log(n[0],n[1])}f.groupEnd();f.groupCollapsed("vert src");f.log(c.gB);f.groupEnd();f.groupCollapsed("vert stats");for(var p in g)"ALU_OPS"!=p&&"TEX_OPS"!=p&&f.log(p,g[p]);f.groupEnd();f.groupCollapsed("frag src");f.log(c.Tw);f.groupEnd();f.groupCollapsed("frag stats");for(p in d)"ALU_OPS"!=p&&"TEX_OPS"!=p&&f.log(p,d[p]);f.groupEnd();
f.groupEnd()}}p("__config");var f=p("__print"),l=p("__extensions"),g=p("__scenes"),m=p("__shaders");p("__util");a.report_repeatful_compilation=function(){var a=m.hw(),b=0,c;for(c in a){var d=a[c],g=d.count;1<g&&f.log(g-1,d.FD,d.UC);b+=g-1}f.log("TOTAL OVERHEAD:",b);return"OK"};a.analyze=function(a){var g=m.Yp(),h=0,p;for(p in g)a&&-1===p.indexOf(a)||h++;var h="of "+h+" analyzing...",z={};for(p in g)if(!a||-1!==p.indexOf(a)){var E=g[p],A;var n=E.Wn;A=E.Qp;var u=l.Zp();if(u){n=u.getTranslatedShaderSource(n);
A=u.getTranslatedShaderSource(A);var u=b("/nvidia_vert",n),e=c(u),O=b("/nvidia_frag",A),I=c(O);A={gB:n,TD:u,hB:e,Tw:A,zC:O,dm:I}}else f.error("WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),A=void 0;u=E.Na;n=u.Ri+" + "+u.$h;A.dw=E;A.Na=u;E=z[n]=z[n]||[];E.push(A);f.log(h)}for(n in z)f.group("%c"+n,"color: #800"),E=z[n],d(E),f.groupEnd()}};b4w.module.textures=function(a,p){var c=p("__textures"),b=p("__print");a.get_canvas_texture_context=function(a){var d=c.nx(a);if(d)return d;b.error('Canvas texture with ID "'+a+'" not found!')};a.update_canvas_texture_context=function(a){c.HA(a)||b.error('Canvas texture with ID "'+a+'" not found!')};a.play_video=function(a){c.play_video(a)||b.error('Texture with name "'+a+'" not found!')};a.pause_video=function(a){c.pause_video(a)||b.error('Texture with name "'+a+'" not found!')};a.reset_video=function(a){c.reset_video(a)||
b.error('Texture with name "'+a+'" not found!')}};"object"==typeof module&&module.Zh&&(GLOBAL.b4w={module:{}});b4w.module.time=function(a,p){var c=p("__time");a.set_timeout=c.set_timeout;a.animate=c.animate};"object"==typeof module&&module.Zh&&b4w.module.time(exports);b4w.module.transform=function(a,p){var c=p("__print"),b=p("__physics"),h=p("__transform"),d=p("__util"),f=p("__objects"),l=new Float32Array(3),g=new Float32Array(4);a.SPACE_LOCAL=h.SPACE_LOCAL;a.SPACE_WORLD=h.SPACE_WORLD;a.set_translation=function(a,d,g,p){f.Xb(a)?(l[0]=d,l[1]=g,l[2]=p,h.set_translation(a,l),h.A(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_v=function(a,d){f.Xb(a)?(h.set_translation(a,d),h.A(a),b.sync_transform(a)):c.error('Wrong object: "'+
a.name+'" is not dynamic.')};a.set_translation_rel=function(a,g,p,r,q){f.Xb(a)?(l[0]=g,l[1]=p,l[2]=r,d.transform_vec3(l,1,q.d.quat,q.d.g,l),h.set_translation(a,l),h.A(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_translation=function(a,b){b||(b=new Float32Array(3));h.get_translation(a,b);return b};a.set_rotation=function(a,d,l,p,q){f.Xb(a)?(g[0]=d,g[1]=l,g[2]=p,g[3]=q,h.set_rotation(a,g),h.A(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};
a.set_rotation_quat=function(){c.error("set_rotation_quat() deprecated, use set_rotation() instead");return a.set_rotation};a.set_rotation_v=function(a,d){f.Xb(a)?(h.set_rotation(a,d),h.A(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_quat_v=function(){c.error("set_rotation_quat_v() deprecated, use set_rotation_v() instead");return a.set_rotation_v};a.get_rotation=function(a,b){b||(b=new Float32Array(4));h.get_rotation(a,b);return b};a.get_rotation_quat=
function(){c.error("get_rotation_quat() deprecated, use get_rotation() instead");return a.get_rotation};a.set_rotation_euler=function(a,d,g,p){f.Xb(a)?(l[0]=d,l[1]=g,l[2]=p,h.set_rotation_euler(a,l),h.A(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_v=function(a,d){f.Xb(a)?(h.set_rotation_euler(a,d),h.A(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale=function(a,b){f.Xb(a)?(h.set_scale(a,b),h.A(a)):c.error('Wrong object: "'+
a.name+'" is not dynamic.')};a.get_scale=function(a){return h.get_scale(a)};a.empty_reset_transform=function(a){if("EMPTY"!=a.type)return c.error("Wrong object: "+a.name),!1;for(var d=0;d<a.yc.length;d++)if(!f.Xb(a.yc[d])){c.error('Wrong object: "'+a.yc[d].name+'" is not dynamic.');return}h.set_translation(a,[0,0,0]);h.set_rotation(a,[0,0,0,1]);h.set_scale(a,1);h.A(a);b.sync_transform(a)};a.get_object_size=function(a){return d.is_mesh(a)?h.get_object_size(a):(c.error("Wrong object: "+a.name),0)};
a.get_object_center=function(a,b,f){return d.is_mesh(a)?h.get_object_center(a,b,f):(c.error("Wrong object: "+a.name),null)};a.move_local=function(a,d,g,l){f.Xb(a)?(h.move_local(a,d,g,l),h.A(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_object_bounding_box=function(a){return h.get_object_bounding_box(a)};a.get_tsr=function(a,b){b||(b=new Float32Array(8));if(f.Xb(a))return h.get_tsr(a,b),b;c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_tsr=function(a,
d){f.Xb(a)?(h.set_tsr(a,d),h.A(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.distance=function(a,b){return h.distance(a,b)}};b4w.module.tsr=function(a,p){p("__print");var c=p("__tsr");a.create=c.create;a.copy=c.copy;a.identity=c.identity;a.create_sep=c.create_sep;a.set_sep=c.set_sep;a.set_trans=c.set_trans;a.set_scale=c.set_scale;a.set_transcale=c.set_transcale;a.set_quat=c.set_quat;a.get_trans_view=c.get_trans_view;a.get_scale=c.get_scale;a.get_quat_view=c.get_quat_view;a.invert=c.invert;a.from_mat4=c.from_mat4;a.multiply=c.multiply;a.transform_vec3=c.transform_vec3;a.transform_vec3_inv=c.transform_vec3_inv;a.transform_vectors=
c.transform_vectors;a.transform_dir_vectors=c.transform_dir_vectors;a.transform_dir_vec3=c.transform_dir_vec3;a.transform_tangents=c.transform_tangents;a.translate=c.translate;a.interpolate=c.interpolate};b4w.module.util=function(a,p){var c=p("__print"),b=p("__util"),h=p("vec3");p("mat4");a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.keyfind=b.keyfind;a.keysearch=b.keysearch;a.matrix_to_quat=function(a){return b.matrix_to_quat(a)};a.euler_to_quat=function(a,c){c||(c=new Float32Array(4));return b.euler_to_quat(a,c)};a.quat_to_euler=
function(a,c){c||(c=new Float32Array(3));return b.quat_to_euler(a,c)};a.sign=b.sign;a.clamp=b.clamp;a.quat_to_dir=b.quat_to_dir;a.ground_project_quat=function(a,c){return b.quat_project(a,b.AXIS_MY,b.AXIS_Y,b.AXIS_MZ,c)};a.cam_quat_to_mesh_quat=function(a,c){return b.cam_quat_to_mesh_quat(a,c)};a.quat_project=function(a,f,l,g,m){return 0!=h.dot(l,g)?(c.error("Wrong in-plane direction"),null):b.quat_project(a,f,l,g,m)};a.hash_code=b.hash_code;a.smooth=b.smooth;a.smooth_v=b.smooth_v;a.is_vector=b.is_vector;
a.correct_cam_quat_up=b.correct_cam_quat_up;a.quat_to_angle_axis=b.quat_to_angle_axis;a.random_from_array=b.random_from_array;a.xz_direction=b.xz_direction;a.line_plane_intersect=b.line_plane_intersect;a.is_mesh=b.is_mesh;a.is_armature=b.is_armature;a.angle_wrap_0_2pi=b.angle_wrap_0_2pi;a.angle_wrap_periodic=b.angle_wrap_periodic;a.smooth_step=b.smooth_step};"object"==typeof module&&module.Zh&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,p){var c=p("__version");a.version=c.version;a.type=c.type;a.date=c.date};"object"==typeof module&&module.Zh&&b4w.module.version(exports);b4w.module.objects=function(a,p){var c=p("__objects"),b=p("__print"),h=p("__util"),d=p("__scenes"),f=p("__geometry");a.get_meta_tags=function(a){if(a&&a.b4w_object_tags)return c.get_meta_tags(a)};a.copy=function(a,g,m){return h.is_mesh(a)?a.po?(b.error('object "'+a.name+'" is meta-object.'),!1):c.Xb(a)?f.gi(a)||f.check_shape_keys(a)||!m?-1==d.Da(d.get_active(),"MESH",d.DATA_ID_ALL).indexOf(a)?(b.error('object "'+a.name+'" does not belong to the active scene.'),!1):c.copy(a,g||"",m):(b.error('object "'+
a.name+'" has not dynamic geometry for deep copying.'),!1):(b.error('object "'+a.name+'" is not dynamic.'),!1):(b.error('object "'+a.name+'" is not of type "MESH".'),!1)};a.set_nodemat_value=function(a,d,f){if(!h.is_mesh(a))return b.error('object "'+a.name+'" is not of type "MESH".'),null;d=d.join("%join%");var k=c.Hx(a,d);null!=k?a.d.Zd[k]=f:b.error('value "'+d+'" was not found in "'+a.name+'" object.')};a.set_nodemat_rgb=function(a,d,f,k,p){if(!h.is_mesh(a))return b.error('object "'+a.name+'" is not of type "MESH".'),
null;d=d.join("%join%");var r=c.Bx(a,d);null!=r?(a.d.mc[r]=f,a.d.mc[r+1]=k,a.d.mc[r+2]=p):b.error('rgb "'+d+'" was not found in "'+a.name+'" object.')}};b4w.module.main=function(a,p){function c(){}function b(){}function h(){}function d(){window.performance||(e.log("Apply performance workaround"),window.performance={});var a=Date.now();window.performance.now||(e.log("Apply performance.now() workaround"),window.performance.now=function(){return Date.now()-a});R.Wr(0)}function f(a,c){a.addEventListener("webglcontextlost",function(a){a.preventDefault();e.error("WebGL context lost");k()},!1);t.qc(c);var d=t.cq();d&&e.log("%cRENDERER INFO:","color: #00a",
c.getParameter(d.UNMASKED_VENDOR_WEBGL)+", "+c.getParameter(d.UNMASKED_RENDERER_WEBGL));M.qc(c);y.qc(c);J.qc(c);N.qc(c);F.qc(c);I.qc(c);G.Yr(a.width,a.height,1,l("x"),l("y"));v.init();b=z();r()}function l(a){if("x"==a)var b=aa.offsetLeft;else if("y"==a)b=aa.offsetTop;else return 0;return g(b,aa,a)}function g(a,b,c){a=a||0;if(b=b.offsetParent){if("x"==c)var d=b.offsetLeft;else"y"==c&&(d=b.offsetTop);a=g(a+d,b,c)}return a}function m(){c=function(){}}function k(){x()||(ma=performance.now()/1E3,v.pause(),
K.pause(),J.pause(),E.pause())}function x(){return fa<ma}function r(){qa(r);var a=performance.now()/1E3;ha||(ha=a);var c=a-ha;if(!(c<1/T.gd)){for(var d=R.Og(),e=0;e<ia.length;e++)ia[e](d,c);x()||(fa>ha&&(c-=fa-Math.max(ma,ha)),d+=c,R.Wr(d),F.update(),H.update(),I.update(),q(d,c),b(c));ha=a}}function q(a,b){I.is_primary_loaded()&&(L.reset(),V.update(b),C.update(a,b),v.update(a,b),b&&A.update(b),I.is_primary_loaded()&&(K.update(a,b),I.is_primary_loaded()&&(c(b,a),I.is_primary_loaded()&&(O.update(a,
b),I.is_primary_loaded()&&(E.update(),G.update(a,b),E.UA(),S&&(S(aa.toDataURL()),S=null))))))}function z(){var a=60,b=0,c=T.Op,d=T.Nw;return function(e){a=ca.smooth(1/e,a,e,c);e=K.vx();b=(b+1)%d;0==b&&h(Math.round(a),e)}}var E=p("__anchors"),A=p("__animation"),n=p("__compat"),u=p("__config"),e=p("__print"),O=p("__controls"),I=p("__data"),F=p("__debug"),t=p("__extensions"),y=p("__geometry"),L=p("__hud"),C=p("__nla"),H=p("__assets"),K=p("__physics"),M=p("__renderer"),G=p("__scenes"),v=p("__sfx"),N=
p("__shaders"),J=p("__textures"),R=p("__time"),V=p("__transform"),ca=p("__util"),U=p("__version"),Z=u.context,T=u.q,aa=null,w=null,ha=0,ma=0,fa=0,ia=[],S=null,P=["webgl","experimental-webgl"],ga=null,qa=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/T.gd)}}();a.init=function(a,b){u.Ez();e.Iz(T.console_verbose);var c=U.version()+
" "+U.type()+" ("+U.date()+")";e.log("%cINIT ENGINE","color: #00a",c);if(!window.WebGLRenderingContext)return null;d();aa=a;n.Du();for(var c=null,g=0;g<P.length;g++){var h=P[g];try{c=a.getContext(h,Z)}catch(k){}if(c)break}if(!c)return null;ga=c;f(aa,c);u.Fu();n.yz(c);e.log("%cSET PRECISION:","color: #00a",T.precision);b?(L.init(b),w=b):(u.q.show_hud_debug_info=!1,u.Tc.dk=!1);E.init(a);return c};a.set_check_gl_errors=function(a){F.set_check_gl_errors(a)};a.resize=function(a,b,c){!1!==c&&(aa.style.width=
a+"px",aa.style.height=b+"px",w&&(w.style.width=a+"px",w.style.height=b+"px"));w&&(w.width=a,w.height=b,L.Ch());if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))T.canvas_resolution_factor=1;c=a*T.canvas_resolution_factor;b*=T.canvas_resolution_factor;T.allow_hidpi&&1<window.devicePixelRatio&&(c*=window.devicePixelRatio,b*=window.devicePixelRatio);aa.width=c;aa.height=b;if(c>ga.drawingBufferWidth||b>ga.drawingBufferHeight){e.warn("Canvas size exceeds platform limits, downscaling");
var d=Math.min(ga.drawingBufferWidth/c,ga.drawingBufferHeight/b);c*=d;b*=d;aa.width=c;aa.height=b}G.Yr(c,b,c/a,l("x"),l("y"));G.Z()&&V.A(G.get_active().camera);q(R.Og(),0);I.LA(aa.width,aa.height)};a.set_fps_callback=function(a){h=a};a.clear_fps_callback=function(){h=function(){}};a.set_on_before_render_callback=function(a){e.error("set_on_before_render_callback() deprecated, use set_render_callback() instead");c=a};a.set_render_callback=function(a){c=a};a.clear_on_before_render_callback=function(){e.error("clear_on_before_render_callback() deprecated, use clear_render_callback() instead");
m()};a.clear_render_callback=function(){m()};a.global_timeline=function(){return R.Og()};a.redraw=function(){e.error("redraw() deprecated");q(R.Og(),0)};a.pause=k;a.resume=function(){x()&&(fa=performance.now()/1E3,v.resume(),K.resume(),J.play(!0),E.resume())};a.is_paused=x;a.reset=function(){I.unload(0);w=aa=null;fa=ma=ha=0;h=function(){};b=function(){};c=function(){};ia.length=0;ga=null;R.reset()};a.canvas_data_url=function(a){S=a};a.get_canvas_elem=function(){return aa};a.detect_mobile=function(){return n.detect_mobile()};
a.append_loop_cb=function(a){for(var b=0;b<ia.length;b++)if(ia[b]==a)return;ia.push(a)};a.remove_loop_cb=function(a){for(var b=0;b<ia.length;b++)if(ia[b]==a){ia.splice(b,1);break}}};b4w.module.app=function(a,p){function c(){var a=F.is_paused();document.addEventListener("visibilitychange",function(){document.hidden?(a=F.is_paused(),F.pause()):a||F.resume()},!1)}function b(a,b,c,d){var e=document.createElement("canvas");e.style.position="absolute";b?(b=document.createElement("canvas"),b.style.position="absolute",b.style.zIndex="2",b.style.pointerEvents="none"):b=null;if(!F.init(e,b))return c&&z("Browser could not initialize WebGL","For more info visit","https://www.blend4web.com/troubleshooting",
d),null;G=e;c=document.getElementById(a);c||(y.error('Warning: canvas container "'+a+'" not found, appending to body'),c=document.body);c.appendChild(e);b&&c.appendChild(b);return c}function h(a,b){a?(b&&(document.getElementById(b).style.display="block"),v=document.getElementById(a)):(v=document.createElement("div"),v.innerHTML=0,v.style.cssText="position:absolute;top: 23px;right: 20px;font-size: 45px;line-height: 50px;font-weight: bold;color: #000;z-index: 1;",document.body.appendChild(v))}function d(a,
b){var c=String(a);b&&(c+="/"+String(b));v.innerHTML=c}function f(a){a=document.getElementById(a);var b=a.cloneNode(!0);a.parentNode.replaceChild(b,a);return b}function l(){F.resize(M.clientWidth,M.clientHeight,!0)}function g(a,b,c){if(A.has_distance_limits(a))var d=C.get_translation(a,R),e=A.get_hover_cam_pivot(a,V),d=K.subtract(d,e,R),d=Math.max(K.len(d),1);else d=10;e=C.get_rotation(a,Z);b=H.quat_to_dir(e,b,R);b[1]=0;K.normalize(b,b);K.scale(b,d*c,b);d=C.get_translation(a,V);K.add(d,b,d);A.hover_cam_set_translation(a,
d)}function m(a,b){if(A.has_distance_limits(a)){var c=A.get_hover_angle_limits(a,N);if(0>c[1]-c[0]){var d=A.get_camera_angles(a,J)[1],c=(c[0]-d)/(c[0]-c[1]),d=A.get_cam_dist_limits(a),c=Math.max(c,2/d[0]);A.rotate_hover_camera(a,0,c*b)}}else c=C.get_translation(a,R),d=K.scale(H.AXIS_Y,-b,V),K.add(c,d,c),A.hover_cam_set_translation(a,c)}function k(a,b,c,d){C.move_local(a,5*b,5*c,5*d)}function x(a,b,c){var d=C.get_translation(a,R),e=A.get_pivot(a,V),d=K.dist(d,e),e=Math.abs(b);c=Math.pow(e*c,1-Math.pow(e*
c,.15));C.move_local(a,0,0>b?.001<d?-d*c:0:c/(1-c)*d,0)}function r(a,b,c,d){for(var e=c*b;0<a;--a)c+=e,d+=e,e=c*b;return d}function q(a,b,c,d,e){e?(e=A.get_pivot(a,R),a=A.get_eye(a),a=K.dist(e,a)+d,d=0<b?r(b,-c,a,d):r(-b,c/(1-c),a,d)):d-=2*b*c;return d}function z(a,b,c,d){var e=document.createElement("div"),f=document.createElement("div"),g=document.createElement("div");if(d)for(var h=0;h<d.length;h++){var k=document.getElementById(d[h]);k&&k.parentNode.removeChild(k)}e.style.cssText="z-index:10;width:100%;height:auto;position:absolute;top:50%;margin-top:150px;text-align:center;";
f.style.cssText="color:#fff;font-size:24px;";g.style.cssText="color:#fff;font-size:20px;";f.innerHTML=a;g.innerHTML=b+'   <a style="color:#fff;font-size:20px;width:100%;" href="'+c+'">'+c.replace("https://www.","")+"</a>";e.appendChild(f);e.appendChild(g);document.body.appendChild(e)}function E(a,b,c,d){function e(){var g=performance.now()-f;d(a+g*(b-a)/c);g>=c&&F.remove_loop_cb(e)}var f=performance.now();F.append_loop_cb(e)}p("animation");var A=p("camera"),n=p("config"),u=p("constraints"),e=p("controls"),
O=p("data"),I=p("debug"),F=p("main"),t=p("physics"),y=p("print"),L=p("scenes"),C=p("transform"),H=p("util"),K=p("vec3");p("quat");var M=null,G=null,v=null,N=new Float32Array(2),J=new Float32Array(2),R=new Float32Array(3),V=new Float32Array(3),ca=new Float32Array(3),U=new Float32Array(3),Z=new Float32Array(4);a.init=function(a){function f(){var a=b(m,E,z,r);a?(M=a,l(),F.set_check_gl_errors(q),x&&(h(t,u),F.set_fps_callback(d)),A&&c(),p&&F.append_loop_cb(function(){var a=M.clientWidth,b=M.clientHeight;
a==G.clientWidth&&b==G.clientHeight||F.resize(a,b,!0)}),k(G,!0)):k(G,!1)}function g(a){a.keyCode==e.KEY_P&&(F.is_paused()?F.resume():F.pause())}function k(){}a=a||{};var m=null,p=!1,q=!1,r=null,t=null,u=null,v=!0,y=!1,A=!0,z=!0,x=!1,C=!1,H;for(H in a)switch(H){case "canvas_container_id":m=a.canvas_container_id;break;case "callback":k=a.callback;break;case "autoresize":p=a.autoresize;break;case "do_not_use_onload":break;case "gl_debug":q=a.gl_debug;break;case "show_hud_debug_info":C=a.show_hud_debug_info;
break;case "sfx_mix_mode":y=a.sfx_mix_mode;break;case "show_fps":x=a.show_fps;break;case "fps_wrapper_id":u=a.fps_wrapper_id;break;case "fps_elem_id":t=a.fps_elem_id;break;case "error_purge_elements":r=a.error_purge_elements;break;case "report_init_failure":z=a.report_init_failure;break;case "pause_invisible":A=a.pause_invisible;break;case "key_pause_enabled":v=a.key_pause_enabled;break;default:n.set(H,a[H])}v&&document.addEventListener("keydown",g,!1);n.set("show_hud_debug_info",C);n.set("sfx_mix_mode",
y);var E=C||y||null;"complete"==document.readyState?window.setTimeout(f,0):window.addEventListener("load",f,!1);window.addEventListener("unload",function(){O.cleanup()},!1)};a.resize_to_container=l;a.get_canvas_container=function(){return M};a.set_onclick=function(a,b){var c=f(a);c.addEventListener("mouseup",function(){b(c.value)},!1)};a.set_onchange=function(a,b){var c=f(a);c.addEventListener("change",function(){var a=c.checked;b(void 0!=a?a:c.value)},!1)};a.set_onkeypress=function(a,b){var c=f(a);
c.addEventListener("keypress",function(a){b(a.keyCode,c.value)},!1)};a.enable_camera_controls=function(a,b){function c(a,b,d,f){if(1==d){var g=r?.003*v[0]:.003*v[1];d=e.get_sensor_value(a,b,0);e.get_sensor_payload(a,b,0)===e.PL_SINGLE_TOUCH_MOVE?(nb+="X"==f?-d*g:0,$a+="Y"==f?-d*g:0):e.get_sensor_payload(a,b,0)===e.PL_MULTITOUCH_MOVE_PAN&&(a=r?.003*v[1]:7.5E-4*v[0],Ja+="X"==f?-d*a:0,Ea+="Y"==f?-d*a:0)}}function d(a,b,c,f){if(1==c){c=e.get_sensor_value(a,b,1);A.get_velocity_params(a,v);if(r)g=.003*
v[0],h=7.5E-4*v[1];else var g=.003*v[1],h=7.5E-4*v[0];if(1===e.get_sensor_payload(a,b,0))lb+="X"==f?-c*g:0,ua+="Y"==f?-c*g:0;else if(2===e.get_sensor_payload(a,b,0)||3===e.get_sensor_payload(a,b,0))mb+="X"==f?-c*h:0,Fa+="Y"==f?-c*h:0}}function f(a){return a[0]&&(a[1]||a[2])}function h(a,b,c){if(!z||!e.get_sensor_value(a,"CAMERA_COLLISION",1)){if(1==c)switch(c=e.get_sensor_value(a,b,0),A.get_velocity_params(a,v),b){case "FORWARD":p?F[0]=1:r?(b=A.get_camera_angles(a,J)[1],b=Math.abs(b)>=Math.PI/4?H.AXIS_MZ:
H.AXIS_MY,g(a,b,.5*v[0]*c)):n?x(a,-v[2],c):k(a,0,-v[0]*c,0);break;case "BACKWARD":p?F[0]=-1:r?(b=A.get_camera_angles(a,J)[1],b=Math.abs(b)>=Math.PI/4?H.AXIS_Z:H.AXIS_Y,g(a,b,.5*v[0]*c)):n?x(a,v[2],c):k(a,0,v[0]*c,0);break;case "UP":r?m(a,30*-v[2]*c):p||k(a,0,0,-v[0]*c);break;case "DOWN":r?m(a,30*v[2]*c):p||k(a,0,0,v[0]*c);break;case "LEFT":p?F[1]=1:r?g(a,H.AXIS_MX,.5*v[0]*c):k(a,-v[0]*c,0,0);break;case "RIGHT":p?F[1]=-1:r?g(a,H.AXIS_X,.5*v[0]*c):k(a,v[0]*c,0,0);break;case "ROT_LEFT":n?A.rotate_target_camera(a,
2*-v[1]*c,0):A.rotate_eye_camera(a,2*v[1]*c,0);break;case "ROT_RIGHT":n?A.rotate_target_camera(a,2*v[1]*c,0):A.rotate_eye_camera(a,2*-v[1]*c,0);break;case "ROT_UP":n?A.rotate_target_camera(a,0,2*-v[1]*c):A.rotate_eye_camera(a,0,2*v[1]*c);break;case "ROT_DOWN":n?A.rotate_target_camera(a,0,2*v[1]*c):A.rotate_eye_camera(a,0,2*-v[1]*c)}else switch(b){case "FORWARD":case "BACKWARD":p&&(F[0]=0);break;case "LEFT":case "RIGHT":p&&(F[1]=0)}p&&(t.set_character_move_dir(p,F[0],F[1]),a=A.get_camera_angles_char(a,
N),t.set_character_rotation(p,a[0],a[1]))}}var l=L.get_active_camera(),n=!1,p=null,r=!1;switch(A.get_move_style(l)){case A.MS_TARGET_CONTROLS:n=!a;break;case A.MS_EYE_CONTROLS:p=L.get_first_character();break;case A.MS_STATIC:return;case A.MS_HOVER_CONTROLS:r=!0}var v=A.get_velocity_params(l,U),y=e.create_elapsed_sensor();if(t.has_simulated_physics(l)){var z=e.create_collision_sensor(l,null,!0);e.create_sensor_manifold(l,"CAMERA_COLLISION",e.CT_CONTINUOUS,[y,z],null,function(a,b,c){if(1==c){b=e.get_sensor_payload(a,
b,1);c=C.get_translation(a,R);var d=V;K.sub(c,b,d);K.normalize(d,d);K.scale(d,.01,d);K.add(c,d,c);C.set_translation_v(a,c)}})}if(p){var G=C.get_translation(l),B=C.get_rotation(l),B=H.cam_quat_to_mesh_quat(B);G[1]-=.5;t.set_transform(p,G,B);u.append_stiff_trans(l,p,[0,.5,0]);var F=new Float32Array(2),E=!0;t.set_character_move_type(p,t.CM_FLY);e.create_kb_sensor_manifold(l,"TOGGLE_CHAR_MOVE_TYPE",e.CT_SHOT,e.KEY_C,function(){E=!E;t.set_character_move_type(p,E?t.CM_FLY:t.CM_WALK)})}if(b)G=B=I=M=O=Z=
e.create_custom_sensor(0);else var G=e.create_keyboard_sensor(e.KEY_W),B=e.create_keyboard_sensor(e.KEY_S),I=e.create_keyboard_sensor(e.KEY_A),M=e.create_keyboard_sensor(e.KEY_D),O=e.create_keyboard_sensor(e.KEY_R),Z=e.create_keyboard_sensor(e.KEY_F);var Q=e.create_keyboard_sensor(e.KEY_UP),La=e.create_keyboard_sensor(e.KEY_DOWN),la=e.create_keyboard_sensor(e.KEY_LEFT),ra=e.create_keyboard_sensor(e.KEY_RIGHT);r||(e.create_sensor_manifold(l,"FORWARD",e.CT_CONTINUOUS,[y,G],null,h),e.create_sensor_manifold(l,
"BACKWARD",e.CT_CONTINUOUS,[y,B],null,h));n?(e.create_sensor_manifold(l,"ROT_UP",e.CT_CONTINUOUS,[y,Q,O],f,h),e.create_sensor_manifold(l,"ROT_DOWN",e.CT_CONTINUOUS,[y,La,Z],f,h),e.create_sensor_manifold(l,"ROT_LEFT",e.CT_CONTINUOUS,[y,la,I],f,h),e.create_sensor_manifold(l,"ROT_RIGHT",e.CT_CONTINUOUS,[y,ra,M],f,h)):r?(e.create_sensor_manifold(l,"LEFT",e.CT_CONTINUOUS,[y,la,I],f,h),e.create_sensor_manifold(l,"RIGHT",e.CT_CONTINUOUS,[y,ra,M],f,h),e.create_sensor_manifold(l,"FORWARD",e.CT_CONTINUOUS,
[y,Q,G],f,h),e.create_sensor_manifold(l,"BACKWARD",e.CT_CONTINUOUS,[y,La,B],f,h),e.create_sensor_manifold(l,"UP",e.CT_CONTINUOUS,[y,Z],f,h),e.create_sensor_manifold(l,"DOWN",e.CT_CONTINUOUS,[y,O],f,h)):(e.create_sensor_manifold(l,"UP",e.CT_CONTINUOUS,[y,O],f,h),e.create_sensor_manifold(l,"DOWN",e.CT_CONTINUOUS,[y,Z],f,h),e.create_sensor_manifold(l,"LEFT",e.CT_CONTINUOUS,[y,I],f,h),e.create_sensor_manifold(l,"RIGHT",e.CT_CONTINUOUS,[y,M],f,h),e.create_sensor_manifold(l,"ROT_UP",e.CT_CONTINUOUS,[y,
Q],f,h),e.create_sensor_manifold(l,"ROT_DOWN",e.CT_CONTINUOUS,[y,La],f,h),e.create_sensor_manifold(l,"ROT_LEFT",e.CT_CONTINUOUS,[y,la],f,h),e.create_sensor_manifold(l,"ROT_RIGHT",e.CT_CONTINUOUS,[y,ra],f,h));var Ia=0,G=e.create_mouse_wheel_sensor(),ta=0,B=e.create_touch_zoom_sensor();e.create_sensor_manifold(l,"MOUSE_WHEEL",e.CT_LEVEL,[G],null,function(a,b,c){1==c&&(b=e.get_sensor_value(a,b,0),A.get_velocity_params(a,v),n||r?Ia=q(a,b,v[2],Ia,n):(v[0]*=1+b*v[2],A.set_velocity_params(a,v)))});e.create_sensor_manifold(l,
"TOUCH_ZOOM",e.CT_LEVEL,[B],null,function(a,b,c){1==c&&(c=e.get_sensor_value(a,b,0),A.get_velocity_params(a,v),e.get_sensor_payload(a,b,0)===e.PL_MULTITOUCH_MOVE_ZOOM&&(ta=q(a,c,.03*v[2],ta,n)))});e.create_sensor_manifold(l,"ZOOM_INTERPOL",e.CT_CONTINUOUS,[y],null,function(a,b,c){if(1==c&&(n||r))if(1E-5<Math.abs(Ia)||1E-5<Math.abs(ta)){b=e.get_sensor_value(a,b,0);c=H.smooth(Ia,0,b,.1);Ia-=c;var d=H.smooth(ta,0,b,.15);ta-=d;if(!z||!e.get_sensor_value(a,"CAMERA_COLLISION",1))if(r)m(a,-(c+d));else{b=
A.get_pivot(a,R);var f=A.get_eye(a,V);.001<K.dist(b,f)+c+d?C.move_local(a,0,c+d,0):(c=K.subtract(f,b,V),d=K.normalize(c,ca),K.scale(d,.001,d),K.add(b,d,c),C.set_translation_v(a,c),ta=Ia=0)}}else ta=Ia=0});var lb=0,ua=0,mb=0,Fa=0,G=e.create_mouse_move_sensor("X"),B=e.create_mouse_move_sensor("Y"),I=e.create_mouse_click_sensor();e.create_sensor_manifold(l,"MOUSE_X",e.CT_LEVEL,[I,G],null,d,"X");e.create_sensor_manifold(l,"MOUSE_Y",e.CT_LEVEL,[I,B],null,d,"Y");var nb=0,$a=0,Ja=0,Ea=0,G=e.create_touch_move_sensor("X"),
B=e.create_touch_move_sensor("Y");e.create_sensor_manifold(l,"TOUCH_X",e.CT_LEVEL,[G],null,c,"X");e.create_sensor_manifold(l,"TOUCH_Y",e.CT_LEVEL,[B],null,c,"Y");e.create_sensor_manifold(l,"ROT_TRANS_INTERPOL",e.CT_CONTINUOUS,[y],null,function(a,b,c){if(1==c&&(.001<Math.abs(lb)||.001<Math.abs(ua)||.001<Math.abs(nb)||.001<Math.abs($a)||.001<Math.abs(mb)||.001<Math.abs(Fa)||1E-5<Math.abs(Ja)||1E-5<Math.abs(Ea))){var d=e.get_sensor_value(a,b,0),f=H.smooth(lb,0,d,.08);b=H.smooth(ua,0,d,.08);lb-=f;ua-=
b;var h=H.smooth(nb,0,d,.12);c=H.smooth($a,0,d,.12);nb-=h;$a-=c;var k=H.smooth(mb,0,d,.08),l=H.smooth(Fa,0,d,.08);mb-=k;Fa-=l;var m=H.smooth(Ja,0,d,.12),d=H.smooth(Ea,0,d,.12);Ja-=m;Ea-=d;n?(A.rotate_target_camera(a,f+h,b+c),A.move_pivot(a,k+m,l+d)):r?(f+h&&g(a,H.AXIS_X,.2*(f+h)),b+c&&(f=A.get_camera_angles(a,J)[1],g(a,Math.abs(f)>Math.PI/4?H.AXIS_Z:H.AXIS_Y,.2*(b+c))),A.rotate_hover_camera(a,k+m,0)):(A.rotate_eye_camera(a,.5*(f+h),.5*(b+c)),p&&(a=A.get_camera_angles_char(a,N),t.set_character_rotation(p,
a[0],a[1])))}});e.create_kb_sensor_manifold(l,"DEC_STEREO_DIST",e.CT_SHOT,e.KEY_LEFT_SQ_BRACKET,function(a){var b=A.get_stereo_distance(a);A.set_stereo_distance(a,.9*b)});e.create_kb_sensor_manifold(l,"INC_STEREO_DIST",e.CT_SHOT,e.KEY_RIGHT_SQ_BRACKET,function(a){var b=A.get_stereo_distance(a);A.set_stereo_distance(a,1.1*b)})};a.disable_camera_controls=function(){for(var a=L.get_active_camera(),b="FORWARD BACKWARD ROT_UP ROT_DOWN ROT_LEFT ROT_RIGHT UP DOWN LEFT RIGHT MOUSE_WHEEL TOUCH_ZOOM ZOOM_INTERPOL MOUSE_X MOUSE_Y TOUCH_X TOUCH_Y ROT_TRANS_INTERPOL".split(" "),
c=0;c<b.length;c++)e.remove_sensor_manifold(a,b[c])};a.enable_object_controls=function(a){function b(a){return a[0]&&(a[1]||a[2])}function c(a,b,f){if(1==f)switch(f=e.get_sensor_value(a,b,0),b){case "FORWARD":d?t.vehicle_throttle(a,1):C.move_local(a,0,0,1*f);break;case "BACKWARD":d?t.vehicle_throttle(a,-1):C.move_local(a,0,0,-1*f);break;case "LEFT":d?t.vehicle_steer(a,-1):C.move_local(a,1*f,0,0);break;case "RIGHT":d?t.vehicle_steer(a,1):C.move_local(a,-1*f,0,0)}else switch(b){case "FORWARD":case "BACKWARD":d&&
t.vehicle_throttle(a,0);break;case "LEFT":case "RIGHT":d&&t.vehicle_steer(a,0)}}var d=t.is_vehicle_chassis(a)||t.is_vehicle_hull(a),f=e.create_elapsed_sensor(),g=e.create_keyboard_sensor(e.KEY_W),h=e.create_keyboard_sensor(e.KEY_S),k=e.create_keyboard_sensor(e.KEY_A),l=e.create_keyboard_sensor(e.KEY_D),n=e.create_keyboard_sensor(e.KEY_UP),m=e.create_keyboard_sensor(e.KEY_DOWN),p=e.create_keyboard_sensor(e.KEY_LEFT),q=e.create_keyboard_sensor(e.KEY_RIGHT);e.create_sensor_manifold(a,"FORWARD",e.CT_CONTINUOUS,
[f,g,n],b,c);e.create_sensor_manifold(a,"BACKWARD",e.CT_CONTINUOUS,[f,h,m],b,c);e.create_sensor_manifold(a,"LEFT",e.CT_CONTINUOUS,[f,k,p],b,c);e.create_sensor_manifold(a,"RIGHT",e.CT_CONTINUOUS,[f,l,q],b,c)};a.disable_object_controls=function(a){for(var b=["FORWARD","BACKWARD","LEFT","RIGHT"],c=0;c<b.length;c++)e.remove_sensor_manifold(a,b[c])};a.enable_controls=function(){e.register_keyboard_events(document,!1);e.register_mouse_events(G,!0);e.register_wheel_events(G,!0);e.register_touch_events(G,
!0);e.register_device_orientation()};a.disable_controls=function(){e.unregister_keyboard_events(document);e.unregister_mouse_events(G);e.unregister_wheel_events(G);e.unregister_touch_events(G);e.unregister_device_orientation()};a.enable_debug_controls=function(){e.create_kb_sensor_manifold(null,"CAMERA_SHOT",e.CT_SHOT,e.KEY_K,function(){I.make_camera_frustum_shot()});e.create_kb_sensor_manifold(null,"LIGHT_SHOT",e.CT_SHOT,e.KEY_L,function(){I.make_light_frustum_shot()});e.create_kb_sensor_manifold(null,
"TELEMETRY",e.CT_SHOT,e.KEY_T,function(){I.plot_telemetry()})};a.request_fullscreen=function(a,b,c){function d(){document.fullscreenElement===a||document.webkitFullScreenElement===a||document.mozFullScreenElement===a||document.webkitIsFullScreen||document.msFullscreenElement===a?b():(document.removeEventListener("fullscreenchange",d,!1),document.removeEventListener("webkitfullscreenchange",d,!1),document.removeEventListener("mozfullscreenchange",d,!1),document.removeEventListener("MSFullscreenChange",
d,!1),c())}b=b||function(){};c=c||function(){};document.addEventListener("fullscreenchange",d,!1);document.addEventListener("webkitfullscreenchange",d,!1);document.addEventListener("mozfullscreenchange",d,!1);document.addEventListener("MSFullscreenChange",d,!1);a.requestFullScreen=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullscreen;a.requestFullScreen==a.webkitRequestFullScreen?a.requestFullScreen(Element.ALLOW_KEYBOARD_INPUT):a.requestFullScreen()};a.exit_fullscreen=
function(){var a=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;if("function"!=typeof a)throw"B4W App: exit fullscreen method is not supported";a.apply(document)};a.check_fullscreen=function(){return window.document.fullscreenEnabled||window.document.mozFullScreenEnabled||window.document.msFullscreenEnabled||window.document.webkitFullscreenEnabled?!0:!1};a.report_app_error=z;a.get_url_params=function(a){a=!!a;var b=location.href.toString();
if(-1==b.indexOf("?"))return null;for(var b=b.split("?")[1].split("&"),c={},d=0;d<b.length;d++){var e=b[d].split("="),f=e[0];1<e.length?(e=e[1],a?f in c?c[f].push(e):c[f]=[e]:c[f]=e):a?f in c||(c[f]=[]):c[f]=""}return c};a.css_animate=function(a,b,c,d,e,f,g,h){function k(e){a.style[b]=f+e+g;if(c>d&&e<=d||c<d&&e>=d)a.style[b]=f+d+g,h()}if(a&&b&&isFinite(c)&&isFinite(d)&&isFinite(e)){f=f||"";g=g||"";h=h||function(){};var l=b.charAt(0).toUpperCase()+b.slice(1);if(void 0==a.style[b])if(void 0!=a.style["webkit"+
l])b="webkit"+l;else if(void 0!=a.style["ms"+l])b="ms"+l;else if(void 0!=a.style["moz"+l])b="moz"+l;else return;E(c,d,e,k)}}};b4w.module.camera_anim=function(a,p){function c(a,b,c,d){b=g.angle_wrap_0_2pi(a-b);a=g.angle_wrap_0_2pi(c-a);if(1E-6>Math.abs(b)||1E-6>2*Math.PI-Math.abs(b))b=0;if(1E-6>Math.abs(a)||1E-6>2*Math.PI-Math.abs(a))a=0;d[0]=b;d[1]=a;return d}var b=p("camera"),h=p("controls"),d=p("print"),f=p("scenes"),l=p("transform"),g=p("util"),m=new Float32Array(2),k=new Float32Array(2),x=new Float32Array(3),r=new Float32Array(3),q=new Float32Array(3),z=new Float32Array(4),E=new Float32Array(2),A=new Float32Array(2),
n=p("vec3"),u=p("quat");a.track_to_target=function(a,c,f,k,p,y,A,C){if(!b.is_eye_camera(a))d.error("track_to_target(): wrong object");else if(a&&c){if(g.is_vector(c))var H=c;else H=q,l.get_object_center(c,!1,H);c=f||1;f=k||2;var E=p||1;p=y||1;r[0]=0;r[1]=-1;r[2]=0;var M=l.get_rotation(a);y=g.quat_to_dir(M,r);k=b.get_camera_angles(a,m);var G=l.get_translation(a);n.subtract(H,G,x);n.normalize(x,x);var v=u.rotationTo(y,x,u.create());u.multiply(v,M,z);g.correct_cam_quat_up(z,!1);n.subtract(H,G,r);var N=
n.length(r)*(1-1/f),H=Math.asin(x[1]);f=Math.acos(-x[2]/Math.abs(Math.cos(H)));0<x[0]&&(f=2*Math.PI-f);var J=f-k[0],R=H-k[1];q[0]=0;q[1]=0;q[2]=-1;f=l.get_rotation(a);0>g.quat_to_dir(f,q)[1]?(R=0<y[1]?H-Math.PI+k[1]:H+Math.PI+k[1],J=0<J?-Math.PI+J:Math.PI+J):Math.abs(J)>Math.PI&&(J=0<J?J-2*Math.PI:J+2*Math.PI);var V=0,H=h.create_elapsed_sensor();y=Math.abs(J/c);c=Math.abs(R/c);var ca=y>c?y:c,U=ca+E,Z=U+p,T=Z+E,aa=J,w=R,ha=N;h.create_sensor_manifold(a,"TRACK_TO_TARGET",h.CT_CONTINUOUS,[H],null,function(a,
c,d){if(d)if(d=h.get_sensor_value(a,c,0),V+=d,V<ca){var e=J/ca*d;d*=R/ca;c=V/ca;c=6*c*(1-c);e*=c;d*=c;aa-=e;w-=d;b.rotate_eye_camera(a,e,d)}else V<U?(aa&&(b.rotate_eye_camera(a,aa,w),aa=0,C&&C()),c=(V-ca)/E,d=-N*d/E,ha-=e,l.move_local(a,0,6*d*c*(1-c),0)):V<Z?ha&&(l.move_local(a,0,ha,0),ha=0):V<T?(c=(V-Z)/E,d=N*d/E,d=6*d*c*(1-c),l.move_local(a,0,d,0)):(l.set_translation_v(a,G),h.remove_sensor_manifold(a,c),A&&A())})}};a.auto_rotate=function(a,l){function n(d,f,l){if(1==l)if(r!=b.MS_HOVER_CONTROLS&&
b.has_horizontal_limits(d)){l=b.get_horizontal_limits(d,A);if(null===u||l[0]!=u[0]||l[1]!=u[1]){u=u||E;u.set(l);z=Math.min(.2,g.angle_wrap_0_2pi(u[1]-u[0])/2);l=u;var p=b.get_camera_angles(q,m)[0];l=c(p,l[0],l[1],k);x=a*Math.min(1,l[0]/.2,l[1]/.2)}f=h.get_sensor_value(d,f,0);l=b.get_camera_angles(d,m)[0];l=c(l,u[0],u[1],k);l[1]>z&&l[0]>z?x=g.sign(x)*a:l[1]<z?x-=Math.pow(a,2)/.4*f:l[0]<z&&(x+=Math.pow(a,2)/.4*f);b.rotate_camera(d,f*x,0)}else u=null,f=h.get_sensor_value(d,f,0),b.rotate_camera(d,f*a,
0)}function p(){h.remove_sensor_manifold(q,"AUTO_ROTATE");h.remove_sensor_manifold(q,"DISABLE_AUTO_ROTATE");l()}l=l||function(){};var q=f.get_active_camera(),r=b.get_move_style(q);if(r==b.MS_STATIC)d.error("auto_rotate(): wrong camera type");else{var u=null,z=0,x=0;if(h.check_sensor_manifold(q,"AUTO_ROTATE"))p();else{var K=h.create_mouse_move_sensor("X"),M=h.create_mouse_move_sensor("Y"),G=h.create_mouse_click_sensor(),v=h.create_touch_move_sensor(),N=h.create_touch_zoom_sensor(),J=h.create_elapsed_sensor();
h.create_sensor_manifold(q,"DISABLE_AUTO_ROTATE",h.CT_LEVEL,[K,M,G,v,N],function(a){return a[0]&&a[2]||a[1]&&a[2]||a[3]||a[4]},p);h.create_sensor_manifold(q,"AUTO_ROTATE",h.CT_CONTINUOUS,[J],function(a){return a[0]},n)}}};a.is_auto_rotate=function(){var a=f.get_active_camera();return h.check_sensor_manifold(a,"AUTO_ROTATE")};a.check_auto_rotate=function(){var a=f.get_active_camera();return b.get_move_style(a)==b.MS_STATIC?!1:!0}};b4w.module.gyroscope=function(a,p){function c(a){var c=b.create_gyro_angles_sensor(),h=!0;b.create_sensor_manifold(a,"CAMERA_ROTATE_GYRO",b.CT_CONTINUOUS,[c],null,function(a,c,n){if(0<n){l=b.get_sensor_payload(a,c,0);h&&(f[0]=l[0],f[1]=l[1],f[2]=l[2],h=!1);n=c=0;0==window.orientation&&(c=l[1]-f[1],n=l[0]-f[0],l[1]>m&&l[1]<g&&(n=0));if(180==window.orientation){c=l[1]-f[1];0>l[1]&&(c=-c);n=f[0]-l[0];if(c>Math.PI/2||c<-Math.PI/2)c=0;l[1]>-g&&l[1]<-m&&(n=0)}if(-90==window.orientation){c=l[0]-f[0];if(c>
Math.PI/2||c<-Math.PI/2)c=0;n=f[1]-l[1];if(l[0]>k||l[0]<x)n=0}if(90==window.orientation){c=f[0]-l[0];if(c>Math.PI/2||c<-Math.PI/2)c=0;n=l[1]-f[1];if(l[0]>k||l[0]<x)n=0}d.rotate_camera(a,n,c);f[0]=l[0];f[1]=l[1];f[2]=l[2]}})}var b=p("controls"),h=p("scenes"),d=p("camera"),f=new Float32Array(3),l=new Float32Array(3),g=110*Math.PI/180,m=70*Math.PI/180,k=70*Math.PI/180,x=70*-Math.PI/180;a.enable_camera_rotation=function(){var a=h.get_active_camera();c(a)}};b4w.module.mixer=function(a,p){function c(){n=A.length=0;u=b();e=new Float32Array(u.length);O=new Float32Array(u.length);var a=z.get_speaker_objects();if(a.length){A.push(h());for(var c=0;c<a.length;c++)A.push(f(a[c]));A.sort(function(a,b){return"MASTER"==a.id?-1:"MASTER"==b.id?1:"COMPRESSOR"==a.id?-1:"COMPRESSOR"==b.id?1:a.id.toUpperCase()<b.id.toUpperCase()?-1:a.id.toUpperCase()>b.id.toUpperCase()?1:0})}}function b(){for(var a=new Float32Array(100),b=0,c=0;100>c;c++)a[c]=20*Math.pow(1E3,b),b+=1/
99;return a}function h(){var a=d("MASTER");a.L.push(["VOLUME",z.get_volume(null),0,1,50,!1]);var b=z.get_compressor_params();b&&(a.L.push(["THRESHOLD",b.threshold,-100,0,100,!1]),a.L.push(["KNEE",b.knee,0,40,40,!1]),a.L.push(["RATIO",b.ratio,1,20,20,!1]),a.L.push(["ATTACK",b.attack,0,1,1E3,!1]),a.L.push(["RELEASE",b.release,0,1,1E3,!1]));a.mute=z.is_muted(null)?1:0;a.Jc=-1;return a}function d(a){return{id:a,L:[],of:0,mute:-1,Jc:-1,qa:null}}function f(a){var b=d(q.get_object_name(a));b.mute=z.is_muted(a)?
1:0;b.Jc=0;b.qa=a;return b}function l(a){if(a.qa){a.L.length=0;a.L.push(["VOLUME",z.get_volume(a.qa),0,1,50,!1]);var b=z.get_positional_params(a.qa);b&&(a.L.push(["DIST_REF",b.dist_ref,0,1E3,1E4,!1]),a.L.push(["ATTENUATION",b.attenuation,0,50,1E3,!1]),a.L.push(["DIST_MAX",b.dist_max,0,1E4,1E4,!1]));if(b=z.get_filter_params(a.qa))a.L.push(["EQ_FREQ",b.freq,20,2E4,100,!0]),a.L.push(["EQ_Q",b.Q,0,10,100,!1]),a.L.push(["EQ_GAIN",b.gain,-70,30,100,!1]);E.clamp(a.of,0,a.L.length-1)}}function g(a){for(var b=
0;b<A.length;b++){var c=A[b];if(c!=a&&1==c.Jc)return!0}return!1}function m(a){for(var b=0;b<A.length;b++){var c=A[b];c!=a&&0==c.mute&&0==c.Jc&&z.mute(c.qa,!1)}}function k(){if(0==A.length)return[0,-1];var a=8*Math.floor(n/8),b=a+7,a=E.clamp(a,0,A.length-1),b=E.clamp(b,0,A.length-1);return[a,b]}var x=p("controls");p("debug");var r=p("hud"),q=p("scenes"),z=p("sfx"),E=p("util"),A=[],n=0,u=null,e=null,O=null;a.enable_mixer_controls=function(){function a(b,c,d){if(1==d){var e=Boolean(x.get_sensor_value(b,
c,2))?-1:1,f=A[n];if(f)switch(d=f.L[f.of],d[1]=d[5]?d[1]*Math.pow(d[3]/d[2],e/d[4]):d[1]+(d[3]-d[2])/d[4]*e,d[1]=E.clamp(d[1],d[2],d[3]),d[0]){case "VOLUME":"MASTER"!=f.id?z.set_volume(f.qa,d[1]):z.set_volume(null,d[1]);break;case "DIST_REF":e=z.get_positional_params(f.qa);e.dist_ref=d[1];z.set_positional_params(f.qa,e);break;case "ATTENUATION":e=z.get_positional_params(f.qa);e.attenuation=d[1];z.set_positional_params(f.qa,e);break;case "DIST_MAX":e=z.get_positional_params(f.qa);e.dist_max=d[1];z.set_positional_params(f.qa,
e);break;case "EQ_FREQ":e=z.get_filter_params(f.qa);e.freq=d[1];z.set_filter_params(f.qa,e);break;case "EQ_Q":e=z.get_filter_params(f.qa);e.Q=d[1];z.set_filter_params(f.qa,e);break;case "EQ_GAIN":e=z.get_filter_params(f.qa);e.gain=d[1];z.set_filter_params(f.qa,e);break;case "THRESHOLD":f=z.get_compressor_params();f.threshold=d[1];z.set_compressor_params(f);break;case "KNEE":f=z.get_compressor_params();f.knee=d[1];z.set_compressor_params(f);break;case "RATIO":f=z.get_compressor_params();f.ratio=d[1];
z.set_compressor_params(f);break;case "ATTACK":f=z.get_compressor_params();f.attack=d[1];z.set_compressor_params(f);break;case "RELEASE":f=z.get_compressor_params();f.release=d[1];z.set_compressor_params(f);break;default:throw"Unknown strip param";}"INC_DEC"==c?x.reset_timer_sensor(b,c,6,.35):x.reset_timer_sensor(b,c,6,.05)}else x.reset_timer_sensor(b,c,6,10)}function b(a,c,d){if(1==d){d=Boolean(x.get_sensor_value(a,c,0))?-1:1;if(A.length){1==d&&n<A.length-1?n++:-1==d&&0<n&&n--;d=k();for(var e=d[0];e<=
d[1];e++)l(A[e])}"SWITCH_STRIP"==c?x.reset_timer_sensor(a,c,5,.15+.3):x.reset_timer_sensor(a,c,5,.15)}else x.reset_timer_sensor(a,c,5,10)}c();var d=x.create_keyboard_sensor(x.KEY_LEFT_SQ_BRACKET),f=x.create_keyboard_sensor(x.KEY_RIGHT_SQ_BRACKET),h=x.create_keyboard_sensor(x.KEY_SEMI_COLON),p=x.create_keyboard_sensor(x.KEY_SINGLE_QUOTE),q=x.create_keyboard_sensor(x.KEY_SHIFT),K=x.create_timer_sensor(.15,!0),M=x.create_timer_sensor(.05,!0),d=[d,f,h,p,q,K,M];x.create_sensor_manifold(null,"SWITCH_STRIP",
x.CT_TRIGGER,d,function(a){return(a[0]||a[1])&&!a[4]},b);x.create_sensor_manifold(null,"SWITCH_STRIP_HOLD",x.CT_SHOT,d,function(a){return(a[0]||a[1])&&!a[4]&&a[5]},b);x.create_sensor_manifold(null,"SWITCH_PARAM",x.CT_SHOT,d,function(a){return(a[0]||a[1])&&a[4]},function(a,b){var c=Boolean(x.get_sensor_value(a,b,0))?-1:1,d=A[n];d&&(1==c&&d.of<d.L.length-1?d.of++:-1==c&&0<d.of&&d.of--)});x.create_sensor_manifold(null,"INC_DEC",x.CT_TRIGGER,d,function(a){return(a[2]||a[3])&&!a[4]},a);x.create_sensor_manifold(null,
"INC_DEC_HOLD",x.CT_SHOT,d,function(a){return(a[2]||a[3])&&!a[4]&&a[6]},a);x.create_sensor_manifold(null,"MUTE_SOLO",x.CT_SHOT,d,function(a){return(a[2]||a[3])&&a[4]},function(a,b){if(Boolean(x.get_sensor_value(a,b,2))){var c=A[n];c&&0<=c.mute&&("MASTER"!=c.id?0==c.mute?(c.mute=1,z.mute(c.qa,!0),1==c.Jc&&(c.Jc=0,g(c)||m(c))):(c.mute=0,g(c)||z.mute(c.qa,!1)):0==c.mute?(c.mute=1,z.mute(null,!0)):(c.mute=0,z.mute(null,!1)))}else if((c=A[n])&&0<=c.Jc)if(0==c.Jc){c.Jc=1;z.mute(c.qa,!1);1==c.mute&&(c.mute=
0);for(var d=0;d<A.length;d++){var e=A[d];e!=c&&0==e.mute&&0==e.Jc&&z.mute(e.qa,!0)}}else c.Jc=0,g(c)?z.mute(c.qa,!0):m(c)});d=x.create_elapsed_sensor();x.create_sensor_manifold(null,"MIXER_DRAW",x.CT_CONTINUOUS,[d],null,function(){if(A[n])for(var a=k(),b=a[0];b<=a[1];b++){var c=A[b];r.draw_mixer_strip(c.id,b==n,b%8,c.L,c.of,c.mute,c.Jc);if(c.qa&&z.get_filter_params(c.qa)){z.get_filter_freq_response(c.qa,u,e,O);for(c=0;c<e.length;c++)e[c]=20*Math.log(e[c])/Math.LN10;r.plot_array("EQ",b%8,e,20,2E4,
-10,10)}}});d=x.create_timer_sensor(1,!0);x.create_sensor_manifold(null,"MIXER_UPDATE",x.CT_TRIGGER,[d],null,function(){for(var a=k(),b=a[0];b<=a[1];b++)l(A[b])})}};b4w.module.npc_ai=function(a,p){function c(a,b){var c=b.destination,d=n;E.get_translation(b.empty,d);var f=u;E.get_translation(b.collider,f);var h=0;b.Hh?h=b.Hh:b.ie&&(h=b.ie,b.type==y&&(h*=.5),b.type==C&&(h*=a));switch(b.type){case y:if(b.random&&b.Oe){c[0]=(12*Math.random()-6)*b.speed+d[0];c[2]=(12*Math.random()-6)*b.speed+d[2];var p=F,d=e,q=b.speed,z=b.rot_speed;E.get_rotation(b.collider,p);g.transformQuat(r.AXIS_Z,p,d);d[1]=0;g.normalize(d,d);p=.5*q/Math.sin(z/2);q=g.dist(c,f);q<2*p&&g.scaleAndAdd(c,
d,2*p-q,c);b.Oe=!1}c[1]=f[1];h&&(c[1]+=h);break;case L:case C:b.random&&b.Oe&&(b.type==C?(b.speed=Math.random()+.1,p=b.qy-b.wy):p=b.max_height-b.min_height,c[0]=10*Math.random()-5+d[0],c[1]=f[1]+(Math.random()*p-.5*p),c[2]=10*Math.random()-5+d[2],b.Oe=!1),h&&(c[1]=f[1]+h)}var c=n,d=u,q=e,f=t,x=b.rig,p=b.collider,h=b.destination,A=b.speed,Z=b.actions,T=k.get_current_anim_name(x);if(!k.is_play(x)||!Z.hi||-1==Z.hi.indexOf(T)){E.get_translation(p,c);var z=h[0]-c[0],aa=h[2]-c[2],z=Math.sqrt(z*z+aa*aa);
if(z>2*A*a)b.state=20,r.xz_direction(h,c,q),Z=b.rig,k.is_animated(Z)&&(x=b.speed,A=k.get_frame(Z),Z=k.get_anim_length(Z),x*=Z/24*(1-A/Z),.9>z/x&&g.scaleAndAdd(h,q,x-z,h)),z=F,x=O,E.get_rotation(b.collider,z),g.transformQuat(r.AXIS_Z,z,d),x[0]=d[0],x[1]=0,x[2]=d[2],g.normalize(x,x),A=g.dot(x,q),Z=a/(Math.abs(Math.acos(A))/Math.PI)*b.rot_speed*b.mn,m.rotationTo(x,q,f),m.rotationTo(r.AXIS_Z,x,z),1<=Math.abs(A)?m.copy(z,f):(m.multiply(f,z,f),m.slerp(z,f,Math.min(Z,1),f)),q=a,b.type!=L&&(q=Math.max(q,
1/60),z=I,x=F,m.setAxisAngle(r.AXIS_X,-Math.asin(d[1]),x),m.setAxisAngle(r.AXIS_X,-Math.atan(b.ie/(b.speed*q)),z),m.slerp(x,z,q,z),m.multiply(f,z,f)),E.set_rotation_v(p,f),d=e,p=O,r.quat_to_dir(f,r.AXIS_Z,d),g.scale(d,b.speed*a,p),g.add(p,c,p),p[1]=b.type!=y?(h[1]-c[1])*a*.1+c[1]:h[1],E.set_translation_v(b.collider,p);else if(b.type==y)Z.move?T&&-1!=Z.move.indexOf(T)&&k.is_play(x)?b.state=20:(b.state=10,b.Oe=!0):(b.state=10,b.Oe=!0);else if(b.type==C||b.type==L)b.Oe=!0;if(l(b)&&(c=b.rig,!k.is_play(c))){f=
null;switch(b.state){case 10:f=b.actions;f=f.hi?r.random_from_array(f.hi):null;break;case 20:f=k.get_current_anim_name(b.rig),d=h=b.actions,d.$d&&-1==d.$d.indexOf(f)&&d.move&&-1!=d.move.indexOf(f)&&.33<Math.random()?(h=b.actions,f=h.$d[h.move.indexOf(f)]):(d=b.actions,d.move&&(-1!=d.move.indexOf(f)||!d.$d&&!d.Ie||!d.Ie&&!f||d.$d&&-1!=d.$d.indexOf(f)||d.Ie&&-1!=d.Ie.indexOf(f))?(h=b.actions,h.$d?(d=h.$d.indexOf(f),-1!=d?(f=d+1,f=f<h.move.length?f:0,f=h.move[f]):f=-1!=h.move.indexOf(f)?f:r.random_from_array(h.move)):
f=r.random_from_array(h.move)):(d=b.actions,f=d.Ie&&-1==d.Ie.indexOf(f)&&d.move&&-1==d.move.indexOf(f)?r.random_from_array(h.Ie):null))}f&&(k.apply(c,f),k.set_behavior(c,k.AB_FINISH_RESET),k.set_frame(c,0),k.play(c))}}}function b(a,b,c,d){if(d)if(1==c)switch(d.type){case L:a:{for(c=0;3>c;c++){var e=x.get_sensor_payload(a,b,c);if(e){b=e;break a}}b=void 0}a=100*b;d.ie=a<d.min_height?10:a>d.max_height?-10:0;break;case y:a=x.get_sensor_payload(a,b,0);d.ie=d.Br==a?0:1-100*a;d.Br=a;break;case C:a=x.get_sensor_payload(a,
b,0),"CLOSE_GROUND"==b?(d.ie=100*a-1,d.ie=.1>d.ie?.05:0):"CLOSE_WATER"==b&&(d.Hh=100*a,d.Hh=d.Hh<d.wy?-.02:d.Hh>d.qy?.02:0)}else d.ie=0}function h(){for(var a=0;a<A.length;a++){var b=A[a];d(b);f(b);b.rig&&k.get_current_anim_name(b.rig)&&k.play(b.rig)}}function d(a){var c=[0,0,0],d=a.collider;switch(a.type){case L:var e=x.create_ray_sensor(d,c,[0,-100,0],!1,"TERRAIN"),f=x.create_ray_sensor(d,c,[0,-100,0],!1,"STONE"),c=x.create_ray_sensor(d,c,[0,-100,0],!1,"WATER"),e=[e,f,c];x.create_sensor_manifold(d,
"CLOSE_GROUND",x.CT_CONTINUOUS,e,function(a){return a[0]||a[1]||a[2]},b,a);break;case y:e=x.create_ray_sensor(d,[0,1,0],[0,-99,0],!1,"TERRAIN");e=[e];x.create_sensor_manifold(d,"CLOSE_GROUND",x.CT_CONTINUOUS,e,null,b,a);break;case C:e=x.create_ray_sensor(d,[0,1,0],[0,-99,0],!1,"TERRAIN"),c=x.create_ray_sensor(d,[0,0,0],[0,100,0],!1,"WATER"),e=[e],x.create_sensor_manifold(d,"CLOSE_WATER",x.CT_CONTINUOUS,[c],null,b,a),x.create_sensor_manifold(d,"CLOSE_GROUND",x.CT_CONTINUOUS,e,null,b,a)}}function f(a){function b(c,
d,e){1==e?(E.get_translation(a.empty,a.destination),a.mn=4):a.mn=1}var c=a.collider;if(a.type==y){var d=x.create_collision_sensor(c,"CONSTRUCTION",!1);x.create_sensor_manifold(c,"CONSTRUCTION_COLL",x.CT_CONTINUOUS,[d],null,b)}}function l(a){var b=a.rig;if(!k.is_play(b))return!0;b=k.get_current_anim_name(b);if(!b)return!0;var c=a.actions;switch(a.state){case 10:if(!c.hi)return!1;if(-1==c.hi.indexOf(b))break;break;case 20:if(!c.move||-1!=c.move.indexOf(b)||c.Ie&&-1!=c.Ie.indexOf(b)||c.$d&&-1!=c.$d.indexOf(b))return!1;
break;default:return!1}return!0}var g=p("vec3"),m=p("quat"),k=p("animation"),x=p("controls"),r=p("util"),q=p("scenes"),z=p("main"),E=p("transform"),A=[];new Float32Array(9);var n=new Float32Array(3),u=new Float32Array(3),e=new Float32Array(3),O=new Float32Array(3),I=new Float32Array(4),F=new Float32Array(4),t=new Float32Array(4),y=a.NT_WALKING=10,L=a.NT_FLYING=20,C=a.NT_SWIMMING=30;a.new_event_track=function(a){a.destination=new Float32Array(3);a.start=[];a.ended=[];a.Ij=[];a.ie=null;a.Br=null;a.Hh=
null;a.Oe=!0;a.mn=1;if(!a.random)for(var b=0;b<a.path.length;b++)a.start[b]=-1,a.ended[b]=!1,a.Ij[b]=!1;A.push(a)};a.enable_animation=function(){if(A.length){h();var a=x.create_elapsed_sensor();x.create_sensor_manifold(A[0].collider,"ELAPSED",x.CT_CONTINUOUS,[a],function(a){return a[0]},function(a,b,d){if(1==d)for(a=x.get_sensor_value(a,b,0),b=0;b<A.length;b++){d=A[b];var e=a;if(q.is_visible(d.obj))if(d.random)c(e,d);else{for(var f=z.global_timeline(),g=0;g<d.path.length;g++)if(!d.ended[g]){d.Ij[g]||
(d.Ij[g]=!0,d.destination[0]=d.path[g][0],d.destination[1]=d.path[g][1],d.destination[2]=d.path[g][2],d.start[g]=f+d.delay[g]);if(f<d.start[g])break;c(e,d);d.ended[g]=d.Oe;break}a:{for(e=0;e<d.path.length;e++)if(0==d.ended[e]){e=!1;break a}e=!0}if(e)for(e=0;e<d.path.length;e++)d.Ij[e]=!1,d.ended[e]=!1}}})}};a.disable_animation=function(){if(!(0>=A.length))for(var a=0;a<A.length;a++){var b=A[a];x.check_sensor_manifolds(b.collider)&&x.remove_sensor_manifold(b.collider);k.is_play(b.rig)&&k.stop(b.rig)}}};b4w.module.mouse=function(a,p){function c(){1==C&&(C=0);var a=document.exitPointerLock||document.webkitExitPointerLock||document.mozExitPointerLock;"function"===typeof a&&a.apply(document)}function b(a){2==C&&(C=0);a.removeEventListener("mousedown",d,!1);a.removeEventListener("mouseup",f,!1);a.removeEventListener("mousemove",h,!1)}function h(a){y()&&(F[0]+=2*(a.clientX-O),F[1]+=2*(a.clientY-I),O=a.clientX,I=a.clientY);a.preventDefault()}function d(a){O=a.clientX;I=a.clientY;a.currentTarget.addEventListener("mousemove",
h,!1);a.preventDefault()}function f(a){a.currentTarget.removeEventListener("mousemove",h,!1);a.preventDefault()}function l(a,b){if(.01<Math.abs(F[0])||.01<Math.abs(F[1])){var c=z.get_sensor_value(a,b,0),d=u.smooth(F[0],0,c,.1),e=u.smooth(F[1],0,c,.1),c=n.get_first_character(),f=n.get_active_camera();q.rotate_eye_camera(f,4E-4*-d,4E-4*-e);F[0]-=d;F[1]-=e;c&&(d=q.get_camera_angles_char(f,t),E.set_character_rotation(c,d[0],d[1]))}}function g(){e.detect_mobile()||e.get_canvas_elem().addEventListener("mousemove",
k)}function m(){e.detect_mobile()||(e.get_canvas_elem().removeEventListener("mousemove",k),L&&n.set_outline_intensity(L,0))}function k(a){(a=n.pick_object(x(a),r(a)))?(n.outlining_is_enabled(a)&&n.set_outline_intensity(a,1),n.outlining_is_enabled(L)&&a!=L&&n.set_outline_intensity(L,0)):n.outlining_is_enabled(L)&&n.set_outline_intensity(L,0);L=a}function x(a){return a.clientX||a.touches&&a.touches[0].pageX||-1}function r(a){return a.clientY||a.touches&&a.touches[0].pageY||-1}var q=p("camera"),z=p("controls"),
E=p("physics"),A=p("print"),n=p("scenes"),u=p("util"),e=p("main"),O=0,I=0,F=new Float32Array(2),t=new Float32Array(2),y=null,L=null,C=0;a.request_pointerlock=function(a,c,d,e,f){function g(){if(document.pointerLockElement===a||document.webkitPointerLockElement===a||document.mozPointerLockElement===a){b(a);a.addEventListener("mousemove",e,!1);var f=n.get_active_camera();if(!z.check_sensor_manifold(f,"SMOOTH_PL")){var h=z.create_elapsed_sensor();z.create_sensor_manifold(f,"SMOOTH_PL",z.CT_CONTINUOUS,
[h],null,l)}c()}else a.removeEventListener("mousemove",e,!1),C=0,document.removeEventListener("pointerlockchange",g,!1),document.removeEventListener("webkitpointerlockchange",g,!1),document.removeEventListener("mozpointerlockchange",g,!1),d()}if(1!=C){C=1;c=c||function(){};d=d||function(){};f=f||function(){return!0};e=e||function(a){if(f()){var b=a.movementY||a.webkitMovementY||a.mozMovementY||0;F[0]+=a.movementX||a.webkitMovementX||a.mozMovementX||0;F[1]+=b}};document.addEventListener("pointerlockchange",
g,!1);document.addEventListener("webkitpointerlockchange",g,!1);document.addEventListener("mozpointerlockchange",g,!1);var h=a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock;"function"===typeof h?h.apply(a):A.error("Pointer lock is not available")}};a.exit_pointerlock=c;a.check_pointerlock=function(a){return"function"===typeof(a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock)?!0:!1};a.request_mouse_drag=function(a,b){if(2!=C){C=2;c();y=b||function(){return!0};
a.addEventListener("mousedown",d,!1);a.addEventListener("mouseup",f,!1);var e=n.get_active_camera();if(!z.check_sensor_manifold(e,"SMOOTH_DRAG")){var g=z.create_elapsed_sensor();z.create_sensor_manifold(e,"SMOOTH_DRAG",z.CT_CONTINUOUS,[g],null,l)}}};a.exit_mouse_drag=b;a.enable_mouse_hover_outline=g;a.enable_mouse_hover_glow=function(){A.error("enable_mouse_hover_glow() deprecated, use enable_mouse_hover_outline() instead");g()};a.disable_mouse_hover_outline=m;a.disable_mouse_hover_glow=function(){A.error("disable_mouse_hover_glow() deprecated, use disable_mouse_hover_outline() instead");
m()};a.get_coords_x=x;a.get_coords_y=r};b4w.module.preloader=function(a,p){var c=p("app"),b,h,d,f,l,g,m,k,x,r=null;a.create_simple_preloader=function(a){var c=null,k=null,m="#bf9221",n="#000",p;for(p in a)switch(p){case "canvas_container_id":c=a.canvas_container_id;break;case "background_container_id":k=a.background_container_id;break;case "bg_color":n=a.bg_color;break;case "bar_color":m=a.bar_color;break;case "preloader_fadeout":b=a.preloader_fadeout}a=document.createElement("div");p=document.createElement("div");a.id="simple_preloader_container";
var e=document.createElement("div"),x=document.createElement("div"),k=document.getElementById(k);r=document.getElementById(c);a.style.cssText="z-index: 4;background-color: "+n+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;";p.style.cssText="position: absolute;left: 50%;top: 82%;width: 300px;height: 20px;margin-left: -150px;margin-top: -10px;border-style:solid;border-width:4px;border-color: #000;border-radius: 0px;";e.style.cssText="position: absolute;left: 0px;top: 1px;width: 0px;height: 18px;background-color: "+
m+";border-radius: 0px;";x.style.cssText="position: absolute;left: 50%;top: 50%;width: 100%;height: 100%;margin-left: -150px;margin-top: -10px;text-align: center;font-size: 17px;font-weight: bold;color: #000;font-family: Verdana;"+p.appendChild(e);p.appendChild(x);a.appendChild(p);document.body.appendChild(a);h="SIMPLE";d=a;f=e;l=x;g=k};a.create_rotation_preloader=function(a){var b=null,c=null,f="rgba(0,0,0,0)",k="",p="",e="rgba(0,0,0,0)",x;for(x in a)switch(x){case "canvas_container_id":b=a.canvas_container_id;
break;case "background_container_id":c=a.background_container_id;break;case "frame_bg_color":f=a.frame_bg_color;break;case "bg_color":e=a.bg_color;break;case "frame_class":k=a.frame_class;break;case "anim_elem_class":p=a.anim_elem_class}a=document.createElement("div");x=document.createElement("div");var I=document.createElement("div"),F=document.createElement("div"),c=document.getElementById(c);r=document.getElementById(b);a.style.cssText="z-index: 4;background-color: "+e+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;";
x.style.cssText="position: absolute;left: 50%;top: 50%;width: 117px;height: 117px;margin-left: -58px;margin-top: -58px;background-color: "+f+";";I.style.cssText="position: absolute;left: 0px;top: 0px;width: 100%;height: 100%;background-position: center;background-repeat: no-repeat;";F.style.cssText="position: absolute;width: 100%;height: 100%;text-align: center;margin-top: 38px;font-size: 36px;color: #ffffff;font-family: Arial;font-weight: bold;";I.className=p;x.appendChild(I);x.className=k;x.appendChild(F);
a.appendChild(x);r.appendChild(a);h="ROTATION";d=a;m=I;l=F;g=c};a.create_advanced_preloader=function(a){var b=a.preloader_width,b=b/(b-a.img_width),c=document.getElementById(a.preloader_bar_id),m=document.getElementById(a.fill_band_id),n=document.getElementById(a.preloader_caption_id),p=document.getElementById(a.preloader_container_id),e=document.getElementById(a.background_container_id);r=document.getElementById(a.canvas_container_id);h="ADVANCED";f=c;k=m;x=b;l=n;d=p;g=e};a.update_preloader=function(a){l.innerHTML=
a+"%";"SIMPLE"==h&&(f.style.width=a+"%");"ADVANCED"==h&&(f.style.width=a/x+"%",k.style.width=100-a+"%");"ROTATION"==h&&(m.style.transform="rotate("+a+"deg)");100==a&&(b?(c.css_animate(g,"opacity",1,0,1500,null,null,function(){g.parentNode.removeChild(g)}),c.css_animate(d,"opacity",1,0,1E3,null,null,function(){d.parentNode.removeChild(d)})):(d.parentNode.removeChild(d),g&&g.parentNode.removeChild(g)))}};b4w.module.storage=function(a,p){function c(a){d=a;try{f=window.localStorage}catch(b){h.warn("Applying chrome localStorage bug workaround"),f=null}f||(h.warn("localStorage is not available, initializing temporary storage"),f={})}function b(){return f[d]?JSON.parse(f[d]):{}}var h=p("__print"),d="",f=null;a.init=c;a.set=function(a,c){var h=b();h[a]=String(c);f[d]=JSON.stringify(h)};a.cleanup=function(){delete f[d]};a.get=function(a){var c=b();return c[a]?c[a]:""};a.debug=function(){h.log(b())};c("b4w")};b4w.module.screenshooter=function(a,p){var c=p("main");a.shot=function(){c.canvas_data_url(function(a){var c=window.document.createElement("a");document.body.appendChild(c);c.style="display: none";c.href=a;c.download="screenshot.png";c.click();document.body.removeChild(c)})}};
